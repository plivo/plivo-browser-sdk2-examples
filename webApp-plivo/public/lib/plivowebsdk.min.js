/* Name: JsSIP Maintainer: José Luis Millán <jmillan@aliax.net> Copyright (c) 2012-2016 José Luis Millán <jmillan@aliax.net> License: The MIT License Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions: The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.*/
/*Copyright (c) 2013-2016, callstats.io All rights reserved.THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.*/
"use strict";var _createClass=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var Plivo=function o(s,a,l){function u(n,e){if(!a[n]){if(!s[n]){var t="function"==typeof require&&require;if(!e&&t)return t(n,!0);if(c)return c(n,!0);var r=new Error("Cannot find module '"+n+"'");throw r.code="MODULE_NOT_FOUND",r}var i=a[n]={exports:{}};s[n][0].call(i.exports,function(e){var t=s[n][1][e];return u(t||e)},i,i.exports,o,s,a,l)}return a[n].exports}for(var c="function"==typeof require&&require,e=0;e<l.length;e++)u(l[e]);return u}({1:[function(i,e,t){var s,n=i("util").inherits,o=i("events").EventEmitter,u=i("./util/constants"),c=i("./util/codecPreference"),a=i("./util/callAnalytics"),l=i("./util/logger"),d=i("./media/audioDevice"),f=i("./media/document"),h=i("./util/headers"),p=i("./util/validateOptions");function v(n){if("object"==_typeof(window._PlivoInstance))return Plivo.log.info("window.Plivo object and its instance already exist"),window._PlivoInstance;if(!(this instanceof v))return new v(n);var r=this,e={codecs:u.DEFAULT_CODECS,enableTracking:!0,debug:"INFO",permOnClick:!1,enableIPV6:!1,audioConstraints:!0,dscp:!0,appId:null,appSecret:null,registrationDomainSocket:null,clientRegion:null,preDetectOwa:!1,disableRtpTimeOut:!1};if(this.permOnClick=!1,this.ringToneFlag=!0,this.ringToneBackFlag=!0,this.connectToneFlag=!0,this.isLoggedIn=!1,this.localStorage="undefined"!=typeof chrome&&chrome.storage?chrome.storage.local:window.localStorage,this.log=new l({enableDate:!0,loggingName:"PlivoSDK",logMethod:"DEBUG"}),Plivo.log=r.log,void 0!==n)for(var t in n)switch(t){case"enableTracking":p.isBoolean(t,n[t])&&(e.enableTracking=n[t]);break;case"debug":n[t]=n[t].toUpperCase(),p.debug(n[t],u.DEBUG_MODES)?(e.debug=n[t],"ALL-PLAIN"==n[t]&&(n[t]="ALL"),r.log.setLevel(n[t])):r.log.setLevel("INFO");break;case"permOnClick":p.isBoolean(t,n[t])&&(r.permOnClick=n[t],e.permOnClick=n[t]);break;case"audioConstraints":n[t]&&(e.audioConstraints=n[t]);break;case"dscp":p.isBoolean(t,n[t])&&(e.dscp=n[t]);break;case"codecs":p.codecs(n[t],u.DEFAULT_CODECS)&&(e.codecs=n[t]);break;case"appSecret":e.appSecret=n[t];break;case"appId":e.appId=n[t];break;case"registrationDomainSocket":e.registrationDomainSocket=n[t];break;case"enableIPV6":break;case"clientRegion":p.region(n[t],u.REGION)&&(e.clientRegion=n[t]);break;case"preDetectOwa":p.isBoolean(t,n[t])&&(e.preDetectOwa=n[t]);break;case"disableRtpTimeOut":p.isBoolean(t,n[t])&&(e.disableRtpTimeOut=n[t]);break;default:Plivo.log.warn("Ignoring invalid option key "+t)}-1!=["ALL","ALL-PLAIN"].indexOf(e.debug)?(this.localStorage.debug="PlivoSIP:*",window._PlivoUseColorLog=!0,"ALL-PLAIN"==e.debug&&(window._PlivoUseColorLog=!1)):this.localStorage.debug="",o.call(this),s=i("../sipLib/JsSIP"),this.phone=null,this.callSession=null,this.callUUID=null,this.lastCallUUID=null,this.callDirection=null,this.callStats=null,this.userName=null,this.options=e,this.audio={availableDevices:d.availableDevices,ringtoneDevices:d.ringtoneDevices,microphoneDevices:d.inputDevices,speakerDevices:d.outputDevices,revealAudioDevices:d.revealAudioDevices},this.audioConstraints=this.options.audioConstraints,this.browserDetails=s.adapter.browserDetails,this.owaLastDetect={time:0,isOneWay:!0},this.owaDetectTime=36e5,this.connStage=[],this.str=function(e){return JSON.stringify(e)},Plivo.audioConstraints=this.audioConstraints,Plivo.AppError=function(e,t){var n;return r.userName&&r.callStats&&(n=r.callUUID?r.callUUID:r.userName,"[object Object]"==Object.prototype.toString.call(e)&&(e=JSON.stringify(e)),t&&Plivo.log.debug("Call summary "+n+"\n",e),r.callStats.reportError(null,n,r.callStats.webRTCFunctions.applicationLog,e)),!0},f.setup(r.options,function(e){if(window.RTCPeerConnection||(Plivo.log.error("No webRTC support"),document.onreadystatechange=function(){"complete"==document.readyState&&r.emit("onWebrtcNotSupported")}),r.emit("onMediaPermission",e),"failure"==e.status&&r.userName&&r.callStats){var t=new DOMError("getUserMedia Error",e.error);r.callStats.reportError(null,r.userName,r.callStats.webRTCFunctions.getUserMedia,t)}"success"==e.status&&e.stream&&d.audioDevDictionary.call(r,!0).then(function(){Plivo.log.debug("audioDevDictionary is updated onMediaPermission: "+e.status)}),r.remoteView=document.getElementById(u.REMOTE_VIEW_ID),r.ringToneView=document.getElementById(u.RINGTONE_ELEMENT_ID),r.ringBackToneView=document.getElementById(u.RINGBACK_ELEMENT_ID),r.connectToneView=document.getElementById(u.CONNECT_TONE_ELEMENT_ID),Plivo.log.info("PlivoWebSdk initialized in "+r.log.level()+" mode, version: 2.0.20"),Plivo.log.debug("PlivoWebSdk initialized with ",r.str(n)),Plivo.log.info(r.str(r.browserDetails))}),navigator.mediaDevices.ondevicechange=function(e){d.checkAudioDevChange.call(r)},"chrome"==s.adapter.browserDetails.browser&&s.adapter.browserDetails.version<57&&setInterval(function(){d.checkAudioDevChange.call(r)},5e3),r.audioDevDic=null,d.audioDevDictionary.call(this,!0),window._PlivoInstance=this}n(v,o),v.prototype.login=function(n,e){if(void 0===n||void 0===e||null===n||null===e&&(n.length<=0||e.length<=0))return Plivo.log.error("username & password cant be null"),this.emit("onLoginFailed","Username and password must be filled out"),!1;this.phone&&(this.phone.stop(),delete this.phone,Plivo.log.debug("deleting the existing phone instance")),this.options.registrationDomainSocket&&(u.WS_SERVERS=this.options.registrationDomainSocket);var t={sockets:[new s.WebSocketInterface(u.WS_SERVERS)],register_expires:u.REGISTER_EXPIRES_SECONDS,uri:n+"@"+u.DOMAIN,password:e,googIPv6:this.enableIPV6||!1,connection_recovery_max_interval:u.WS_RECOVERY_MAX_INTERVAL,connection_recovery_min_interval:u.WS_RECOVERY_MIN_INTERVAL,session_timers:!1};try{this.phone=new s.UA(t)}catch(e){return Plivo.log.debug("Failed to create user agent"+e),!1}Plivo.log.info("Ready to login");var o=this,r=!1;return this.phone.on("connected",function(e){Plivo.log.info("websocket connection established",e),r||(r=!0,o.emit("onConnectionChange",{state:"connected"}))}),this.phone.on("disconnected",function(e){if(Plivo.log.info("websocket connection closed",e),r&&e&&1e3<e.code){var t={state:"disconnected",eventCode:e.code,eventReason:e.reason};o.emit("onConnectionChange",t)}r=!1}),this.phone.on("registered",function(){if(o.userName=n,!1===o.isLoggedIn&&(o.isLoggedIn=!0,o.emit("onLogin"),Plivo.log.debug("logged in"),o.options.enableTracking&&!o.callStats)){!o.options.appId&&(o.options.appId="380077084"),window.csioChromeLegacyGetStats=!0,o.callStats=new callstats;var e=function(e){var t=e.streams;a.call(o,m,t),window._PlivoDevLogging&&console.log(t)};if("chrome"!=s.adapter.browserDetails.browser&&(e=null),o.callStats){var t=o.options.appSecret||S(o);o.callStats.initialize(o.options.appId,t,n,function(e,t){Plivo.log.debug("Stats Initializing Status: err= "+e+" msg= "+t)},e,{disableBeforeUnloadHandler:!1,applicationVersion:"2.0.20"})}Plivo.log.debug("enableTracking initialized")}}),this.phone.on("unregistered",function(){Plivo.log.debug("Plivo client logged out"),o.isLoggedIn=!1,!o.ringToneView.paused&&f.stopAudio(u.RINGTONE_ELEMENT_ID),!o.ringBackToneView.paused&&f.stopAudio(u.RINGBACK_ELEMENT_ID),o.userName=null,o.emit("onLogout")}),this.phone.on("registrationFailed",function(e){o.isLoggedIn=!1,Plivo.log.debug("Login failed : ",e.cause),o.userName=null,o.emit("onLoginFailed",e.cause)}),this.phone.on("newRTCSession",function(e){if(Plivo.log.debug("new rtc session"),o.callSession&&"closed"==o.callSession.connection.signalingState&&(Plivo.log.warn("Previous call doesn't end properly"),o.callSession=null),o.callSession)Plivo.log.debug("Already on call, sending busy signal."),e.session.terminate({status_code:486,reason_phrase:"Busy Here"});else if(o.callSession=e.session,"remote"===e.originator){o.callDirection="incoming",Plivo.log.info("<----- INCOMING -----\x3e"),o.connStage=[],o.connStage.push("I-invite@"+_()),o.callUUID=e.request.getHeader("X-Calluuid")||null;var t=e.request.getHeader("From");o.caller=t.match(/:(.*)@/i)[1];try{e.request.body=c(o.options.codecs,e.request.body)}catch(e){Plivo.log.debug("checkCodecPreference err - ",e)}o.callSession.on("progress",function(e){Plivo.log.debug("Incoming call progress"),o.connStage.push("progress-180@"+_());var t=o.callSession.remote_identity.uri.toString();!1!==o.ringToneFlag&&(Plivo.log.debug("ringtone enabled : ",o.ringToneFlag),f.playAudio(u.RINGTONE_ELEMENT_ID)),o.emit("onIncomingCall",t.substring(4,t.indexOf("@"))+"@"+u.DOMAIN,i),Plivo.log.debug("Incoming Call Extra Headers : ",i)}),o.callSession.on("sdp",function(e){Plivo.log.debug("Incoming call SDP processing done")}),o.callSession.on("accepted",function(e){Plivo.log.info("Incoming call accepted"),b(o);var r=o.callSession.connection||null;r.oniceconnectionstatechange=function(e){var t=r.iceConnectionState;if(Plivo.log.debug("oniceconnectionstatechange:: "+t),o.connStage.push("iceConnectionState-"+t+"@"+_()),C.call(o,t),o.callStats&&o.callUUID&&r&&("failed"==t||"disconnected"==t)){var n=new DOMError(t,t);o.callStats.reportError(r,o.callUUID,o.callStats.webRTCFunctions.iceConnectionFailure,n)}}}),o.callSession.on("confirmed",function(e){Plivo.log.debug("Incoming call confirmed - "+o.callUUID),o.connStage.push("confirmed@"+_()),o.options.disableRtpTimeOut&&(o.callSession.connection.disableRtpTimeOut=!0);var t=this.connection.getRemoteStreams()[0];t||Plivo.log.error("Incoming call remoteStream does not exists"),o.remoteView.srcObject=t,o.callStats&&this.connection&&o.callStats.addNewFabric(this.connection,o.caller,o.callStats.fabricUsage.audio,o.callUUID,function(e){Plivo.log.debug("Stats new fabric message: "+e)}),!o.ringToneView.paused&&f.stopAudio(u.RINGTONE_ELEMENT_ID),!o.ringBackToneView.paused&&f.stopAudio(u.RINGBACK_ELEMENT_ID),o.emit("onCallAnswered"),Plivo.log.debug("Plivo Event: Post-Answer detecting OWA"),setTimeout(g,3e3,this.connection,o)}),o.callSession.on("icetimeout",function(e){Plivo.log.debug("iceGathering timed out"),m(o,"network","warning","ice_timeout",e,!0,"Possible NAT/Firewall issue")}),o.callSession.on("failed",function(e){if(Plivo.log.error("Call failed: "+e.cause),o.connStage.push("failed@"+_()),!o.ringToneView.paused&&f.stopAudio(u.RINGTONE_ELEMENT_ID),e.cause==s.C.causes.CANCELED&&"incoming"==o.callDirection?o.emit("onIncomingCallCanceled"):o.emit("onCallFailed",e.cause),o.callStats&&o.callUUID&&this.connection&&!e.cause.match("edia")){var t,n;e.message&&(n=t=e.cause,e.message.status_code&&(n=String(e.message.status_code)));var r=new DOMError(t,n);Plivo.log.debug(r),o.callStats.reportError(this.connection,o.callUUID,o.callStats.webRTCFunctions.signalingError,r)}E(o)}),o.callSession.on("ended",function(e){Plivo.log.debug("Incoming call ended - "+o.callUUID),Plivo.log.info("Incoming call ended"),o.connStage.push("ended@"+_()),o.callStats&&o.callStats.sendFabricEvent(this.connection,o.callStats.fabricEvent.fabricTerminated,o.callUUID),o.emit("onCallTerminated",{originator:e.originator,reason:e.cause}),E(o)}),o.callSession.on("getusermediafailed",function(e){Plivo.log.error("getusermediafailed: "+e),o.userName&&o.callStats&&(e.message="getusermediafailed",o.callStats.reportError(null,o.userName,o.callStats.webRTCFunctions.getUserMedia,e))}),o.callSession.on("peerconnection:createofferfailed",function(e){Plivo.log.error("peerconnection:createofferfailed: ",e),o.userName&&o.callStats&&(e.message="peerconnection:createofferfailed",o.callStats.reportError(null,o.userName,o.callStats.webRTCFunctions.createOffer,e))}),o.callSession.on("peerconnection:createanswerfailed",function(e){Plivo.log.error("peerconnection:createanswerfailed: ",e),o.userName&&o.callStats&&(e.message="peerconnection:createanswerfailed",o.callStats.reportError(null,o.userName,o.callStats.webRTCFunctions.createAnswer,e))}),o.callSession.on("peerconnection:setlocaldescriptionfailed",function(e){Plivo.log.error("peerconnection:setlocaldescriptionfailed: ",e),o.userName&&o.callStats&&(e.message="peerconnection:setlocaldescriptionfailed",o.callStats.reportError(null,o.userName,o.callStats.webRTCFunctions.setLocalDescription,e))}),o.callSession.on("peerconnection:setremotedescriptionfailed",function(e){Plivo.log.error("peerconnection:setremotedescriptionfailed: ",e),e.message&&"pranswer not yet implemented"==!e.message&&o.userName&&o.callStats&&o.callStats.reportError(null,o.userName,o.callStats.webRTCFunctions.setRemoteDescription,e)});var n=e.request,r=n.headers,i=h.receiveExtraHeader(n,r);Plivo.log.debug("callSession - "+o.callUUID)}else o.callDirection="outgoing",Plivo.log.debug("new RTCSession outgoing"),o.emit("onCalling")}),this.phone.start(),!0},v.prototype.logout=function(){return Plivo.log.debug("logout() triggered!"),this.callSession&&(Plivo.log.debug("Terminating an active call"),this.callSession.terminate()),this.connStage.push("logout()@"+_()),this.phone&&this.phone.stop(),!0},v.prototype.call=function(e,t){var n=this;if(Plivo.log.info("<----- OUTGOING -----\x3e"),n.connStage=[],Plivo.log.info("Outgoing call initialized to : "+e),!this.isLoggedIn)return Plivo.log.warn("Must be logged in before make a call"),!1;function r(e){return n.emit("onCallFailed",e),!0}function i(){return n.owaLastDetect.isOneWay=!1,y(n,t,e)}n.connStage.push("call()@"+_()),n.options.preDetectOwa&&"chrome"==n.browserDetails.browser&&(new Date-n.owaLastDetect.time>n.owaDetectTime||n.owaLastDetect.isOneWay)?T(function(e,t){return n.owaLastDetect.time=new Date,t?(Plivo.log.error("Error in detecting microphone status ",t),n.emit("onMediaPermission",{status:"failure",error:t.name}),r("media - "+t.name),!1):(Plivo.log.debug("getUserMedia precheck ",e),0==Number(e.bytesSent)&&0==Number(e.audioInputLevel)?(m(n,"audio","warning","no_microphone_access",0,!0,"chrome lost access to microphone - restart browser"),n.owaLastDetect.isOneWay=!0,r("no_microphone_access"),!1):(0==Number(e.audioInputLevel)&&m(n,"audio","warning","no_microphone_access",0,!0,"microphone is muted"),void i()))}):i()},v.prototype.answer=function(){Plivo.log.debug("answer - "+this.callUUID);var n=this,t={};if(!this.callSession)return Plivo.log.error("Incoming call answer() failed : no incoming call"),!1;var r=function(e){return n.reject(),!0},i=function(){if(n.owaLastDetect.isOneWay=!1,t.pcConfig={iceServers:[{urls:u.STUN_SERVERS}]},n.permOnClick){var e=n.options.audioConstraints||!0;t.mediaConstraints={audio:e,video:!1}}else window.localStream||Plivo.log.warn("no localStream attached for this call");t.mediaStream=window.localStream||null,t.rtcConstraints=n.options.dscp?{optional:[{googDscp:!0}]}:null,t.sessionTimersExpires=u.SESSION_TIMERS_EXPIRES;try{n.callSession&&n.callSession.answer(t)}catch(e){Plivo.log.error("error in answering : ",e),n.emit("onIncomingCallCanceled",e)}return!n.ringToneView.paused&&f.stopAudio(u.RINGTONE_ELEMENT_ID),!0};return n.connStage.push("answer()@"+_()),n.options.preDetectOwa&&"chrome"==n.browserDetails.browser&&(new Date-n.owaLastDetect.time>n.owaDetectTime||n.owaLastDetect.isOneWay)?T(function(e,t){return n.owaLastDetect.time=new Date,t?(Plivo.log.error("Error in detecting microphone status ",t),n.emit("onMediaPermission",{status:"failure",error:t.name}),r(t.name),!1):(Plivo.log.debug("getUserMedia precheck ",n.str(e)),0==Number(e.bytesSent)&&0==Number(e.audioInputLevel)?(m(n,"audio","warning","no_microphone_access",0,!0,"chrome lost access to microphone - restart browser"),n.owaLastDetect.isOneWay=!0,r(),!1):(0==Number(e.audioInputLevel)&&m(n,"audio","warning","no_microphone_access",0,!0,"microphone is muted"),void i()))}):i(),!0},v.prototype.hangup=function(){if(Plivo.log.debug("hangup - "+this.callUUID),!this.callSession)return Plivo.log.warn("No call session exists to hangup"),!1;"outgoing"==this.callSession.direction||w(this.callSession)||Plivo.log.warn("use of hangup() on unanswered call is deprecated. use reject() instead");try{Plivo.log.info("hangup initialized"),Plivo.AppError({name:"hangup",message:"hangup initialized",method:"hangup()"}),this.callSession.terminate(),!this.ringBackToneView.paused&&f.stopAudio(u.RINGBACK_ELEMENT_ID)}catch(e){Plivo.log.error("Could not hangup reason : ",e),Plivo.AppError({name:e.name,message:e.message,method:"hangup()"})}return!0},v.prototype.reject=function(){if(Plivo.log.debug("reject - "+this.callUUID),!this.callSession)return Plivo.log.warn("No call session exists to reject()"),!1;if(w(this.callSession))return Plivo.log.warn("call already answerd, please use hangup() method"),!1;if(this.callSession){Plivo.log.info("rejecting call"),Plivo.AppError({name:"reject",message:"reject initialized",method:"reject()"});try{this.callSession.terminate({status_code:486,reason_phrase:"Busy Here"})}catch(e){Plivo.log.error("error in rejecting call : ",e),Plivo.AppError({name:e.name,message:e.message,method:"reject()"})}return!this.ringToneView.paused&&f.stopAudio(u.RINGTONE_ELEMENT_ID),!0}},v.prototype.sendDtmf=function(e){if(Plivo.log.debug("sendDtmf - "+this.callUUID),void 0===e||null==e)return Plivo.log.warn("DTMF digit can not be null");if(void 0===u.DTMF_TONE_FLAG[e])return Plivo.log.warn(e+" is not a valid DTMF digit");if(this.callSession)try{return Plivo.log.debug("sending dtmf digit "+e),this.callSession.sendDTMF(e),"*"===e?f.playAudio("dtmfstar"):"#"===e?f.playAudio("dtmfpound"):f.playAudio("dtmf"+e)}catch(e){Plivo.log.error("Call has not been confirmed cannot send DTMF"),Plivo.AppError({name:e.name,message:e.message,method:"sendDtmf()"})}else Plivo.log.warn("No call session exists to sendDtmf")},v.prototype.mute=function(){if(!this.callSession)return Plivo.log.warn("No call session exists to mute"),!1;Plivo.log.debug("mute called");try{this.callSession.mute(),this.callStats&&this.callStats.sendFabricEvent(this.callSession.connection,this.callStats.fabricEvent.audioMute,this.callUUID)}catch(e){Plivo.log.error("error in mute :",e),Plivo.AppError({name:e.name,message:e.message,method:"mute()"})}return!0},v.prototype.unmute=function(){if(!this.callSession)return Plivo.log.warn("No call session exists to unmute"),!1;Plivo.log.debug("unmute called");try{this.callSession.unmute(),this.callStats&&this.callStats.sendFabricEvent(this.callSession.connection,this.callStats.fabricEvent.audioUnmute,this.callUUID)}catch(e){Plivo.log.error("error in unmute : ",e),Plivo.AppError({name:e.name,message:e.message,method:"unmute()"})}return!0},v.prototype.setRingTone=function(e){return!1===e||null===e?this.ringToneFlag=!1:"string"==typeof e?(this.ringToneFlag="user",Plivo.log.debug("setRingTone() url : "+e),this.ringToneView.src=e):this.ringToneFlag=!0,!0},v.prototype.setRingToneBack=function(e){return!1===e||null===e?this.ringToneBackFlag=!1:"string"==typeof e?(this.ringToneBackFlag="user",Plivo.log.debug("setRingToneBack() url : "+e),this.ringBackToneView.src=e):this.ringToneBackFlag=!0,!0},v.prototype.setConnectTone=function(e){return this.connectToneFlag=!!e,!0},v.prototype.setDtmfTone=function(e,t){if(!1===t||null===t)u.DTMF_TONE_FLAG[e]=!1;else if("string"==typeof t){Plivo.log.debug("set dtmf tone"),u.DTMF_TONE_FLAG[e]="user";var n="dtmf"+e;document.getElementById(n).src=t}else u.DTMF_TONE_FLAG[e]=!0;return!0},v.prototype.getCallUUID=function(){return this.callUUID},v.prototype.getLastCallUUID=function(){return this.lastCallUUID},v.prototype.setDebug=function(e){e&&-1!=["INFO","DEBUG","WARN","ERROR","ALL","OFF"].indexOf(e)&&Plivo.log.setLevel(e)},v.prototype.getPeerConnection=function(){return this.callSession&&w(this.callSession)?{status:"success",pc:this.callSession.connection}:{status:"called in wrong state",pc:null}},v.prototype.version="2.0.20",v.prototype.webRTC=function(){return!!window.RTCPeerConnection},v.prototype.supportedBrowsers=function(){return"Chrome, Firefox"},v.prototype.sendQualityFeedback=function(e,t,n){if(t=Number(t),this.callStats)if(this.userName)if(e)if(n&&200<n.toString().length)Plivo.log.error("sendQualityFeedback() comment max length is 200 character");else if(n||Plivo.log.error("sendQualityFeedback() comment is mandatory"),0<t&&t<=5){var r={userID:this.userName,overall:t,comment:n};Plivo.log.debug("Feedback sent for callUUID : "+e),this.callStats.sendUserFeedback(e,r,function(e){Plivo.log.debug("Stats sendFeedback status: "+e)})}else Plivo.log.error("sendQualityFeedback() score: "+t+" , score should be from 1-5 range");else Plivo.log.error("sendQualityFeedback() callUUID is mandatory");else Plivo.log.error("sendQualityFeedback() userName is null, isLoggedIn : "+this.isLoggedIn);else Plivo.log.warn("Stats integration not configured, ignoring feedback")};var g=function(e,n){if(e&&"closed"!=e.signalingState&&"chrome"==s.adapter.browserDetails.browser){var t=e;t.getStats(function(e){e.result().forEach(function(e){var t=e;t.stat("bytesSent")&&Plivo.log.debug("Bytes sent by WebSDK client: "+t.stat("bytesSent")+" audioInputLevel: "+t.stat("audioInputLevel")),n.storage.audioCodec=t.stat("googCodecName"),"ssrc"===t.type&&"audio"===t.stat("mediaType")&&0===parseInt(t.stat("bytesSent"),10)&&0===t.stat("audioInputLevel")&&(Plivo.log.debug("One way audio detected"),m(n,"audio","warning","no_microphone_access",0,!0,"no access to your microphone"))})},t.getLocalStreams()[0].getAudioTracks()[0],function(e){console.log(e)})}},m=function(e,t,n,r,i,o,s){var a={group:t,level:n,type:r,value:i,active:o,desc:s||""};e.emit("mediaMetrics",a)},y=function(i,e,t){var n,r={};if(t&&(t=String(t)),null==t||t.length<=0)return Plivo.log.warn("Destination address cant be null and its length must be > 0"),!1;if(i.callSession)return Plivo.log.warn("Can't make another call while in call"),!1;e=e||{};var o=[];for(var s in e){var a=e[s];h.checkExtraHeaderKey(s)&&h.checkExtraHeaderVal(a)?(o.push(s+": "+a),Plivo.log.debug("valid hdr = "+s+" -> "+a)):Plivo.log.debug("invalid hdr = "+s+" -> "+a)}i.options.clientRegion&&o.push("X-ClientRegion: "+i.options.clientRegion),n="sip:"!=t.substring(0,4)?"sip:"+t:t,r.sessionTimersExpires=u.SESSION_TIMERS_EXPIRES,r.pcConfig={iceServers:[{urls:u.STUN_SERVERS}]};var l=i.options.audioConstraints||!0;r.mediaConstraints={audio:l,video:!1},r.rtcConstraints=i.options.dscp?{optional:[{googDscp:!0}]}:null,r.extraHeaders=o,r.mediaStream=window.localStream||null,r.eventHandlers={sending:function(e){Plivo.log.debug("Outgoing call sending"),i.connStage.push("O-invite@"+_());var n=this.connection||null;!1!==i.connectToneFlag&&f.playAudio(u.CONNECT_TONE_ELEMENT_ID),n.ontrack=function(e){Plivo.log.debug("Outgoing call received addStream"),i.connStage.push("addStream-success@"+_()),e.streams[0]?(setTimeout(function(){i.remoteView.srcObject=e.streams[0]},100),i.ringToneBackFlag&&!w(i.callSession)?setTimeout(function(){w(i.callSession)||i.remoteView.pause()},100):i.ringToneBackFlag||w(i.callSession)||Plivo.log.debug("playAudio - MediaServer")):(Plivo.log.error("Outgoing call addStream failure"),i.connStage.push("addStream-failure@"+_()))},n.oniceconnectionstatechange=function(){var e=n.iceConnectionState;if(Plivo.log.debug("oniceconnectionstatechange:: "+e),i.connStage.push("iceConnectionState-"+e+"@"+_()),C.call(i,e),i.callStats&&i.callUUID&&n&&("failed"==e||"disconnected"==e)){Plivo.log.debug("iceState :: "+e);var t=new DOMError(e,e);i.callStats.reportError(n,i.callUUID,i.callStats.webRTCFunctions.iceConnectionFailure,t)}}},sdp:function(e){try{e.sdp=c(i.options.codecs,e.sdp)}catch(e){Plivo.log.debug("checkCodecPreference err - ",e)}},progress:function(e){if(i.callSession=this,i.callUUID=e.response.getHeader("X-Calluuid"),i.emit("onCallRemoteRinging"),i.callStats&&this.connection){var t=this._request.headers.To.toString().match(/:(.*)@/i)[1];i.callStats.addNewFabric(this.connection,t,i.callStats.fabricUsage.audio,i.callUUID,function(e){Plivo.log.debug("Stats new fabric message: "+e)})}i.connStage.push("progress-"+e.response.status_code+"@"+_()),Plivo.log.debug("Outgoing call progress",e.response.status_code),Plivo.log.debug("ringback tone enabled : "+i.ringToneBackFlag),!i.connectToneView.paused&&f.stopAudio(u.CONNECT_TONE_ELEMENT_ID),i.ringToneBackFlag&&f.playAudio(u.RINGBACK_ELEMENT_ID),183!=e.response.status_code||!e.response.body||(Plivo.log.debug("callSession - "+i.callUUID),i.ringToneBackFlag)||!i.ringBackToneView.paused&&f.stopAudio(u.RINGBACK_ELEMENT_ID)},accepted:function(e){var t=e.response.getHeader("To").match(/:(.*)@/i)[1];i.callUUID=e.response.getHeader("X-Calluuid"),Plivo.log.info("Outgoing call accepted"),b(i),i.callStats&&this.connection&&i.callStats.addNewFabric(this.connection,t,i.callStats.fabricUsage.audio,i.callUUID,function(e){Plivo.log.debug("Stats new fabric message: "+e)})},confirmed:function(e){Plivo.log.debug("Outgoing call confirmed - "+i.callUUID),i.connStage.push("confirmed@"+_()),i.remoteView.paused&&i.remoteView.play(),i.options.disableRtpTimeOut&&(i.callSession.connection.disableRtpTimeOut=!0),!i.ringToneView.paused&&f.stopAudio(u.RINGTONE_ELEMENT_ID),!i.ringBackToneView.paused&&f.stopAudio(u.RINGBACK_ELEMENT_ID),!i.connectToneView.paused&&f.stopAudio(u.CONNECT_TONE_ELEMENT_ID),i.emit("onCallAnswered"),setTimeout(g,3e3,this.connection,i)},icetimeout:function(e){Plivo.log.debug("iceGathering timed out"),m(i,"network","warning","ice_timeout",e,!0,"Possible NAT/Firewall issue")},failed:function(e){if(Plivo.log.error("Outgoing call failed: "+e.cause),i.connStage.push("failed@"+_()),!i.ringBackToneView.paused&&f.stopAudio(u.RINGBACK_ELEMENT_ID),!i.connectToneView.paused&&f.stopAudio(u.CONNECT_TONE_ELEMENT_ID),e.message&&(i.callUUID=e.message.getHeader("X-CallUUID")||null),i.callStats&&i.callUUID&&!e.cause.match("edia")){var t=e.cause,n=t;e.message&&e.message.status_code&&(n=String(e.message.status_code));var r=new DOMError(t,n);Plivo.log.debug(r),i.callStats.reportError(null,i.callUUID,i.callStats.webRTCFunctions.signalingError,r)}i.emit("onCallFailed",e.cause),E(i)},ended:function(e){Plivo.log.debug("Outgoing call ended - "+i.callUUID),Plivo.log.info("Outgoing call ended"),i.connStage.push("ended@"+_()),i.callStats&&i.callStats.sendFabricEvent(this.connection,i.callStats.fabricEvent.fabricTerminated,i.callUUID),i.emit("onCallTerminated",{originator:e.originator,reason:e.cause}),Plivo.AppError({name:"onCallTerminated",originator:e.originator,reason:e.cause}),E(i)},getusermediafailed:function(e){Plivo.log.error("getusermediafailed: "+e),i.userName&&i.callStats&&(e.message="getusermediafailed",i.callStats.reportError(null,i.userName,i.callStats.webRTCFunctions.getUserMedia,e))},"peerconnection:createofferfailed":function(e){Plivo.log.error("peerconnection:createofferfailed: ",e),i.userName&&i.callStats&&(e.message="peerconnection:createofferfailed",i.callStats.reportError(null,i.userName,i.callStats.webRTCFunctions.createOffer,e))},"peerconnection:createanswerfailed":function(e){Plivo.log.error("peerconnection:createanswerfailed: ",e),i.userName&&i.callStats&&(e.message="peerconnection:createanswerfailed",i.callStats.reportError(null,i.userName,i.callStats.webRTCFunctions.createAnswer,e))},"peerconnection:setlocaldescriptionfailed":function(e){Plivo.log.error("peerconnection:setlocaldescriptionfailed: ",e),i.userName&&i.callStats&&(e.message="peerconnection:setlocaldescriptionfailed",i.callStats.reportError(null,i.userName,i.callStats.webRTCFunctions.setLocalDescription,e))},"peerconnection:setremotedescriptionfailed":function(e){e.message&&!/pranswer/.test(e.message)&&(Plivo.log.error("peerconnection:setremotedescriptionfailed: ",e),i.userName&&i.callStats&&(e.message="peerconnection:setremotedescriptionfailed",i.callStats.reportError(null,i.userName,i.callStats.webRTCFunctions.setRemoteDescription,e)))}};try{i.phone.call(n,r),Plivo.log.debug("Outgoing call options : ",JSON.stringify(r.mediaConstraints))}catch(e){return Plivo.log.error("Failed to execute plivo.onCalling event handler",e),Plivo.AppError({name:e.name,message:e.message,method:"call()"}),!1}return!0},_=function(){var e=new Date;return e.toISOString().substring(0,10)+" "+e.toString().split(" ")[4]+"."+e.getMilliseconds()},b=function(e){return e.storage={},(t=e.storage).local_audio=[],t.remote_audio=[],t.mosLocalMeasures=[],t.mosRemoteMeasures=[],t.jitterLocalMeasures=[],t.jitterRemoteMeasures=[],t.packetLossRemoteMeasures=[],t.packetLossLocalMeasures=[],t.rtt=[],t.audioCodec=null,t.warning={audioLocalMeasures:!1,audioRemoteMeasures:!1,mosLocalMeasures:!1,mosRemoteMeasures:!1,jitterLocalMeasures:!1,jitterRemoteMeasures:!1,packetLossRemoteMeasures:!1,packetLossLocalMeasures:!1,rtt:!1,ice_connection:!1},t.startAnalysis=!1,setTimeout(function(){t.startAnalysis=!0,Plivo.log.debug("Stats startAnalysis started")},5e3),!0;var t},S=function(r){return function(e,n){Plivo.log.info("Stats token req...");var t={eventHandlers:{succeeded:function(e){Plivo.log.info("Stats token success!");var t=JSON.parse(e.response.getHeader("x-token"));return t&&"0"!==t?n(null,t.token):(Plivo.log.error("Stats token failed with 0"),n("token failed 0"))},failed:function(e){return e.response&&e.response.status_code?(Plivo.log.error("Stats token failed!",e.response.status_code),n(e.response.status_code)):(Plivo.log.error("Stats token failed!"),n("failed"))}},extraHeaders:["X-appID: "+r.options.appId,"X-userID: "+r.userName]};r.phone.sendMessage("admin","-- Plivo web client --",t)}},C=function(e){-1!=["disconnected","failed"].indexOf(e)&&(m(this,"network","warning","ice_connection",e,!0,"network drop"),this.storage&&(this.storage.warning.ice_connection=!0)),"connected"==e&&this.storage&&!0===this.storage.warning.ice_connection&&(m(this,"network","warning","ice_connection",e,!1),this.storage.warning.ice_connection=!1)},T=function(o){var n,s,r;function t(e,t){t.candidate&&e.addIceCandidate(t.candidate).then().catch(a)}function a(e){o&&o(null,e)}function l(){n&&n.getTracks().forEach(function(e){e.stop(),n.removeTrack(e),n=null}),"stable"==s.signalingState&&s.close(),"stable"==r.signalingState&&r.close()}s=new RTCPeerConnection(null),r=new RTCPeerConnection(null),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(e){var t;n=e,(t=s).addStream(n),t.createOffer().then(function(e){t.setLocalDescription(e).then(function(){!function t(n,e){n.setRemoteDescription(e).then(function(){"offer"==e.type&&n.createAnswer().then(function(e){n.setLocalDescription(e).then(function(){}).catch(a),t(s,e)}).catch(a)}).catch(a)}(r,e)}).catch(a)}).catch(a)}).catch(a),s.onicecandidate=function(e){t(r,e)},r.onicecandidate=function(e){t(s,e)},setTimeout(function(){Plivo.log.debug("getUM precheck icestate : "+s.iceConnectionState);var i=0;!function r(){s.getLocalStreams()[0]&&s.getStats(function(e){e.result().forEach(function(e){var t=e;if("ssrc"===t.type&&"audio"===t.stat("mediaType")){var n={bytesSent:t.stat("bytesSent"),audioInputLevel:t.stat("audioInputLevel")};Number(n.audioInputLevel)<=0&&2!=i?(i++,setTimeout(r,1e3),Plivo.log.debug("getUM precheck re-attempt: "+i)):(o&&o(n,null),setTimeout(l,3e3))}})},s.getLocalStreams()[0].getAudioTracks()[0],a)}()},500)},w=function(e){return e?e.is_confirmed:(Plivo.log.debug("session not available"),!1)},E=function(e){if(e.remoteView.pause(),Plivo.AppError(function(e){for(var t,n=[],r=0;e.length>r;r++){var i=e[r].split("@");if(0==r)t=i[1],n.push(i[0]+" = "+i[1]+"#");else{var o=new Date(i[1])-new Date(t);1e3<o?(o/=1e3,o=String(o)+"s#"):o=String(o)+"ms#",n.push(i[0]+" = "+i[1]+" +"+o)}}return n=(n=(n=JSON.stringify(n)).replace(/[[",\]]/g,"")).replace(/#/g,"\n")}(e.connStage),"log"),e.callSession=null,delete e.storage,e.lastCallUUID=e.callUUID,e.callUUID=null,e.callDirection=null,window.localStream&&("chrome"==s.adapter.browserDetails.browser||e.permOnClick))try{window.localStream.getTracks().forEach(function(e){e.stop(),window.localStream.removeTrack(e)}),window.localStream=null}catch(e){Plivo.log.debug("error on stop track in localStream : "+e.message)}};e.exports=v},{"../sipLib/JsSIP":42,"./media/audioDevice":3,"./media/document":4,"./util/callAnalytics":5,"./util/codecPreference":6,"./util/constants":7,"./util/headers":8,"./util/logger":9,"./util/validateOptions":10,events:11,util:23}],2:[function(e,t,n){var r=e("./client");t.exports=function(e){var t=new r(e);Object.defineProperties(this,{client:{enumerable:!0,value:t}})}},{"./client":1}],3:[function(e,t,n){var r=e("../util/constants"),o=function(r){return new Promise(function(n,t){navigator.mediaDevices.enumerateDevices().then(function(e){var t=[];e.filter(function(e){"input"==r?"audioinput"==e.kind&&t.push(e):"output"==r?"audiooutput"==e.kind&&t.push(e):/video/i.test(e.kind)||t.push(e)}),n(t)}).catch(function(e){t(e)})})},i={set:function(e){if("string"==typeof e&&"optional"in Plivo.audioConstraints)return Plivo.audioConstraints.optional.push({sourceId:e}),!0},get:function(){if(Plivo.audioConstraints.optional){var e=Plivo.audioConstraints.optional.filter(function(e){return e.sourceId});return 0<e.length?e[0].sourceId:""}return""},reset:function(){return Plivo.audioConstraints.optional&&(Plivo.audioConstraints.optional=Plivo.audioConstraints.optional.filter(function(e){return!e.sourceId})),!0}},s={set:function(t){return document.querySelectorAll('[data-devicetype="speakerDevice"]').forEach(function(e){e.setSinkId&&e.setSinkId(t)}),!0},get:function(){var e=document.querySelector('[data-devicetype="speakerDevice"]');if(e.sinkId)return e.sinkId},reset:function(){return document.querySelectorAll('[data-devicetype="speakerDevice"]').forEach(function(e){e.setSinkId&&e.setSinkId("")}),!0},media:function(e){var t={dtmf:"dtmfstar",ringback:r.RINGBACK_ELEMENT_ID};return e&&e in t?document.getElementById(t[e]):document.getElementById(r.RINGBACK_ELEMENT_ID)}},a={set:function(e){var t=document.getElementById(r.RINGTONE_ELEMENT_ID);return t.setSinkId&&t.setSinkId(e),!0},get:function(){var e=document.getElementById(r.RINGTONE_ELEMENT_ID);if(e.sinkId)return e.sinkId},reset:function(){var e=document.getElementById(r.RINGTONE_ELEMENT_ID);return e.setSinkId&&e.setSinkId(""),!0},media:function(){return document.getElementById(r.RINGTONE_ELEMENT_ID)}},l=function(r){var i=this;return new Promise(function(t,n){o().then(function(e){var n=[];e.forEach(function(e){if(e.label){var t=JSON.stringify(e);n.push(t)}else n=null}),r?(i.audioDevDic=n,t(!0)):t(n)}).catch(function(e){Plivo.log.error("Error availableDevices() ",e),n(e)})})};t.exports.inputDevices=i,t.exports.outputDevices=s,t.exports.ringtoneDevices=a,t.exports.revealAudioDevices=function(r){return new Promise(function(t,n){navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then(function(e){"returnStream"==r?t(e):(e.getTracks().forEach(function(e){e.stop()}),t("success"))}).catch(function(e){Plivo.log.error("failed to get user media :: "+e.name),n(e.name)}):n("no getUserMedia support")})},t.exports.availableDevices=o,t.exports.audioDevDictionary=l,t.exports.checkAudioDevChange=function(){var n,r,i=this;l().then(function(t){i.audioDevDic&&t&&(t.forEach(function(e){-1==i.audioDevDic.indexOf(e)&&(n=JSON.parse(e),/default/i.test(n.deviceId)||i.emit("audioDeviceChange",{change:"added",device:n}))}),i.audioDevDic.forEach(function(e){-1==t.indexOf(e)&&(r=JSON.parse(e),/default/i.test(r.deviceId)||i.emit("audioDeviceChange",{change:"removed",device:r}))})),i.audioDevDic||i.emit("audioDeviceChange",{change:"",device:""}),t&&(i.audioDevDic=t)}).catch(function(e){Plivo.log.error("Error checkAudioDevChange() ",e)})}},{"../util/constants":7}],4:[function(e,t,n){var u=e("../util/constants"),c=function(e,t){navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:e,video:!1}).then(function(e){window.localStream=e,Plivo.log.debug("getUserMedia success"),t({status:"success",stream:!0})}).catch(function(e){Plivo.log.error("failed to get user media :: "+e.name),t({status:"failure",error:e.name})}):(Plivo.log.error("getUserMedia not available"),t({status:"failure",error:"getUserMedia not supported"}))};t.exports.setup=function(e,t){var n=document.createElement("audio");n.id=u.REMOTE_VIEW_ID,n.hidden=!0,n.autoplay=!0,n.width=0,n.height=0,n.setAttribute("data-devicetype","speakerDevice"),document.body.appendChild(n);var r=document.createElement("audio");r.id=u.CONNECT_TONE_ELEMENT_ID,r.loop="loop",r.src=u.CONNECT_TONE_URL,r.setAttribute("data-devicetype","speakerDevice"),document.body.appendChild(r);var i=document.createElement("audio");i.id=u.RINGBACK_ELEMENT_ID,i.loop="loop",i.src=u.RINGTONE_URL,i.setAttribute("data-devicetype","speakerDevice"),document.body.appendChild(i);var o=document.createElement("audio");o.id=u.RINGTONE_ELEMENT_ID,o.loop="loop",o.src=u.RINGTONE_URL,o.setAttribute("data-devicetype","ringtoneDevice"),document.body.appendChild(o);for(var s="https://cdn.plivo.com/sdk/browser/audio/dtmf-",a=function(e,t,n){var r="dtmf"+t,i=e+t+"."+n,o=document.createElement("audio");o.id=r,o.src=i,o.setAttribute("data-devicetype","speakerDevice"),document.body.appendChild(o)},l=0;l<=9;l++)a(s,l,"mp3");a(s,"star","mp3"),a(s,"pound","mp3"),e.permOnClick?(window.localStream=null,t({status:"success",stream:!1})):c(e.audioConstraints,function(e){t(e)})},t.exports.getLocalMedia=c,t.exports.playAudio=function(t){try{document.getElementById(t).play(),Plivo.log.debug("playAudio - "+t)}catch(e){Plivo.log.debug("failed to play audio for elementId "+t+" Cause: "+e)}},t.exports.stopAudio=function(t){try{document.getElementById(t).pause(),Plivo.log.debug("stopAudio - "+t)}catch(e){Plivo.log.debug("failed to stop audio for elementId "+t+" Cause: "+e)}},t.exports.maskPage=function(){var e=document.createElement("div");e.id="plivo_mask",document.body.insertBefore(e,document.body.firstChild),e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.background="#000",e.style.opacity="0.8",e.style.filter="alpha(opacity=80)",e.style.zindex="50"}},{"../util/constants":7}],5:[function(e,t,n){t.exports=function(s,e){var a=this;function t(e,t){var n=a.storage[e];if(2==n.length){n.push(Number(t));var r={},i=null;for(var o in n.forEach(function(e){r[e]=r[e]+1||1}),r)2<=r[o]&&(i=Number(o));"number"==typeof i?(a.storage.warning[e]=!0,1<i?Plivo.log.debug("Same audioLevel detected for "+e+" : ",a.str(n)):Plivo.log.debug("Audio mute detected for "+e+" : ",a.str(n)),s(a,"audio","warning","no_audio_received",i,!0,e)):a.storage.warning[e]&&(a.storage.warning[e]=!1,s(a,"audio","warning","no_audio_received",0,!1,e))}else n.push(Number(t));3==n.length&&n.splice(0,2)}function n(e,t){t=Number(t);var n=a.storage[e];if(2==n.length){n.push(t);var r=n.filter(function(e,t){return 400<e});if(2<=r.length){var i=(r.reduce(function(e,t){return e+t})/r.length).toFixed(2);a.storage.warning[e]=!0,Plivo.log.debug(e+" : getting high rtt  : ",a.str(r)),s(a,"network","warning","high_rtt",i,!0,"high latency")}else a.storage.warning[e]&&(a.storage.warning[e]=!1,s(a,"network","warning","high_rtt",0,!1))}else n.push(t);3==n.length&&n.splice(0,2)}function r(e,t){t=Number(t);var n=a.storage[e];if(2==n.length){n.push(t);var r=n.filter(function(e,t){return 30<e});if(2<=r.length){var i=r.reduce(function(e,t){return e+t})/r.length;a.storage.warning[e]=!0,Plivo.log.debug(e+" : getting high jitter rate : ",a.str(r)),s(a,"network","warning","high_jitter",i,!0,e)}else a.storage.warning[e]&&(a.storage.warning[e]=!1,s(a,"network","warning","high_jitter",0,!1,e))}else n.push(t);3==n.length&&n.splice(0,2)}function i(e,t){var n=a.storage[e];if(2==n.length){n.push(t);var r=n.filter(function(e,t){return"opus"==a.storage.audioCodec?"bad"==e:"excellent"!=e});2<=r.length?(a.storage.warning[e]=!0,Plivo.log.debug(e+" : getting low mos : ",a.str(n)),s(a,"network","warning","low_mos",r[0],!0,e)):a.storage.warning[e]&&(a.storage.warning[e]=!1,s(a,"network","warning","low_mos",0,!1,e))}else n.push(t);3==n.length&&n.splice(0,2)}function o(e,t){t=Number(t);var n=a.storage[e];if(2==n.length){n.push(t);var r=n.filter(function(e,t){return"opus"==a.storage.audioCodec?.1<=e:.02<=e});if(2<=r.length){var i=r.reduce(function(e,t){return e+t})/r.length;i=i.toFixed(3),a.storage.warning[e]=!0,Plivo.log.debug(e+" : ploss score value is high :",a.str(r)),s(a,"network","warning","high_packetloss",i,!0,e)}else a.storage.warning[e]&&(a.storage.warning[e]=!1,s(a,"network","warning","high_packetloss",0,!1,e))}else n.push(t);3==n.length&&n.splice(0,2)}if(a.storage&&a.storage.startAnalysis)for(var l in e)if("audioInputLevel"in e[l]){var u=(h=e[l]).fractionLoss?h.fractionLoss.toFixed(2):0,c=(h.bitrate&&h.bitrate.toFixed(2),h.quality||null),d=h.rtt||0,f=h.jitter||0;t("local_audio",h.audioInputLevel||0),n("rtt",d),r("jitterLocalMeasures",f),o("packetLossLocalMeasures",u)}else if("audioOutputLevel"in e[l]){var h;u=(h=e[l]).fractionLoss?h.fractionLoss.toFixed(2):0,h.bitrate&&h.bitrate.toFixed(2),c=h.quality||null,f=h.jitter||0,t("remote_audio",h.audioOutputLevel||0),r("jitterRemoteMeasures",f),i("mosRemoteMeasures",c),o("packetLossRemoteMeasures",u)}}},{}],6:[function(e,t,n){t.exports=function(e,r){function i(e,t){var n=new RegExp("a=rtpmap:.* "+e+"(.*)","ig");return!!t.match(n)&&t.match(n)[0].split(" ")[0].match(/\d+/)}if(0<e.length){var o=["OPUS","G722","PCMA","PCMU","ISAC","CN"],s="";e.forEach(function(e){var t=o.indexOf(e);-1<t&&o.splice(t,1);var n=i(e,r);n&&(s+=n+" ")}),s=s.slice(0,-1),r=r.replace(r.match(/m=audio .*[a-z] (.*)/i)[1],s),n=r,o.forEach(function(e){var t=i(e,n);a=new RegExp("\na=rtpmap:.*"+e+"/.*","ig"),n=n.replace(a,""),a=new RegExp("\na=fmtp:"+t+" (.*)","ig"),n=n.replace(a,""),a=new RegExp("\na=rtcp-fb:"+t+" (.*)","ig"),n=n.replace(a,"")}),r=n}var n,a;return r}},{}],7:[function(e,t,n){t.exports.DEFAULT_LOG_LEVEL="INFO",t.exports.DOMAIN="phone.plivo.com",t.exports.WS_SERVERS="wss://phone.plivo.com:5063",t.exports.REGISTER_EXPIRES_SECONDS=120,t.exports.SESSION_TIMERS_EXPIRES=300,t.exports.WS_RECOVERY_MAX_INTERVAL=20,t.exports.WS_RECOVERY_MIN_INTERVAL=2,t.exports.DEFAULT_CODECS=["OPUS","PCMU"],t.exports.STUN_SERVERS=["stun:stun.l.google.com:19302","stun:stun1.l.google.com:19302"],t.exports.LIB_NAME="plivojs",t.exports.DEBUG_MODES=["INFO","DEBUG","WARN","ERROR","ALL","ALL-PLAIN","OFF"],t.exports.REGION=["usa_west","usa_east","australia","europe","asia","south_america"],t.exports.RINGTONE_URL="https://cdn.plivo.com/sdk/browser/audio/us-ring.mp3",t.exports.CONNECT_TONE_URL="https://cdn.plivo.com/sdk/browser/audio/connect-tone.mp3",t.exports.SELF_VIEW_ID="plivo_webrtc_selfview",t.exports.REMOTE_VIEW_ID="plivo_webrtc_remoteview",t.exports.RINGBACK_ELEMENT_ID="plivo_ringbacktone",t.exports.RINGTONE_ELEMENT_ID="plivo_ringtone",t.exports.CONNECT_TONE_ELEMENT_ID="plivo_connect_tone",t.exports.DTMF_TONE_FLAG={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,"#":!0,"*":!0},t.exports.DEFAULT_COMMENTS=["bad-audio","call-dropped","wrong-callerid","post-dial-delay","dtmf-not-captured","audio-latency","unsolicited-call","one-way-audio","no-audio","never-connected"];var r={};"undefined"!=typeof navigator&&navigator.mozGetUserMedia?r={offerToReceiveAudio:!0}:r.mandatory={OfferToReceiveAudio:!0},t.exports.DEFAULT_OFFER_OPTIONS=r},{}],8:[function(e,t,n){var o=function(e){return("X-Ph-"==e.substr(0,5)||"X-PH-"==e.substr(0,5))&&!1!==/^([a-z0-9A-Z]){1,19}$/.test(e.substr(5))},s=function(e){return!1!==/^([a-z0-9A-Z_\-\+\(\)%]){1,120}$/.test(e)};t.exports.checkExtraHeaderKey=o,t.exports.checkExtraHeaderVal=s,t.exports.receiveExtraHeader=function(e,t){var n={};for(var r in t){var i=e.getHeader(r);o(r)&&s(i)&&(n[r]=i)}return n}},{}],9:[function(e,t,n){t.exports=function(e){e||(e={});var t=["INFO","DEBUG","WARN","ERROR","ALL","OFF"],o=e.logMethod||"INFO",s=e.enableDate||!1,a=e.loggingName||"",n="undefined"!=typeof chrome&&chrome.storage?chrome.storage.local:window.localStorage,r=function(){function e(){if(s){var e=new Date,t=e.toISOString().substring(0,10)+" "+e.toString().split(" ")[4]+"."+e.getMilliseconds();console.log("["+t+"] ["+n+"] "+a+" :: ",r,i)}else console.log("["+n+"] "+a+" :: ",r,i)}var n=arguments[0].toUpperCase(),t=arguments[1],r=t[0]||"",i=t[1]||"";if("DEBUG"==o||"ALL"==o)e();else{if(o!=n)return;e()}};return{info:function(){r("info",arguments)},debug:function(){r("debug",arguments)},warn:function(){r("warn",arguments)},error:function(){r("error",arguments)},setLevel:function(e){return e=e.toUpperCase(),-1!=t.indexOf(e)?(-1==["DEBUG","ALL"].indexOf(o=e)&&(n.debug=""),"logLevel is now : "+o):"only : "+t.toString()+" are allowed in run time!"},level:function(){return o}}}},{}],10:[function(e,t,n){t.exports={codecs:function(e,t){if("[object Array]"==Object.prototype.toString.call(e)){var n=!0;return e.forEach(function(e){-1==t.indexOf(e)&&(n=!1,Plivo.log.warn("Ignoring invalid codec - ",e),Plivo.log.debug("Allowed list: ",t))}),!!n}return Plivo.log.error("Please send codecs in Array. Eg:",t),!1},isBoolean:function(e,t){return"boolean"==typeof t||(Plivo.log.error(e+" has to be boolean. "+t+" is not accepted"),!1)},debug:function(e,t){return-1!=t.indexOf(e)||(Plivo.log.error("debug method "+e+" is not allowed"),Plivo.log.debug("Allowed list for debug: ",t),!1)},region:function(e,t){return-1!=t.indexOf(e)||(Plivo.log.error("region name "+e+" is not allowed"),Plivo.log.debug("Allowed list for regions: ",t),!1)}}},{}],11:[function(e,t,n){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function a(e){return"function"==typeof e}function l(e){return"object"===(void 0===e?"undefined":_typeof(e))&&null!==e}function u(e){return void 0===e}((t.exports=r).EventEmitter=r).prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,n,r,i,o,s;if(this._events||(this._events={}),"error"===e&&(!this._events.error||l(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(u(n=this._events[e]))return!1;if(a(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(r=arguments.length,i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];n.apply(this,i)}else if(l(n)){for(r=arguments.length,i=new Array(r-1),o=1;o<r;o++)i[o-1]=arguments[o];for(r=(s=n.slice()).length,o=0;o<r;o++)s[o].apply(this,i)}return!0},r.prototype.on=r.prototype.addListener=function(e,t){var n;if(!a(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,a(t.listener)?t.listener:t),this._events[e]?l(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,l(this._events[e])&&!this._events[e].warned&&(n=u(this._maxListeners)?r.defaultMaxListeners:this._maxListeners)&&0<n&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},r.prototype.once=function(e,t){if(!a(t))throw TypeError("listener must be a function");var n=!1;function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}return r.listener=t,this.on(e,r),this},r.prototype.removeListener=function(e,t){var n,r,i,o;if(!a(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(i=(n=this._events[e]).length,r=-1,n===t||a(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(l(n)){for(o=i;0<o--;)if(n[o]===t||n[o].listener&&n[o].listener===t){r=o;break}if(r<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(r,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(a(n=this._events[e]))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){return this._events&&this._events[e]?a(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.listenerCount=function(e,t){return e._events&&e._events[t]?a(e._events[t])?1:e._events[t].length:0}},{}],12:[function(n,r,o){(function(t){function e(){var e;try{e=o.storage.debug}catch(e){}return!e&&void 0!==t&&"env"in t&&(e=t.env.DEBUG),e}(o=r.exports=n("./debug")).log=function(){return"object"===("undefined"==typeof console?"undefined":_typeof(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},o.formatArgs=function(e){var t=window._PlivoUseColorLog;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+o.humanize(this.diff),t){var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var r=0,i=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(r++,"%c"===e&&(i=r))}),e.splice(i,0,n)}},o.save=function(e){try{null==e?o.storage.removeItem("debug"):o.storage.debug=e}catch(e){}},o.load=e,o.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},o.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),o.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"],o.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},o.enable(e())}).call(this,n("_process"))},{"./debug":13,_process:15}],13:[function(e,t,a){var l;function n(e){function r(){if(r.enabled){var i=r,e=+new Date,t=e-(l||e);i.diff=t,i.prev=l,i.curr=e,l=e;for(var o=new Array(arguments.length),n=0;n<o.length;n++)o[n]=arguments[n];o[0]=a.coerce(o[0]),"string"!=typeof o[0]&&o.unshift("%O");var s=0;o[0]=o[0].replace(/%([a-zA-Z%])/g,function(e,t){if("%%"===e)return e;s++;var n=a.formatters[t];if("function"==typeof n){var r=o[s];e=n.call(i,r),o.splice(s,1),s--}return e}),a.formatArgs.call(i,o),(r.log||a.log||console.log.bind(console)).apply(i,o)}}return r.namespace=e,r.enabled=a.enabled(e),r.useColors=a.useColors(),r.color=function(e){var t,n=0;for(t in e)n=(n<<5)-n+e.charCodeAt(t),n|=0;return a.colors[Math.abs(n)%a.colors.length]}(e),"function"==typeof a.init&&a.init(r),r}(a=t.exports=n.debug=n.default=n).coerce=function(e){return e instanceof Error?e.stack||e.message:e},a.disable=function(){a.enable("")},a.enable=function(e){a.save(e),a.names=[],a.skips=[];for(var t=("string"==typeof e?e:"").split(/[\s,]+/),n=t.length,r=0;r<n;r++)t[r]&&("-"===(e=t[r].replace(/\*/g,".*?"))[0]?a.skips.push(new RegExp("^"+e.substr(1)+"$")):a.names.push(new RegExp("^"+e+"$")))},a.enabled=function(e){var t,n;for(t=0,n=a.skips.length;t<n;t++)if(a.skips[t].test(e))return!1;for(t=0,n=a.names.length;t<n;t++)if(a.names[t].test(e))return!0;return!1},a.humanize=e("ms"),a.names=[],a.skips=[],a.formatters={}},{ms:14}],14:[function(e,t,n){var o=36e5,s=864e5;function a(e,t,n){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+n:Math.ceil(e/t)+" "+n+"s"}t.exports=function(e,t){t=t||{};var n,r,i=void 0===e?"undefined":_typeof(e);if("string"===i&&0<e.length)return function(e){if(!(100<(e=String(e)).length)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*n;case"days":case"day":case"d":return n*s;case"hours":case"hour":case"hrs":case"hr":case"h":return n*o;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*n;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}(e);if("number"===i&&!1===isNaN(e))return t.long?a(n=e,s,"day")||a(n,o,"hour")||a(n,6e4,"minute")||a(n,1e3,"second")||n+" ms":s<=(r=e)?Math.round(r/s)+"d":o<=r?Math.round(r/o)+"h":6e4<=r?Math.round(r/6e4)+"m":1e3<=r?Math.round(r/1e3)+"s":r+"ms";throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],15:[function(e,t,n){var r,i,o=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function l(t){if(r===setTimeout)return setTimeout(t,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(e){r=s}try{i="function"==typeof clearTimeout?clearTimeout:a}catch(e){i=a}}();var u,c=[],d=!1,f=-1;function h(){d&&u&&(d=!1,u.length?c=u.concat(c):f=-1,c.length&&p())}function p(){if(!d){var e=l(h);d=!0;for(var t=c.length;t;){for(u=c,c=[];++f<t;)u&&u[f].run();f=-1,t=c.length}u=null,d=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===a||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(e)}}function v(e,t){this.fun=e,this.array=t}function g(){}o.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new v(e,t)),1!==c.length||d||l(p)},v.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=g,o.addListener=g,o.once=g,o.off=g,o.removeListener=g,o.removeAllListeners=g,o.emit=g,o.prependListener=g,o.prependOnceListener=g,o.listeners=function(e){return[]},o.binding=function(e){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(e){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],16:[function(e,t,n){var r=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{push:"invalid",names:["value"]}]};Object.keys(r).forEach(function(e){r[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},{}],17:[function(e,t,n){var r=e("./parser"),i=e("./writer");n.write=i,n.parse=r.parse,n.parseFmtpConfig=r.parseFmtpConfig,n.parseParams=r.parseParams,n.parsePayloads=r.parsePayloads,n.parseRemoteCandidates=r.parseRemoteCandidates,n.parseImageAttributes=r.parseImageAttributes,n.parseSimulcastStreamList=r.parseSimulcastStreamList},{"./parser":18,"./writer":19}],18:[function(e,t,n){var o=function(e){return String(Number(e))===e?Number(e):e},a=function(e,t,n){var r=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:r&&!t[e.name]&&(t[e.name]={});var i=e.push?{}:r?t[e.name]:t;!function(e,t,n,r){if(r&&!n)t[r]=o(e[1]);else for(var i=0;i<n.length;i+=1)null!=e[i+1]&&(t[n[i]]=o(e[i+1]))}(n.match(e.reg),i,e.names,e.name),e.push&&t[e.push].push(i)},l=e("./grammar"),r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);n.parse=function(e){var t={},o=[],s=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach(function(e){var t=e[0],n=e.slice(2);"m"===t&&(o.push({rtp:[],fmtp:[]}),s=o[o.length-1]);for(var r=0;r<(l[t]||[]).length;r+=1){var i=l[t][r];if(i.reg.test(n))return a(i,s,n)}}),t.media=o,t};var i=function(e,t){var n=t.split(/=(.+)/,2);return 2===n.length?e[n[0]]=o(n[1]):1===n.length&&1<t.length&&(e[n[0]]=void 0),e};n.parseParams=function(e){return e.split(/\;\s?/).reduce(i,{})},n.parseFmtpConfig=n.parseParams,n.parsePayloads=function(e){return e.split(" ").map(Number)},n.parseRemoteCandidates=function(e){for(var t=[],n=e.split(" ").map(o),r=0;r<n.length;r+=3)t.push({component:n[r],ip:n[r+1],port:n[r+2]});return t},n.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(i,{})})},n.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,n=!1;return"~"!==e[0]?t=o(e):(t=o(e.substring(1,e.length)),n=!0),{scid:t,paused:n}})})}},{"./grammar":16}],19:[function(e,t,n){var o=e("./grammar"),s=/%[sdv%]/g,a=function(e,t,n){var r=[e+"="+(t.format instanceof Function?t.format(t.push?n:n[t.name]):t.format)];if(t.names)for(var i=0;i<t.names.length;i+=1){var o=t.names[i];t.name?r.push(n[t.name][o]):r.push(n[t.names[i]])}else r.push(n[t.name]);return function(e){var n=1,r=arguments,i=r.length;return e.replace(s,function(e){if(i<=n)return e;var t=r[n];switch(n+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}})}.apply(null,r)},l=["v","o","s","i","u","e","p","c","b","t","r","z","a"],u=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var n=t.outerOrder||l,r=t.innerOrder||u,i=[];return n.forEach(function(n){o[n].forEach(function(t){t.name in e&&null!=e[t.name]?i.push(a(n,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){i.push(a(n,t,e))})})}),e.media.forEach(function(e){i.push(a("m",o.m[0],e)),r.forEach(function(n){o[n].forEach(function(t){t.name in e&&null!=e[t.name]?i.push(a(n,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){i.push(a(n,t,e))})})})}),i.join("\r\n")+"\r\n"}},{"./grammar":16}],20:[function(e,t,n){var c={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};c.localCName=c.generateIdentifier(),c.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},c.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(0<t?"m="+e:e).trim()+"\r\n"})},c.matchPrefix=function(e,t){return c.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},c.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},r=8;r<t.length;r+=2)switch(t[r]){case"raddr":n.relatedAddress=t[r+1];break;case"rport":n.relatedPort=parseInt(t[r+1],10);break;case"tcptype":n.tcpType=t[r+1];break;default:n[t[r]]=t[r+1]}return n},c.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),"candidate:"+t.join(" ")},c.parseIceOptions=function(e){return e.substr(14).split(" ")},c.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.numChannels=3===t.length?parseInt(t[2],10):1,n},c.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},c.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:0<t[0].indexOf("/")?t[0].split("/")[1]:"sendrecv",uri:t[1]}},c.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},c.parseFmtp=function(e){for(var t,n={},r=e.substr(e.indexOf(" ")+1).split(";"),i=0;i<r.length;i++)n[(t=r[i].trim().split("="))[0].trim()]=t[1];return n},c.writeFmtp=function(t){var e="",n=t.payloadType;if(void 0!==t.preferredPayloadType&&(n=t.preferredPayloadType),t.parameters&&Object.keys(t.parameters).length){var r=[];Object.keys(t.parameters).forEach(function(e){r.push(e+"="+t.parameters[e])}),e+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return e},c.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},c.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},c.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},r=e.indexOf(":",t);return-1<r?(n.attribute=e.substr(t+1,r-t-1),n.value=e.substr(r+1)):n.attribute=e.substr(t+1),n},c.getMid=function(e){var t=c.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},c.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},c.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:c.matchPrefix(e+t,"a=fingerprint:").map(c.parseFingerprint)}},c.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},c.getIceParameters=function(e,t){var n=c.splitLines(e);return{usernameFragment:(n=n.concat(c.splitLines(t))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:n.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},c.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},c.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},n=c.splitLines(e)[0].split(" "),r=3;r<n.length;r++){var i=n[r],o=c.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(o){var s=c.parseRtpMap(o),a=c.matchPrefix(e,"a=fmtp:"+i+" ");switch(s.parameters=a.length?c.parseFmtp(a[0]):{},s.rtcpFeedback=c.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(c.parseRtcpFb),t.codecs.push(s),s.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(s.name.toUpperCase())}}}return c.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(c.parseExtmap(e))}),t},c.writeRtpDescription=function(e,t){var n="";n+="m="+e+" ",n+=0<t.codecs.length?"9":"0",n+=" UDP/TLS/RTP/SAVPF ",n+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",n+="c=IN IP4 0.0.0.0\r\n",n+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){n+=c.writeRtpMap(e),n+=c.writeFmtp(e),n+=c.writeRtcpFb(e)});var r=0;return t.codecs.forEach(function(e){e.maxptime>r&&(r=e.maxptime)}),0<r&&(n+="a=maxptime:"+r+"\r\n"),n+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){n+=c.writeExtmap(e)}),n},c.parseRtpEncodingParameters=function(e){var n,r=[],t=c.parseRtpParameters(e),i=-1!==t.fecMechanisms.indexOf("RED"),o=-1!==t.fecMechanisms.indexOf("ULPFEC"),s=c.matchPrefix(e,"a=ssrc:").map(function(e){return c.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),a=0<s.length&&s[0].ssrc,l=c.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});0<l.length&&1<l[0].length&&l[0][0]===a&&(n=l[0][1]),t.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:n}};r.push(t),i&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:n,mechanism:o?"red+ulpfec":"red"},r.push(t))}}),0===r.length&&a&&r.push({ssrc:a});var u=c.matchPrefix(e,"b=");return u.length&&(0===u[0].indexOf("b=TIAS:")?u=parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")&&(u=parseInt(u[0].substr(5),10)),r.forEach(function(e){e.maxBitrate=u})),r},c.parseRtcpParameters=function(e){var t={},n=c.matchPrefix(e,"a=ssrc:").map(function(e){return c.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];n&&(t.cname=n.value,t.ssrc=n.ssrc);var r=c.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=0<r.length,t.compound=0===r.length;var i=c.matchPrefix(e,"a=rtcp-mux");return t.mux=0<i.length,t},c.parseMsid=function(e){var t,n=c.matchPrefix(e,"a=msid:");if(1===n.length)return{stream:(t=n[0].substr(7).split(" "))[0],track:t[1]};var r=c.matchPrefix(e,"a=ssrc:").map(function(e){return c.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return 0<r.length?{stream:(t=r[0].value.split(" "))[0],track:t[1]}:void 0},c.writeSessionBoilerplate=function(){return"v=0\r\no=thisisadapterortc 8169639915646943137 2 IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},c.writeMediaSection=function(e,t,n,r){var i=c.writeRtpDescription(e.kind,t);if(i+=c.writeIceParameters(e.iceGatherer.getLocalParameters()),i+=c.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===n?"actpass":"active"),i+="a=mid:"+e.mid+"\r\n",e.direction?i+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?i+="a=sendrecv\r\n":e.rtpSender?i+="a=sendonly\r\n":e.rtpReceiver?i+="a=recvonly\r\n":i+="a=inactive\r\n",e.rtpSender){var o="msid:"+r.id+" "+e.rtpSender.track.id+"\r\n";i+="a="+o,i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,i+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+c.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+c.localCName+"\r\n"),i},c.getDirection=function(e,t){for(var n=c.splitLines(e),r=0;r<n.length;r++)switch(n[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return n[r].substr(2)}return t?c.getDirection(t):"sendrecv"},c.getKind=function(e){return c.splitLines(e)[0].split(" ")[0].substr(2)},c.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.exports=c},{}],21:[function(e,t,n){"function"==typeof Object.create?t.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:t.exports=function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},{}],22:[function(e,t,n){t.exports=function(e){return e&&"object"===(void 0===e?"undefined":_typeof(e))&&"function"==typeof e.copy&&"function"==typeof e.fill&&"function"==typeof e.readUInt8}},{}],23:[function(f,e,A){(function(r,i){var a=/%[sdj%]/g;A.format=function(e){if(!T(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(l(arguments[n]));return t.join(" ")}n=1;for(var r=arguments,i=r.length,o=String(e).replace(a,function(e){if("%%"===e)return"%";if(i<=n)return e;switch(e){case"%s":return String(r[n++]);case"%d":return Number(r[n++]);case"%j":try{return JSON.stringify(r[n++])}catch(e){return"[Circular]"}default:return e}}),s=r[n];n<i;s=r[++n])S(s)||!c(s)?o+=" "+s:o+=" "+l(s);return o},A.deprecate=function(e,t){if(w(i.process))return function(){return A.deprecate(e,t).apply(this,arguments)};if(!0===r.noDeprecation)return e;var n=!1;return function(){if(!n){if(r.throwDeprecation)throw new Error(t);r.traceDeprecation?console.trace(t):console.error(t),n=!0}return e.apply(this,arguments)}};var e,o={};function l(e,t){var n={seen:[],stylize:u};return 3<=arguments.length&&(n.depth=arguments[2]),4<=arguments.length&&(n.colors=arguments[3]),b(t)?n.showHidden=t:t&&A._extend(n,t),w(n.showHidden)&&(n.showHidden=!1),w(n.depth)&&(n.depth=2),w(n.colors)&&(n.colors=!1),w(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=s),g(n,e,n.depth)}function s(e,t){var n=l.styles[t];return n?"["+l.colors[n][0]+"m"+e+"["+l.colors[n][1]+"m":e}function u(e,t){return e}function g(t,n,r){if(t.customInspect&&n&&I(n.inspect)&&n.inspect!==A.inspect&&(!n.constructor||n.constructor.prototype!==n)){var e=n.inspect(r,t);return T(e)||(e=g(t,e,r)),e}var i=function(e,t){if(w(t))return e.stylize("undefined","undefined");if(T(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return C(t)?e.stylize(""+t,"number"):b(t)?e.stylize(""+t,"boolean"):S(t)?e.stylize("null","null"):void 0}(t,n);if(i)return i;var o,s=Object.keys(n),a=(o={},s.forEach(function(e,t){o[e]=!0}),o);if(t.showHidden&&(s=Object.getOwnPropertyNames(n)),R(n)&&(0<=s.indexOf("message")||0<=s.indexOf("description")))return m(n);if(0===s.length){if(I(n)){var l=n.name?": "+n.name:"";return t.stylize("[Function"+l+"]","special")}if(E(n))return t.stylize(RegExp.prototype.toString.call(n),"regexp");if(k(n))return t.stylize(Date.prototype.toString.call(n),"date");if(R(n))return m(n)}var u,c,d,f,h="",p=!1,v=["{","}"];return _(n)&&(p=!0,v=["[","]"]),I(n)&&(h=" [Function"+(n.name?": "+n.name:"")+"]"),E(n)&&(h=" "+RegExp.prototype.toString.call(n)),k(n)&&(h=" "+Date.prototype.toUTCString.call(n)),R(n)&&(h=" "+m(n)),0!==s.length||p&&0!=n.length?r<0?E(n)?t.stylize(RegExp.prototype.toString.call(n),"regexp"):t.stylize("[Object]","special"):(t.seen.push(n),u=p?function(t,n,r,i,e){for(var o=[],s=0,a=n.length;s<a;++s)P(n,String(s))?o.push(y(t,n,r,i,String(s),!0)):o.push("");return e.forEach(function(e){e.match(/^\d+$/)||o.push(y(t,n,r,i,e,!0))}),o}(t,n,r,a,s):s.map(function(e){return y(t,n,r,a,e,p)}),t.seen.pop(),d=h,f=v,60<(c=u).reduce(function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1},0)?f[0]+(""===d?"":d+"\n ")+" "+c.join(",\n  ")+" "+f[1]:f[0]+d+" "+c.join(", ")+" "+f[1]):v[0]+h+v[1]}function m(e){return"["+Error.prototype.toString.call(e)+"]"}function y(e,t,n,r,i,o){var s,a,l;if((l=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?a=l.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):l.set&&(a=e.stylize("[Setter]","special")),P(r,i)||(s="["+i+"]"),a||(e.seen.indexOf(l.value)<0?-1<(a=S(n)?g(e,l.value,null):g(e,l.value,n-1)).indexOf("\n")&&(a=o?a.split("\n").map(function(e){return"  "+e}).join("\n").substr(2):"\n"+a.split("\n").map(function(e){return"   "+e}).join("\n")):a=e.stylize("[Circular]","special")),w(s)){if(o&&i.match(/^\d+$/))return a;(s=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(s=s.substr(1,s.length-2),s=e.stylize(s,"name")):(s=s.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),s=e.stylize(s,"string"))}return s+": "+a}function _(e){return Array.isArray(e)}function b(e){return"boolean"==typeof e}function S(e){return null===e}function C(e){return"number"==typeof e}function T(e){return"string"==typeof e}function w(e){return void 0===e}function E(e){return c(e)&&"[object RegExp]"===t(e)}function c(e){return"object"===(void 0===e?"undefined":_typeof(e))&&null!==e}function k(e){return c(e)&&"[object Date]"===t(e)}function R(e){return c(e)&&("[object Error]"===t(e)||e instanceof Error)}function I(e){return"function"==typeof e}function t(e){return Object.prototype.toString.call(e)}function n(e){return e<10?"0"+e.toString(10):e.toString(10)}A.debuglog=function(t){if(w(e)&&(e=r.env.NODE_DEBUG||""),t=t.toUpperCase(),!o[t])if(new RegExp("\\b"+t+"\\b","i").test(e)){var n=r.pid;o[t]=function(){var e=A.format.apply(A,arguments);console.error("%s %d: %s",t,n,e)}}else o[t]=function(){};return o[t]},(A.inspect=l).colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},l.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},A.isArray=_,A.isBoolean=b,A.isNull=S,A.isNullOrUndefined=function(e){return null==e},A.isNumber=C,A.isString=T,A.isSymbol=function(e){return"symbol"===(void 0===e?"undefined":_typeof(e))},A.isUndefined=w,A.isRegExp=E,A.isObject=c,A.isDate=k,A.isError=R,A.isFunction=I,A.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"===(void 0===e?"undefined":_typeof(e))||void 0===e},A.isBuffer=f("./support/isBuffer");var d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function P(e,t){return Object.prototype.hasOwnProperty.call(e,t)}A.log=function(){var e,t;console.log("%s - %s",(e=new Date,t=[n(e.getHours()),n(e.getMinutes()),n(e.getSeconds())].join(":"),[e.getDate(),d[e.getMonth()],t].join(" ")),A.format.apply(A,arguments))},A.inherits=f("inherits"),A._extend=function(e,t){if(!t||!c(t))return e;for(var n=Object.keys(t),r=n.length;r--;)e[n[r]]=t[n[r]];return e}}).call(this,f("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./support/isBuffer":22,_process:15,inherits:21}],24:[function(a,l,e){!function(){var e=a("./utils"),t=e.log,n=e.browserDetails;l.exports.browserDetails=n,l.exports.extractVersion=e.extractVersion,l.exports.disableLog=e.disableLog;var r=a("./chrome/chrome_shim")||null,i=a("./edge/edge_shim")||null,o=a("./firefox/firefox_shim")||null,s=a("./safari/safari_shim")||null;switch(n.browser){case"chrome":if(!r||!r.shimPeerConnection)return t("Chrome shim is not included in this adapter release.");t("adapter.js shimming chrome."),(l.exports.browserShim=r).shimGetUserMedia(),r.shimMediaStream(),e.shimCreateObjectURL(),r.shimSourceObject(),r.shimPeerConnection(),r.shimOnTrack(),r.shimGetSendersWithDtmf();break;case"firefox":if(!o||!o.shimPeerConnection)return t("Firefox shim is not included in this adapter release.");t("adapter.js shimming firefox."),(l.exports.browserShim=o).shimGetUserMedia(),e.shimCreateObjectURL(),o.shimSourceObject(),o.shimPeerConnection(),o.shimOnTrack();break;case"edge":if(!i||!i.shimPeerConnection)return t("MS edge shim is not included in this adapter release.");t("adapter.js shimming edge."),(l.exports.browserShim=i).shimGetUserMedia(),e.shimCreateObjectURL(),i.shimPeerConnection(),i.shimReplaceTrack();break;case"safari":if(!s)return t("Safari shim is not included in this adapter release.");t("adapter.js shimming safari."),(l.exports.browserShim=s).shimCallbacksAPI(),s.shimAddStream(),s.shimOnAddStream(),s.shimGetUserMedia();break;default:t("Unsupported browser!")}}()},{"./chrome/chrome_shim":25,"./edge/edge_shim":27,"./firefox/firefox_shim":30,"./safari/safari_shim":32,"./utils":33}],25:[function(e,t,n){var r=e("../utils.js").log,i=e("../utils.js").browserDetails,o={shimMediaStream:function(){window.MediaStream=window.MediaStream||window.webkitMediaStream},shimOnTrack:function(){"object"!==("undefined"==typeof window?"undefined":_typeof(window))||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){var i=this;this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(r){r.stream.addEventListener("addtrack",function(t){var e;e=RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(e){return e.track.id===t.track.id}):{track:t.track};var n=new Event("track");n.track=t.track,n.receiver=e,n.streams=[r.stream],i.dispatchEvent(n)}),r.stream.getTracks().forEach(function(t){var e;e=RTCPeerConnection.prototype.getReceivers?i.getReceivers().find(function(e){return e.track.id===t.id}):{track:t};var n=new Event("track");n.track=t,n.receiver=e,n.streams=[r.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))}})},shimGetSendersWithDtmf:function(){if("object"===("undefined"==typeof window?"undefined":_typeof(window))&&window.RTCPeerConnection&&!("getSenders"in RTCPeerConnection.prototype)&&"createDTMFSender"in RTCPeerConnection.prototype){RTCPeerConnection.prototype.getSenders=function(){return this._senders||[]};var n=RTCPeerConnection.prototype.addStream,t=RTCPeerConnection.prototype.removeStream;RTCPeerConnection.prototype.addTrack||(RTCPeerConnection.prototype.addTrack=function(t,e){var n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(n._senders=n._senders||[],n._senders.find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");n._streams=n._streams||{};var i=n._streams[e.id];if(i)i.addTrack(t),n.removeStream(i),n.addStream(i);else{var o=new MediaStream([t]);n._streams[e.id]=o,n.addStream(o)}var s={track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=n.createDTMFSender(t):this._dtmf=null),this._dtmf}};return n._senders.push(s),s}),RTCPeerConnection.prototype.addStream=function(e){var t=this;t._senders=t._senders||[],n.apply(t,[e]),e.getTracks().forEach(function(e){t._senders.push({track:e,get dtmf(){return void 0===this._dtmf&&("audio"===e.kind?this._dtmf=t.createDTMFSender(e):this._dtmf=null),this._dtmf}})})},RTCPeerConnection.prototype.removeStream=function(e){var n=this;n._senders=n._senders||[],t.apply(n,[e]),e.getTracks().forEach(function(t){var e=n._senders.find(function(e){return e.track===t});e&&n._senders.splice(n._senders.indexOf(e),1)})}}},shimSourceObject:function(){"object"===("undefined"==typeof window?"undefined":_typeof(window))&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var t=this;this._srcObject=e,this.src&&URL.revokeObjectURL(this.src),e?(this.src=URL.createObjectURL(e),e.addEventListener("addtrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)}),e.addEventListener("removetrack",function(){t.src&&URL.revokeObjectURL(t.src),t.src=URL.createObjectURL(e)})):this.src=""}}))},shimPeerConnection:function(){if(window.RTCPeerConnection){var o=RTCPeerConnection;window.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var n=[],r=0;r<e.iceServers.length;r++){var i=e.iceServers[r];!i.hasOwnProperty("urls")&&i.hasOwnProperty("url")?(console.warn("RTCIceServer.url is deprecated! Use urls instead."),(i=JSON.parse(JSON.stringify(i))).urls=i.url,n.push(i)):n.push(e.iceServers[r])}e.iceServers=n}return new o(e,t)},window.RTCPeerConnection.prototype=o.prototype,Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return o.generateCertificate}})}else window.RTCPeerConnection=function(e,t){return r("PeerConnection"),e&&e.iceTransportPolicy&&(e.iceTransports=e.iceTransportPolicy),new webkitRTCPeerConnection(e,t)},window.RTCPeerConnection.prototype=webkitRTCPeerConnection.prototype,webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return webkitRTCPeerConnection.generateCertificate}});var a=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(e,t,n){var r=this,i=arguments;if(0<arguments.length&&"function"==typeof e)return a.apply(this,arguments);if(0===a.length&&(0===arguments.length||"function"!=typeof e))return a.apply(this,[]);var o=function(e){var r={};return e.result().forEach(function(t){var n={id:t.id,timestamp:t.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[t.type]||t.type};t.names().forEach(function(e){n[e]=t.stat(e)}),r[n.id]=n}),r},s=function(t){return new Map(Object.keys(t).map(function(e){return[e,t[e]]}))};return 2<=arguments.length?a.apply(this,[function(e){i[1](s(o(e)))},e]):new Promise(function(t,e){a.apply(r,[function(e){t(s(o(e)))},e])}).then(t,n)},i.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var i=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){var n=arguments,r=this,e=new Promise(function(e,t){i.apply(r,[n[0],e,t])});return n.length<2?e:e.then(function(){n[1].apply(null,[])},function(e){3<=n.length&&n[2].apply(null,[e])})}}),i.version<52&&["createOffer","createAnswer"].forEach(function(e){var i=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){var n=this;if(arguments.length<1||1===arguments.length&&"object"===_typeof(arguments[0])){var r=1===arguments.length?arguments[0]:void 0;return new Promise(function(e,t){i.apply(n,[e,t,r])})}return i.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};t.exports={shimMediaStream:o.shimMediaStream,shimOnTrack:o.shimOnTrack,shimGetSendersWithDtmf:o.shimGetSendersWithDtmf,shimSourceObject:o.shimSourceObject,shimPeerConnection:o.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils.js":33,"./getusermedia":26}],26:[function(e,t,n){var a=e("../utils.js").log,l=e("../utils.js").browserDetails;t.exports=function(){var s=function(i){if("object"!==(void 0===i?"undefined":_typeof(i))||i.mandatory||i.optional)return i;var o={};return Object.keys(i).forEach(function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var n="object"===_typeof(i[t])?i[t]:{ideal:i[t]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){o.optional=o.optional||[];var e={};"number"==typeof n.ideal?(e[r("min",t)]=n.ideal,o.optional.push(e),(e={})[r("max",t)]=n.ideal):e[r("",t)]=n.ideal,o.optional.push(e)}void 0!==n.exact&&"number"!=typeof n.exact?(o.mandatory=o.mandatory||{},o.mandatory[r("",t)]=n.exact):["min","max"].forEach(function(e){void 0!==n[e]&&(o.mandatory=o.mandatory||{},o.mandatory[r(e,t)]=n[e])})}}),i.advanced&&(o.optional=(o.optional||[]).concat(i.advanced)),o},r=function(n,r){if((n=JSON.parse(JSON.stringify(n)))&&n.audio&&(n.audio=s(n.audio)),n&&"object"===_typeof(n.video)){var i=n.video.facingMode;i=i&&("object"===(void 0===i?"undefined":_typeof(i))?i:{ideal:i});var o,e=l.version<61;if(i&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!navigator.mediaDevices.getSupportedConstraints||!navigator.mediaDevices.getSupportedConstraints().facingMode||e)&&(delete n.video.facingMode,"environment"===i.exact||"environment"===i.ideal?o=["back","rear"]:"user"!==i.exact&&"user"!==i.ideal||(o=["front"]),o))return navigator.mediaDevices.enumerateDevices().then(function(e){var t=(e=e.filter(function(e){return"videoinput"===e.kind})).find(function(t){return o.some(function(e){return-1!==t.label.toLowerCase().indexOf(e)})});return!t&&e.length&&-1!==o.indexOf("back")&&(t=e[e.length-1]),t&&(n.video.deviceId=i.exact?{exact:t.deviceId}:{ideal:t.deviceId}),n.video=s(n.video),a("chrome: "+JSON.stringify(n)),r(n)});n.video=s(n.video)}return a("chrome: "+JSON.stringify(n)),r(n)},i=function(e){return{name:{ConstraintNotSatisfiedError:"OverconstrainedError",PermissionDeniedError:"NotAllowedError",TrackStartError:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};navigator.getUserMedia=function(e,t,n){r(e,function(e){navigator.webkitGetUserMedia(e,t,function(e){n(i(e))})})};var t=function(n){return new Promise(function(e,t){navigator.getUserMedia(n,e,t)})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:t,enumerateDevices:function(){return new Promise(function(t){var n={audio:"audioinput",video:"videoinput"};return MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),navigator.mediaDevices.getUserMedia){var n=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return r(e,function(t){return n(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return e},function(e){return Promise.reject(i(e))})})}}else navigator.mediaDevices.getUserMedia=function(e){return t(e)};void 0===navigator.mediaDevices.addEventListener&&(navigator.mediaDevices.addEventListener=function(){a("Dummy mediaDevices.addEventListener called.")}),void 0===navigator.mediaDevices.removeEventListener&&(navigator.mediaDevices.removeEventListener=function(){a("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":33}],27:[function(e,t,n){var r=e("../utils").browserDetails,i=e("./rtcpeerconnection_shim");t.exports={shimGetUserMedia:e("./getusermedia"),shimPeerConnection:function(){if(window.RTCIceGatherer&&(window.RTCIceCandidate||(window.RTCIceCandidate=function(e){return e}),window.RTCSessionDescription||(window.RTCSessionDescription=function(e){return e}),r.version<15025)){var n=Object.getOwnPropertyDescriptor(MediaStreamTrack.prototype,"enabled");Object.defineProperty(MediaStreamTrack.prototype,"enabled",{set:function(e){n.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}window.RTCPeerConnection=i(r.version)},shimReplaceTrack:function(){!window.RTCRtpSender||"replaceTrack"in RTCRtpSender.prototype||(RTCRtpSender.prototype.replaceTrack=RTCRtpSender.prototype.setTrack)}}},{"../utils":33,"./getusermedia":28,"./rtcpeerconnection_shim":29}],28:[function(e,t,n){t.exports=function(){var t=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(e){return t(e).catch(function(e){return Promise.reject({name:{PermissionDeniedError:"NotAllowedError"}[(t=e).name]||t.name,message:t.message,constraint:t.constraint,toString:function(){return this.name}});var t})}}},{}],29:[function(e,t,n){var M=e("sdp");function p(u,c){var d={codecs:[],headerExtensions:[],fecMechanisms:[]},f=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]};return u.codecs.forEach(function(n){for(var e=0;e<c.codecs.length;e++){var t=c.codecs[e];if(n.name.toLowerCase()===t.name.toLowerCase()&&n.clockRate===t.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&t.parameters.apt&&(r=n,i=t,o=u.codecs,s=c.codecs,l=a=void 0,a=f(r.parameters.apt,o),l=f(i.parameters.apt,s),!a||!l||a.name.toLowerCase()!==l.name.toLowerCase()))continue;(t=JSON.parse(JSON.stringify(t))).numChannels=Math.min(n.numChannels,t.numChannels),d.codecs.push(t),t.rtcpFeedback=t.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}var r,i,o,s,a,l}),u.headerExtensions.forEach(function(e){for(var t=0;t<c.headerExtensions.length;t++){var n=c.headerExtensions[t];if(e.uri===n.uri){d.headerExtensions.push(n);break}}}),d}function s(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}t.exports=function(O){var e=function(e){var t,r,i,n=this,o=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){n[e]=o[e].bind(o)}),this.needNegotiation=!1,this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onicegatheringstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.canTrickleIceCandidates=null,this.localStreams=[],this.remoteStreams=[],this.getLocalStreams=function(){return n.localStreams},this.getRemoteStreams=function(){return n.remoteStreams},this.localDescription=new RTCSessionDescription({type:"",sdp:""}),this.remoteDescription=new RTCSessionDescription({type:"",sdp:""}),this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",this.iceOptions={gatherPolicy:"all",iceServers:[]},e&&e.iceTransportPolicy)switch(e.iceTransportPolicy){case"all":case"relay":this.iceOptions.gatherPolicy=e.iceTransportPolicy}this.usingBundle=e&&"max-bundle"===e.bundlePolicy,e&&e.iceServers&&(this.iceOptions.iceServers=(t=e.iceServers,r=O,i=!1,(t=JSON.parse(JSON.stringify(t))).filter(function(e){if(e&&(e.urls||e.url)){var t=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var n="string"==typeof t;return n&&(t=[t]),t=t.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||i?0===e.indexOf("stun:")&&14393<=r:i=!0}),delete e.url,e.urls=n?t[0]:t,!!t.length}return!1}))),this._config=e||{},this.transceivers=[],this._localIceCandidatesBuffer=[]};return e.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this.dispatchEvent(e),null!==this.onicegatheringstatechange&&this.onicegatheringstatechange(e)},e.prototype._emitBufferedCandidates=function(){var n=this,r=M.splitSections(n.localDescription.sdp);this._localIceCandidatesBuffer.forEach(function(e){if(e.candidate&&0!==Object.keys(e.candidate).length)r[e.candidate.sdpMLineIndex+1]+="a="+e.candidate.candidate+"\r\n";else for(var t=1;t<r.length;t++)-1===r[t].indexOf("\r\na=end-of-candidates\r\n")&&(r[t]+="a=end-of-candidates\r\n");n.localDescription.sdp=r.join(""),n.dispatchEvent(e),null!==n.onicecandidate&&n.onicecandidate(e),e.candidate||"complete"===n.iceGatheringState||n.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state})&&"complete"!==n.iceGatheringStateChange&&(n.iceGatheringState="complete",n._emitGatheringStateChange())}),this._localIceCandidatesBuffer=[]},e.prototype.getConfiguration=function(){return this._config},e.prototype._createTransceiver=function(e){var t=0<this.transceivers.length,n={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,wantReceive:!0};if(this.usingBundle&&t)n.iceTransport=this.transceivers[0].iceTransport,n.dtlsTransport=this.transceivers[0].dtlsTransport;else{var r=this._createIceAndDtlsTransports();n.iceTransport=r.iceTransport,n.dtlsTransport=r.dtlsTransport}return this.transceivers.push(n),n},e.prototype.addTrack=function(e,t){for(var n,r=0;r<this.transceivers.length;r++)this.transceivers[r].track||this.transceivers[r].kind!==e.kind||(n=this.transceivers[r]);return n||(n=this._createTransceiver(e.kind)),n.track=e,n.stream=t,n.rtpSender=new RTCRtpSender(e,n.dtlsTransport),this._maybeFireNegotiationNeeded(),n.rtpSender},e.prototype.addStream=function(t){var n=this;if(15025<=O)this.localStreams.push(t),t.getTracks().forEach(function(e){n.addTrack(e,t)});else{var r=t.clone();t.getTracks().forEach(function(e,t){var n=r.getTracks()[t];e.addEventListener("enabled",function(e){n.enabled=e.enabled})}),r.getTracks().forEach(function(e){n.addTrack(e,r)}),this.localStreams.push(r)}this._maybeFireNegotiationNeeded()},e.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);-1<t&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},e.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},e.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},e.prototype._createIceGatherer=function(s,a){var l=this,u=new RTCIceGatherer(l.iceOptions);return u.onlocalcandidate=function(e){var t=new Event("icecandidate");t.candidate={sdpMid:s,sdpMLineIndex:a};var n=e.candidate,r=!n||0===Object.keys(n).length;r?void 0===u.state&&(u.state="completed"):(n.component=1,t.candidate.candidate=M.writeCandidate(n));var i=M.splitSections(l.localDescription.sdp);i[t.candidate.sdpMLineIndex+1]+=r?"a=end-of-candidates\r\n":"a="+t.candidate.candidate+"\r\n",l.localDescription.sdp=i.join("");var o=(l._pendingOffer?l._pendingOffer:l.transceivers).every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});switch(l.iceGatheringState){case"new":r||l._localIceCandidatesBuffer.push(t),r&&o&&l._localIceCandidatesBuffer.push(new Event("icecandidate"));break;case"gathering":l._emitBufferedCandidates(),r||(l.dispatchEvent(t),null!==l.onicecandidate&&l.onicecandidate(t)),o&&(l.dispatchEvent(new Event("icecandidate")),null!==l.onicecandidate&&l.onicecandidate(new Event("icecandidate")),l.iceGatheringState="complete",l._emitGatheringStateChange())}},u},e.prototype._createIceAndDtlsTransports=function(){var e=this,t=new RTCIceTransport(null);t.onicestatechange=function(){e._updateConnectionState()};var n=new RTCDtlsTransport(t);return n.ondtlsstatechange=function(){e._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),e._updateConnectionState()},{iceTransport:t,dtlsTransport:n}},e.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var r=this.transceivers[e].dtlsTransport;r&&(delete r.ondtlssttatechange,delete r.onerror,delete this.transceivers[e].dtlsTransport)},e.prototype._transceive=function(e,t,n){var r=p(e.localCapabilities,e.remoteCapabilities);t&&e.rtpSender&&(r.encodings=e.sendEncodingParameters,r.rtcp={cname:M.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(r.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(r)),n&&e.rtpReceiver&&("video"===e.kind&&e.recvEncodingParameters&&O<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),r.encodings=e.recvEncodingParameters,r.rtcp={cname:e.rtcpParameters.cname,compound:e.rtcpParameters.compound},e.sendEncodingParameters.length&&(r.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(r))},e.prototype.setLocalDescription=function(e){var t,d,f=this;if(!s("setLocalDescription",e.type,this.signalingState)){var n=new Error("Can not set local "+e.type+" in state "+this.signalingState);return n.name="InvalidStateError",2<arguments.length&&"function"==typeof arguments[2]&&window.setTimeout(arguments[2],0,n),Promise.reject(n)}if("offer"===e.type)this._pendingOffer&&(t=M.splitSections(e.sdp),d=t.shift(),t.forEach(function(e,t){var n=M.parseRtpParameters(e);f._pendingOffer[t].localCapabilities=n}),this.transceivers=this._pendingOffer,delete this._pendingOffer);else if("answer"===e.type){t=M.splitSections(f.remoteDescription.sdp),d=t.shift();var h=0<M.matchPrefix(d,"a=ice-lite").length;t.forEach(function(e,t){var n=f.transceivers[t],r=n.iceGatherer,i=n.iceTransport,o=n.dtlsTransport,s=n.localCapabilities,a=n.remoteCapabilities;if(!M.isRejected(e)&&!n.isDatachannel){var l=M.getIceParameters(e,d),u=M.getDtlsParameters(e,d);h&&(u.role="server"),f.usingBundle&&0!==t||(i.start(r,l,h?"controlling":"controlled"),o.start(u));var c=p(s,a);f._transceive(n,0<c.codecs.length,!1)}})}switch(this.localDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var r=1<arguments.length&&"function"==typeof arguments[1];if(r){var i=arguments[1];window.setTimeout(function(){i(),"new"===f.iceGatheringState&&(f.iceGatheringState="gathering",f._emitGatheringStateChange()),f._emitBufferedCandidates()},0)}var o=Promise.resolve();return o.then(function(){r||("new"===f.iceGatheringState&&(f.iceGatheringState="gathering",f._emitGatheringStateChange()),window.setTimeout(f._emitBufferedCandidates.bind(f),500))}),o},e.prototype.setRemoteDescription=function(w){var E=this;if(!s("setRemoteDescription",w.type,this.signalingState)){var e=new Error("Can not set remote "+w.type+" in state "+this.signalingState);return e.name="InvalidStateError",2<arguments.length&&"function"==typeof arguments[2]&&window.setTimeout(arguments[2],0,e),Promise.reject(e)}var k={},R=[],t=M.splitSections(w.sdp),I=t.shift(),P=0<M.matchPrefix(I,"a=ice-lite").length,A=0<M.matchPrefix(I,"a=group:BUNDLE ").length;this.usingBundle=A;var n=M.matchPrefix(I,"a=ice-options:")[0];switch(this.canTrickleIceCandidates=!!n&&0<=n.substr(14).split(" ").indexOf("trickle"),t.forEach(function(e,t){var n=M.splitLines(e),r=M.getKind(e),i=M.isRejected(e),o=n[0].substr(2).split(" ")[2],s=M.getDirection(e,I),a=M.parseMsid(e),l=M.getMid(e)||M.generateIdentifier();if("application"!==r||"DTLS/SCTP"!==o){var u,c,d,f,h,p,v,g,m,y,_,b=M.parseRtpParameters(e);i||(y=M.getIceParameters(e,I),(_=M.getDtlsParameters(e,I)).role="client"),v=M.parseRtpEncodingParameters(e);var S=M.parseRtcpParameters(e),C=0<M.matchPrefix(e,"a=end-of-candidates",I).length,T=M.matchPrefix(e,"a=candidate:").map(function(e){return M.parseCandidate(e)}).filter(function(e){return"1"===e.component||1===e.component});"offer"!==w.type||i?"answer"!==w.type||i||(A&&0<t&&(E._disposeIceAndDtlsTransports(t),E.transceivers[t].iceGatherer=E.transceivers[0].iceGatherer,E.transceivers[t].iceTransport=E.transceivers[0].iceTransport,E.transceivers[t].dtlsTransport=E.transceivers[0].dtlsTransport,E.transceivers[t].rtpSender&&E.transceivers[t].rtpSender.setTransport(E.transceivers[0].dtlsTransport),E.transceivers[t].rtpReceiver&&E.transceivers[t].rtpReceiver.setTransport(E.transceivers[0].dtlsTransport)),c=(u=E.transceivers[t]).iceGatherer,d=u.iceTransport,f=u.dtlsTransport,h=u.rtpReceiver,p=u.sendEncodingParameters,g=u.localCapabilities,E.transceivers[t].recvEncodingParameters=v,E.transceivers[t].remoteCapabilities=b,E.transceivers[t].rtcpParameters=S,(P||C)&&T.length&&d.setRemoteCandidates(T),A&&0!==t||(d.start(c,y,"controlling"),f.start(_)),E._transceive(u,"sendrecv"===s||"recvonly"===s,"sendrecv"===s||"sendonly"===s),!h||"sendrecv"!==s&&"sendonly"!==s?delete u.rtpReceiver:(m=h.track,a?(k[a.stream]||(k[a.stream]=new MediaStream),k[a.stream].addTrack(m),R.push([m,h,k[a.stream]])):(k.default||(k.default=new MediaStream),k.default.addTrack(m),R.push([m,h,k.default])))):((u=E.transceivers[t]||E._createTransceiver(r)).mid=l,u.iceGatherer||(u.iceGatherer=A&&0<t?E.transceivers[0].iceGatherer:E._createIceGatherer(l,t)),!C||A&&0!==t||u.iceTransport.setRemoteCandidates(T),g=RTCRtpReceiver.getCapabilities(r),O<15019&&(g.codecs=g.codecs.filter(function(e){return"rtx"!==e.name})),p=[{ssrc:1001*(2*t+2)}],"sendrecv"!==s&&"sendonly"!==s||(m=(h=new RTCRtpReceiver(u.dtlsTransport,r)).track,a?(k[a.stream]||(k[a.stream]=new MediaStream,Object.defineProperty(k[a.stream],"id",{get:function(){return a.stream}})),Object.defineProperty(m,"id",{get:function(){return a.track}}),k[a.stream].addTrack(m),R.push([m,h,k[a.stream]])):(k.default||(k.default=new MediaStream),k.default.addTrack(m),R.push([m,h,k.default]))),u.localCapabilities=g,u.remoteCapabilities=b,u.rtpReceiver=h,u.rtcpParameters=S,u.sendEncodingParameters=p,u.recvEncodingParameters=v,E._transceive(E.transceivers[t],!1,"sendrecv"===s||"sendonly"===s))}else E.transceivers[t]={mid:l,isDatachannel:!0}}),this.remoteDescription={type:w.type,sdp:w.sdp},w.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+w.type+'"')}return Object.keys(k).forEach(function(e){var i=k[e];if(i.getTracks().length){E.remoteStreams.push(i);var t=new Event("addstream");t.stream=i,E.dispatchEvent(t),null!==E.onaddstream&&window.setTimeout(function(){E.onaddstream(t)},0),R.forEach(function(e){var t=e[0],n=e[1];if(i.id===e[2].id){var r=new Event("track");r.track=t,r.receiver=n,r.streams=[i],E.dispatchEvent(r),null!==E.ontrack&&window.setTimeout(function(){E.ontrack(r)},0)}})}}),window.setTimeout(function(){E&&E.transceivers&&E.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&0<e.iceTransport.getRemoteCandidates().length&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),1<arguments.length&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},e.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},e.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t),null!==this.onsignalingstatechange&&this.onsignalingstatechange(t)},e.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,window.setTimeout(function(){if(!1!==t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t.dispatchEvent(e),null!==t.onnegotiationneeded&&t.onnegotiationneeded(e)}},0))},e.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",0<t.failed?e="failed":0<t.connecting||0<t.checking?e="connecting":0<t.disconnected?e="disconnected":0<t.new?e="new":(0<t.connected||0<t.completed)&&(e="connected"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this.dispatchEvent(n),null!==this.oniceconnectionstatechange&&this.oniceconnectionstatechange(n)}},e.prototype.createOffer=function(){var e,a=this;if(this._pendingOffer)throw new Error("createOffer called while there is a pending offer.");1===arguments.length&&"function"!=typeof arguments[0]?e=arguments[0]:3===arguments.length&&(e=arguments[2]);var t=this.transceivers.filter(function(e){return"audio"===e.kind}).length,n=this.transceivers.filter(function(e){return"video"===e.kind}).length;if(e){if(e.mandatory||e.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==e.offerToReceiveAudio&&(t=!0===e.offerToReceiveAudio?1:!1===e.offerToReceiveAudio?0:e.offerToReceiveAudio),void 0!==e.offerToReceiveVideo&&(n=!0===e.offerToReceiveVideo?1:!1===e.offerToReceiveVideo?0:e.offerToReceiveVideo)}for(this.transceivers.forEach(function(e){"audio"===e.kind?--t<0&&(e.wantReceive=!1):"video"===e.kind&&--n<0&&(e.wantReceive=!1)});0<t||0<n;)0<t&&(this._createTransceiver("audio"),t--),0<n&&(this._createTransceiver("video"),n--);var l=function(e){var t=e.filter(function(e){return"audio"===e.kind}),n=e.filter(function(e){return"video"===e.kind});for(e=[];t.length||n.length;)t.length&&e.push(t.shift()),n.length&&e.push(n.shift());return e}(this.transceivers),r=M.writeSessionBoilerplate();l.forEach(function(e,t){var n=e.track,r=e.kind,i=M.generateIdentifier();e.mid=i,e.iceGatherer||(e.iceGatherer=a.usingBundle&&0<t?l[0].iceGatherer:a._createIceGatherer(i,t));var o=RTCRtpSender.getCapabilities(r);O<15019&&(o.codecs=o.codecs.filter(function(e){return"rtx"!==e.name})),o.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1")});var s=[{ssrc:1001*(2*t+1)}];n&&15019<=O&&"video"===r&&(s[0].rtx={ssrc:1001*(2*t+1)+1}),e.wantReceive&&(e.rtpReceiver=new RTCRtpReceiver(e.dtlsTransport,r)),e.localCapabilities=o,e.sendEncodingParameters=s}),"max-compat"!==this._config.bundlePolicy&&(r+="a=group:BUNDLE "+l.map(function(e){return e.mid}).join(" ")+"\r\n"),r+="a=ice-options:trickle\r\n",l.forEach(function(e,t){r+=M.writeMediaSection(e,e.localCapabilities,"offer",e.stream),r+="a=rtcp-rsize\r\n"}),this._pendingOffer=l;var i=new RTCSessionDescription({type:"offer",sdp:r});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,i),Promise.resolve(i)},e.prototype.createAnswer=function(){var i=M.writeSessionBoilerplate();this.usingBundle&&(i+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),this.transceivers.forEach(function(e,t){if(e.isDatachannel)i+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+e.mid+"\r\n";else{var n;e.stream&&("audio"===e.kind?n=e.stream.getAudioTracks()[0]:"video"===e.kind&&(n=e.stream.getVideoTracks()[0]),n&&15019<=O&&"video"===e.kind&&(e.sendEncodingParameters[0].rtx={ssrc:1001*(2*t+2)+1}));var r=p(e.localCapabilities,e.remoteCapabilities);!r.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,i+=M.writeMediaSection(e,r,"answer",e.stream),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(i+="a=rtcp-rsize\r\n")}});var e=new RTCSessionDescription({type:"answer",sdp:i});return arguments.length&&"function"==typeof arguments[0]&&window.setTimeout(arguments[0],0,e),Promise.resolve(e)},e.prototype.addIceCandidate=function(e){if(e){var t=e.sdpMLineIndex;if(e.sdpMid)for(var n=0;n<this.transceivers.length;n++)if(this.transceivers[n].mid===e.sdpMid){t=n;break}var r=this.transceivers[t];if(r){var i=0<Object.keys(e.candidate).length?M.parseCandidate(e.candidate):{};if("tcp"===i.protocol&&(0===i.port||9===i.port))return Promise.resolve();if(i.component&&"1"!==i.component&&1!==i.component)return Promise.resolve();r.iceTransport.addRemoteCandidate(i);var o=M.splitSections(this.remoteDescription.sdp);o[t+1]+=(i.type?e.candidate.trim():"a=end-of-candidates")+"\r\n",this.remoteDescription.sdp=o.join("")}}else for(var s=0;s<this.transceivers.length;s++)if(this.transceivers[s].iceTransport.addRemoteCandidate({}),this.usingBundle)return Promise.resolve();return 1<arguments.length&&"function"==typeof arguments[1]&&window.setTimeout(arguments[1],0),Promise.resolve()},e.prototype.getStats=function(){var n=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(e){t[e]&&n.push(t[e].getStats())})});var i=1<arguments.length&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(t){var r=new Map;Promise.all(n).then(function(e){e.forEach(function(n){Object.keys(n).forEach(function(e){var t;n[e].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(t=n[e]).type]||t.type,r.set(e,n[e])})}),i&&window.setTimeout(i,0,r),t(r)})})},e}},{sdp:20}],30:[function(e,t,n){var a=e("../utils").browserDetails,r={shimOnTrack:function(){"object"!==("undefined"==typeof window?"undefined":_typeof(window))||!window.RTCPeerConnection||"ontrack"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(n){n.stream.getTracks().forEach(function(e){var t=new Event("track");t.track=e,t.receiver={track:e},t.streams=[n.stream],this.dispatchEvent(t)}.bind(this))}.bind(this))}})},shimSourceObject:function(){"object"===("undefined"==typeof window?"undefined":_typeof(window))&&(!window.HTMLMediaElement||"srcObject"in window.HTMLMediaElement.prototype||Object.defineProperty(window.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(){if("object"===("undefined"==typeof window?"undefined":_typeof(window))&&(window.RTCPeerConnection||window.mozRTCPeerConnection)){window.RTCPeerConnection||(window.RTCPeerConnection=function(e,t){if(a.version<38&&e&&e.iceServers){for(var n=[],r=0;r<e.iceServers.length;r++){var i=e.iceServers[r];if(i.hasOwnProperty("urls"))for(var o=0;o<i.urls.length;o++){var s={url:i.urls[o]};0===i.urls[o].indexOf("turn")&&(s.username=i.username,s.credential=i.credential),n.push(s)}else n.push(e.iceServers[r])}e.iceServers=n}return new mozRTCPeerConnection(e,t)},window.RTCPeerConnection.prototype=mozRTCPeerConnection.prototype,mozRTCPeerConnection.generateCertificate&&Object.defineProperty(window.RTCPeerConnection,"generateCertificate",{get:function(){return mozRTCPeerConnection.generateCertificate}}),window.RTCSessionDescription=mozRTCSessionDescription,window.RTCIceCandidate=mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(e){var t=RTCPeerConnection.prototype[e];RTCPeerConnection.prototype[e]=function(){return arguments[0]=new("addIceCandidate"===e?RTCIceCandidate:RTCSessionDescription)(arguments[0]),t.apply(this,arguments)}});var e=RTCPeerConnection.prototype.addIceCandidate;RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?e.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},n=RTCPeerConnection.prototype.getStats;RTCPeerConnection.prototype.getStats=function(e,i,t){return n.apply(this,[e||null]).then(function(n){var t,r;if(a.version<48&&(t=n,r=new Map,Object.keys(t).forEach(function(e){r.set(e,t[e]),r[e]=t[e]}),n=r),a.version<53&&!i)try{n.forEach(function(e){e.type=o[e.type]||e.type})}catch(e){if("TypeError"!==e.name)throw e;n.forEach(function(e,t){n.set(t,Object.assign({},e,{type:o[e.type]||e.type}))})}return n}).then(i,t)}}}};t.exports={shimOnTrack:r.shimOnTrack,shimSourceObject:r.shimSourceObject,shimPeerConnection:r.shimPeerConnection,shimGetUserMedia:e("./getusermedia")}},{"../utils":33,"./getusermedia":31}],31:[function(e,t,n){var o=e("../utils").log,s=e("../utils").browserDetails;t.exports=function(){var i=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},r=function(e,t,n){var r=function(r){if("object"!==(void 0===r?"undefined":_typeof(r))||r.require)return r;var i=[];return Object.keys(r).forEach(function(e){if("require"!==e&&"advanced"!==e&&"mediaSource"!==e){var t=r[e]="object"===_typeof(r[e])?r[e]:{ideal:r[e]};if(void 0===t.min&&void 0===t.max&&void 0===t.exact||i.push(e),void 0!==t.exact&&("number"==typeof t.exact?t.min=t.max=t.exact:r[e]=t.exact,delete t.exact),void 0!==t.ideal){r.advanced=r.advanced||[];var n={};"number"==typeof t.ideal?n[e]={min:t.ideal,max:t.ideal}:n[e]=t.ideal,r.advanced.push(n),delete t.ideal,Object.keys(t).length||delete r[e]}}}),i.length&&(r.require=i),r};return e=JSON.parse(JSON.stringify(e)),s.version<38&&(o("spec: "+JSON.stringify(e)),e.audio&&(e.audio=r(e.audio)),e.video&&(e.video=r(e.video)),o("ff37: "+JSON.stringify(e))),navigator.mozGetUserMedia(e,t,function(e){n(i(e))})};if(navigator.mediaDevices||(navigator.mediaDevices={getUserMedia:function(n){return new Promise(function(e,t){r(n,e,t)})},addEventListener:function(){},removeEventListener:function(){}}),navigator.mediaDevices.enumerateDevices=navigator.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},s.version<41){var e=navigator.mediaDevices.enumerateDevices.bind(navigator.mediaDevices);navigator.mediaDevices.enumerateDevices=function(){return e().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(s.version<49){var n=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices);navigator.mediaDevices.getUserMedia=function(t){return n(t).then(function(e){if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return e},function(e){return Promise.reject(i(e))})}}navigator.getUserMedia=function(e,t,n){if(s.version<44)return r(e,t,n);console.warn("navigator.getUserMedia has been replaced by navigator.mediaDevices.getUserMedia"),navigator.mediaDevices.getUserMedia(e).then(t,n)}}},{"../utils":33}],32:[function(e,t,n){var r={shimAddStream:function(){"object"!==("undefined"==typeof window?"undefined":_typeof(window))||!window.RTCPeerConnection||"addStream"in window.RTCPeerConnection.prototype||(RTCPeerConnection.prototype.addStream=function(t){var n=this;t.getTracks().forEach(function(e){n.addTrack(e,t)})})},shimOnAddStream:function(){"object"!==("undefined"==typeof window?"undefined":_typeof(window))||!window.RTCPeerConnection||"onaddstream"in window.RTCPeerConnection.prototype||Object.defineProperty(window.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(this._streams||(this._streams=[]),!(0<=this._streams.indexOf(t))){this._streams.push(t);var n=new Event("addstream");n.stream=e.streams[0],this.dispatchEvent(n)}}.bind(this))}})},shimCallbacksAPI:function(){if("object"===("undefined"==typeof window?"undefined":_typeof(window))&&window.RTCPeerConnection){var e=RTCPeerConnection.prototype,i=e.createOffer,o=e.createAnswer,s=e.setLocalDescription,a=e.setRemoteDescription,l=e.addIceCandidate;e.createOffer=function(e,t){var n=2<=arguments.length?arguments[2]:e,r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r},e.createAnswer=function(e,t){var n=2<=arguments.length?arguments[2]:e,r=o.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};var t=function(e,t,n){var r=s.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};e.setLocalDescription=t,t=function(e,t,n){var r=a.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},e.setRemoteDescription=t,t=function(e,t,n){var r=l.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},e.addIceCandidate=t}},shimGetUserMedia:function(){navigator.getUserMedia||(navigator.webkitGetUserMedia?navigator.getUserMedia=navigator.webkitGetUserMedia.bind(navigator):navigator.mediaDevices&&navigator.mediaDevices.getUserMedia&&(navigator.getUserMedia=function(e,t,n){navigator.mediaDevices.getUserMedia(e).then(t,n)}.bind(navigator)))}};t.exports={shimCallbacksAPI:r.shimCallbacksAPI,shimAddStream:r.shimAddStream,shimOnAddStream:r.shimOnAddStream,shimGetUserMedia:r.shimGetUserMedia}},{}],33:[function(e,t,n){var r=!0,i={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":_typeof(e))+". Please use a boolean."):(r=e)?"adapter.js logging disabled":"adapter.js logging enabled"},log:function(){if("object"===("undefined"==typeof window?"undefined":_typeof(window))){if(r)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},extractVersion:function(e,t,n){var r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)},detectBrowser:function(){var e={browser:null,version:null};if("undefined"==typeof window||!window.navigator)return e.browser="Not a browser.",e;if(navigator.mozGetUserMedia)e.browser="firefox",e.version=this.extractVersion(navigator.userAgent,/Firefox\/(\d+)\./,1);else if(navigator.webkitGetUserMedia)if(window.webkitRTCPeerConnection)e.browser="chrome",e.version=this.extractVersion(navigator.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!navigator.userAgent.match(/Version\/(\d+).(\d+)/))return e.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",e;e.browser="safari",e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/))e.browser="edge",e.version=this.extractVersion(navigator.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!navigator.mediaDevices||!navigator.userAgent.match(/AppleWebKit\/(\d+)\./))return e.browser="Not a supported browser.",e;e.browser="safari",e.version=this.extractVersion(navigator.userAgent,/AppleWebKit\/(\d+)\./,1)}return e},shimCreateObjectURL:function(){}};t.exports={log:i.log,disableLog:i.disableLog,browserDetails:i.detectBrowser(),extractVersion:i.extractVersion,shimCreateObjectURL:i.shimCreateObjectURL,detectBrowser:i.detectBrowser.bind(i)}},{}],34:[function(e,t,n){t.exports={name:"plivowebsdk",title:"plivowebsdk",version:"2.0.20",description:"Plivo WebRTC sdk for use in chrome/firefox ",main:"./lib/index.js",scripts:{build:"node_modules/gulp/bin/gulp.js build",test:"node test/server.js & karma start --single-run --browsers FirefoxHeadless,ChromeWebRTC karma.conf.js"},repository:{type:"git",url:"git+https://github.com/gigster-eng/PlivoWebSDK.git"},author:"",license:"ISC",bugs:{url:"https://github.com/gigster-eng/PlivoWebSDK/issues"},homepage:"https://github.com/gigster-eng/PlivoWebSDK#readme",dependencies:{debug:"^2.6.3",events:"^2.0.0","sdp-transform":"^2.4.1",uuid:"^2.0.3","webrtc-adapter":"^3.2.0"},devDependencies:{browserify:"^10.0.0",chai:"^4.1.2","babel-cli":"^6.26.0","babel-core":"^6.26.3","babel-preset-es2015":"^6.24.1",cheerio:"^0.22.0",del:"^2.0.2",disc:"^1.3.2",eslint:"^2.12.0",gulp:"^4.0.0","gulp-cli":"^2.0.1","gulp-babel":"*","gulp-copy":"0.0.2","gulp-eslint":"^4.0.2","gulp-expect-file":"0.0.7","gulp-express":"^0.3.5","gulp-footer":"^1.1.2","gulp-insert":"^0.5.0","gulp-istanbul":"^0.10.3","gulp-newer":"^1.4.0","gulp-rename":"^1.3.0","gulp-header":"^2.0.5","gulp-nodeunit-runner":"^0.2.2","gulp-plumber":"^1.2.0","gulp-replace":"^0.5.4","gulp-uglify":"^3.0.0","gulp-util":"^3.0.7",jsdoc:"git+https://github.com/jsdoc3/jsdoc.git#e2fd9e75de9617aadfc3120331f020b2d66cff86",jshint:"^2.6.3","jshint-stylish":"^1.0.0",karma:"^2.0.3","karma-browserify":"^5.3.0","karma-chai":"^0.1.0","karma-chrome-launcher":"^2.2.0","karma-firefox-launcher":"^1.1.0","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5",mkdirp:"^0.5.1",mocha:"^5.2.0",opener:"^1.4.2",promptly:"^0.2.0","release-tool":"^0.2.2","run-sequence":"^1.2.2",sinon:"^1.15.3","stream-from-promise":"^0.1.0",through2:"^2.0.0",watchify:"^3.0.0","uglify-es":"^3.3.9","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0"}}},{}],35:[function(e,t,n){var l=e("./Utils"),r=e("./Constants"),i=e("./Grammar"),o=e("./URI"),u=e("./Socket"),c=e("./Exceptions");n.settings={authorization_user:null,password:null,realm:null,ha1:null,display_name:null,uri:null,contact_uri:null,instance_id:null,use_preloaded_route:!1,session_timers:!0,session_timers_refresh_method:r.UPDATE,no_answer_timeout:60,register:!0,register_expires:600,registrar_server:null,sockets:null,connection_recovery_max_interval:null,connection_recovery_min_interval:null,via_host:l.createRandomToken(12)+".invalid"};var d={mandatory:{sockets:function(e){var t=[];if(u.isSocket(e))t.push({socket:e});else{if(!Array.isArray(e)||!e.length)return;var n=!0,r=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value;Object.prototype.hasOwnProperty.call(a,"socket")&&u.isSocket(a.socket)?t.push(a):u.isSocket(a)&&t.push({socket:a})}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}}return t},uri:function(e){/^sip:/i.test(e)||(e=r.SIP+":"+e);var t=o.parse(e);return t&&t.user?t:void 0}},optional:{authorization_user:function(e){return-1===i.parse('"'+e+'"',"quoted_string")?void 0:e},user_agent:function(e){if("string"==typeof e)return e},connection_recovery_max_interval:function(e){if(l.isDecimal(e)){var t=Number(e);if(0<t)return t}},connection_recovery_min_interval:function(e){if(l.isDecimal(e)){var t=Number(e);if(0<t)return t}},contact_uri:function(e){if("string"==typeof e){var t=i.parse(e,"SIP_URI");if(-1!==t)return t}},display_name:function(e){return-1===i.parse('"'+e+'"',"display_name")?void 0:e},instance_id:function(e){return/^uuid:/i.test(e)&&(e=e.substr(5)),-1===i.parse(e,"uuid")?void 0:e},no_answer_timeout:function(e){if(l.isDecimal(e)){var t=Number(e);if(0<t)return t}},session_timers:function(e){if("boolean"==typeof e)return e},session_timers_refresh_method:function(e){if("string"==typeof e&&((e=e.toUpperCase())===r.INVITE||e===r.UPDATE))return e},password:function(e){return String(e)},realm:function(e){return String(e)},ha1:function(e){return String(e)},register:function(e){if("boolean"==typeof e)return e},register_expires:function(e){if(l.isDecimal(e)){var t=Number(e);if(0<t)return t}},registrar_server:function(e){/^sip:/i.test(e)||(e=r.SIP+":"+e);var t=o.parse(e);return t?t.user?void 0:t:void 0},use_preloaded_route:function(e){if("boolean"==typeof e)return e}}};n.load=function(e,t){for(var n in d.mandatory){if(!t.hasOwnProperty(n))throw new c.ConfigurationError(n);var r=t[n],i=d.mandatory[n](r);if(void 0===i)throw new c.ConfigurationError(n,r);e[n]=i}for(var o in d.optional)if(t.hasOwnProperty(o)){var s=t[o];if(l.isEmpty(s))continue;var a=d.optional[o](s);if(void 0===a)throw new c.ConfigurationError(o,s);e[o]=a}}},{"./Constants":36,"./Exceptions":40,"./Grammar":41,"./Socket":54,"./URI":59,"./Utils":60}],36:[function(e,t,n){var r=e("../package.json");t.exports={USER_AGENT:r.title+" "+r.version,SIP:"sip",SIPS:"sips",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",MISSING_SDP:"Missing SDP",AUTHENTICATION_ERROR:"Authentication Error",BYE:"Terminated",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",DIALOG_ERROR:"Dialog Error",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484,424],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",REFER:"REFER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",424:"Bad Location Information",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"JsSIP Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"},ALLOWED_METHODS:"INVITE,ACK,CANCEL,BYE,UPDATE,MESSAGE,OPTIONS,REFER,INFO",ACCEPTED_BODY_TYPES:"application/sdp, application/dtmf-relay",MAX_FORWARDS:69,SESSION_EXPIRES:90,MIN_SESSION_EXPIRES:60}},{"../package.json":34}],37:[function(e,t,n){var s=e("./SIPMessage"),i=e("./Constants"),r=e("./Transactions"),a=e("./Dialog/RequestSender"),l=e("./Utils"),u=e("debug")("PlivoSIP:Dialog"),c={STATUS_EARLY:1,STATUS_CONFIRMED:2};t.exports=function(){function o(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:c.STATUS_CONFIRMED;if(_classCallCheck(this,o),this._owner=e,this._ua=e._ua,this._uac_pending_reply=!1,this._uas_pending_reply=!1,!t.hasHeader("contact"))return{error:"unable to create a Dialog without Contact header field"};t instanceof s.IncomingResponse&&(r=t.status_code<200?c.STATUS_EARLY:c.STATUS_CONFIRMED);var i=t.parseHeader("contact");"UAS"===n?(this._id={call_id:t.call_id,local_tag:t.to_tag,remote_tag:t.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this._state=r,this._remote_seqnum=t.cseq,this._local_uri=t.parseHeader("to").uri,this._remote_uri=t.parseHeader("from").uri,this._remote_target=i.uri,this._route_set=t.getHeaders("record-route"),this._ack_seqnum=this._remote_seqnum):"UAC"===n&&(this._id={call_id:t.call_id,local_tag:t.from_tag,remote_tag:t.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this._state=r,this._local_seqnum=t.cseq,this._local_uri=t.parseHeader("from").uri,this._remote_uri=t.parseHeader("to").uri,this._remote_target=i.uri,this._route_set=t.getHeaders("record-route").reverse(),this._ack_seqnum=null),this._ua.newDialog(this),u("new "+n+" dialog created with status "+(this._state===c.STATUS_EARLY?"EARLY":"CONFIRMED"))}return _createClass(o,null,[{key:"C",get:function(){return c}}]),_createClass(o,[{key:"update",value:function(e,t){this._state=c.STATUS_CONFIRMED,u("dialog "+this._id.toString()+"  changed to CONFIRMED state"),"UAC"===t&&(this._route_set=e.getHeaders("record-route").reverse())}},{key:"terminate",value:function(){u("dialog "+this._id.toString()+" deleted"),this._ua.destroyDialog(this)}},{key:"sendRequest",value:function(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=l.cloneArray(n.extraHeaders),i=n.eventHandlers||{},o=n.body||null,s=this._createRequest(e,r,o);return i.onAuthenticated=function(){t._local_seqnum+=1},new a(this,s,i).send(),s}},{key:"receiveRequest",value:function(e){this._checkInDialogRequest(e)&&(e.method===i.ACK&&null!==this._ack_seqnum?this._ack_seqnum=null:e.method===i.INVITE&&(this._ack_seqnum=e.cseq),this._owner.receiveRequest(e))}},{key:"_createRequest",value:function(e,t,n){t=l.cloneArray(t),this._local_seqnum||(this._local_seqnum=Math.floor(1e4*Math.random()));var r=e===i.CANCEL||e===i.ACK?this._local_seqnum:this._local_seqnum+=1;return new s.OutgoingRequest(e,this._remote_target,this._ua,{cseq:r,call_id:this._id.call_id,from_uri:this._local_uri,from_tag:this._id.local_tag,to_uri:this._remote_uri,to_tag:this._id.remote_tag,route_set:this._route_set},t,n)}},{key:"_checkInDialogRequest",value:function(t){var n=this;if(this._remote_seqnum)if(t.cseq<this._remote_seqnum){if(t.method!==i.ACK)return t.reply(500),!1;if(null===this._ack_seqnum||t.cseq!==this._ack_seqnum)return!1}else t.cseq>this._remote_seqnum&&(this._remote_seqnum=t.cseq);else this._remote_seqnum=t.cseq;if(t.method===i.INVITE||t.method===i.UPDATE&&t.body){if(!0===this._uac_pending_reply)t.reply(491);else{if(!0===this._uas_pending_reply){var e=1+(10*Math.random()|0);return t.reply(500,null,["Retry-After:"+e]),!1}this._uas_pending_reply=!0,t.server_transaction.on("stateChanged",function e(){t.server_transaction.state!==r.C.STATUS_ACCEPTED&&t.server_transaction.state!==r.C.STATUS_COMPLETED&&t.server_transaction.state!==r.C.STATUS_TERMINATED||(t.server_transaction.removeListener("stateChanged",e),n._uas_pending_reply=!1)})}t.hasHeader("contact")&&t.server_transaction.on("stateChanged",function(){t.server_transaction.state===r.C.STATUS_ACCEPTED&&(n._remote_target=t.parseHeader("contact").uri)})}else t.method===i.NOTIFY&&t.hasHeader("contact")&&t.server_transaction.on("stateChanged",function(){t.server_transaction.state===r.C.STATUS_COMPLETED&&(n._remote_target=t.parseHeader("contact").uri)});return!0}},{key:"id",get:function(){return this._id}},{key:"local_seqnum",get:function(){return this._local_seqnum},set:function(e){this._local_seqnum=e}},{key:"owner",get:function(){return this._owner}},{key:"uac_pending_reply",get:function(){return this._uac_pending_reply},set:function(e){this._uac_pending_reply=e}},{key:"uas_pending_reply",get:function(){return this._uas_pending_reply}}]),o}()},{"./Constants":36,"./Dialog/RequestSender":38,"./SIPMessage":53,"./Transactions":56,"./Utils":60,debug:12}],38:[function(e,t,n){var r=e("../Constants"),o=e("../Transactions"),s=e("../RTCSession"),a=e("../RequestSender"),l={onRequestTimeout:function(){},onTransportError:function(){},onSuccessResponse:function(){},onErrorResponse:function(){},onAuthenticated:function(){},onDialogError:function(){}};t.exports=function(){function i(e,t,n){for(var r in _classCallCheck(this,i),this._dialog=e,this._ua=e._ua,this._request=t,this._eventHandlers=n,this._reattempt=!1,this._reattemptTimer=null,l)Object.prototype.hasOwnProperty.call(l,r)&&(this._eventHandlers[r]||(this._eventHandlers[r]=l[r]))}return _createClass(i,[{key:"send",value:function(){var t=this,n=new a(this._ua,this._request,{onRequestTimeout:function(){t._eventHandlers.onRequestTimeout()},onTransportError:function(){t._eventHandlers.onTransportError()},onAuthenticated:function(e){t._eventHandlers.onAuthenticated(e)},onReceiveResponse:function(e){t._receiveResponse(e)}});n.send(),(this._request.method===r.INVITE||this._request.method===r.UPDATE&&this._request.body)&&n.clientTransaction.state!==o.C.STATUS_TERMINATED&&(this._dialog.uac_pending_reply=!0,n.clientTransaction.on("stateChanged",function e(){n.clientTransaction.state!==o.C.STATUS_ACCEPTED&&n.clientTransaction.state!==o.C.STATUS_COMPLETED&&n.clientTransaction.state!==o.C.STATUS_TERMINATED||(n.clientTransaction.removeListener("stateChanged",e),t._dialog.uac_pending_reply=!1)}))}},{key:"_receiveResponse",value:function(e){var t=this;408===e.status_code||481===e.status_code?this._eventHandlers.onDialogError(e):e.method===r.INVITE&&491===e.status_code?this._reattempt?200<=e.status_code&&e.status_code<300?this._eventHandlers.onSuccessResponse(e):300<=e.status_code&&this._eventHandlers.onErrorResponse(e):(this._request.cseq.value=this._dialog.local_seqnum+=1,this._reattemptTimer=setTimeout(function(){t._dialog.owner.status!==s.C.STATUS_TERMINATED&&(t._reattempt=!0,t._request_sender.send())},1e3)):200<=e.status_code&&e.status_code<300?this._eventHandlers.onSuccessResponse(e):300<=e.status_code&&this._eventHandlers.onErrorResponse(e)}},{key:"request",get:function(){return this._request}}]),i}()},{"../Constants":36,"../RTCSession":46,"../RequestSender":52,"../Transactions":56}],39:[function(e,t,n){var l=e("./Utils"),u=e("debug")("PlivoSIP:DigestAuthentication"),c=e("debug")("PlivoSIP:ERROR:DigestAuthentication");c.log=console.warn.bind(console),t.exports=function(){function t(e){_classCallCheck(this,t),this._credentials=e,this._cnonce=null,this._nc=0,this._ncHex="00000000",this._algorithm=null,this._realm=null,this._nonce=null,this._opaque=null,this._stale=null,this._qop=null,this._method=null,this._uri=null,this._ha1=null,this._response=null}return _createClass(t,[{key:"get",value:function(e){switch(e){case"realm":return this._realm;case"ha1":return this._ha1;default:return void c('get() | cannot get "%s" parameter',e)}}},{key:"authenticate",value:function(e,t){var n=e.method,r=e.ruri,i=e.body,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(this._algorithm=t.algorithm,this._realm=t.realm,this._nonce=t.nonce,this._opaque=t.opaque,this._stale=t.stale,this._algorithm){if("MD5"!==this._algorithm)return c('authenticate() | challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this._algorithm="MD5";if(!this._nonce)return c("authenticate() | challenge without Digest nonce, authentication aborted"),!1;if(!this._realm)return c("authenticate() | challenge without Digest realm, authentication aborted"),!1;if(!this._credentials.password){if(!this._credentials.ha1)return c("authenticate() | no plain SIP password nor ha1 provided, authentication aborted"),!1;if(this._credentials.realm!==this._realm)return c('authenticate() | no plain SIP password, and stored `realm` does not match the given `realm`, cannot authenticate [stored:"%s", given:"%s"]',this._credentials.realm,this._realm),!1}if(t.qop)if(-1<t.qop.indexOf("auth-int"))this._qop="auth-int";else{if(!(-1<t.qop.indexOf("auth")))return c('authenticate() | challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this._qop="auth"}else this._qop=null;this._method=n,this._uri=r,this._cnonce=o||l.createRandomToken(12),this._nc+=1;var s=Number(this._nc).toString(16);this._ncHex="00000000".substr(0,8-s.length)+s,4294967296===this._nc&&(this._nc=1,this._ncHex="00000001"),this._credentials.password?this._ha1=l.calculateMD5(this._credentials.username+":"+this._realm+":"+this._credentials.password):this._ha1=this._credentials.ha1;var a=void 0;return"auth"===this._qop?(a=l.calculateMD5(this._method+":"+this._uri),this._response=l.calculateMD5(this._ha1+":"+this._nonce+":"+this._ncHex+":"+this._cnonce+":auth:"+a)):"auth-int"===this._qop?(a=l.calculateMD5(this._method+":"+this._uri+":"+l.calculateMD5(i||"")),this._response=l.calculateMD5(this._ha1+":"+this._nonce+":"+this._ncHex+":"+this._cnonce+":auth-int:"+a)):null===this._qop&&(a=l.calculateMD5(this._method+":"+this._uri),this._response=l.calculateMD5(this._ha1+":"+this._nonce+":"+a)),u("authenticate() | response generated"),!0}},{key:"toString",value:function(){var e=[];if(!this._response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push("algorithm="+this._algorithm),e.push('username="'+this._credentials.username+'"'),e.push('realm="'+this._realm+'"'),e.push('nonce="'+this._nonce+'"'),e.push('uri="'+this._uri+'"'),e.push('response="'+this._response+'"'),this._opaque&&e.push('opaque="'+this._opaque+'"'),this._qop&&(e.push("qop="+this._qop),e.push('cnonce="'+this._cnonce+'"'),e.push("nc="+this._ncHex)),"Digest "+e.join(", ")}}]),t}()},{"./Utils":60,debug:12}],40:[function(e,t,n){var r=function(e){function r(e,t){_classCallCheck(this,r);var n=_possibleConstructorReturn(this,(r.__proto__||Object.getPrototypeOf(r)).call(this));return n.code=1,n.name="CONFIGURATION_ERROR",n.parameter=e,n.value=t,n.message=n.value?"Invalid value "+JSON.stringify(n.value)+' for parameter "'+n.parameter+'"':"Missing parameter: "+n.parameter,n}return _inherits(r,Error),r}(),i=function(e){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t.code=2,t.name="INVALID_STATE_ERROR",t.status=e,t.message="Invalid status: "+e,t}return _inherits(n,Error),n}(),o=function(e){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t.code=3,t.name="NOT_SUPPORTED_ERROR",t.message=e,t}return _inherits(n,Error),n}(),s=function(e){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t.code=4,t.name="NOT_READY_ERROR",t.message=e,t}return _inherits(n,Error),n}();t.exports={ConfigurationError:r,InvalidStateError:i,NotSupportedError:o,NotReadyError:s}},{}],41:[function(Gn,e,t){e.exports=function(){function qn(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var e={parse:function(m,l){var e={CRLF:s,DIGIT:u,ALPHA:a,HEXDIG:c,WSP:d,OCTET:n,DQUOTE:f,SP:h,HTAB:p,alphanum:i,reserved:v,unreserved:g,mark:r,escaped:S,LWS:C,SWS:T,HCOLON:w,TEXT_UTF8_TRIM:E,TEXT_UTF8char:k,UTF8_NONASCII:R,UTF8_CONT:I,LHEX:function(){var e;return null===(e=u())&&(/^[a-f]/.test(m.charAt(y))?(e=m.charAt(y),y++):(e=null,0===_&&b("[a-f]"))),e},token:P,token_nodot:A,separators:function(){var e;return 40===m.charCodeAt(y)?(e="(",y++):(e=null,0===_&&b('"("')),null===e&&(41===m.charCodeAt(y)?(e=")",y++):(e=null,0===_&&b('")"')),null===e&&(60===m.charCodeAt(y)?(e="<",y++):(e=null,0===_&&b('"<"')),null===e&&(62===m.charCodeAt(y)?(e=">",y++):(e=null,0===_&&b('">"')),null===e&&(64===m.charCodeAt(y)?(e="@",y++):(e=null,0===_&&b('"@"')),null===e&&(44===m.charCodeAt(y)?(e=",",y++):(e=null,0===_&&b('","')),null===e&&(59===m.charCodeAt(y)?(e=";",y++):(e=null,0===_&&b('";"')),null===e&&(58===m.charCodeAt(y)?(e=":",y++):(e=null,0===_&&b('":"')),null===e&&(92===m.charCodeAt(y)?(e="\\",y++):(e=null,0===_&&b('"\\\\"')),null===e&&null===(e=f())&&(47===m.charCodeAt(y)?(e="/",y++):(e=null,0===_&&b('"/"')),null===e&&(91===m.charCodeAt(y)?(e="[",y++):(e=null,0===_&&b('"["')),null===e&&(93===m.charCodeAt(y)?(e="]",y++):(e=null,0===_&&b('"]"')),null===e&&(63===m.charCodeAt(y)?(e="?",y++):(e=null,0===_&&b('"?"')),null===e&&(61===m.charCodeAt(y)?(e="=",y++):(e=null,0===_&&b('"="')),null===e&&(123===m.charCodeAt(y)?(e="{",y++):(e=null,0===_&&b('"{"')),null===e&&(125===m.charCodeAt(y)?(e="}",y++):(e=null,0===_&&b('"}"')),null===e&&null===(e=h())&&(e=p())))))))))))))))),e},word:O,STAR:M,SLASH:D,EQUAL:x,LPAREN:N,RPAREN:F,RAQUOT:U,LAQUOT:j,COMMA:L,SEMI:H,COLON:B,LDQUOT:q,RDQUOT:G,comment:function e(){var t,n,r,i;if(i=y,null!==(t=N())){for(n=[],null===(r=W())&&null===(r=Q())&&(r=e());null!==r;)n.push(r),null===(r=W())&&null===(r=Q())&&(r=e());null!==n&&null!==(r=F())?t=[t,n,r]:(t=null,y=i)}else t=null,y=i;return t},ctext:W,quoted_string:V,quoted_string_clean:z,qdtext:K,quoted_pair:Q,SIP_URI_noparams:J,SIP_URI:X,uri_scheme:$,uri_scheme_sips:Y,uri_scheme_sip:Z,userinfo:ee,user:te,user_unreserved:ne,password:re,hostport:ie,host:oe,hostname:se,domainlabel:ae,toplabel:le,IPv6reference:ue,IPv6address:ce,h16:de,ls32:fe,IPv4address:he,dec_octet:pe,port:ve,uri_parameters:ge,uri_parameter:me,transport_param:ye,user_param:_e,method_param:be,ttl_param:Se,maddr_param:Ce,lr_param:Te,other_param:we,pname:Ee,pvalue:ke,paramchar:Re,param_unreserved:Ie,headers:Pe,header:Ae,hname:Oe,hvalue:Me,hnv_unreserved:De,Request_Response:function(){var e;return null===(e=ut())&&(e=xe()),e},Request_Line:xe,Request_URI:Ne,absoluteURI:Fe,hier_part:Ue,net_path:je,abs_path:Le,opaque_part:He,uric:Be,uric_no_slash:qe,path_segments:Ge,segment:We,param:Ve,pchar:ze,scheme:Ke,authority:Qe,srvr:Je,reg_name:Xe,query:$e,SIP_Version:Ye,INVITEm:Ze,ACKm:et,OPTIONSm:tt,BYEm:nt,CANCELm:rt,REGISTERm:it,SUBSCRIBEm:ot,NOTIFYm:st,REFERm:at,Method:lt,Status_Line:ut,Status_Code:ct,extension_code:dt,Reason_Phrase:ft,Allow_Events:function(){var e,t,n,r,i,o;if(i=y,null!==(e=Ft())){for(t=[],o=y,null!==(n=L())&&null!==(r=Ft())?n=[n,r]:(n=null,y=o);null!==n;)t.push(n),o=y,null!==(n=L())&&null!==(r=Ft())?n=[n,r]:(n=null,y=o);null!==t?e=[e,t]:(e=null,y=i)}else e=null,y=i;return e},Call_ID:function(){var e,t,n,r,i,o,s;return i=r=y,null!==(e=O())?(o=y,64===m.charCodeAt(y)?(t="@",y++):(t=null,0===_&&b('"@"')),null!==t&&null!==(n=O())?t=[t,n]:(t=null,y=o),null!==(t=null!==t?t:"")?e=[e,t]:(e=null,y=i)):(e=null,y=i),null!==e&&(s=r,e=void(jn=m.substring(y,s))),null===e&&(y=r),e},Contact:function(){var e,t,n,r,i,o,s;if(i=y,null===(e=M()))if(o=y,null!==(e=ht())){for(t=[],s=y,null!==(n=L())&&null!==(r=ht())?n=[n,r]:(n=null,y=s);null!==n;)t.push(n),s=y,null!==(n=L())&&null!==(r=ht())?n=[n,r]:(n=null,y=s);null!==t?e=[e,t]:(e=null,y=o)}else e=null,y=o;return null!==e&&(e=function(e){var t,n;for(n=jn.multi_header.length,t=0;t<n;t++)if(null===jn.multi_header[t].parsed){jn=null;break}jn=null!==jn?jn.multi_header:-1}()),null===e&&(y=i),e},contact_param:ht,name_addr:pt,display_name:vt,contact_params:gt,c_p_q:mt,c_p_expires:yt,delta_seconds:_t,qvalue:bt,generic_param:St,gen_value:Ct,Content_Disposition:function(){var e,t,n,r,i,o;if(i=y,null!==(e=Tt())){for(t=[],o=y,null!==(n=H())&&null!==(r=wt())?n=[n,r]:(n=null,y=o);null!==n;)t.push(n),o=y,null!==(n=H())&&null!==(r=wt())?n=[n,r]:(n=null,y=o);null!==t?e=[e,t]:(e=null,y=i)}else e=null,y=i;return e},disp_type:Tt,disp_param:wt,handling_param:Et,Content_Encoding:function(){var e,t,n,r,i,o;if(i=y,null!==(e=P())){for(t=[],o=y,null!==(n=L())&&null!==(r=P())?n=[n,r]:(n=null,y=o);null!==n;)t.push(n),o=y,null!==(n=L())&&null!==(r=P())?n=[n,r]:(n=null,y=o);null!==t?e=[e,t]:(e=null,y=i)}else e=null,y=i;return e},Content_Length:function(){var e,t,n;if(n=y,null!==(t=u()))for(e=[];null!==t;)e.push(t),t=u();else e=null;return null!==e&&(e=void(jn=parseInt(e.join("")))),null===e&&(y=n),e},Content_Type:function(){var e,t,n;return t=y,null!==(e=kt())&&(n=t,e=void(jn=m.substring(y,n))),null===e&&(y=t),e},media_type:kt,m_type:Rt,discrete_type:It,composite_type:Pt,extension_token:At,x_token:Ot,m_subtype:Mt,m_parameter:Dt,m_value:xt,CSeq:function(){var e,t,n,r;return r=y,null!==(e=Nt())&&null!==(t=C())&&null!==(n=lt())?e=[e,t,n]:(e=null,y=r),e},CSeq_value:Nt,Expires:function(){var e,t;return t=y,null!==(e=_t())&&(e=void(jn=e)),null===e&&(y=t),e},Event:function(){var e,t,n,r,i,o,s,a;if(o=i=y,null!==(e=Ft())){for(t=[],s=y,null!==(n=H())&&null!==(r=St())?n=[n,r]:(n=null,y=s);null!==n;)t.push(n),s=y,null!==(n=H())&&null!==(r=St())?n=[n,r]:(n=null,y=s);null!==t?e=[e,t]:(e=null,y=o)}else e=null,y=o;return null!==e&&(a=e[0],e=void(jn.event=a.join("").toLowerCase())),null===e&&(y=i),e},event_type:Ft,From:function(){var e,t,n,r,i,o,s;if(o=i=y,null===(e=J())&&(e=pt()),null!==e){for(t=[],s=y,null!==(n=H())&&null!==(r=Ut())?n=[n,r]:(n=null,y=s);null!==n;)t.push(n),s=y,null!==(n=H())&&null!==(r=Ut())?n=[n,r]:(n=null,y=s);null!==t?e=[e,t]:(e=null,y=o)}else e=null,y=o;return null!==e&&(e=function(e){var t=jn.tag;try{jn=new Un(jn.uri,jn.display_name,jn.params),t&&jn.setParam("tag",t)}catch(e){jn=-1}}()),null===e&&(y=i),e},from_param:Ut,tag_param:jt,Max_Forwards:function(){var e,t,n;if(n=y,null!==(t=u()))for(e=[];null!==t;)e.push(t),t=u();else e=null;return null!==e&&(e=void(jn=parseInt(e.join("")))),null===e&&(y=n),e},Min_Expires:function(){var e,t;return t=y,null!==(e=_t())&&(e=void(jn=e)),null===e&&(y=t),e},Name_Addr_Header:function(){var e,t,n,r,i,o,s,a,l,u;for(l=a=y,e=[],t=vt();null!==t;)e.push(t),t=vt();if(null!==e)if(null!==(t=j()))if(null!==(n=X()))if(null!==(r=U())){for(i=[],u=y,null!==(o=H())&&null!==(s=St())?o=[o,s]:(o=null,y=u);null!==o;)i.push(o),u=y,null!==(o=H())&&null!==(s=St())?o=[o,s]:(o=null,y=u);null!==i?e=[e,t,n,r,i]:(e=null,y=l)}else e=null,y=l;else e=null,y=l;else e=null,y=l;else e=null,y=l;return null!==e&&(e=function(e){try{jn=new Un(jn.uri,jn.display_name,jn.params)}catch(e){jn=-1}}()),null===e&&(y=a),e},Proxy_Authenticate:function(){return Lt()},challenge:Lt,other_challenge:Ht,auth_param:Bt,digest_cln:qt,realm:Gt,realm_value:Wt,domain:Vt,URI:zt,nonce:Kt,nonce_value:Qt,opaque:Jt,stale:Xt,algorithm:$t,qop_options:Yt,qop_value:Zt,Proxy_Require:function(){var e,t,n,r,i,o;if(i=y,null!==(e=P())){for(t=[],o=y,null!==(n=L())&&null!==(r=P())?n=[n,r]:(n=null,y=o);null!==n;)t.push(n),o=y,null!==(n=L())&&null!==(r=P())?n=[n,r]:(n=null,y=o);null!==t?e=[e,t]:(e=null,y=i)}else e=null,y=i;return e},Record_Route:function(){var e,t,n,r,i,o,s;if(o=i=y,null!==(e=en())){for(t=[],s=y,null!==(n=L())&&null!==(r=en())?n=[n,r]:(n=null,y=s);null!==n;)t.push(n),s=y,null!==(n=L())&&null!==(r=en())?n=[n,r]:(n=null,y=s);null!==t?e=[e,t]:(e=null,y=o)}else e=null,y=o;return null!==e&&(e=function(e){var t,n;for(n=jn.multi_header.length,t=0;t<n;t++)if(null===jn.multi_header[t].parsed){jn=null;break}jn=null!==jn?jn.multi_header:-1}()),null===e&&(y=i),e},rec_route:en,Reason:function(){var e,t,n,r,i,o,s;if(o=i=y,"sip"===m.substr(y,3).toLowerCase()?(e=m.substr(y,3),y+=3):(e=null,0===_&&b('"SIP"')),null===e&&(e=P()),null!==e){for(t=[],s=y,null!==(n=H())&&null!==(r=tn())?n=[n,r]:(n=null,y=s);null!==n;)t.push(n),s=y,null!==(n=H())&&null!==(r=tn())?n=[n,r]:(n=null,y=s);null!==t?e=[e,t]:(e=null,y=o)}else e=null,y=o;return null!==e&&(e=function(e,t){if(jn.protocol=t.toLowerCase(),jn.params||(jn.params={}),jn.params.text&&'"'===jn.params.text[0]){var n=jn.params.text;jn.text=n.substring(1,n.length-1),delete jn.params.text}}(0,e[0])),null===e&&(y=i),e},reason_param:tn,reason_cause:nn,Require:function(){var e,t,n,r,i,o;if(i=y,null!==(e=P())){for(t=[],o=y,null!==(n=L())&&null!==(r=P())?n=[n,r]:(n=null,y=o);null!==n;)t.push(n),o=y,null!==(n=L())&&null!==(r=P())?n=[n,r]:(n=null,y=o);null!==t?e=[e,t]:(e=null,y=i)}else e=null,y=i;return e},Route:function(){var e,t,n,r,i,o;if(i=y,null!==(e=rn())){for(t=[],o=y,null!==(n=L())&&null!==(r=rn())?n=[n,r]:(n=null,y=o);null!==n;)t.push(n),o=y,null!==(n=L())&&null!==(r=rn())?n=[n,r]:(n=null,y=o);null!==t?e=[e,t]:(e=null,y=i)}else e=null,y=i;return e},route_param:rn,Subscription_State:function(){var e,t,n,r,i,o;if(i=y,null!==(e=on())){for(t=[],o=y,null!==(n=H())&&null!==(r=sn())?n=[n,r]:(n=null,y=o);null!==n;)t.push(n),o=y,null!==(n=H())&&null!==(r=sn())?n=[n,r]:(n=null,y=o);null!==t?e=[e,t]:(e=null,y=i)}else e=null,y=i;return e},substate_value:on,subexp_params:sn,event_reason_value:an,Subject:function(){var e;return e=null!==(e=E())?e:""},Supported:function(){var e,t,n,r,i,o;if(i=y,null!==(e=P())){for(t=[],o=y,null!==(n=L())&&null!==(r=P())?n=[n,r]:(n=null,y=o);null!==n;)t.push(n),o=y,null!==(n=L())&&null!==(r=P())?n=[n,r]:(n=null,y=o);null!==t?e=[e,t]:(e=null,y=i)}else e=null,y=i;return e=null!==e?e:""},To:function(){var e,t,n,r,i,o,s;if(o=i=y,null===(e=J())&&(e=pt()),null!==e){for(t=[],s=y,null!==(n=H())&&null!==(r=ln())?n=[n,r]:(n=null,y=s);null!==n;)t.push(n),s=y,null!==(n=H())&&null!==(r=ln())?n=[n,r]:(n=null,y=s);null!==t?e=[e,t]:(e=null,y=o)}else e=null,y=o;return null!==e&&(e=function(e){var t=jn.tag;try{jn=new Un(jn.uri,jn.display_name,jn.params),t&&jn.setParam("tag",t)}catch(e){jn=-1}}()),null===e&&(y=i),e},to_param:ln,Via:function(){var e,t,n,r,i,o;if(i=y,null!==(e=un())){for(t=[],o=y,null!==(n=L())&&null!==(r=un())?n=[n,r]:(n=null,y=o);null!==n;)t.push(n),o=y,null!==(n=L())&&null!==(r=un())?n=[n,r]:(n=null,y=o);null!==t?e=[e,t]:(e=null,y=i)}else e=null,y=i;return e},via_param:un,via_params:cn,via_ttl:dn,via_maddr:fn,via_received:hn,via_branch:pn,response_port:vn,sent_protocol:gn,protocol_name:mn,transport:yn,sent_by:_n,via_host:bn,via_port:Sn,ttl:Cn,WWW_Authenticate:function(){return Lt()},Session_Expires:function(){var e,t,n,r,i,o;if(i=y,null!==(e=Tn())){for(t=[],o=y,null!==(n=H())&&null!==(r=wn())?n=[n,r]:(n=null,y=o);null!==n;)t.push(n),o=y,null!==(n=H())&&null!==(r=wn())?n=[n,r]:(n=null,y=o);null!==t?e=[e,t]:(e=null,y=i)}else e=null,y=i;return e},s_e_expires:Tn,s_e_params:wn,s_e_refresher:En,extension_header:function(){var e,t,n,r;return r=y,null!==(e=P())&&null!==(t=w())&&null!==(n=kn())?e=[e,t,n]:(e=null,y=r),e},header_value:kn,message_body:function(){var e,t;for(e=[],t=n();null!==t;)e.push(t),t=n();return e},uuid_URI:function(){var e,t,n;return n=y,"uuid:"===m.substr(y,5)?(e="uuid:",y+=5):(e=null,0===_&&b('"uuid:"')),null!==e&&null!==(t=Rn())?e=[e,t]:(e=null,y=n),e},uuid:Rn,hex4:In,hex8:Pn,hex12:An,Refer_To:function(){var e,t,n,r,i,o,s;if(o=i=y,null===(e=J())&&(e=pt()),null!==e){for(t=[],s=y,null!==(n=H())&&null!==(r=St())?n=[n,r]:(n=null,y=s);null!==n;)t.push(n),s=y,null!==(n=H())&&null!==(r=St())?n=[n,r]:(n=null,y=s);null!==t?e=[e,t]:(e=null,y=o)}else e=null,y=o;return null!==e&&(e=function(e){try{jn=new Un(jn.uri,jn.display_name,jn.params)}catch(e){jn=-1}}()),null===e&&(y=i),e},Replaces:function(){var e,t,n,r,i,o;if(i=y,null!==(e=On())){for(t=[],o=y,null!==(n=H())&&null!==(r=Mn())?n=[n,r]:(n=null,y=o);null!==n;)t.push(n),o=y,null!==(n=H())&&null!==(r=Mn())?n=[n,r]:(n=null,y=o);null!==t?e=[e,t]:(e=null,y=i)}else e=null,y=i;return e},call_id:On,replaces_param:Mn,to_tag:Dn,from_tag:xn,early_flag:Nn};if(void 0!==l){if(void 0===e[l])throw new Error("Invalid rule name: "+qn(l)+".")}else l="CRLF";var y=0,_=0,o=0,t=[];function b(e){y<o||(o<y&&(o=y,t=[]),t.push(e))}function s(){var e;return"\r\n"===m.substr(y,2)?(e="\r\n",y+=2):(e=null,0===_&&b('"\\r\\n"')),e}function u(){var e;return/^[0-9]/.test(m.charAt(y))?(e=m.charAt(y),y++):(e=null,0===_&&b("[0-9]")),e}function a(){var e;return/^[a-zA-Z]/.test(m.charAt(y))?(e=m.charAt(y),y++):(e=null,0===_&&b("[a-zA-Z]")),e}function c(){var e;return/^[0-9a-fA-F]/.test(m.charAt(y))?(e=m.charAt(y),y++):(e=null,0===_&&b("[0-9a-fA-F]")),e}function d(){var e;return null===(e=h())&&(e=p()),e}function n(){var e;return/^[\0-\xFF]/.test(m.charAt(y))?(e=m.charAt(y),y++):(e=null,0===_&&b("[\\0-\\xFF]")),e}function f(){var e;return/^["]/.test(m.charAt(y))?(e=m.charAt(y),y++):(e=null,0===_&&b('["]')),e}function h(){var e;return 32===m.charCodeAt(y)?(e=" ",y++):(e=null,0===_&&b('" "')),e}function p(){var e;return 9===m.charCodeAt(y)?(e="\t",y++):(e=null,0===_&&b('"\\t"')),e}function i(){var e;return/^[a-zA-Z0-9]/.test(m.charAt(y))?(e=m.charAt(y),y++):(e=null,0===_&&b("[a-zA-Z0-9]")),e}function v(){var e;return 59===m.charCodeAt(y)?(e=";",y++):(e=null,0===_&&b('";"')),null===e&&(47===m.charCodeAt(y)?(e="/",y++):(e=null,0===_&&b('"/"')),null===e&&(63===m.charCodeAt(y)?(e="?",y++):(e=null,0===_&&b('"?"')),null===e&&(58===m.charCodeAt(y)?(e=":",y++):(e=null,0===_&&b('":"')),null===e&&(64===m.charCodeAt(y)?(e="@",y++):(e=null,0===_&&b('"@"')),null===e&&(38===m.charCodeAt(y)?(e="&",y++):(e=null,0===_&&b('"&"')),null===e&&(61===m.charCodeAt(y)?(e="=",y++):(e=null,0===_&&b('"="')),null===e&&(43===m.charCodeAt(y)?(e="+",y++):(e=null,0===_&&b('"+"')),null===e&&(36===m.charCodeAt(y)?(e="$",y++):(e=null,0===_&&b('"$"')),null===e&&(44===m.charCodeAt(y)?(e=",",y++):(e=null,0===_&&b('","'))))))))))),e}function g(){var e;return null===(e=i())&&(e=r()),e}function r(){var e;return 45===m.charCodeAt(y)?(e="-",y++):(e=null,0===_&&b('"-"')),null===e&&(95===m.charCodeAt(y)?(e="_",y++):(e=null,0===_&&b('"_"')),null===e&&(46===m.charCodeAt(y)?(e=".",y++):(e=null,0===_&&b('"."')),null===e&&(33===m.charCodeAt(y)?(e="!",y++):(e=null,0===_&&b('"!"')),null===e&&(126===m.charCodeAt(y)?(e="~",y++):(e=null,0===_&&b('"~"')),null===e&&(42===m.charCodeAt(y)?(e="*",y++):(e=null,0===_&&b('"*"')),null===e&&(39===m.charCodeAt(y)?(e="'",y++):(e=null,0===_&&b('"\'"')),null===e&&(40===m.charCodeAt(y)?(e="(",y++):(e=null,0===_&&b('"("')),null===e&&(41===m.charCodeAt(y)?(e=")",y++):(e=null,0===_&&b('")"')))))))))),e}function S(){var e,t,n,r,i;return i=r=y,37===m.charCodeAt(y)?(e="%",y++):(e=null,0===_&&b('"%"')),null!==e&&null!==(t=c())&&null!==(n=c())?e=[e,t,n]:(e=null,y=i),null!==e&&(e=e.join("")),null===e&&(y=r),e}function C(){var e,t,n,r,i,o;for(o=i=r=y,e=[],t=d();null!==t;)e.push(t),t=d();if(null!==e&&null!==(t=s())?e=[e,t]:(e=null,y=o),null!==(e=null!==e?e:"")){if(null!==(n=d()))for(t=[];null!==n;)t.push(n),n=d();else t=null;null!==t?e=[e,t]:(e=null,y=i)}else e=null,y=i;return null!==e&&(e=" "),null===e&&(y=r),e}function T(){var e;return e=null!==(e=C())?e:""}function w(){var e,t,n,r,i;for(i=r=y,e=[],null===(t=h())&&(t=p());null!==t;)e.push(t),null===(t=h())&&(t=p());return null!==e?(58===m.charCodeAt(y)?(t=":",y++):(t=null,0===_&&b('":"')),null!==t&&null!==(n=T())?e=[e,t,n]:(e=null,y=i)):(e=null,y=i),null!==e&&(e=":"),null===e&&(y=r),e}function E(){var e,t,n,r,i,o,s,a;if(o=i=y,null!==(t=k()))for(e=[];null!==t;)e.push(t),t=k();else e=null;if(null!==e){for(t=[],s=y,n=[],r=C();null!==r;)n.push(r),r=C();for(null!==n&&null!==(r=k())?n=[n,r]:(n=null,y=s);null!==n;){for(t.push(n),s=y,n=[],r=C();null!==r;)n.push(r),r=C();null!==n&&null!==(r=k())?n=[n,r]:(n=null,y=s)}null!==t?e=[e,t]:(e=null,y=o)}else e=null,y=o;return null!==e&&(a=i,e=m.substring(y,a)),null===e&&(y=i),e}function k(){var e;return/^[!-~]/.test(m.charAt(y))?(e=m.charAt(y),y++):(e=null,0===_&&b("[!-~]")),null===e&&(e=R()),e}function R(){var e;return/^[\x80-\uFFFF]/.test(m.charAt(y))?(e=m.charAt(y),y++):(e=null,0===_&&b("[\\x80-\\uFFFF]")),e}function I(){var e;return/^[\x80-\xBF]/.test(m.charAt(y))?(e=m.charAt(y),y++):(e=null,0===_&&b("[\\x80-\\xBF]")),e}function P(){var e,t,n,r;if(n=y,null===(t=i())&&(45===m.charCodeAt(y)?(t="-",y++):(t=null,0===_&&b('"-"')),null===t&&(46===m.charCodeAt(y)?(t=".",y++):(t=null,0===_&&b('"."')),null===t&&(33===m.charCodeAt(y)?(t="!",y++):(t=null,0===_&&b('"!"')),null===t&&(37===m.charCodeAt(y)?(t="%",y++):(t=null,0===_&&b('"%"')),null===t&&(42===m.charCodeAt(y)?(t="*",y++):(t=null,0===_&&b('"*"')),null===t&&(95===m.charCodeAt(y)?(t="_",y++):(t=null,0===_&&b('"_"')),null===t&&(43===m.charCodeAt(y)?(t="+",y++):(t=null,0===_&&b('"+"')),null===t&&(96===m.charCodeAt(y)?(t="`",y++):(t=null,0===_&&b('"`"')),null===t&&(39===m.charCodeAt(y)?(t="'",y++):(t=null,0===_&&b('"\'"')),null===t&&(126===m.charCodeAt(y)?(t="~",y++):(t=null,0===_&&b('"~"')))))))))))),null!==t)for(e=[];null!==t;)e.push(t),null===(t=i())&&(45===m.charCodeAt(y)?(t="-",y++):(t=null,0===_&&b('"-"')),null===t&&(46===m.charCodeAt(y)?(t=".",y++):(t=null,0===_&&b('"."')),null===t&&(33===m.charCodeAt(y)?(t="!",y++):(t=null,0===_&&b('"!"')),null===t&&(37===m.charCodeAt(y)?(t="%",y++):(t=null,0===_&&b('"%"')),null===t&&(42===m.charCodeAt(y)?(t="*",y++):(t=null,0===_&&b('"*"')),null===t&&(95===m.charCodeAt(y)?(t="_",y++):(t=null,0===_&&b('"_"')),null===t&&(43===m.charCodeAt(y)?(t="+",y++):(t=null,0===_&&b('"+"')),null===t&&(96===m.charCodeAt(y)?(t="`",y++):(t=null,0===_&&b('"`"')),null===t&&(39===m.charCodeAt(y)?(t="'",y++):(t=null,0===_&&b('"\'"')),null===t&&(126===m.charCodeAt(y)?(t="~",y++):(t=null,0===_&&b('"~"'))))))))))));else e=null;return null!==e&&(r=n,e=m.substring(y,r)),null===e&&(y=n),e}function A(){var e,t,n,r;if(n=y,null===(t=i())&&(45===m.charCodeAt(y)?(t="-",y++):(t=null,0===_&&b('"-"')),null===t&&(33===m.charCodeAt(y)?(t="!",y++):(t=null,0===_&&b('"!"')),null===t&&(37===m.charCodeAt(y)?(t="%",y++):(t=null,0===_&&b('"%"')),null===t&&(42===m.charCodeAt(y)?(t="*",y++):(t=null,0===_&&b('"*"')),null===t&&(95===m.charCodeAt(y)?(t="_",y++):(t=null,0===_&&b('"_"')),null===t&&(43===m.charCodeAt(y)?(t="+",y++):(t=null,0===_&&b('"+"')),null===t&&(96===m.charCodeAt(y)?(t="`",y++):(t=null,0===_&&b('"`"')),null===t&&(39===m.charCodeAt(y)?(t="'",y++):(t=null,0===_&&b('"\'"')),null===t&&(126===m.charCodeAt(y)?(t="~",y++):(t=null,0===_&&b('"~"'))))))))))),null!==t)for(e=[];null!==t;)e.push(t),null===(t=i())&&(45===m.charCodeAt(y)?(t="-",y++):(t=null,0===_&&b('"-"')),null===t&&(33===m.charCodeAt(y)?(t="!",y++):(t=null,0===_&&b('"!"')),null===t&&(37===m.charCodeAt(y)?(t="%",y++):(t=null,0===_&&b('"%"')),null===t&&(42===m.charCodeAt(y)?(t="*",y++):(t=null,0===_&&b('"*"')),null===t&&(95===m.charCodeAt(y)?(t="_",y++):(t=null,0===_&&b('"_"')),null===t&&(43===m.charCodeAt(y)?(t="+",y++):(t=null,0===_&&b('"+"')),null===t&&(96===m.charCodeAt(y)?(t="`",y++):(t=null,0===_&&b('"`"')),null===t&&(39===m.charCodeAt(y)?(t="'",y++):(t=null,0===_&&b('"\'"')),null===t&&(126===m.charCodeAt(y)?(t="~",y++):(t=null,0===_&&b('"~"')))))))))));else e=null;return null!==e&&(r=n,e=m.substring(y,r)),null===e&&(y=n),e}function O(){var e,t,n,r;if(n=y,null===(t=i())&&(45===m.charCodeAt(y)?(t="-",y++):(t=null,0===_&&b('"-"')),null===t&&(46===m.charCodeAt(y)?(t=".",y++):(t=null,0===_&&b('"."')),null===t&&(33===m.charCodeAt(y)?(t="!",y++):(t=null,0===_&&b('"!"')),null===t&&(37===m.charCodeAt(y)?(t="%",y++):(t=null,0===_&&b('"%"')),null===t&&(42===m.charCodeAt(y)?(t="*",y++):(t=null,0===_&&b('"*"')),null===t&&(95===m.charCodeAt(y)?(t="_",y++):(t=null,0===_&&b('"_"')),null===t&&(43===m.charCodeAt(y)?(t="+",y++):(t=null,0===_&&b('"+"')),null===t&&(96===m.charCodeAt(y)?(t="`",y++):(t=null,0===_&&b('"`"')),null===t&&(39===m.charCodeAt(y)?(t="'",y++):(t=null,0===_&&b('"\'"')),null===t&&(126===m.charCodeAt(y)?(t="~",y++):(t=null,0===_&&b('"~"')),null===t&&(40===m.charCodeAt(y)?(t="(",y++):(t=null,0===_&&b('"("')),null===t&&(41===m.charCodeAt(y)?(t=")",y++):(t=null,0===_&&b('")"')),null===t&&(60===m.charCodeAt(y)?(t="<",y++):(t=null,0===_&&b('"<"')),null===t&&(62===m.charCodeAt(y)?(t=">",y++):(t=null,0===_&&b('">"')),null===t&&(58===m.charCodeAt(y)?(t=":",y++):(t=null,0===_&&b('":"')),null===t&&(92===m.charCodeAt(y)?(t="\\",y++):(t=null,0===_&&b('"\\\\"')),null===t&&null===(t=f())&&(47===m.charCodeAt(y)?(t="/",y++):(t=null,0===_&&b('"/"')),null===t&&(91===m.charCodeAt(y)?(t="[",y++):(t=null,0===_&&b('"["')),null===t&&(93===m.charCodeAt(y)?(t="]",y++):(t=null,0===_&&b('"]"')),null===t&&(63===m.charCodeAt(y)?(t="?",y++):(t=null,0===_&&b('"?"')),null===t&&(123===m.charCodeAt(y)?(t="{",y++):(t=null,0===_&&b('"{"')),null===t&&(125===m.charCodeAt(y)?(t="}",y++):(t=null,0===_&&b('"}"')))))))))))))))))))))))),null!==t)for(e=[];null!==t;)e.push(t),null===(t=i())&&(45===m.charCodeAt(y)?(t="-",y++):(t=null,0===_&&b('"-"')),null===t&&(46===m.charCodeAt(y)?(t=".",y++):(t=null,0===_&&b('"."')),null===t&&(33===m.charCodeAt(y)?(t="!",y++):(t=null,0===_&&b('"!"')),null===t&&(37===m.charCodeAt(y)?(t="%",y++):(t=null,0===_&&b('"%"')),null===t&&(42===m.charCodeAt(y)?(t="*",y++):(t=null,0===_&&b('"*"')),null===t&&(95===m.charCodeAt(y)?(t="_",y++):(t=null,0===_&&b('"_"')),null===t&&(43===m.charCodeAt(y)?(t="+",y++):(t=null,0===_&&b('"+"')),null===t&&(96===m.charCodeAt(y)?(t="`",y++):(t=null,0===_&&b('"`"')),null===t&&(39===m.charCodeAt(y)?(t="'",y++):(t=null,0===_&&b('"\'"')),null===t&&(126===m.charCodeAt(y)?(t="~",y++):(t=null,0===_&&b('"~"')),null===t&&(40===m.charCodeAt(y)?(t="(",y++):(t=null,0===_&&b('"("')),null===t&&(41===m.charCodeAt(y)?(t=")",y++):(t=null,0===_&&b('")"')),null===t&&(60===m.charCodeAt(y)?(t="<",y++):(t=null,0===_&&b('"<"')),null===t&&(62===m.charCodeAt(y)?(t=">",y++):(t=null,0===_&&b('">"')),null===t&&(58===m.charCodeAt(y)?(t=":",y++):(t=null,0===_&&b('":"')),null===t&&(92===m.charCodeAt(y)?(t="\\",y++):(t=null,0===_&&b('"\\\\"')),null===t&&null===(t=f())&&(47===m.charCodeAt(y)?(t="/",y++):(t=null,0===_&&b('"/"')),null===t&&(91===m.charCodeAt(y)?(t="[",y++):(t=null,0===_&&b('"["')),null===t&&(93===m.charCodeAt(y)?(t="]",y++):(t=null,0===_&&b('"]"')),null===t&&(63===m.charCodeAt(y)?(t="?",y++):(t=null,0===_&&b('"?"')),null===t&&(123===m.charCodeAt(y)?(t="{",y++):(t=null,0===_&&b('"{"')),null===t&&(125===m.charCodeAt(y)?(t="}",y++):(t=null,0===_&&b('"}"'))))))))))))))))))))))));else e=null;return null!==e&&(r=n,e=m.substring(y,r)),null===e&&(y=n),e}function M(){var e,t,n,r,i;return i=r=y,null!==(e=T())?(42===m.charCodeAt(y)?(t="*",y++):(t=null,0===_&&b('"*"')),null!==t&&null!==(n=T())?e=[e,t,n]:(e=null,y=i)):(e=null,y=i),null!==e&&(e="*"),null===e&&(y=r),e}function D(){var e,t,n,r,i;return i=r=y,null!==(e=T())?(47===m.charCodeAt(y)?(t="/",y++):(t=null,0===_&&b('"/"')),null!==t&&null!==(n=T())?e=[e,t,n]:(e=null,y=i)):(e=null,y=i),null!==e&&(e="/"),null===e&&(y=r),e}function x(){var e,t,n,r,i;return i=r=y,null!==(e=T())?(61===m.charCodeAt(y)?(t="=",y++):(t=null,0===_&&b('"="')),null!==t&&null!==(n=T())?e=[e,t,n]:(e=null,y=i)):(e=null,y=i),null!==e&&(e="="),null===e&&(y=r),e}function N(){var e,t,n,r,i;return i=r=y,null!==(e=T())?(40===m.charCodeAt(y)?(t="(",y++):(t=null,0===_&&b('"("')),null!==t&&null!==(n=T())?e=[e,t,n]:(e=null,y=i)):(e=null,y=i),null!==e&&(e="("),null===e&&(y=r),e}function F(){var e,t,n,r,i;return i=r=y,null!==(e=T())?(41===m.charCodeAt(y)?(t=")",y++):(t=null,0===_&&b('")"')),null!==t&&null!==(n=T())?e=[e,t,n]:(e=null,y=i)):(e=null,y=i),null!==e&&(e=")"),null===e&&(y=r),e}function U(){var e,t,n,r;return r=n=y,62===m.charCodeAt(y)?(e=">",y++):(e=null,0===_&&b('">"')),null!==e&&null!==(t=T())?e=[e,t]:(e=null,y=r),null!==e&&(e=">"),null===e&&(y=n),e}function j(){var e,t,n,r;return r=n=y,null!==(e=T())?(60===m.charCodeAt(y)?(t="<",y++):(t=null,0===_&&b('"<"')),null!==t?e=[e,t]:(e=null,y=r)):(e=null,y=r),null!==e&&(e="<"),null===e&&(y=n),e}function L(){var e,t,n,r,i;return i=r=y,null!==(e=T())?(44===m.charCodeAt(y)?(t=",",y++):(t=null,0===_&&b('","')),null!==t&&null!==(n=T())?e=[e,t,n]:(e=null,y=i)):(e=null,y=i),null!==e&&(e=","),null===e&&(y=r),e}function H(){var e,t,n,r,i;return i=r=y,null!==(e=T())?(59===m.charCodeAt(y)?(t=";",y++):(t=null,0===_&&b('";"')),null!==t&&null!==(n=T())?e=[e,t,n]:(e=null,y=i)):(e=null,y=i),null!==e&&(e=";"),null===e&&(y=r),e}function B(){var e,t,n,r,i;return i=r=y,null!==(e=T())?(58===m.charCodeAt(y)?(t=":",y++):(t=null,0===_&&b('":"')),null!==t&&null!==(n=T())?e=[e,t,n]:(e=null,y=i)):(e=null,y=i),null!==e&&(e=":"),null===e&&(y=r),e}function q(){var e,t,n,r;return r=n=y,null!==(e=T())&&null!==(t=f())?e=[e,t]:(e=null,y=r),null!==e&&(e='"'),null===e&&(y=n),e}function G(){var e,t,n,r;return r=n=y,null!==(e=f())&&null!==(t=T())?e=[e,t]:(e=null,y=r),null!==e&&(e='"'),null===e&&(y=n),e}function W(){var e;return/^[!-']/.test(m.charAt(y))?(e=m.charAt(y),y++):(e=null,0===_&&b("[!-']")),null===e&&(/^[*-[]/.test(m.charAt(y))?(e=m.charAt(y),y++):(e=null,0===_&&b("[*-[]")),null===e&&(/^[\]-~]/.test(m.charAt(y))?(e=m.charAt(y),y++):(e=null,0===_&&b("[\\]-~]")),null===e&&null===(e=R())&&(e=C()))),e}function V(){var e,t,n,r,i,o,s;if(o=i=y,null!==(e=T()))if(null!==(t=f())){for(n=[],null===(r=K())&&(r=Q());null!==r;)n.push(r),null===(r=K())&&(r=Q());null!==n&&null!==(r=f())?e=[e,t,n,r]:(e=null,y=o)}else e=null,y=o;else e=null,y=o;return null!==e&&(s=i,e=m.substring(y,s)),null===e&&(y=i),e}function z(){var e,t,n,r,i,o,s;if(o=i=y,null!==(e=T()))if(null!==(t=f())){for(n=[],null===(r=K())&&(r=Q());null!==r;)n.push(r),null===(r=K())&&(r=Q());null!==n&&null!==(r=f())?e=[e,t,n,r]:(e=null,y=o)}else e=null,y=o;else e=null,y=o;return null!==e&&(s=i,e=m.substring(y-1,s+1)),null===e&&(y=i),e}function K(){var e;return null===(e=C())&&(33===m.charCodeAt(y)?(e="!",y++):(e=null,0===_&&b('"!"')),null===e&&(/^[#-[]/.test(m.charAt(y))?(e=m.charAt(y),y++):(e=null,0===_&&b("[#-[]")),null===e&&(/^[\]-~]/.test(m.charAt(y))?(e=m.charAt(y),y++):(e=null,0===_&&b("[\\]-~]")),null===e&&(e=R())))),e}function Q(){var e,t,n;return n=y,92===m.charCodeAt(y)?(e="\\",y++):(e=null,0===_&&b('"\\\\"')),null!==e?(/^[\0-\t]/.test(m.charAt(y))?(t=m.charAt(y),y++):(t=null,0===_&&b("[\\0-\\t]")),null===t&&(/^[\x0B-\f]/.test(m.charAt(y))?(t=m.charAt(y),y++):(t=null,0===_&&b("[\\x0B-\\f]")),null===t&&(/^[\x0E-]/.test(m.charAt(y))?(t=m.charAt(y),y++):(t=null,0===_&&b("[\\x0E-]")))),null!==t?e=[e,t]:(e=null,y=n)):(e=null,y=n),e}function J(){var e,t,n,r,i,o;return o=i=y,null!==(e=$())?(58===m.charCodeAt(y)?(t=":",y++):(t=null,0===_&&b('":"')),null!==t&&null!==(n=null!==(n=ee())?n:"")&&null!==(r=ie())?e=[e,t,n,r]:(e=null,y=o)):(e=null,y=o),null!==e&&(e=function(e){try{jn.uri=new Fn(jn.scheme,jn.user,jn.host,jn.port),delete jn.scheme,delete jn.user,delete jn.host,delete jn.host_type,delete jn.port}catch(e){jn=-1}}()),null===e&&(y=i),e}function X(){var e,t,n,r,i,o,s,a;return a=s=y,null!==(e=$())?(58===m.charCodeAt(y)?(t=":",y++):(t=null,0===_&&b('":"')),null!==t&&null!==(n=null!==(n=ee())?n:"")&&null!==(r=ie())&&null!==(i=ge())&&null!==(o=null!==(o=Pe())?o:"")?e=[e,t,n,r,i,o]:(e=null,y=a)):(e=null,y=a),null!==e&&(e=function(e){try{jn.uri=new Fn(jn.scheme,jn.user,jn.host,jn.port,jn.uri_params,jn.uri_headers),delete jn.scheme,delete jn.user,delete jn.host,delete jn.host_type,delete jn.port,delete jn.uri_params,"SIP_URI"===l&&(jn=jn.uri)}catch(e){jn=-1}}()),null===e&&(y=s),e}function $(){var e;return null===(e=Y())&&(e=Z()),e}function Y(){var e,t,n;return t=y,"sips"===m.substr(y,4).toLowerCase()?(e=m.substr(y,4),y+=4):(e=null,0===_&&b('"sips"')),null!==e&&(n=e,e=void(jn.scheme=n.toLowerCase())),null===e&&(y=t),e}function Z(){var e,t,n;return t=y,"sip"===m.substr(y,3).toLowerCase()?(e=m.substr(y,3),y+=3):(e=null,0===_&&b('"sip"')),null!==e&&(n=e,e=void(jn.scheme=n.toLowerCase())),null===e&&(y=t),e}function ee(){var e,t,n,r,i,o,s;return i=r=y,null!==(e=te())?(o=y,58===m.charCodeAt(y)?(t=":",y++):(t=null,0===_&&b('":"')),null!==t&&null!==(n=re())?t=[t,n]:(t=null,y=o),null!==(t=null!==t?t:"")?(64===m.charCodeAt(y)?(n="@",y++):(n=null,0===_&&b('"@"')),null!==n?e=[e,t,n]:(e=null,y=i)):(e=null,y=i)):(e=null,y=i),null!==e&&(s=r,e=void(jn.user=decodeURIComponent(m.substring(y-1,s)))),null===e&&(y=r),e}function te(){var e,t;if(null===(t=g())&&null===(t=S())&&(t=ne()),null!==t)for(e=[];null!==t;)e.push(t),null===(t=g())&&null===(t=S())&&(t=ne());else e=null;return e}function ne(){var e;return 38===m.charCodeAt(y)?(e="&",y++):(e=null,0===_&&b('"&"')),null===e&&(61===m.charCodeAt(y)?(e="=",y++):(e=null,0===_&&b('"="')),null===e&&(43===m.charCodeAt(y)?(e="+",y++):(e=null,0===_&&b('"+"')),null===e&&(36===m.charCodeAt(y)?(e="$",y++):(e=null,0===_&&b('"$"')),null===e&&(44===m.charCodeAt(y)?(e=",",y++):(e=null,0===_&&b('","')),null===e&&(59===m.charCodeAt(y)?(e=";",y++):(e=null,0===_&&b('";"')),null===e&&(63===m.charCodeAt(y)?(e="?",y++):(e=null,0===_&&b('"?"')),null===e&&(47===m.charCodeAt(y)?(e="/",y++):(e=null,0===_&&b('"/"'))))))))),e}function re(){var e,t,n,r;for(n=y,e=[],null===(t=g())&&null===(t=S())&&(38===m.charCodeAt(y)?(t="&",y++):(t=null,0===_&&b('"&"')),null===t&&(61===m.charCodeAt(y)?(t="=",y++):(t=null,0===_&&b('"="')),null===t&&(43===m.charCodeAt(y)?(t="+",y++):(t=null,0===_&&b('"+"')),null===t&&(36===m.charCodeAt(y)?(t="$",y++):(t=null,0===_&&b('"$"')),null===t&&(44===m.charCodeAt(y)?(t=",",y++):(t=null,0===_&&b('","')))))));null!==t;)e.push(t),null===(t=g())&&null===(t=S())&&(38===m.charCodeAt(y)?(t="&",y++):(t=null,0===_&&b('"&"')),null===t&&(61===m.charCodeAt(y)?(t="=",y++):(t=null,0===_&&b('"="')),null===t&&(43===m.charCodeAt(y)?(t="+",y++):(t=null,0===_&&b('"+"')),null===t&&(36===m.charCodeAt(y)?(t="$",y++):(t=null,0===_&&b('"$"')),null===t&&(44===m.charCodeAt(y)?(t=",",y++):(t=null,0===_&&b('","')))))));return null!==e&&(r=n,e=void(jn.password=m.substring(y,r))),null===e&&(y=n),e}function ie(){var e,t,n,r,i;return r=y,null!==(e=oe())?(i=y,58===m.charCodeAt(y)?(t=":",y++):(t=null,0===_&&b('":"')),null!==t&&null!==(n=ve())?t=[t,n]:(t=null,y=i),null!==(t=null!==t?t:"")?e=[e,t]:(e=null,y=r)):(e=null,y=r),e}function oe(){var e,t,n;return t=y,null===(e=se())&&null===(e=he())&&(e=ue()),null!==e&&(n=t,jn.host=m.substring(y,n).toLowerCase(),e=jn.host),null===e&&(y=t),e}function se(){var e,t,n,r,i,o,s;for(e=[],o=i=r=y,null!==(t=ae())?(46===m.charCodeAt(y)?(n=".",y++):(n=null,0===_&&b('"."')),null!==n?t=[t,n]:(t=null,y=o)):(t=null,y=o);null!==t;)e.push(t),o=y,null!==(t=ae())?(46===m.charCodeAt(y)?(n=".",y++):(n=null,0===_&&b('"."')),null!==n?t=[t,n]:(t=null,y=o)):(t=null,y=o);return null!==e&&null!==(t=le())?(46===m.charCodeAt(y)?(n=".",y++):(n=null,0===_&&b('"."')),null!==(n=null!==n?n:"")?e=[e,t,n]:(e=null,y=i)):(e=null,y=i),null!==e&&(s=r,jn.host_type="domain",e=m.substring(y,s)),null===e&&(y=r),e}function ae(){var e,t,n,r;if(r=y,null!==(e=i())){for(t=[],null===(n=i())&&(45===m.charCodeAt(y)?(n="-",y++):(n=null,0===_&&b('"-"')),null===n&&(95===m.charCodeAt(y)?(n="_",y++):(n=null,0===_&&b('"_"'))));null!==n;)t.push(n),null===(n=i())&&(45===m.charCodeAt(y)?(n="-",y++):(n=null,0===_&&b('"-"')),null===n&&(95===m.charCodeAt(y)?(n="_",y++):(n=null,0===_&&b('"_"'))));null!==t?e=[e,t]:(e=null,y=r)}else e=null,y=r;return e}function le(){var e,t,n,r;if(r=y,null!==(e=a())){for(t=[],null===(n=i())&&(45===m.charCodeAt(y)?(n="-",y++):(n=null,0===_&&b('"-"')),null===n&&(95===m.charCodeAt(y)?(n="_",y++):(n=null,0===_&&b('"_"'))));null!==n;)t.push(n),null===(n=i())&&(45===m.charCodeAt(y)?(n="-",y++):(n=null,0===_&&b('"-"')),null===n&&(95===m.charCodeAt(y)?(n="_",y++):(n=null,0===_&&b('"_"'))));null!==t?e=[e,t]:(e=null,y=r)}else e=null,y=r;return e}function ue(){var e,t,n,r,i,o;return i=r=y,91===m.charCodeAt(y)?(e="[",y++):(e=null,0===_&&b('"["')),null!==e&&null!==(t=ce())?(93===m.charCodeAt(y)?(n="]",y++):(n=null,0===_&&b('"]"')),null!==n?e=[e,t,n]:(e=null,y=i)):(e=null,y=i),null!==e&&(o=r,jn.host_type="IPv6",e=m.substring(y,o)),null===e&&(y=r),e}function ce(){var e,t,n,r,i,o,s,a,l,u,c,d,f,h,p,v,g;return p=h=y,null!==(e=de())?(58===m.charCodeAt(y)?(t=":",y++):(t=null,0===_&&b('":"')),null!==t&&null!==(n=de())?(58===m.charCodeAt(y)?(r=":",y++):(r=null,0===_&&b('":"')),null!==r&&null!==(i=de())?(58===m.charCodeAt(y)?(o=":",y++):(o=null,0===_&&b('":"')),null!==o&&null!==(s=de())?(58===m.charCodeAt(y)?(a=":",y++):(a=null,0===_&&b('":"')),null!==a&&null!==(l=de())?(58===m.charCodeAt(y)?(u=":",y++):(u=null,0===_&&b('":"')),null!==u&&null!==(c=de())?(58===m.charCodeAt(y)?(d=":",y++):(d=null,0===_&&b('":"')),null!==d&&null!==(f=fe())?e=[e,t,n,r,i,o,s,a,l,u,c,d,f]:(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p),null===e&&(p=y,"::"===m.substr(y,2)?(e="::",y+=2):(e=null,0===_&&b('"::"')),null!==e&&null!==(t=de())?(58===m.charCodeAt(y)?(n=":",y++):(n=null,0===_&&b('":"')),null!==n&&null!==(r=de())?(58===m.charCodeAt(y)?(i=":",y++):(i=null,0===_&&b('":"')),null!==i&&null!==(o=de())?(58===m.charCodeAt(y)?(s=":",y++):(s=null,0===_&&b('":"')),null!==s&&null!==(a=de())?(58===m.charCodeAt(y)?(l=":",y++):(l=null,0===_&&b('":"')),null!==l&&null!==(u=de())?(58===m.charCodeAt(y)?(c=":",y++):(c=null,0===_&&b('":"')),null!==c&&null!==(d=fe())?e=[e,t,n,r,i,o,s,a,l,u,c,d]:(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p),null===e&&(p=y,"::"===m.substr(y,2)?(e="::",y+=2):(e=null,0===_&&b('"::"')),null!==e&&null!==(t=de())?(58===m.charCodeAt(y)?(n=":",y++):(n=null,0===_&&b('":"')),null!==n&&null!==(r=de())?(58===m.charCodeAt(y)?(i=":",y++):(i=null,0===_&&b('":"')),null!==i&&null!==(o=de())?(58===m.charCodeAt(y)?(s=":",y++):(s=null,0===_&&b('":"')),null!==s&&null!==(a=de())?(58===m.charCodeAt(y)?(l=":",y++):(l=null,0===_&&b('":"')),null!==l&&null!==(u=fe())?e=[e,t,n,r,i,o,s,a,l,u]:(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p),null===e&&(p=y,"::"===m.substr(y,2)?(e="::",y+=2):(e=null,0===_&&b('"::"')),null!==e&&null!==(t=de())?(58===m.charCodeAt(y)?(n=":",y++):(n=null,0===_&&b('":"')),null!==n&&null!==(r=de())?(58===m.charCodeAt(y)?(i=":",y++):(i=null,0===_&&b('":"')),null!==i&&null!==(o=de())?(58===m.charCodeAt(y)?(s=":",y++):(s=null,0===_&&b('":"')),null!==s&&null!==(a=fe())?e=[e,t,n,r,i,o,s,a]:(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p),null===e&&(p=y,"::"===m.substr(y,2)?(e="::",y+=2):(e=null,0===_&&b('"::"')),null!==e&&null!==(t=de())?(58===m.charCodeAt(y)?(n=":",y++):(n=null,0===_&&b('":"')),null!==n&&null!==(r=de())?(58===m.charCodeAt(y)?(i=":",y++):(i=null,0===_&&b('":"')),null!==i&&null!==(o=fe())?e=[e,t,n,r,i,o]:(e=null,y=p)):(e=null,y=p)):(e=null,y=p),null===e&&(p=y,"::"===m.substr(y,2)?(e="::",y+=2):(e=null,0===_&&b('"::"')),null!==e&&null!==(t=de())?(58===m.charCodeAt(y)?(n=":",y++):(n=null,0===_&&b('":"')),null!==n&&null!==(r=fe())?e=[e,t,n,r]:(e=null,y=p)):(e=null,y=p),null===e&&(p=y,"::"===m.substr(y,2)?(e="::",y+=2):(e=null,0===_&&b('"::"')),null!==e&&null!==(t=fe())?e=[e,t]:(e=null,y=p),null===e&&(p=y,"::"===m.substr(y,2)?(e="::",y+=2):(e=null,0===_&&b('"::"')),null!==e&&null!==(t=de())?e=[e,t]:(e=null,y=p),null===e&&(p=y,null!==(e=de())?("::"===m.substr(y,2)?(t="::",y+=2):(t=null,0===_&&b('"::"')),null!==t&&null!==(n=de())?(58===m.charCodeAt(y)?(r=":",y++):(r=null,0===_&&b('":"')),null!==r&&null!==(i=de())?(58===m.charCodeAt(y)?(o=":",y++):(o=null,0===_&&b('":"')),null!==o&&null!==(s=de())?(58===m.charCodeAt(y)?(a=":",y++):(a=null,0===_&&b('":"')),null!==a&&null!==(l=de())?(58===m.charCodeAt(y)?(u=":",y++):(u=null,0===_&&b('":"')),null!==u&&null!==(c=fe())?e=[e,t,n,r,i,o,s,a,l,u,c]:(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p),null===e&&(p=y,null!==(e=de())?(v=y,58===m.charCodeAt(y)?(t=":",y++):(t=null,0===_&&b('":"')),null!==t&&null!==(n=de())?t=[t,n]:(t=null,y=v),null!==(t=null!==t?t:"")?("::"===m.substr(y,2)?(n="::",y+=2):(n=null,0===_&&b('"::"')),null!==n&&null!==(r=de())?(58===m.charCodeAt(y)?(i=":",y++):(i=null,0===_&&b('":"')),null!==i&&null!==(o=de())?(58===m.charCodeAt(y)?(s=":",y++):(s=null,0===_&&b('":"')),null!==s&&null!==(a=de())?(58===m.charCodeAt(y)?(l=":",y++):(l=null,0===_&&b('":"')),null!==l&&null!==(u=fe())?e=[e,t,n,r,i,o,s,a,l,u]:(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p),null===e&&(p=y,null!==(e=de())?(v=y,58===m.charCodeAt(y)?(t=":",y++):(t=null,0===_&&b('":"')),null!==t&&null!==(n=de())?t=[t,n]:(t=null,y=v),null!==(t=null!==t?t:"")?(v=y,58===m.charCodeAt(y)?(n=":",y++):(n=null,0===_&&b('":"')),null!==n&&null!==(r=de())?n=[n,r]:(n=null,y=v),null!==(n=null!==n?n:"")?("::"===m.substr(y,2)?(r="::",y+=2):(r=null,0===_&&b('"::"')),null!==r&&null!==(i=de())?(58===m.charCodeAt(y)?(o=":",y++):(o=null,0===_&&b('":"')),null!==o&&null!==(s=de())?(58===m.charCodeAt(y)?(a=":",y++):(a=null,0===_&&b('":"')),null!==a&&null!==(l=fe())?e=[e,t,n,r,i,o,s,a,l]:(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p),null===e&&(p=y,null!==(e=de())?(v=y,58===m.charCodeAt(y)?(t=":",y++):(t=null,0===_&&b('":"')),null!==t&&null!==(n=de())?t=[t,n]:(t=null,y=v),null!==(t=null!==t?t:"")?(v=y,58===m.charCodeAt(y)?(n=":",y++):(n=null,0===_&&b('":"')),null!==n&&null!==(r=de())?n=[n,r]:(n=null,y=v),null!==(n=null!==n?n:"")?(v=y,58===m.charCodeAt(y)?(r=":",y++):(r=null,0===_&&b('":"')),null!==r&&null!==(i=de())?r=[r,i]:(r=null,y=v),null!==(r=null!==r?r:"")?("::"===m.substr(y,2)?(i="::",y+=2):(i=null,0===_&&b('"::"')),null!==i&&null!==(o=de())?(58===m.charCodeAt(y)?(s=":",y++):(s=null,0===_&&b('":"')),null!==s&&null!==(a=fe())?e=[e,t,n,r,i,o,s,a]:(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p),null===e&&(p=y,null!==(e=de())?(v=y,58===m.charCodeAt(y)?(t=":",y++):(t=null,0===_&&b('":"')),null!==t&&null!==(n=de())?t=[t,n]:(t=null,y=v),null!==(t=null!==t?t:"")?(v=y,58===m.charCodeAt(y)?(n=":",y++):(n=null,0===_&&b('":"')),null!==n&&null!==(r=de())?n=[n,r]:(n=null,y=v),null!==(n=null!==n?n:"")?(v=y,58===m.charCodeAt(y)?(r=":",y++):(r=null,0===_&&b('":"')),null!==r&&null!==(i=de())?r=[r,i]:(r=null,y=v),null!==(r=null!==r?r:"")?(v=y,58===m.charCodeAt(y)?(i=":",y++):(i=null,0===_&&b('":"')),null!==i&&null!==(o=de())?i=[i,o]:(i=null,y=v),null!==(i=null!==i?i:"")?("::"===m.substr(y,2)?(o="::",y+=2):(o=null,0===_&&b('"::"')),null!==o&&null!==(s=fe())?e=[e,t,n,r,i,o,s]:(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p),null===e&&(p=y,null!==(e=de())?(v=y,58===m.charCodeAt(y)?(t=":",y++):(t=null,0===_&&b('":"')),null!==t&&null!==(n=de())?t=[t,n]:(t=null,y=v),null!==(t=null!==t?t:"")?(v=y,58===m.charCodeAt(y)?(n=":",y++):(n=null,0===_&&b('":"')),null!==n&&null!==(r=de())?n=[n,r]:(n=null,y=v),null!==(n=null!==n?n:"")?(v=y,58===m.charCodeAt(y)?(r=":",y++):(r=null,0===_&&b('":"')),null!==r&&null!==(i=de())?r=[r,i]:(r=null,y=v),null!==(r=null!==r?r:"")?(v=y,58===m.charCodeAt(y)?(i=":",y++):(i=null,0===_&&b('":"')),null!==i&&null!==(o=de())?i=[i,o]:(i=null,y=v),null!==(i=null!==i?i:"")?(v=y,58===m.charCodeAt(y)?(o=":",y++):(o=null,0===_&&b('":"')),null!==o&&null!==(s=de())?o=[o,s]:(o=null,y=v),null!==(o=null!==o?o:"")?("::"===m.substr(y,2)?(s="::",y+=2):(s=null,0===_&&b('"::"')),null!==s&&null!==(a=de())?e=[e,t,n,r,i,o,s,a]:(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p),null===e&&(p=y,null!==(e=de())?(v=y,58===m.charCodeAt(y)?(t=":",y++):(t=null,0===_&&b('":"')),null!==t&&null!==(n=de())?t=[t,n]:(t=null,y=v),null!==(t=null!==t?t:"")?(v=y,58===m.charCodeAt(y)?(n=":",y++):(n=null,0===_&&b('":"')),null!==n&&null!==(r=de())?n=[n,r]:(n=null,y=v),null!==(n=null!==n?n:"")?(v=y,58===m.charCodeAt(y)?(r=":",y++):(r=null,0===_&&b('":"')),null!==r&&null!==(i=de())?r=[r,i]:(r=null,y=v),null!==(r=null!==r?r:"")?(v=y,58===m.charCodeAt(y)?(i=":",y++):(i=null,0===_&&b('":"')),null!==i&&null!==(o=de())?i=[i,o]:(i=null,y=v),null!==(i=null!==i?i:"")?(v=y,58===m.charCodeAt(y)?(o=":",y++):(o=null,0===_&&b('":"')),null!==o&&null!==(s=de())?o=[o,s]:(o=null,y=v),null!==(o=null!==o?o:"")?(v=y,58===m.charCodeAt(y)?(s=":",y++):(s=null,0===_&&b('":"')),null!==s&&null!==(a=de())?s=[s,a]:(s=null,y=v),null!==(s=null!==s?s:"")?("::"===m.substr(y,2)?(a="::",y+=2):(a=null,0===_&&b('"::"')),null!==a?e=[e,t,n,r,i,o,s,a]:(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p)):(e=null,y=p))))))))))))))),null!==e&&(g=h,jn.host_type="IPv6",e=m.substring(y,g)),null===e&&(y=h),e}function de(){var e,t,n,r,i;return i=y,null!==(e=c())&&null!==(t=null!==(t=c())?t:"")&&null!==(n=null!==(n=c())?n:"")&&null!==(r=null!==(r=c())?r:"")?e=[e,t,n,r]:(e=null,y=i),e}function fe(){var e,t,n,r;return r=y,null!==(e=de())?(58===m.charCodeAt(y)?(t=":",y++):(t=null,0===_&&b('":"')),null!==t&&null!==(n=de())?e=[e,t,n]:(e=null,y=r)):(e=null,y=r),null===e&&(e=he()),e}function he(){var e,t,n,r,i,o,s,a,l,u;return l=a=y,null!==(e=pe())?(46===m.charCodeAt(y)?(t=".",y++):(t=null,0===_&&b('"."')),null!==t&&null!==(n=pe())?(46===m.charCodeAt(y)?(r=".",y++):(r=null,0===_&&b('"."')),null!==r&&null!==(i=pe())?(46===m.charCodeAt(y)?(o=".",y++):(o=null,0===_&&b('"."')),null!==o&&null!==(s=pe())?e=[e,t,n,r,i,o,s]:(e=null,y=l)):(e=null,y=l)):(e=null,y=l)):(e=null,y=l),null!==e&&(u=a,jn.host_type="IPv4",e=m.substring(y,u)),null===e&&(y=a),e}function pe(){var e,t,n,r;return r=y,"25"===m.substr(y,2)?(e="25",y+=2):(e=null,0===_&&b('"25"')),null!==e?(/^[0-5]/.test(m.charAt(y))?(t=m.charAt(y),y++):(t=null,0===_&&b("[0-5]")),null!==t?e=[e,t]:(e=null,y=r)):(e=null,y=r),null===e&&(r=y,50===m.charCodeAt(y)?(e="2",y++):(e=null,0===_&&b('"2"')),null!==e?(/^[0-4]/.test(m.charAt(y))?(t=m.charAt(y),y++):(t=null,0===_&&b("[0-4]")),null!==t&&null!==(n=u())?e=[e,t,n]:(e=null,y=r)):(e=null,y=r),null===e&&(r=y,49===m.charCodeAt(y)?(e="1",y++):(e=null,0===_&&b('"1"')),null!==e&&null!==(t=u())&&null!==(n=u())?e=[e,t,n]:(e=null,y=r),null===e&&(r=y,/^[1-9]/.test(m.charAt(y))?(e=m.charAt(y),y++):(e=null,0===_&&b("[1-9]")),null!==e&&null!==(t=u())?e=[e,t]:(e=null,y=r),null===e&&(e=u())))),e}function ve(){var e,t,n,r,i,o,s,a;return s=o=y,null!==(e=null!==(e=u())?e:"")&&null!==(t=null!==(t=u())?t:"")&&null!==(n=null!==(n=u())?n:"")&&null!==(r=null!==(r=u())?r:"")&&null!==(i=null!==(i=u())?i:"")?e=[e,t,n,r,i]:(e=null,y=s),null!==e&&(a=e,a=parseInt(a.join("")),e=jn.port=a),null===e&&(y=o),e}function ge(){var e,t,n,r;for(e=[],r=y,59===m.charCodeAt(y)?(t=";",y++):(t=null,0===_&&b('";"')),null!==t&&null!==(n=me())?t=[t,n]:(t=null,y=r);null!==t;)e.push(t),r=y,59===m.charCodeAt(y)?(t=";",y++):(t=null,0===_&&b('";"')),null!==t&&null!==(n=me())?t=[t,n]:(t=null,y=r);return e}function me(){var e;return null===(e=ye())&&null===(e=_e())&&null===(e=be())&&null===(e=Se())&&null===(e=Ce())&&null===(e=Te())&&(e=we()),e}function ye(){var e,t,n,r,i;return r=n=y,"transport="===m.substr(y,10).toLowerCase()?(e=m.substr(y,10),y+=10):(e=null,0===_&&b('"transport="')),null!==e?("udp"===m.substr(y,3).toLowerCase()?(t=m.substr(y,3),y+=3):(t=null,0===_&&b('"udp"')),null===t&&("tcp"===m.substr(y,3).toLowerCase()?(t=m.substr(y,3),y+=3):(t=null,0===_&&b('"tcp"')),null===t&&("sctp"===m.substr(y,4).toLowerCase()?(t=m.substr(y,4),y+=4):(t=null,0===_&&b('"sctp"')),null===t&&("tls"===m.substr(y,3).toLowerCase()?(t=m.substr(y,3),y+=3):(t=null,0===_&&b('"tls"')),null===t&&(t=P())))),null!==t?e=[e,t]:(e=null,y=r)):(e=null,y=r),null!==e&&(i=e[1],jn.uri_params||(jn.uri_params={}),e=void(jn.uri_params.transport=i.toLowerCase())),null===e&&(y=n),e}function _e(){var e,t,n,r,i;return r=n=y,"user="===m.substr(y,5).toLowerCase()?(e=m.substr(y,5),y+=5):(e=null,0===_&&b('"user="')),null!==e?("phone"===m.substr(y,5).toLowerCase()?(t=m.substr(y,5),y+=5):(t=null,0===_&&b('"phone"')),null===t&&("ip"===m.substr(y,2).toLowerCase()?(t=m.substr(y,2),y+=2):(t=null,0===_&&b('"ip"')),null===t&&(t=P())),null!==t?e=[e,t]:(e=null,y=r)):(e=null,y=r),null!==e&&(i=e[1],jn.uri_params||(jn.uri_params={}),e=void(jn.uri_params.user=i.toLowerCase())),null===e&&(y=n),e}function be(){var e,t,n,r,i;return r=n=y,"method="===m.substr(y,7).toLowerCase()?(e=m.substr(y,7),y+=7):(e=null,0===_&&b('"method="')),null!==e&&null!==(t=lt())?e=[e,t]:(e=null,y=r),null!==e&&(i=e[1],jn.uri_params||(jn.uri_params={}),e=void(jn.uri_params.method=i)),null===e&&(y=n),e}function Se(){var e,t,n,r,i;return r=n=y,"ttl="===m.substr(y,4).toLowerCase()?(e=m.substr(y,4),y+=4):(e=null,0===_&&b('"ttl="')),null!==e&&null!==(t=Cn())?e=[e,t]:(e=null,y=r),null!==e&&(i=e[1],jn.params||(jn.params={}),e=void(jn.params.ttl=i)),null===e&&(y=n),e}function Ce(){var e,t,n,r,i;return r=n=y,"maddr="===m.substr(y,6).toLowerCase()?(e=m.substr(y,6),y+=6):(e=null,0===_&&b('"maddr="')),null!==e&&null!==(t=oe())?e=[e,t]:(e=null,y=r),null!==e&&(i=e[1],jn.uri_params||(jn.uri_params={}),e=void(jn.uri_params.maddr=i)),null===e&&(y=n),e}function Te(){var e,t,n,r,i,o;return i=r=y,"lr"===m.substr(y,2).toLowerCase()?(e=m.substr(y,2),y+=2):(e=null,0===_&&b('"lr"')),null!==e?(o=y,61===m.charCodeAt(y)?(t="=",y++):(t=null,0===_&&b('"="')),null!==t&&null!==(n=P())?t=[t,n]:(t=null,y=o),null!==(t=null!==t?t:"")?e=[e,t]:(e=null,y=i)):(e=null,y=i),null!==e&&(jn.uri_params||(jn.uri_params={}),e=void(jn.uri_params.lr=void 0)),null===e&&(y=r),e}function we(){var e,t,n,r,i,o,s,a;return i=r=y,null!==(e=Ee())?(o=y,61===m.charCodeAt(y)?(t="=",y++):(t=null,0===_&&b('"="')),null!==t&&null!==(n=ke())?t=[t,n]:(t=null,y=o),null!==(t=null!==t?t:"")?e=[e,t]:(e=null,y=i)):(e=null,y=i),null!==e&&(s=e[0],a=e[1],jn.uri_params||(jn.uri_params={}),a=void 0===a?void 0:a[1],e=void(jn.uri_params[s.toLowerCase()]=a)),null===e&&(y=r),e}function Ee(){var e,t,n;if(n=y,null!==(t=Re()))for(e=[];null!==t;)e.push(t),t=Re();else e=null;return null!==e&&(e=e.join("")),null===e&&(y=n),e}function ke(){var e,t,n;if(n=y,null!==(t=Re()))for(e=[];null!==t;)e.push(t),t=Re();else e=null;return null!==e&&(e=e.join("")),null===e&&(y=n),e}function Re(){var e;return null===(e=Ie())&&null===(e=g())&&(e=S()),e}function Ie(){var e;return 91===m.charCodeAt(y)?(e="[",y++):(e=null,0===_&&b('"["')),null===e&&(93===m.charCodeAt(y)?(e="]",y++):(e=null,0===_&&b('"]"')),null===e&&(47===m.charCodeAt(y)?(e="/",y++):(e=null,0===_&&b('"/"')),null===e&&(58===m.charCodeAt(y)?(e=":",y++):(e=null,0===_&&b('":"')),null===e&&(38===m.charCodeAt(y)?(e="&",y++):(e=null,0===_&&b('"&"')),null===e&&(43===m.charCodeAt(y)?(e="+",y++):(e=null,0===_&&b('"+"')),null===e&&(36===m.charCodeAt(y)?(e="$",y++):(e=null,0===_&&b('"$"')))))))),e}function Pe(){var e,t,n,r,i,o,s;if(o=y,63===m.charCodeAt(y)?(e="?",y++):(e=null,0===_&&b('"?"')),null!==e)if(null!==(t=Ae())){for(n=[],s=y,38===m.charCodeAt(y)?(r="&",y++):(r=null,0===_&&b('"&"')),null!==r&&null!==(i=Ae())?r=[r,i]:(r=null,y=s);null!==r;)n.push(r),s=y,38===m.charCodeAt(y)?(r="&",y++):(r=null,0===_&&b('"&"')),null!==r&&null!==(i=Ae())?r=[r,i]:(r=null,y=s);null!==n?e=[e,t,n]:(e=null,y=o)}else e=null,y=o;else e=null,y=o;return e}function Ae(){var e,t,n,r,i,o,s;return i=r=y,null!==(e=Oe())?(61===m.charCodeAt(y)?(t="=",y++):(t=null,0===_&&b('"="')),null!==t&&null!==(n=Me())?e=[e,t,n]:(e=null,y=i)):(e=null,y=i),null!==e&&(o=e[0],s=e[2],o=o.join("").toLowerCase(),s=s.join(""),jn.uri_headers||(jn.uri_headers={}),e=void(jn.uri_headers[o]?jn.uri_headers[o].push(s):jn.uri_headers[o]=[s])),null===e&&(y=r),e}function Oe(){var e,t;if(null===(t=De())&&null===(t=g())&&(t=S()),null!==t)for(e=[];null!==t;)e.push(t),null===(t=De())&&null===(t=g())&&(t=S());else e=null;return e}function Me(){var e,t;for(e=[],null===(t=De())&&null===(t=g())&&(t=S());null!==t;)e.push(t),null===(t=De())&&null===(t=g())&&(t=S());return e}function De(){var e;return 91===m.charCodeAt(y)?(e="[",y++):(e=null,0===_&&b('"["')),null===e&&(93===m.charCodeAt(y)?(e="]",y++):(e=null,0===_&&b('"]"')),null===e&&(47===m.charCodeAt(y)?(e="/",y++):(e=null,0===_&&b('"/"')),null===e&&(63===m.charCodeAt(y)?(e="?",y++):(e=null,0===_&&b('"?"')),null===e&&(58===m.charCodeAt(y)?(e=":",y++):(e=null,0===_&&b('":"')),null===e&&(43===m.charCodeAt(y)?(e="+",y++):(e=null,0===_&&b('"+"')),null===e&&(36===m.charCodeAt(y)?(e="$",y++):(e=null,0===_&&b('"$"')))))))),e}function xe(){var e,t,n,r,i,o;return o=y,null!==(e=lt())&&null!==(t=h())&&null!==(n=Ne())&&null!==(r=h())&&null!==(i=Ye())?e=[e,t,n,r,i]:(e=null,y=o),e}function Ne(){var e;return null===(e=X())&&(e=Fe()),e}function Fe(){var e,t,n,r;return r=y,null!==(e=Ke())?(58===m.charCodeAt(y)?(t=":",y++):(t=null,0===_&&b('":"')),null!==t?(null===(n=Ue())&&(n=He()),null!==n?e=[e,t,n]:(e=null,y=r)):(e=null,y=r)):(e=null,y=r),e}function Ue(){var e,t,n,r,i;return r=y,null===(e=je())&&(e=Le()),null!==e?(i=y,63===m.charCodeAt(y)?(t="?",y++):(t=null,0===_&&b('"?"')),null!==t&&null!==(n=$e())?t=[t,n]:(t=null,y=i),null!==(t=null!==t?t:"")?e=[e,t]:(e=null,y=r)):(e=null,y=r),e}function je(){var e,t,n,r;return r=y,"//"===m.substr(y,2)?(e="//",y+=2):(e=null,0===_&&b('"//"')),null!==e&&null!==(t=Qe())&&null!==(n=null!==(n=Le())?n:"")?e=[e,t,n]:(e=null,y=r),e}function Le(){var e,t,n;return n=y,47===m.charCodeAt(y)?(e="/",y++):(e=null,0===_&&b('"/"')),null!==e&&null!==(t=Ge())?e=[e,t]:(e=null,y=n),e}function He(){var e,t,n,r;if(r=y,null!==(e=qe())){for(t=[],n=Be();null!==n;)t.push(n),n=Be();null!==t?e=[e,t]:(e=null,y=r)}else e=null,y=r;return e}function Be(){var e;return null===(e=v())&&null===(e=g())&&(e=S()),e}function qe(){var e;return null===(e=g())&&null===(e=S())&&(59===m.charCodeAt(y)?(e=";",y++):(e=null,0===_&&b('";"')),null===e&&(63===m.charCodeAt(y)?(e="?",y++):(e=null,0===_&&b('"?"')),null===e&&(58===m.charCodeAt(y)?(e=":",y++):(e=null,0===_&&b('":"')),null===e&&(64===m.charCodeAt(y)?(e="@",y++):(e=null,0===_&&b('"@"')),null===e&&(38===m.charCodeAt(y)?(e="&",y++):(e=null,0===_&&b('"&"')),null===e&&(61===m.charCodeAt(y)?(e="=",y++):(e=null,0===_&&b('"="')),null===e&&(43===m.charCodeAt(y)?(e="+",y++):(e=null,0===_&&b('"+"')),null===e&&(36===m.charCodeAt(y)?(e="$",y++):(e=null,0===_&&b('"$"')),null===e&&(44===m.charCodeAt(y)?(e=",",y++):(e=null,0===_&&b('","'))))))))))),e}function Ge(){var e,t,n,r,i,o;if(i=y,null!==(e=We())){for(t=[],o=y,47===m.charCodeAt(y)?(n="/",y++):(n=null,0===_&&b('"/"')),null!==n&&null!==(r=We())?n=[n,r]:(n=null,y=o);null!==n;)t.push(n),o=y,47===m.charCodeAt(y)?(n="/",y++):(n=null,0===_&&b('"/"')),null!==n&&null!==(r=We())?n=[n,r]:(n=null,y=o);null!==t?e=[e,t]:(e=null,y=i)}else e=null,y=i;return e}function We(){var e,t,n,r,i,o;for(i=y,e=[],t=ze();null!==t;)e.push(t),t=ze();if(null!==e){for(t=[],o=y,59===m.charCodeAt(y)?(n=";",y++):(n=null,0===_&&b('";"')),null!==n&&null!==(r=Ve())?n=[n,r]:(n=null,y=o);null!==n;)t.push(n),o=y,59===m.charCodeAt(y)?(n=";",y++):(n=null,0===_&&b('";"')),null!==n&&null!==(r=Ve())?n=[n,r]:(n=null,y=o);null!==t?e=[e,t]:(e=null,y=i)}else e=null,y=i;return e}function Ve(){var e,t;for(e=[],t=ze();null!==t;)e.push(t),t=ze();return e}function ze(){var e;return null===(e=g())&&null===(e=S())&&(58===m.charCodeAt(y)?(e=":",y++):(e=null,0===_&&b('":"')),null===e&&(64===m.charCodeAt(y)?(e="@",y++):(e=null,0===_&&b('"@"')),null===e&&(38===m.charCodeAt(y)?(e="&",y++):(e=null,0===_&&b('"&"')),null===e&&(61===m.charCodeAt(y)?(e="=",y++):(e=null,0===_&&b('"="')),null===e&&(43===m.charCodeAt(y)?(e="+",y++):(e=null,0===_&&b('"+"')),null===e&&(36===m.charCodeAt(y)?(e="$",y++):(e=null,0===_&&b('"$"')),null===e&&(44===m.charCodeAt(y)?(e=",",y++):(e=null,0===_&&b('","'))))))))),e}function Ke(){var e,t,n,r,i,o;if(i=r=y,null!==(e=a())){for(t=[],null===(n=a())&&null===(n=u())&&(43===m.charCodeAt(y)?(n="+",y++):(n=null,0===_&&b('"+"')),null===n&&(45===m.charCodeAt(y)?(n="-",y++):(n=null,0===_&&b('"-"')),null===n&&(46===m.charCodeAt(y)?(n=".",y++):(n=null,0===_&&b('"."')))));null!==n;)t.push(n),null===(n=a())&&null===(n=u())&&(43===m.charCodeAt(y)?(n="+",y++):(n=null,0===_&&b('"+"')),null===n&&(45===m.charCodeAt(y)?(n="-",y++):(n=null,0===_&&b('"-"')),null===n&&(46===m.charCodeAt(y)?(n=".",y++):(n=null,0===_&&b('"."')))));null!==t?e=[e,t]:(e=null,y=i)}else e=null,y=i;return null!==e&&(o=r,e=void(jn.scheme=m.substring(y,o))),null===e&&(y=r),e}function Qe(){var e;return null===(e=Je())&&(e=Xe()),e}function Je(){var e,t,n,r;return r=n=y,null!==(e=ee())?(64===m.charCodeAt(y)?(t="@",y++):(t=null,0===_&&b('"@"')),null!==t?e=[e,t]:(e=null,y=r)):(e=null,y=r),null!==(e=null!==e?e:"")&&null!==(t=ie())?e=[e,t]:(e=null,y=n),e=null!==e?e:""}function Xe(){var e,t;if(null===(t=g())&&null===(t=S())&&(36===m.charCodeAt(y)?(t="$",y++):(t=null,0===_&&b('"$"')),null===t&&(44===m.charCodeAt(y)?(t=",",y++):(t=null,0===_&&b('","')),null===t&&(59===m.charCodeAt(y)?(t=";",y++):(t=null,0===_&&b('";"')),null===t&&(58===m.charCodeAt(y)?(t=":",y++):(t=null,0===_&&b('":"')),null===t&&(64===m.charCodeAt(y)?(t="@",y++):(t=null,0===_&&b('"@"')),null===t&&(38===m.charCodeAt(y)?(t="&",y++):(t=null,0===_&&b('"&"')),null===t&&(61===m.charCodeAt(y)?(t="=",y++):(t=null,0===_&&b('"="')),null===t&&(43===m.charCodeAt(y)?(t="+",y++):(t=null,0===_&&b('"+"')))))))))),null!==t)for(e=[];null!==t;)e.push(t),null===(t=g())&&null===(t=S())&&(36===m.charCodeAt(y)?(t="$",y++):(t=null,0===_&&b('"$"')),null===t&&(44===m.charCodeAt(y)?(t=",",y++):(t=null,0===_&&b('","')),null===t&&(59===m.charCodeAt(y)?(t=";",y++):(t=null,0===_&&b('";"')),null===t&&(58===m.charCodeAt(y)?(t=":",y++):(t=null,0===_&&b('":"')),null===t&&(64===m.charCodeAt(y)?(t="@",y++):(t=null,0===_&&b('"@"')),null===t&&(38===m.charCodeAt(y)?(t="&",y++):(t=null,0===_&&b('"&"')),null===t&&(61===m.charCodeAt(y)?(t="=",y++):(t=null,0===_&&b('"="')),null===t&&(43===m.charCodeAt(y)?(t="+",y++):(t=null,0===_&&b('"+"'))))))))));else e=null;return e}function $e(){var e,t;for(e=[],t=Be();null!==t;)e.push(t),t=Be();return e}function Ye(){var e,t,n,r,i,o,s,a,l;if(a=s=y,"sip"===m.substr(y,3).toLowerCase()?(e=m.substr(y,3),y+=3):(e=null,0===_&&b('"SIP"')),null!==e)if(47===m.charCodeAt(y)?(t="/",y++):(t=null,0===_&&b('"/"')),null!==t){if(null!==(r=u()))for(n=[];null!==r;)n.push(r),r=u();else n=null;if(null!==n)if(46===m.charCodeAt(y)?(r=".",y++):(r=null,0===_&&b('"."')),null!==r){if(null!==(o=u()))for(i=[];null!==o;)i.push(o),o=u();else i=null;null!==i?e=[e,t,n,r,i]:(e=null,y=a)}else e=null,y=a;else e=null,y=a}else e=null,y=a;else e=null,y=a;return null!==e&&(l=s,e=void(jn.sip_version=m.substring(y,l))),null===e&&(y=s),e}function Ze(){var e;return"INVITE"===m.substr(y,6)?(e="INVITE",y+=6):(e=null,0===_&&b('"INVITE"')),e}function et(){var e;return"ACK"===m.substr(y,3)?(e="ACK",y+=3):(e=null,0===_&&b('"ACK"')),e}function tt(){var e;return"OPTIONS"===m.substr(y,7)?(e="OPTIONS",y+=7):(e=null,0===_&&b('"OPTIONS"')),e}function nt(){var e;return"BYE"===m.substr(y,3)?(e="BYE",y+=3):(e=null,0===_&&b('"BYE"')),e}function rt(){var e;return"CANCEL"===m.substr(y,6)?(e="CANCEL",y+=6):(e=null,0===_&&b('"CANCEL"')),e}function it(){var e;return"REGISTER"===m.substr(y,8)?(e="REGISTER",y+=8):(e=null,0===_&&b('"REGISTER"')),e}function ot(){var e;return"SUBSCRIBE"===m.substr(y,9)?(e="SUBSCRIBE",y+=9):(e=null,0===_&&b('"SUBSCRIBE"')),e}function st(){var e;return"NOTIFY"===m.substr(y,6)?(e="NOTIFY",y+=6):(e=null,0===_&&b('"NOTIFY"')),e}function at(){var e;return"REFER"===m.substr(y,5)?(e="REFER",y+=5):(e=null,0===_&&b('"REFER"')),e}function lt(){var e,t,n;return t=y,null===(e=Ze())&&null===(e=et())&&null===(e=tt())&&null===(e=nt())&&null===(e=rt())&&null===(e=it())&&null===(e=ot())&&null===(e=st())&&null===(e=at())&&(e=P()),null!==e&&(n=t,jn.method=m.substring(y,n),e=jn.method),null===e&&(y=t),e}function ut(){var e,t,n,r,i,o;return o=y,null!==(e=Ye())&&null!==(t=h())&&null!==(n=ct())&&null!==(r=h())&&null!==(i=ft())?e=[e,t,n,r,i]:(e=null,y=o),e}function ct(){var e,t,n;return t=y,null!==(e=dt())&&(n=e,e=void(jn.status_code=parseInt(n.join("")))),null===e&&(y=t),e}function dt(){var e,t,n,r;return r=y,null!==(e=u())&&null!==(t=u())&&null!==(n=u())?e=[e,t,n]:(e=null,y=r),e}function ft(){var e,t,n,r;for(n=y,e=[],null===(t=v())&&null===(t=g())&&null===(t=S())&&null===(t=R())&&null===(t=I())&&null===(t=h())&&(t=p());null!==t;)e.push(t),null===(t=v())&&null===(t=g())&&null===(t=S())&&null===(t=R())&&null===(t=I())&&null===(t=h())&&(t=p());return null!==e&&(r=n,e=void(jn.reason_phrase=m.substring(y,r))),null===e&&(y=n),e}function ht(){var e,t,n,r,i,o,s;if(o=i=y,null===(e=J())&&(e=pt()),null!==e){for(t=[],s=y,null!==(n=H())&&null!==(r=gt())?n=[n,r]:(n=null,y=s);null!==n;)t.push(n),s=y,null!==(n=H())&&null!==(r=gt())?n=[n,r]:(n=null,y=s);null!==t?e=[e,t]:(e=null,y=o)}else e=null,y=o;return null!==e&&(e=function(e){var t;jn.multi_header||(jn.multi_header=[]);try{t=new Un(jn.uri,jn.display_name,jn.params),delete jn.uri,delete jn.display_name,delete jn.params}catch(e){t=null}jn.multi_header.push({possition:y,offset:e,parsed:t})}(i)),null===e&&(y=i),e}function pt(){var e,t,n,r,i;return i=y,null!==(e=null!==(e=vt())?e:"")&&null!==(t=j())&&null!==(n=X())&&null!==(r=U())?e=[e,t,n,r]:(e=null,y=i),e}function vt(){var e,t,n,r,i,o,s,a,l;if(o=i=y,null!==(e=P())){for(t=[],s=y,null!==(n=C())&&null!==(r=P())?n=[n,r]:(n=null,y=s);null!==n;)t.push(n),s=y,null!==(n=C())&&null!==(r=P())?n=[n,r]:(n=null,y=s);null!==t?e=[e,t]:(e=null,y=o)}else e=null,y=o;return null===e&&(e=V()),null!==e&&(a=i,l=e,'"'===(l=m.substring(y,a).trim())[0]&&(l=l.substring(1,l.length-1)),e=void(jn.display_name=l)),null===e&&(y=i),e}function gt(){var e;return null===(e=mt())&&null===(e=yt())&&(e=St()),e}function mt(){var e,t,n,r,i,o;return i=r=y,"q"===m.substr(y,1).toLowerCase()?(e=m.substr(y,1),y++):(e=null,0===_&&b('"q"')),null!==e&&null!==(t=x())&&null!==(n=bt())?e=[e,t,n]:(e=null,y=i),null!==e&&(o=e[2],jn.params||(jn.params={}),e=void(jn.params.q=o)),null===e&&(y=r),e}function yt(){var e,t,n,r,i,o;return i=r=y,"expires"===m.substr(y,7).toLowerCase()?(e=m.substr(y,7),y+=7):(e=null,0===_&&b('"expires"')),null!==e&&null!==(t=x())&&null!==(n=_t())?e=[e,t,n]:(e=null,y=i),null!==e&&(o=e[2],jn.params||(jn.params={}),e=void(jn.params.expires=o)),null===e&&(y=r),e}function _t(){var e,t,n;if(n=y,null!==(t=u()))for(e=[];null!==t;)e.push(t),t=u();else e=null;return null!==e&&(e=parseInt(e.join(""))),null===e&&(y=n),e}function bt(){var e,t,n,r,i,o,s,a,l;return s=o=y,48===m.charCodeAt(y)?(e="0",y++):(e=null,0===_&&b('"0"')),null!==e?(a=y,46===m.charCodeAt(y)?(t=".",y++):(t=null,0===_&&b('"."')),null!==t&&null!==(n=null!==(n=u())?n:"")&&null!==(r=null!==(r=u())?r:"")&&null!==(i=null!==(i=u())?i:"")?t=[t,n,r,i]:(t=null,y=a),null!==(t=null!==t?t:"")?e=[e,t]:(e=null,y=s)):(e=null,y=s),null!==e&&(l=o,e=parseFloat(m.substring(y,l))),null===e&&(y=o),e}function St(){var e,t,n,r,i,o,s,a;return i=r=y,null!==(e=P())?(o=y,null!==(t=x())&&null!==(n=Ct())?t=[t,n]:(t=null,y=o),null!==(t=null!==t?t:"")?e=[e,t]:(e=null,y=i)):(e=null,y=i),null!==e&&(s=e[0],a=e[1],jn.params||(jn.params={}),a=void 0===a?void 0:a[1],e=void(jn.params[s.toLowerCase()]=a)),null===e&&(y=r),e}function Ct(){var e;return null===(e=P())&&null===(e=oe())&&(e=V()),e}function Tt(){var e;return"render"===m.substr(y,6).toLowerCase()?(e=m.substr(y,6),y+=6):(e=null,0===_&&b('"render"')),null===e&&("session"===m.substr(y,7).toLowerCase()?(e=m.substr(y,7),y+=7):(e=null,0===_&&b('"session"')),null===e&&("icon"===m.substr(y,4).toLowerCase()?(e=m.substr(y,4),y+=4):(e=null,0===_&&b('"icon"')),null===e&&("alert"===m.substr(y,5).toLowerCase()?(e=m.substr(y,5),y+=5):(e=null,0===_&&b('"alert"')),null===e&&(e=P())))),e}function wt(){var e;return null===(e=Et())&&(e=St()),e}function Et(){var e,t,n,r;return r=y,"handling"===m.substr(y,8).toLowerCase()?(e=m.substr(y,8),y+=8):(e=null,0===_&&b('"handling"')),null!==e&&null!==(t=x())?("optional"===m.substr(y,8).toLowerCase()?(n=m.substr(y,8),y+=8):(n=null,0===_&&b('"optional"')),null===n&&("required"===m.substr(y,8).toLowerCase()?(n=m.substr(y,8),y+=8):(n=null,0===_&&b('"required"')),null===n&&(n=P())),null!==n?e=[e,t,n]:(e=null,y=r)):(e=null,y=r),e}function kt(){var e,t,n,r,i,o,s,a;if(s=y,null!==(e=Rt()))if(null!==(t=D()))if(null!==(n=Mt())){for(r=[],a=y,null!==(i=H())&&null!==(o=Dt())?i=[i,o]:(i=null,y=a);null!==i;)r.push(i),a=y,null!==(i=H())&&null!==(o=Dt())?i=[i,o]:(i=null,y=a);null!==r?e=[e,t,n,r]:(e=null,y=s)}else e=null,y=s;else e=null,y=s;else e=null,y=s;return e}function Rt(){var e;return null===(e=It())&&(e=Pt()),e}function It(){var e;return"text"===m.substr(y,4).toLowerCase()?(e=m.substr(y,4),y+=4):(e=null,0===_&&b('"text"')),null===e&&("image"===m.substr(y,5).toLowerCase()?(e=m.substr(y,5),y+=5):(e=null,0===_&&b('"image"')),null===e&&("audio"===m.substr(y,5).toLowerCase()?(e=m.substr(y,5),y+=5):(e=null,0===_&&b('"audio"')),null===e&&("video"===m.substr(y,5).toLowerCase()?(e=m.substr(y,5),y+=5):(e=null,0===_&&b('"video"')),null===e&&("application"===m.substr(y,11).toLowerCase()?(e=m.substr(y,11),y+=11):(e=null,0===_&&b('"application"')),null===e&&(e=At()))))),e}function Pt(){var e;return"message"===m.substr(y,7).toLowerCase()?(e=m.substr(y,7),y+=7):(e=null,0===_&&b('"message"')),null===e&&("multipart"===m.substr(y,9).toLowerCase()?(e=m.substr(y,9),y+=9):(e=null,0===_&&b('"multipart"')),null===e&&(e=At())),e}function At(){var e;return null===(e=P())&&(e=Ot()),e}function Ot(){var e,t,n;return n=y,"x-"===m.substr(y,2).toLowerCase()?(e=m.substr(y,2),y+=2):(e=null,0===_&&b('"x-"')),null!==e&&null!==(t=P())?e=[e,t]:(e=null,y=n),e}function Mt(){var e;return null===(e=At())&&(e=P()),e}function Dt(){var e,t,n,r;return r=y,null!==(e=P())&&null!==(t=x())&&null!==(n=xt())?e=[e,t,n]:(e=null,y=r),e}function xt(){var e;return null===(e=P())&&(e=V()),e}function Nt(){var e,t,n,r;if(n=y,null!==(t=u()))for(e=[];null!==t;)e.push(t),t=u();else e=null;return null!==e&&(r=e,e=void(jn.value=parseInt(r.join("")))),null===e&&(y=n),e}function Ft(){var e,t,n,r,i,o;if(i=y,null!==(e=A())){for(t=[],o=y,46===m.charCodeAt(y)?(n=".",y++):(n=null,0===_&&b('"."')),null!==n&&null!==(r=A())?n=[n,r]:(n=null,y=o);null!==n;)t.push(n),o=y,46===m.charCodeAt(y)?(n=".",y++):(n=null,0===_&&b('"."')),null!==n&&null!==(r=A())?n=[n,r]:(n=null,y=o);null!==t?e=[e,t]:(e=null,y=i)}else e=null,y=i;return e}function Ut(){var e;return null===(e=jt())&&(e=St()),e}function jt(){var e,t,n,r,i,o;return i=r=y,"tag"===m.substr(y,3).toLowerCase()?(e=m.substr(y,3),y+=3):(e=null,0===_&&b('"tag"')),null!==e&&null!==(t=x())&&null!==(n=P())?e=[e,t,n]:(e=null,y=i),null!==e&&(o=e[2],e=void(jn.tag=o)),null===e&&(y=r),e}function Lt(){var e,t,n,r,i,o,s,a;if(s=y,"digest"===m.substr(y,6).toLowerCase()?(e=m.substr(y,6),y+=6):(e=null,0===_&&b('"Digest"')),null!==e)if(null!==(t=C()))if(null!==(n=qt())){for(r=[],a=y,null!==(i=L())&&null!==(o=qt())?i=[i,o]:(i=null,y=a);null!==i;)r.push(i),a=y,null!==(i=L())&&null!==(o=qt())?i=[i,o]:(i=null,y=a);null!==r?e=[e,t,n,r]:(e=null,y=s)}else e=null,y=s;else e=null,y=s;else e=null,y=s;return null===e&&(e=Ht()),e}function Ht(){var e,t,n,r,i,o,s,a;if(s=y,null!==(e=P()))if(null!==(t=C()))if(null!==(n=Bt())){for(r=[],a=y,null!==(i=L())&&null!==(o=Bt())?i=[i,o]:(i=null,y=a);null!==i;)r.push(i),a=y,null!==(i=L())&&null!==(o=Bt())?i=[i,o]:(i=null,y=a);null!==r?e=[e,t,n,r]:(e=null,y=s)}else e=null,y=s;else e=null,y=s;else e=null,y=s;return e}function Bt(){var e,t,n,r;return r=y,null!==(e=P())&&null!==(t=x())?(null===(n=P())&&(n=V()),null!==n?e=[e,t,n]:(e=null,y=r)):(e=null,y=r),e}function qt(){var e;return null===(e=Gt())&&null===(e=Vt())&&null===(e=Kt())&&null===(e=Jt())&&null===(e=Xt())&&null===(e=$t())&&null===(e=Yt())&&(e=Bt()),e}function Gt(){var e,t,n,r;return r=y,"realm"===m.substr(y,5).toLowerCase()?(e=m.substr(y,5),y+=5):(e=null,0===_&&b('"realm"')),null!==e&&null!==(t=x())&&null!==(n=Wt())?e=[e,t,n]:(e=null,y=r),e}function Wt(){var e,t,n;return t=y,null!==(e=z())&&(n=e,e=void(jn.realm=n)),null===e&&(y=t),e}function Vt(){var e,t,n,r,i,o,s,a,l;if(a=y,"domain"===m.substr(y,6).toLowerCase()?(e=m.substr(y,6),y+=6):(e=null,0===_&&b('"domain"')),null!==e)if(null!==(t=x()))if(null!==(n=q()))if(null!==(r=zt())){if(i=[],l=y,null!==(s=h()))for(o=[];null!==s;)o.push(s),s=h();else o=null;for(null!==o&&null!==(s=zt())?o=[o,s]:(o=null,y=l);null!==o;){if(i.push(o),l=y,null!==(s=h()))for(o=[];null!==s;)o.push(s),s=h();else o=null;null!==o&&null!==(s=zt())?o=[o,s]:(o=null,y=l)}null!==i&&null!==(o=G())?e=[e,t,n,r,i,o]:(e=null,y=a)}else e=null,y=a;else e=null,y=a;else e=null,y=a;else e=null,y=a;return e}function zt(){var e;return null===(e=Fe())&&(e=Le()),e}function Kt(){var e,t,n,r;return r=y,"nonce"===m.substr(y,5).toLowerCase()?(e=m.substr(y,5),y+=5):(e=null,0===_&&b('"nonce"')),null!==e&&null!==(t=x())&&null!==(n=Qt())?e=[e,t,n]:(e=null,y=r),e}function Qt(){var e,t,n;return t=y,null!==(e=z())&&(n=e,e=void(jn.nonce=n)),null===e&&(y=t),e}function Jt(){var e,t,n,r,i,o;return i=r=y,"opaque"===m.substr(y,6).toLowerCase()?(e=m.substr(y,6),y+=6):(e=null,0===_&&b('"opaque"')),null!==e&&null!==(t=x())&&null!==(n=z())?e=[e,t,n]:(e=null,y=i),null!==e&&(o=e[2],e=void(jn.opaque=o)),null===e&&(y=r),e}function Xt(){var e,t,n,r,i;return r=y,"stale"===m.substr(y,5).toLowerCase()?(e=m.substr(y,5),y+=5):(e=null,0===_&&b('"stale"')),null!==e&&null!==(t=x())?(i=y,"true"===m.substr(y,4).toLowerCase()?(n=m.substr(y,4),y+=4):(n=null,0===_&&b('"true"')),null!==n&&(n=void(jn.stale=!0)),null===n&&(y=i),null===n&&(i=y,"false"===m.substr(y,5).toLowerCase()?(n=m.substr(y,5),y+=5):(n=null,0===_&&b('"false"')),null!==n&&(n=void(jn.stale=!1)),null===n&&(y=i)),null!==n?e=[e,t,n]:(e=null,y=r)):(e=null,y=r),e}function $t(){var e,t,n,r,i,o;return i=r=y,"algorithm"===m.substr(y,9).toLowerCase()?(e=m.substr(y,9),y+=9):(e=null,0===_&&b('"algorithm"')),null!==e&&null!==(t=x())?("md5"===m.substr(y,3).toLowerCase()?(n=m.substr(y,3),y+=3):(n=null,0===_&&b('"MD5"')),null===n&&("md5-sess"===m.substr(y,8).toLowerCase()?(n=m.substr(y,8),y+=8):(n=null,0===_&&b('"MD5-sess"')),null===n&&(n=P())),null!==n?e=[e,t,n]:(e=null,y=i)):(e=null,y=i),null!==e&&(o=e[2],e=void(jn.algorithm=o.toUpperCase())),null===e&&(y=r),e}function Yt(){var e,t,n,r,i,o,s,a,l,u;if(a=y,"qop"===m.substr(y,3).toLowerCase()?(e=m.substr(y,3),y+=3):(e=null,0===_&&b('"qop"')),null!==e)if(null!==(t=x()))if(null!==(n=q())){if(l=y,null!==(r=Zt())){for(i=[],u=y,44===m.charCodeAt(y)?(o=",",y++):(o=null,0===_&&b('","')),null!==o&&null!==(s=Zt())?o=[o,s]:(o=null,y=u);null!==o;)i.push(o),u=y,44===m.charCodeAt(y)?(o=",",y++):(o=null,0===_&&b('","')),null!==o&&null!==(s=Zt())?o=[o,s]:(o=null,y=u);null!==i?r=[r,i]:(r=null,y=l)}else r=null,y=l;null!==r&&null!==(i=G())?e=[e,t,n,r,i]:(e=null,y=a)}else e=null,y=a;else e=null,y=a;else e=null,y=a;return e}function Zt(){var e,t,n;return t=y,"auth-int"===m.substr(y,8).toLowerCase()?(e=m.substr(y,8),y+=8):(e=null,0===_&&b('"auth-int"')),null===e&&("auth"===m.substr(y,4).toLowerCase()?(e=m.substr(y,4),y+=4):(e=null,0===_&&b('"auth"')),null===e&&(e=P())),null!==e&&(n=e,jn.qop||(jn.qop=[]),e=void jn.qop.push(n.toLowerCase())),null===e&&(y=t),e}function en(){var e,t,n,r,i,o,s;if(o=i=y,null!==(e=pt())){for(t=[],s=y,null!==(n=H())&&null!==(r=St())?n=[n,r]:(n=null,y=s);null!==n;)t.push(n),s=y,null!==(n=H())&&null!==(r=St())?n=[n,r]:(n=null,y=s);null!==t?e=[e,t]:(e=null,y=o)}else e=null,y=o;return null!==e&&(e=function(e){var t;jn.multi_header||(jn.multi_header=[]);try{t=new Un(jn.uri,jn.display_name,jn.params),delete jn.uri,delete jn.display_name,delete jn.params}catch(e){t=null}jn.multi_header.push({possition:y,offset:e,parsed:t})}(i)),null===e&&(y=i),e}function tn(){var e;return null===(e=nn())&&(e=St()),e}function nn(){var e,t,n,r,i,o,s;if(o=i=y,"cause"===m.substr(y,5).toLowerCase()?(e=m.substr(y,5),y+=5):(e=null,0===_&&b('"cause"')),null!==e)if(null!==(t=x())){if(null!==(r=u()))for(n=[];null!==r;)n.push(r),r=u();else n=null;null!==n?e=[e,t,n]:(e=null,y=o)}else e=null,y=o;else e=null,y=o;return null!==e&&(s=e[2],e=void(jn.cause=parseInt(s.join("")))),null===e&&(y=i),e}function rn(){var e,t,n,r,i,o;if(i=y,null!==(e=pt())){for(t=[],o=y,null!==(n=H())&&null!==(r=St())?n=[n,r]:(n=null,y=o);null!==n;)t.push(n),o=y,null!==(n=H())&&null!==(r=St())?n=[n,r]:(n=null,y=o);null!==t?e=[e,t]:(e=null,y=i)}else e=null,y=i;return e}function on(){var e,t,n;return t=y,"active"===m.substr(y,6).toLowerCase()?(e=m.substr(y,6),y+=6):(e=null,0===_&&b('"active"')),null===e&&("pending"===m.substr(y,7).toLowerCase()?(e=m.substr(y,7),y+=7):(e=null,0===_&&b('"pending"')),null===e&&("terminated"===m.substr(y,10).toLowerCase()?(e=m.substr(y,10),y+=10):(e=null,0===_&&b('"terminated"')),null===e&&(e=P()))),null!==e&&(n=t,e=void(jn.state=m.substring(y,n))),null===e&&(y=t),e}function sn(){var e,t,n,r,i,o,s,a;return i=r=y,"reason"===m.substr(y,6).toLowerCase()?(e=m.substr(y,6),y+=6):(e=null,0===_&&b('"reason"')),null!==e&&null!==(t=x())&&null!==(n=an())?e=[e,t,n]:(e=null,y=i),null!==e&&(e=void(void 0!==(o=e[2])&&(jn.reason=o))),null===e&&(y=r),null===e&&(i=r=y,"expires"===m.substr(y,7).toLowerCase()?(e=m.substr(y,7),y+=7):(e=null,0===_&&b('"expires"')),null!==e&&null!==(t=x())&&null!==(n=_t())?e=[e,t,n]:(e=null,y=i),null!==e&&(e=void(void 0!==(a=e[2])&&(jn.expires=a))),null===e&&(y=r),null===e&&(i=r=y,"retry_after"===m.substr(y,11).toLowerCase()?(e=m.substr(y,11),y+=11):(e=null,0===_&&b('"retry_after"')),null!==e&&null!==(t=x())&&null!==(n=_t())?e=[e,t,n]:(e=null,y=i),null!==e&&(e=void(void 0!==(s=e[2])&&(jn.retry_after=s))),null===e&&(y=r),null===e&&(e=St()))),e}function an(){var e;return"deactivated"===m.substr(y,11).toLowerCase()?(e=m.substr(y,11),y+=11):(e=null,0===_&&b('"deactivated"')),null===e&&("probation"===m.substr(y,9).toLowerCase()?(e=m.substr(y,9),y+=9):(e=null,0===_&&b('"probation"')),null===e&&("rejected"===m.substr(y,8).toLowerCase()?(e=m.substr(y,8),y+=8):(e=null,0===_&&b('"rejected"')),null===e&&("timeout"===m.substr(y,7).toLowerCase()?(e=m.substr(y,7),y+=7):(e=null,0===_&&b('"timeout"')),null===e&&("giveup"===m.substr(y,6).toLowerCase()?(e=m.substr(y,6),y+=6):(e=null,0===_&&b('"giveup"')),null===e&&("noresource"===m.substr(y,10).toLowerCase()?(e=m.substr(y,10),y+=10):(e=null,0===_&&b('"noresource"')),null===e&&("invariant"===m.substr(y,9).toLowerCase()?(e=m.substr(y,9),y+=9):(e=null,0===_&&b('"invariant"')),null===e&&(e=P()))))))),e}function ln(){var e;return null===(e=jt())&&(e=St()),e}function un(){var e,t,n,r,i,o,s,a;if(s=y,null!==(e=gn()))if(null!==(t=C()))if(null!==(n=_n())){for(r=[],a=y,null!==(i=H())&&null!==(o=cn())?i=[i,o]:(i=null,y=a);null!==i;)r.push(i),a=y,null!==(i=H())&&null!==(o=cn())?i=[i,o]:(i=null,y=a);null!==r?e=[e,t,n,r]:(e=null,y=s)}else e=null,y=s;else e=null,y=s;else e=null,y=s;return e}function cn(){var e;return null===(e=dn())&&null===(e=fn())&&null===(e=hn())&&null===(e=pn())&&null===(e=vn())&&(e=St()),e}function dn(){var e,t,n,r,i,o;return i=r=y,"ttl"===m.substr(y,3).toLowerCase()?(e=m.substr(y,3),y+=3):(e=null,0===_&&b('"ttl"')),null!==e&&null!==(t=x())&&null!==(n=Cn())?e=[e,t,n]:(e=null,y=i),null!==e&&(o=e[2],e=void(jn.ttl=o)),null===e&&(y=r),e}function fn(){var e,t,n,r,i,o;return i=r=y,"maddr"===m.substr(y,5).toLowerCase()?(e=m.substr(y,5),y+=5):(e=null,0===_&&b('"maddr"')),null!==e&&null!==(t=x())&&null!==(n=oe())?e=[e,t,n]:(e=null,y=i),null!==e&&(o=e[2],e=void(jn.maddr=o)),null===e&&(y=r),e}function hn(){var e,t,n,r,i,o;return i=r=y,"received"===m.substr(y,8).toLowerCase()?(e=m.substr(y,8),y+=8):(e=null,0===_&&b('"received"')),null!==e&&null!==(t=x())?(null===(n=he())&&(n=ce()),null!==n?e=[e,t,n]:(e=null,y=i)):(e=null,y=i),null!==e&&(o=e[2],e=void(jn.received=o)),null===e&&(y=r),e}function pn(){var e,t,n,r,i,o;return i=r=y,"branch"===m.substr(y,6).toLowerCase()?(e=m.substr(y,6),y+=6):(e=null,0===_&&b('"branch"')),null!==e&&null!==(t=x())&&null!==(n=P())?e=[e,t,n]:(e=null,y=i),null!==e&&(o=e[2],e=void(jn.branch=o)),null===e&&(y=r),e}function vn(){var e,t,n,r,i,o,s;if(o=i=y,"rport"===m.substr(y,5).toLowerCase()?(e=m.substr(y,5),y+=5):(e=null,0===_&&b('"rport"')),null!==e){if(s=y,null!==(t=x())){for(n=[],r=u();null!==r;)n.push(r),r=u();null!==n?t=[t,n]:(t=null,y=s)}else t=null,y=s;null!==(t=null!==t?t:"")?e=[e,t]:(e=null,y=o)}else e=null,y=o;return null!==e&&(e=void("undefined"!=typeof response_port&&(jn.rport=response_port.join("")))),null===e&&(y=i),e}function gn(){var e,t,n,r,i,o;return o=y,null!==(e=mn())&&null!==(t=D())&&null!==(n=P())&&null!==(r=D())&&null!==(i=yn())?e=[e,t,n,r,i]:(e=null,y=o),e}function mn(){var e,t,n;return t=y,"sip"===m.substr(y,3).toLowerCase()?(e=m.substr(y,3),y+=3):(e=null,0===_&&b('"SIP"')),null===e&&(e=P()),null!==e&&(n=e,e=void(jn.protocol=n)),null===e&&(y=t),e}function yn(){var e,t,n;return t=y,"udp"===m.substr(y,3).toLowerCase()?(e=m.substr(y,3),y+=3):(e=null,0===_&&b('"UDP"')),null===e&&("tcp"===m.substr(y,3).toLowerCase()?(e=m.substr(y,3),y+=3):(e=null,0===_&&b('"TCP"')),null===e&&("tls"===m.substr(y,3).toLowerCase()?(e=m.substr(y,3),y+=3):(e=null,0===_&&b('"TLS"')),null===e&&("sctp"===m.substr(y,4).toLowerCase()?(e=m.substr(y,4),y+=4):(e=null,0===_&&b('"SCTP"')),null===e&&(e=P())))),null!==e&&(n=e,e=void(jn.transport=n)),null===e&&(y=t),e}function _n(){var e,t,n,r,i;return r=y,null!==(e=bn())?(i=y,null!==(t=B())&&null!==(n=Sn())?t=[t,n]:(t=null,y=i),null!==(t=null!==t?t:"")?e=[e,t]:(e=null,y=r)):(e=null,y=r),e}function bn(){var e,t,n;return t=y,null===(e=he())&&null===(e=ue())&&(e=se()),null!==e&&(n=t,e=void(jn.host=m.substring(y,n))),null===e&&(y=t),e}function Sn(){var e,t,n,r,i,o,s,a;return s=o=y,null!==(e=null!==(e=u())?e:"")&&null!==(t=null!==(t=u())?t:"")&&null!==(n=null!==(n=u())?n:"")&&null!==(r=null!==(r=u())?r:"")&&null!==(i=null!==(i=u())?i:"")?e=[e,t,n,r,i]:(e=null,y=s),null!==e&&(a=e,e=void(jn.port=parseInt(a.join("")))),null===e&&(y=o),e}function Cn(){var e,t,n,r,i;return i=r=y,null!==(e=u())&&null!==(t=null!==(t=u())?t:"")&&null!==(n=null!==(n=u())?n:"")?e=[e,t,n]:(e=null,y=i),null!==e&&(e=parseInt(e.join(""))),null===e&&(y=r),e}function Tn(){var e,t,n;return t=y,null!==(e=_t())&&(n=e,e=void(jn.expires=n)),null===e&&(y=t),e}function wn(){var e;return null===(e=En())&&(e=St()),e}function En(){var e,t,n,r,i,o;return i=r=y,"refresher"===m.substr(y,9).toLowerCase()?(e=m.substr(y,9),y+=9):(e=null,0===_&&b('"refresher"')),null!==e&&null!==(t=x())?("uac"===m.substr(y,3).toLowerCase()?(n=m.substr(y,3),y+=3):(n=null,0===_&&b('"uac"')),null===n&&("uas"===m.substr(y,3).toLowerCase()?(n=m.substr(y,3),y+=3):(n=null,0===_&&b('"uas"'))),null!==n?e=[e,t,n]:(e=null,y=i)):(e=null,y=i),null!==e&&(o=e[2],e=void(jn.refresher=o.toLowerCase())),null===e&&(y=r),e}function kn(){var e,t;for(e=[],null===(t=k())&&null===(t=I())&&(t=C());null!==t;)e.push(t),null===(t=k())&&null===(t=I())&&(t=C());return e}function Rn(){var e,t,n,r,i,o,s,a,l,u,c,d;return c=u=y,null!==(e=Pn())?(45===m.charCodeAt(y)?(t="-",y++):(t=null,0===_&&b('"-"')),null!==t&&null!==(n=In())?(45===m.charCodeAt(y)?(r="-",y++):(r=null,0===_&&b('"-"')),null!==r&&null!==(i=In())?(45===m.charCodeAt(y)?(o="-",y++):(o=null,0===_&&b('"-"')),null!==o&&null!==(s=In())?(45===m.charCodeAt(y)?(a="-",y++):(a=null,0===_&&b('"-"')),null!==a&&null!==(l=An())?e=[e,t,n,r,i,o,s,a,l]:(e=null,y=c)):(e=null,y=c)):(e=null,y=c)):(e=null,y=c)):(e=null,y=c),null!==e&&(d=u,e[0],e=void(jn=m.substring(y+5,d))),null===e&&(y=u),e}function In(){var e,t,n,r,i;return i=y,null!==(e=c())&&null!==(t=c())&&null!==(n=c())&&null!==(r=c())?e=[e,t,n,r]:(e=null,y=i),e}function Pn(){var e,t,n;return n=y,null!==(e=In())&&null!==(t=In())?e=[e,t]:(e=null,y=n),e}function An(){var e,t,n,r;return r=y,null!==(e=In())&&null!==(t=In())&&null!==(n=In())?e=[e,t,n]:(e=null,y=r),e}function On(){var e,t,n,r,i,o,s;return i=r=y,null!==(e=O())?(o=y,64===m.charCodeAt(y)?(t="@",y++):(t=null,0===_&&b('"@"')),null!==t&&null!==(n=O())?t=[t,n]:(t=null,y=o),null!==(t=null!==t?t:"")?e=[e,t]:(e=null,y=i)):(e=null,y=i),null!==e&&(s=r,e=void(jn.call_id=m.substring(y,s))),null===e&&(y=r),e}function Mn(){var e;return null===(e=Dn())&&null===(e=xn())&&null===(e=Nn())&&(e=St()),e}function Dn(){var e,t,n,r,i,o;return i=r=y,"to-tag"===m.substr(y,6)?(e="to-tag",y+=6):(e=null,0===_&&b('"to-tag"')),null!==e&&null!==(t=x())&&null!==(n=P())?e=[e,t,n]:(e=null,y=i),null!==e&&(o=e[2],e=void(jn.to_tag=o)),null===e&&(y=r),e}function xn(){var e,t,n,r,i,o;return i=r=y,"from-tag"===m.substr(y,8)?(e="from-tag",y+=8):(e=null,0===_&&b('"from-tag"')),null!==e&&null!==(t=x())&&null!==(n=P())?e=[e,t,n]:(e=null,y=i),null!==e&&(o=e[2],e=void(jn.from_tag=o)),null===e&&(y=r),e}function Nn(){var e,t;return t=y,"early-only"===m.substr(y,10)?(e="early-only",y+=10):(e=null,0===_&&b('"early-only"')),null!==e&&(e=void(jn.early_only=!0)),null===e&&(y=t),e}var Fn=Gn("./URI"),Un=Gn("./NameAddrHeader"),jn={};if(null===e[l]()||y!==m.length){var Ln=Math.max(y,o),Hn=Ln<m.length?m.charAt(Ln):null,Bn=function(){for(var e=1,t=1,n=!1,r=0;r<Math.max(y,o);r++){var i=m.charAt(r);"\n"===i?(n||e++,n=!(t=1)):"\r"===i||"\u2028"===i||"\u2029"===i?(e++,t=1,n=!0):(t++,n=!1)}return{line:e,column:t}}();return new this.SyntaxError(function(e){e.sort();for(var t=null,n=[],r=0;r<e.length;r++)e[r]!==t&&(n.push(e[r]),t=e[r]);return n}(t),Hn,Ln,Bn.line,Bn.column),-1}return jn},toSource:function(){return this._source},SyntaxError:function(e,t,n,r,i){this.name="SyntaxError",this.expected=e,this.found=t,this.message=function(e,t){var n;switch(e.length){case 0:n="end of input";break;case 1:n=e[0];break;default:n=e.slice(0,e.length-1).join(", ")+" or "+e[e.length-1]}return"Expected "+n+" but "+(t?qn(t):"end of input")+" found."}(e,t),this.offset=n,this.line=r,this.column=i}};return e.SyntaxError.prototype=Error.prototype,e}()},{"./NameAddrHeader":44,"./URI":59}],42:[function(e,t,n){var r=e("webrtc-adapter"),i=e("../package.json"),o=e("./Constants"),s=e("./Exceptions"),a=e("./Utils"),l=e("./UA"),u=e("./URI"),c=e("./NameAddrHeader"),d=e("./Grammar"),f=e("./WebSocketInterface");e("debug")("PlivoSIP")("version %s",i.version),t.exports={C:o,Exceptions:s,Utils:a,UA:l,URI:u,NameAddrHeader:c,WebSocketInterface:f,Grammar:d,debug:e("debug"),adapter:r,get name(){return i.title},get version(){return i.version}}},{"../package.json":34,"./Constants":36,"./Exceptions":40,"./Grammar":41,"./NameAddrHeader":44,"./UA":58,"./URI":59,"./Utils":60,"./WebSocketInterface":61,debug:12,"webrtc-adapter":24}],43:[function(e,t,n){var r=e("events").EventEmitter,c=e("./Constants"),d=e("./SIPMessage"),f=e("./Utils"),h=e("./RequestSender"),o=e("./Exceptions"),i=e("debug")("PlivoSIP:Message");t.exports=function(e){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t._ua=e,t._request=null,t._closed=!1,t._direction=null,t._local_identity=null,t._remote_identity=null,t._is_replied=!1,t._data={},t}return _inherits(n,r),_createClass(n,[{key:"send",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},i=e;if(void 0===e||void 0===t)throw new TypeError("Not enough arguments");if(!(e=this._ua.normalizeTarget(e)))throw new TypeError("Invalid target: "+i);var o=f.cloneArray(r.extraHeaders),s=r.eventHandlers||{},a=r.contentType||"text/plain";for(var l in s)Object.prototype.hasOwnProperty.call(s,l)&&this.on(l,s[l]);o.push("Content-Type: "+a),this._request=new d.OutgoingRequest(c.MESSAGE,e,this._ua,null,o),t&&(this._request.body=t);var u=new h(this._ua,this._request,{onRequestTimeout:function(){n._onRequestTimeout()},onTransportError:function(){n._onTransportError()},onReceiveResponse:function(e){n._receiveResponse(e)}});this._newMessage("local",this._request),u.send()}},{key:"init_incoming",value:function(e){this._request=e,this._newMessage("remote",e),this._is_replied||(this._is_replied=!0,e.reply(200)),this._close()}},{key:"accept",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=f.cloneArray(e.extraHeaders),n=e.body;if("incoming"!==this._direction)throw new o.NotSupportedError('"accept" not supported for outgoing Message');if(this._is_replied)throw new Error("incoming Message already replied");this._is_replied=!0,this._request.reply(200,null,t,n)}},{key:"reject",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.status_code||480,n=e.reason_phrase,r=f.cloneArray(e.extraHeaders),i=e.body;if("incoming"!==this._direction)throw new o.NotSupportedError('"reject" not supported for outgoing Message');if(this._is_replied)throw new Error("incoming Message already replied");if(t<300||700<=t)throw new TypeError("Invalid status_code: "+t);this._is_replied=!0,this._request.reply(t,n,r,i)}},{key:"_receiveResponse",value:function(e){if(!this._closed)switch(!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):this._succeeded("remote",e);break;default:var t=f.sipErrorCause(e.status_code);this._failed("remote",e,t)}}},{key:"_onRequestTimeout",value:function(){this._closed||this._failed("system",null,c.causes.REQUEST_TIMEOUT)}},{key:"_onTransportError",value:function(){this._closed||this._failed("system",null,c.causes.CONNECTION_ERROR)}},{key:"_close",value:function(){this._closed=!0,this._ua.destroyMessage(this)}},{key:"_newMessage",value:function(e,t){"remote"===e?(this._direction="incoming",this._local_identity=t.to,this._remote_identity=t.from):"local"===e&&(this._direction="outgoing",this._local_identity=t.from,this._remote_identity=t.to),this._ua.newMessage(this,{originator:e,message:this,request:t})}},{key:"_failed",value:function(e,t,n){i("MESSAGE failed"),this._close(),i('emit "failed"'),this.emit("failed",{originator:e,response:t||null,cause:n})}},{key:"_succeeded",value:function(e,t){i("MESSAGE succeeded"),this._close(),i('emit "succeeded"'),this.emit("succeeded",{originator:e,response:t})}},{key:"direction",get:function(){return this._direction}},{key:"local_identity",get:function(){return this._local_identity}},{key:"remote_identity",get:function(){return this._remote_identity}}]),n}()},{"./Constants":36,"./Exceptions":40,"./RequestSender":52,"./SIPMessage":53,"./Utils":60,debug:12,events:11}],44:[function(e,t,n){var o=e("./URI"),r=e("./Grammar");t.exports=function(){function i(e,t,n){if(_classCallCheck(this,i),!(e&&e instanceof o))throw new TypeError('missing or invalid "uri" parameter');for(var r in this._uri=e,this._parameters={},this._display_name=t,n)Object.prototype.hasOwnProperty.call(n,r)&&this.setParam(r,n[r])}return _createClass(i,null,[{key:"parse",value:function(e){return-1!==(e=r.parse(e,"Name_Addr_Header"))?e:void 0}}]),_createClass(i,[{key:"setParam",value:function(e,t){e&&(this._parameters[e.toLowerCase()]=null==t?null:t.toString())}},{key:"getParam",value:function(e){if(e)return this._parameters[e.toLowerCase()]}},{key:"hasParam",value:function(e){if(e)return!!this._parameters.hasOwnProperty(e.toLowerCase())}},{key:"deleteParam",value:function(e){if(e=e.toLowerCase(),this._parameters.hasOwnProperty(e)){var t=this._parameters[e];return delete this._parameters[e],t}}},{key:"clearParams",value:function(){this._parameters={}}},{key:"clone",value:function(){return new i(this._uri.clone(),this._display_name,JSON.parse(JSON.stringify(this._parameters)))}},{key:"toString",value:function(){var e=this._display_name||0===this._display_name?'"'+this._display_name+'" ':"";for(var t in e+="<"+this._uri.toString()+">",this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,t)&&(e+=";"+t,null!==this._parameters[t]&&(e+="="+this._parameters[t]));return e}},{key:"uri",get:function(){return this._uri}},{key:"display_name",get:function(){return this._display_name},set:function(e){this._display_name=0===e?"0":e}}]),i}()},{"./Grammar":41,"./URI":59}],45:[function(e,t,n){var b=e("./Grammar"),S=e("./SIPMessage"),u=e("debug")("PlivoSIP:ERROR:Parser");function c(e,t){var n=t,r=0,i=0;if(e.substring(n,n+2).match(/(^\r\n)/))return-2;for(;0===r;){if(-1===(i=e.indexOf("\r\n",n)))return i;!e.substring(i+2,i+4).match(/(^\r\n)/)&&e.charAt(i+2).match(/(^\s+)/)?n=i+2:r=i}return r}function d(e,t,n,r){var i=void 0,o=t.indexOf(":",n),s=t.substring(n,o).trim(),a=t.substring(o+1,r).trim();switch(s.toLowerCase()){case"via":case"v":e.addHeader("via",a),1===e.getHeaders("via").length?(i=e.parseHeader("Via"))&&(e.via=i,e.via_branch=i.branch):i=0;break;case"from":case"f":e.setHeader("from",a),(i=e.parseHeader("from"))&&(e.from=i,e.from_tag=i.getParam("tag"));break;case"to":case"t":e.setHeader("to",a),(i=e.parseHeader("to"))&&(e.to=i,e.to_tag=i.getParam("tag"));break;case"record-route":if(-1===(i=b.parse(a,"Record_Route")))i=void 0;else{var l=!0,u=!1,c=void 0;try{for(var d,f=i[Symbol.iterator]();!(l=(d=f.next()).done);l=!0){var h=d.value;e.addHeader("record-route",a.substring(h.possition,h.offset)),e.headers["Record-Route"][e.getHeaders("record-route").length-1].parsed=h.parsed}}catch(e){u=!0,c=e}finally{try{!l&&f.return&&f.return()}finally{if(u)throw c}}}break;case"call-id":case"i":e.setHeader("call-id",a),(i=e.parseHeader("call-id"))&&(e.call_id=a);break;case"contact":case"m":if(-1===(i=b.parse(a,"Contact")))i=void 0;else{var p=!0,v=!1,g=void 0;try{for(var m,y=i[Symbol.iterator]();!(p=(m=y.next()).done);p=!0){var _=m.value;e.addHeader("contact",a.substring(_.possition,_.offset)),e.headers.Contact[e.getHeaders("contact").length-1].parsed=_.parsed}}catch(e){v=!0,g=e}finally{try{!p&&y.return&&y.return()}finally{if(v)throw g}}}break;case"content-length":case"l":e.setHeader("content-length",a),i=e.parseHeader("content-length");break;case"content-type":case"c":e.setHeader("content-type",a),i=e.parseHeader("content-type");break;case"cseq":e.setHeader("cseq",a),(i=e.parseHeader("cseq"))&&(e.cseq=i.value),e instanceof S.IncomingResponse&&(e.method=i.method);break;case"max-forwards":e.setHeader("max-forwards",a),i=e.parseHeader("max-forwards");break;case"www-authenticate":e.setHeader("www-authenticate",a),i=e.parseHeader("www-authenticate");break;case"proxy-authenticate":e.setHeader("proxy-authenticate",a),i=e.parseHeader("proxy-authenticate");break;case"session-expires":case"x":e.setHeader("session-expires",a),(i=e.parseHeader("session-expires"))&&(e.session_expires=i.expires,e.session_expires_refresher=i.refresher);break;case"refer-to":case"r":e.setHeader("refer-to",a),(i=e.parseHeader("refer-to"))&&(e.refer_to=i);break;case"replaces":e.setHeader("replaces",a),(i=e.parseHeader("replaces"))&&(e.replaces=i);break;case"event":case"o":e.setHeader("event",a),(i=e.parseHeader("event"))&&(e.event=i);break;default:e.setHeader(s,a),i=0}return void 0!==i||{error:'error parsing header "'+s+'"'}}u.log=console.warn.bind(console),n.parseMessage=function(e,t){var n=void 0,r=void 0,i=e.indexOf("\r\n");if(-1!==i){var o=e.substring(0,i),s=b.parse(o,"Request_Response");if(-1!==s){s.status_code?((n=new S.IncomingResponse).status_code=s.status_code,n.reason_phrase=s.reason_phrase):((n=new S.IncomingRequest(t)).method=s.method,n.ruri=s.uri),n.data=e;for(var a=i+2;;){if(-2===(i=c(e,a))){r=a+2;break}if(-1===i)return void u("parseMessage() | malformed message");if(!0!==(s=d(n,e,a,i)))return void u("parseMessage() |",s.error);a=i+2}if(n.hasHeader("content-length")){var l=n.getHeader("content-length");n.body=e.substr(r,l)}else n.body=e.substring(r);return n}u('parseMessage() | error parsing first line of SIP message: "'+o+'"')}else u("parseMessage() | no CRLF found, not a SIP message")}},{"./Grammar":41,"./SIPMessage":53,debug:12}],46:[function(e,t,n){var r=e("events").EventEmitter,_=e("sdp-transform"),D=e("./Constants"),x=e("./Exceptions"),u=e("./Transactions"),N=e("./Utils"),i=e("./Timers"),p=e("./SIPMessage"),l=e("./Dialog"),o=e("./RequestSender"),c=e("./RTCSession/DTMF"),a=e("./RTCSession/Info"),d=e("./RTCSession/ReferNotifier"),f=e("./RTCSession/ReferSubscriber"),F=e("debug")("PlivoSIP:RTCSession"),U=e("debug")("PlivoSIP:ERROR:RTCSession");U.log=console.warn.bind(console);var j={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_ANSWERED:5,STATUS_WAITING_FOR_ACK:6,STATUS_CANCELED:7,STATUS_TERMINATED:8,STATUS_CONFIRMED:9},b=["audio","video"];t.exports=function(e){function s(e){_classCallCheck(this,s),F("new");var t=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));return t._id=null,t._ua=e,t._status=j.STATUS_NULL,t._dialog=null,t._earlyDialogs={},t._contact=null,t._from_tag=null,t._to_tag=null,t._connection=null,t._connectionPromiseQueue=Promise.resolve(),t._request=null,t._is_canceled=!1,t._cancel_reason="",t._is_confirmed=!1,t._late_sdp=!1,t._rtcOfferConstraints=null,t._rtcAnswerConstraints=null,t._localMediaStream=null,t._localMediaStreamLocallyGenerated=!1,t._rtcReady=!0,t._timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},t._direction=null,t._local_identity=null,t._remote_identity=null,t._start_time=null,t._end_time=null,t._tones=null,t._audioMuted=!1,t._videoMuted=!1,t._localHold=!1,t._remoteHold=!1,t._sessionTimers={enabled:t._ua.configuration.session_timers,refreshMethod:t._ua.configuration.session_timers_refresh_method,defaultExpires:D.SESSION_EXPIRES,currentExpires:null,running:!1,refresher:!1,timer:null},t._referSubscribers={},t._data={},t}return _inherits(s,r),_createClass(s,null,[{key:"C",get:function(){return j}}]),_createClass(s,[{key:"isInProgress",value:function(){switch(this._status){case j.STATUS_NULL:case j.STATUS_INVITE_SENT:case j.STATUS_1XX_RECEIVED:case j.STATUS_INVITE_RECEIVED:case j.STATUS_WAITING_FOR_ANSWER:return!0;default:return!1}}},{key:"isEstablished",value:function(){switch(this._status){case j.STATUS_ANSWERED:case j.STATUS_WAITING_FOR_ACK:case j.STATUS_CONFIRMED:return!0;default:return!1}}},{key:"isEnded",value:function(){switch(this._status){case j.STATUS_CANCELED:case j.STATUS_TERMINATED:return!0;default:return!1}}},{key:"isMuted",value:function(){return{audio:this._audioMuted,video:this._videoMuted}}},{key:"isOnHold",value:function(){return{local:this._localHold,remote:this._remoteHold}}},{key:"connect",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=arguments[2];F("connect()");var r=e,i=t.eventHandlers||{},o=N.cloneArray(t.extraHeaders),s=t.mediaConstraints||{audio:!0,video:!0},a=t.mediaStream||null,l=t.pcConfig||{iceServers:[]},u=t.rtcConstraints||null,c=t.rtcOfferConstraints||null;if(this._rtcOfferConstraints=c,this._rtcAnswerConstraints=t.rtcAnswerConstraints||null,this._data=t.data||this._data,void 0===e)throw new TypeError("Not enough arguments");if(this._status!==j.STATUS_NULL)throw new x.InvalidStateError(this._status);if(!window.RTCPeerConnection)throw new x.NotSupportedError("WebRTC not supported");if(!(e=this._ua.normalizeTarget(e)))throw new TypeError("Invalid target: "+r);for(var d in this._sessionTimers.enabled&&N.isDecimal(t.sessionTimersExpires)&&(t.sessionTimersExpires>=D.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=t.sessionTimersExpires:this._sessionTimers.defaultExpires=D.SESSION_EXPIRES),i)Object.prototype.hasOwnProperty.call(i,d)&&this.on(d,i[d]);this._from_tag=N.newTag();var f=t.anonymous||!1,h={from_tag:this._from_tag};this._contact=this._ua.contact.toString({anonymous:f,outbound:!0}),f&&(h.from_display_name="Anonymous",h.from_uri="sip:anonymous@anonymous.invalid",o.push("P-Preferred-Identity: "+this._ua.configuration.uri.toString()),o.push("Privacy: id")),o.push("Contact: "+this._contact),o.push("Content-Type: application/sdp"),this._sessionTimers.enabled&&o.push("Session-Expires: "+this._sessionTimers.defaultExpires),this._request=new p.InitialOutgoingInviteRequest(e,this._ua,h,o),this._id=this._request.call_id+this._from_tag,this._createRTCConnection(l,u),this._direction="outgoing",this._local_identity=this._request.from,this._remote_identity=this._request.to,n&&n(this),this._newRTCSession("local",this._request),this._sendInitialRequest(s,c,a)}},{key:"init_incoming",value:function(e,t){var n=this;F("init_incoming()");var r=void 0,i=e.getHeader("Content-Type");e.body&&"application/sdp"!==i?e.reply(415):(this._status=j.STATUS_INVITE_RECEIVED,this._from_tag=e.from_tag,this._id=e.call_id+this._from_tag,this._request=e,this._contact=this._ua.contact.toString(),e.hasHeader("expires")&&(r=1e3*e.getHeader("expires")),e.to_tag=N.newTag(),this._createDialog(e,"UAS",!0)?(e.body?this._late_sdp=!1:this._late_sdp=!0,this._status=j.STATUS_WAITING_FOR_ANSWER,this._timers.userNoAnswerTimer=setTimeout(function(){e.reply(408),n._failed("local",null,D.causes.NO_ANSWER)},this._ua.configuration.no_answer_timeout),r&&(this._timers.expiresTimer=setTimeout(function(){n._status===j.STATUS_WAITING_FOR_ANSWER&&(e.reply(487),n._failed("system",null,D.causes.EXPIRES))},r)),this._direction="incoming",this._local_identity=e.to,this._remote_identity=e.from,t&&t(this),this._newRTCSession("remote",e),this._status!==j.STATUS_TERMINATED&&(e.reply(180,null,["Contact: "+this._contact]),this._progress("local",null))):e.reply(500,"Missing Contact header field"))}},{key:"answer",value:function(){var n=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};F("answer()");var r=this._request,t=N.cloneArray(e.extraHeaders),i=e.mediaConstraints||{},o=e.mediaStream||null,s=e.pcConfig||{iceServers:[]},a=e.rtcConstraints||null,l=e.rtcAnswerConstraints||null,u=void 0,c=!1,d=!1,f=!1,h=!1;if(this._rtcAnswerConstraints=l,this._rtcOfferConstraints=e.rtcOfferConstraints||null,this._data=e.data||this._data,"incoming"!==this._direction)throw new x.NotSupportedError('"answer" not supported for outgoing RTCSession');if(this._status!==j.STATUS_WAITING_FOR_ANSWER)throw new x.InvalidStateError(this._status);if(this._sessionTimers.enabled&&N.isDecimal(e.sessionTimersExpires)&&(e.sessionTimersExpires>=D.MIN_SESSION_EXPIRES?this._sessionTimers.defaultExpires=e.sessionTimersExpires:this._sessionTimers.defaultExpires=D.SESSION_EXPIRES),this._status=j.STATUS_ANSWERED,this._createDialog(r,"UAS")){clearTimeout(this._timers.userNoAnswerTimer),t.unshift("Contact: "+this._contact);var p=r.parseSDP();Array.isArray(p.media)||(p.media=[p.media]);var v=!0,g=!1,m=void 0;try{for(var y,_=p.media[Symbol.iterator]();!(v=(y=_.next()).done);v=!0){var b=y.value;"audio"===b.type&&(c=!0,b.direction&&"sendrecv"!==b.direction||(f=!0)),"video"===b.type&&(d=!0,b.direction&&"sendrecv"!==b.direction||(h=!0))}}catch(e){g=!0,m=e}finally{try{!v&&_.return&&_.return()}finally{if(g)throw m}}if(o&&!1===i.audio){u=o.getAudioTracks();var S=!0,C=!1,T=void 0;try{for(var w,E=u[Symbol.iterator]();!(S=(w=E.next()).done);S=!0){var k=w.value;o.removeTrack(k)}}catch(e){C=!0,T=e}finally{try{!S&&E.return&&E.return()}finally{if(C)throw T}}}if(o&&!1===i.video){u=o.getVideoTracks();var R=!0,I=!1,P=void 0;try{for(var A,O=u[Symbol.iterator]();!(R=(A=O.next()).done);R=!0){var M=A.value;o.removeTrack(M)}}catch(e){I=!0,P=e}finally{try{!R&&O.return&&O.return()}finally{if(I)throw P}}}o||void 0!==i.audio||(i.audio=f),o||void 0!==i.video||(i.video=h),o||c||(i.audio=!1),o||d||(i.video=!1),this._createRTCConnection(s,a),Promise.resolve().then(function(){return o||(i.audio||i.video?(n._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(i).catch(function(e){if(n._status===j.STATUS_TERMINATED)throw new Error("terminated");throw r.reply(480),n._failed("local",null,D.causes.USER_DENIED_MEDIA_ACCESS),U('emit "getusermediafailed" [error:%o]',e),n.emit("getusermediafailed",e),new Error("getUserMedia() failed")})):void 0)}).then(function(e){if(n._status===j.STATUS_TERMINATED)throw new Error("terminated");(n._localMediaStream=e)&&n._connection.addStream(e)}).then(function(){if(!n._late_sdp){var e={originator:"remote",type:"offer",sdp:r.body};F('emit "sdp"'),n.emit("sdp",e);var t=new RTCSessionDescription({type:"offer",sdp:e.sdp});return n._connectionPromiseQueue=n._connectionPromiseQueue.then(function(){return n._connection.setRemoteDescription(t)}).catch(function(e){throw r.reply(488),n._failed("system",null,D.causes.WEBRTC_ERROR),U('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),n.emit("peerconnection:setremotedescriptionfailed",e),new Error("peerconnection.setRemoteDescription() failed")}),n._connectionPromiseQueue}}).then(function(){if(n._status===j.STATUS_TERMINATED)throw new Error("terminated");return n._connecting(r),n._late_sdp?n._createLocalDescription("offer",n._rtcOfferConstraints).catch(function(){throw r.reply(500),new Error("_createLocalDescription() failed")}):n._createLocalDescription("answer",l).catch(function(){throw r.reply(500),new Error("_createLocalDescription() failed")})}).then(function(e){if(n._status===j.STATUS_TERMINATED)throw new Error("terminated");n._handleSessionTimersInIncomingRequest(r,t),r.reply(200,null,t,e,function(){n._status=j.STATUS_WAITING_FOR_ACK,n._setInvite2xxTimer(r,e),n._setACKTimer(),n._accepted("local")},function(){n._failed("system",null,D.causes.CONNECTION_ERROR)})}).catch(function(e){n._status!==j.STATUS_TERMINATED&&U(e)})}else r.reply(500,"Error creating dialog")}},{key:"terminate",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};F("terminate()");var n=e.cause||D.causes.BYE,r=N.cloneArray(e.extraHeaders),i=e.body,o=void 0,s=e.status_code,a=e.reason_phrase;if(this._status===j.STATUS_TERMINATED)throw new x.InvalidStateError(this._status);switch(this._status){case j.STATUS_NULL:case j.STATUS_INVITE_SENT:case j.STATUS_1XX_RECEIVED:if(F("canceling session"),s&&(s<200||700<=s))throw new TypeError("Invalid status_code: "+s);s&&(o="SIP ;cause="+s+' ;text="'+(a=a||D.REASON_PHRASE[s]||"")+'"'),this._status===j.STATUS_NULL||this._status===j.STATUS_INVITE_SENT?(this._is_canceled=!0,this._cancel_reason=o):this._status===j.STATUS_1XX_RECEIVED&&this._request.cancel(o),this._status=j.STATUS_CANCELED,this._failed("local",null,D.causes.CANCELED);break;case j.STATUS_WAITING_FOR_ANSWER:case j.STATUS_ANSWERED:if(F("rejecting session"),(s=s||480)<300||700<=s)throw new TypeError("Invalid status_code: "+s);this._request.reply(s,a,r,i),this._failed("local",null,D.causes.REJECTED);break;case j.STATUS_WAITING_FOR_ACK:case j.STATUS_CONFIRMED:if(F("terminating session"),a=e.reason_phrase||D.REASON_PHRASE[s]||"",s&&(s<200||700<=s))throw new TypeError("Invalid status_code: "+s);if(s&&r.push("Reason: SIP ;cause="+s+'; text="'+a+'"'),this._status===j.STATUS_WAITING_FOR_ACK&&"incoming"===this._direction&&this._request.server_transaction.state!==u.C.STATUS_TERMINATED){var l=this._dialog;this.receiveRequest=function(e){e.method===D.ACK&&(t.sendRequest(D.BYE,{extraHeaders:r,body:i}),l.terminate())},this._request.server_transaction.on("stateChanged",function(){t._request.server_transaction.state===u.C.STATUS_TERMINATED&&(t.sendRequest(D.BYE,{extraHeaders:r,body:i}),l.terminate())}),this._ended("local",null,n),this._dialog=l,this._ua.newDialog(l)}else this.sendRequest(D.BYE,{extraHeaders:r,body:i}),this._ended("local",null,n)}}},{key:"sendDTMF",value:function(e){var o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};F("sendDTMF() | tones: %s",e);var s=0,a=o.duration||null,l=o.interToneGap||null;if(void 0===e)throw new TypeError("Not enough arguments");if(this._status!==j.STATUS_CONFIRMED&&this._status!==j.STATUS_WAITING_FOR_ACK)throw new x.InvalidStateError(this._status);if("number"==typeof e&&(e=e.toString()),!e||"string"!=typeof e||!e.match(/^[0-9A-DR#*,]+$/i))throw new TypeError("Invalid tones: "+e);if(a&&!N.isDecimal(a))throw new TypeError("Invalid tone duration: "+a);if(a?a<c.C.MIN_DURATION?(F('"duration" value is lower than the minimum allowed, setting it to '+c.C.MIN_DURATION+" milliseconds"),a=c.C.MIN_DURATION):a>c.C.MAX_DURATION?(F('"duration" value is greater than the maximum allowed, setting it to '+c.C.MAX_DURATION+" milliseconds"),a=c.C.MAX_DURATION):a=Math.abs(a):a=c.C.DEFAULT_DURATION,o.duration=a,l&&!N.isDecimal(l))throw new TypeError("Invalid interToneGap: "+l);l?l<c.C.MIN_INTER_TONE_GAP?(F('"interToneGap" value is lower than the minimum allowed, setting it to '+c.C.MIN_INTER_TONE_GAP+" milliseconds"),l=c.C.MIN_INTER_TONE_GAP):l=Math.abs(l):l=c.C.DEFAULT_INTER_TONE_GAP,this._tones?this._tones+=e:(this._tones=e,function e(){var t=this,n=void 0;if(this._status===j.STATUS_TERMINATED||!this._tones||s>=this._tones.length)this._tones=null;else{var r=this._tones[s];if(s+=1,","===r)n=2e3;else{var i=new c(this);o.eventHandlers={onFailed:function(){t._tones=null}},i.send(r,o),n=a+l}setTimeout(e.bind(this),n)}}.call(this))}},{key:"sendInfo",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(F("sendInfo()"),this._status!==j.STATUS_CONFIRMED&&this._status!==j.STATUS_WAITING_FOR_ACK)throw new x.InvalidStateError(this._status);new a(this).send(e,t,n)}},{key:"mute",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{audio:!0,video:!1};F("mute()");var t=!1,n=!1;!1===this._audioMuted&&e.audio&&(t=!0,this._audioMuted=!0,this._toogleMuteAudio(!0)),!1===this._videoMuted&&e.video&&(n=!0,this._videoMuted=!0,this._toogleMuteVideo(!0)),!0!==t&&!0!==n||this._onmute({audio:t,video:n})}},{key:"unmute",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{audio:!0,video:!0};F("unmute()");var t=!1,n=!1;!0===this._audioMuted&&e.audio&&(t=!0,(this._audioMuted=!1)===this._localHold&&this._toogleMuteAudio(!1)),!0===this._videoMuted&&e.video&&(n=!0,(this._videoMuted=!1)===this._localHold&&this._toogleMuteVideo(!1)),!0!==t&&!0!==n||this._onunmute({audio:t,video:n})}},{key:"hold",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];if(F("hold()"),this._status!==j.STATUS_WAITING_FOR_ACK&&this._status!==j.STATUS_CONFIRMED)return!1;if(!0===this._localHold)return!1;if(!this._isReadyToReOffer())return!1;this._localHold=!0,this._onhold("local");var r={succeeded:function(){n&&n()},failed:function(){e.terminate({cause:D.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Hold Failed"})}};return t.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:r,extraHeaders:t.extraHeaders}):this._sendReinvite({eventHandlers:r,extraHeaders:t.extraHeaders}),!0}},{key:"unhold",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];if(F("unhold()"),this._status!==j.STATUS_WAITING_FOR_ACK&&this._status!==j.STATUS_CONFIRMED)return!1;if(!1===this._localHold)return!1;if(!this._isReadyToReOffer())return!1;this._localHold=!1,this._onunhold("local");var r={succeeded:function(){n&&n()},failed:function(){e.terminate({cause:D.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Unhold Failed"})}};return t.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:r,extraHeaders:t.extraHeaders}):this._sendReinvite({eventHandlers:r,extraHeaders:t.extraHeaders}),!0}},{key:"renegotiate",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1];F("renegotiate()");var r=t.rtcOfferConstraints||null;if(this._status!==j.STATUS_WAITING_FOR_ACK&&this._status!==j.STATUS_CONFIRMED)return!1;if(!this._isReadyToReOffer())return!1;var i={succeeded:function(){n&&n()},failed:function(){e.terminate({cause:D.causes.WEBRTC_ERROR,status_code:500,reason_phrase:"Media Renegotiation Failed"})}};return this._setLocalMediaStatus(),t.useUpdate?this._sendUpdate({sdpOffer:!0,eventHandlers:i,rtcOfferConstraints:r,extraHeaders:t.extraHeaders}):this._sendReinvite({eventHandlers:i,rtcOfferConstraints:r,extraHeaders:t.extraHeaders}),!0}},{key:"refer",value:function(e,t){var n=this;F("refer()");var r=e;if(this._status!==j.STATUS_WAITING_FOR_ACK&&this._status!==j.STATUS_CONFIRMED)return!1;if(!(e=this._ua.normalizeTarget(e)))throw new TypeError("Invalid target: "+r);var i=new f(this);i.sendRefer(e,t);var o=i.id;return(this._referSubscribers[o]=i).on("requestFailed",function(){delete n._referSubscribers[o]}),i.on("accepted",function(){delete n._referSubscribers[o]}),i.on("failed",function(){delete n._referSubscribers[o]}),i}},{key:"sendRequest",value:function(e,t){return F("sendRequest()"),this._dialog.sendRequest(e,t)}},{key:"receiveRequest",value:function(e){var t=this;if(F("receiveRequest()"),e.method===D.CANCEL)this._status!==j.STATUS_WAITING_FOR_ANSWER&&this._status!==j.STATUS_ANSWERED||(this._status=j.STATUS_CANCELED,this._request.reply(487),this._failed("remote",e,D.causes.CANCELED));else switch(e.method){case D.ACK:if(this._status!==j.STATUS_WAITING_FOR_ACK)return;if(this._status=j.STATUS_CONFIRMED,clearTimeout(this._timers.ackTimer),clearTimeout(this._timers.invite2xxTimer),this._late_sdp){if(!e.body){this.terminate({cause:D.causes.MISSING_SDP,status_code:400});break}var n={originator:"remote",type:"answer",sdp:e.body};F('emit "sdp"'),this.emit("sdp",n);var r=new RTCSessionDescription({type:"answer",sdp:n.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return t._connection.setRemoteDescription(r)}).then(function(){t._is_confirmed||t._confirmed("remote",e)}).catch(function(e){t.terminate({cause:D.causes.BAD_MEDIA_DESCRIPTION,status_code:488}),U('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),t.emit("peerconnection:setremotedescriptionfailed",e)})}else this._is_confirmed||this._confirmed("remote",e);break;case D.BYE:this._status===j.STATUS_CONFIRMED?(e.reply(200),this._ended("remote",e,D.causes.BYE)):this._status===j.STATUS_INVITE_RECEIVED?(e.reply(200),this._request.reply(487,"BYE Received"),this._ended("remote",e,D.causes.BYE)):e.reply(403,"Wrong Status");break;case D.INVITE:this._status===j.STATUS_CONFIRMED?e.hasHeader("replaces")?this._receiveReplaces(e):this._receiveReinvite(e):e.reply(403,"Wrong Status");break;case D.INFO:if(this._status===j.STATUS_1XX_RECEIVED||this._status===j.STATUS_WAITING_FOR_ANSWER||this._status===j.STATUS_ANSWERED||this._status===j.STATUS_WAITING_FOR_ACK||this._status===j.STATUS_CONFIRMED){var i=e.getHeader("content-type");i&&i.match(/^application\/dtmf-relay/i)?new c(this).init_incoming(e):void 0!==i?new a(this).init_incoming(e):e.reply(415)}else e.reply(403,"Wrong Status");break;case D.UPDATE:this._status===j.STATUS_CONFIRMED?this._receiveUpdate(e):e.reply(403,"Wrong Status");break;case D.REFER:this._status===j.STATUS_CONFIRMED?this._receiveRefer(e):e.reply(403,"Wrong Status");break;case D.NOTIFY:this._status===j.STATUS_CONFIRMED?this._receiveNotify(e):e.reply(403,"Wrong Status");break;default:e.reply(501)}}},{key:"onTransportError",value:function(){U("onTransportError()"),this._status!==j.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:D.causes.CONNECTION_ERROR,cause:D.causes.CONNECTION_ERROR})}},{key:"onRequestTimeout",value:function(){U("onRequestTimeout()"),this._status!==j.STATUS_TERMINATED&&this.terminate({status_code:408,reason_phrase:D.causes.REQUEST_TIMEOUT,cause:D.causes.REQUEST_TIMEOUT})}},{key:"onDialogError",value:function(){U("onDialogError()"),this._status!==j.STATUS_TERMINATED&&this.terminate({status_code:500,reason_phrase:D.causes.DIALOG_ERROR,cause:D.causes.DIALOG_ERROR})}},{key:"newDTMF",value:function(e){F("newDTMF()"),this.emit("newDTMF",e)}},{key:"newInfo",value:function(e){F("newInfo()"),this.emit("newInfo",e)}},{key:"_isReadyToReOffer",value:function(){return this._rtcReady?this._dialog?!0!==this._dialog.uac_pending_reply&&!0!==this._dialog.uas_pending_reply||(F("_isReadyToReOffer() | there is another INVITE/UPDATE transaction in progress"),!1):(F("_isReadyToReOffer() | session not established yet"),!1):(F("_isReadyToReOffer() | internal WebRTC status not ready"),!1)}},{key:"_close",value:function(){if(F("close()"),this._status!==j.STATUS_TERMINATED){if(this._status=j.STATUS_TERMINATED,this._connection)try{this._connection.close()}catch(e){U("close() | error closing the RTCPeerConnection: %o",e)}for(var e in this._localMediaStream&&this._localMediaStreamLocallyGenerated&&(F("close() | closing local MediaStream"),N.closeMediaStream(this._localMediaStream)),this._timers)Object.prototype.hasOwnProperty.call(this._timers,e)&&clearTimeout(this._timers[e]);for(var t in clearTimeout(this._sessionTimers.timer),this._dialog&&(this._dialog.terminate(),delete this._dialog),this._earlyDialogs)Object.prototype.hasOwnProperty.call(this._earlyDialogs,t)&&(this._earlyDialogs[t].terminate(),delete this._earlyDialogs[t]);for(var n in this._referSubscribers)Object.prototype.hasOwnProperty.call(this._referSubscribers,n)&&delete this._referSubscribers[n];this._ua.destroyRTCSession(this)}}},{key:"_setInvite2xxTimer",value:function(t,n){var r=i.T1;this._timers.invite2xxTimer=setTimeout(function e(){this._status===j.STATUS_WAITING_FOR_ACK&&(t.reply(200,null,["Contact: "+this._contact],n),r<i.T2&&(r*=2)>i.T2&&(r=i.T2),this._timers.invite2xxTimer=setTimeout(e.bind(this),r))}.bind(this),r)}},{key:"_setACKTimer",value:function(){var e=this;this._timers.ackTimer=setTimeout(function(){e._status===j.STATUS_WAITING_FOR_ACK&&(F("no ACK received, terminating the session"),clearTimeout(e._timers.invite2xxTimer),e.sendRequest(D.BYE),e._ended("remote",null,D.causes.NO_ACK))},i.TIMER_H)}},{key:"_createRTCConnection",value:function(e,t){var n=this;this._connection=new RTCPeerConnection(e,t),this._connection.addEventListener("iceconnectionstatechange",function(){"failed"!==n._connection.iceConnectionState||n.disableRtpTimeOut||n.terminate({cause:D.causes.RTP_TIMEOUT,status_code:408,reason_phrase:D.causes.RTP_TIMEOUT})}),F('emit "peerconnection"'),this.emit("peerconnection",{peerconnection:this._connection})}},{key:"_createLocalDescription",value:function(o,e){var s=this;if(F("createLocalDescription()"),"offer"!==o&&"answer"!==o)throw new Error('createLocalDescription() | invalid type "'+o+'"');var a=this._connection;return this._rtcReady=!1,Promise.resolve().then(function(){return"offer"===o?a.createOffer(e).catch(function(e){return U('emit "peerconnection:createofferfailed" [error:%o]',e),s.emit("peerconnection:createofferfailed",e),Promise.reject(e)}):a.createAnswer(e).catch(function(e){return U('emit "peerconnection:createanswerfailed" [error:%o]',e),s.emit("peerconnection:createanswerfailed",e),Promise.reject(e)})}).then(function(e){return a.setLocalDescription(e).catch(function(e){return s._rtcReady=!0,U('emit "peerconnection:setlocaldescriptionfailed" [error:%o]',e),s.emit("peerconnection:setlocaldescriptionfailed",e),Promise.reject(e)})}).then(function(){if("complete"===a.iceGatheringState){s._rtcReady=!0;var e={originator:"local",type:o,sdp:a.localDescription.sdp};return F('emit "sdp"'),s.emit("sdp",e),Promise.resolve(e.sdp)}return new Promise(function(t){var n=!1,r=void 0,i=function(){a.removeEventListener("icecandidate",r),n=!0,s._rtcReady=!0;var e={originator:"local",type:o,sdp:a.localDescription.sdp};F('emit "sdp"'),s.emit("sdp",e),t(e.sdp)};a.addEventListener("icecandidate",r=function(e){var t=e.candidate;t?s.emit("icecandidate",{candidate:t,ready:i}):n||i()})})})}},{key:"_createDialog",value:function(e,t,n){var r="UAS"===t?e.to_tag:e.from_tag,i="UAS"===t?e.from_tag:e.to_tag,o=e.call_id+r+i,s=this._earlyDialogs[o];if(n)return!!s||((s=new l(this,e,t,l.C.STATUS_EARLY)).error?(F(s.error),this._failed("remote",e,D.causes.INTERNAL_ERROR),!1):(this._earlyDialogs[o]=s,!0));if(this._from_tag=e.from_tag,this._to_tag=e.to_tag,s)return s.update(e,t),this._dialog=s,delete this._earlyDialogs[o],!0;var a=new l(this,e,t);return a.error?(F(a.error),this._failed("remote",e,D.causes.INTERNAL_ERROR),!1):(this._dialog=a,!0)}},{key:"_receiveReinvite",value:function(i){var t=this;F("receiveReinvite()");var e=i.getHeader("Content-Type"),r={request:i,callback:void 0,reject:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};o=!0;var t=e.status_code||403,n=e.reason_phrase||"",r=N.cloneArray(e.extraHeaders);if(this._status!==j.STATUS_CONFIRMED)return!1;if(t<300||700<=t)throw new TypeError("Invalid status_code: "+t);i.reply(t,n,r)}.bind(this)},o=!1;if(this.emit("reinvite",r),!o){if(this._late_sdp=!1,!i.body)return this._late_sdp=!0,void(this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return t._createLocalDescription("offer",t._rtcOfferConstraints)}).then(function(e){n.call(t,e)}).catch(function(){i.reply(500)}));if("application/sdp"!==e)return F("invalid Content-Type"),void i.reply(415);this._processInDialogSdpOffer(i).then(function(e){t._status!==j.STATUS_TERMINATED&&n.call(t,e)}).catch(function(e){U(e)})}function n(e){var t=this,n=["Contact: "+this._contact];this._handleSessionTimersInIncomingRequest(i,n),this._late_sdp&&(e=this._mangleOffer(e)),i.reply(200,null,n,e,function(){t._status=j.STATUS_WAITING_FOR_ACK,t._setInvite2xxTimer(i,e),t._setACKTimer()}),"function"==typeof r.callback&&r.callback()}}},{key:"_receiveUpdate",value:function(i){var t=this;F("receiveUpdate()");var e=i.getHeader("Content-Type"),n={request:i,callback:void 0,reject:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};o=!0;var t=e.status_code||403,n=e.reason_phrase||"",r=N.cloneArray(e.extraHeaders);if(this._status!==j.STATUS_CONFIRMED)return!1;if(t<300||700<=t)throw new TypeError("Invalid status_code: "+t);i.reply(t,n,r)}.bind(this)},o=!1;if(this.emit("update",n),!o)if(i.body){if("application/sdp"!==e)return F("invalid Content-Type"),void i.reply(415);this._processInDialogSdpOffer(i).then(function(e){t._status!==j.STATUS_TERMINATED&&r.call(t,e)}).catch(function(e){U(e)})}else r.call(this,null);function r(e){var t=["Contact: "+this._contact];this._handleSessionTimersInIncomingRequest(i,t),i.reply(200,null,t,e),"function"==typeof n.callback&&n.callback()}}},{key:"_processInDialogSdpOffer",value:function(t){var n=this;F("_processInDialogSdpOffer()");var e=t.parseSDP(),r=!1,i=!0,o=!1,s=void 0;try{for(var a,l=e.media[Symbol.iterator]();!(i=(a=l.next()).done);i=!0){var u=a.value;if(-1!==b.indexOf(u.type)){var c=u.direction||e.direction||"sendrecv";if("sendonly"!==c&&"inactive"!==c){r=!1;break}r=!0}}}catch(e){o=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw s}}var d={originator:"remote",type:"offer",sdp:t.body};F('emit "sdp"'),this.emit("sdp",d);var f=new RTCSessionDescription({type:"offer",sdp:d.sdp});return this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){if(n._status===j.STATUS_TERMINATED)throw new Error("terminated");return n._connection.setRemoteDescription(f).catch(function(e){throw t.reply(488),U('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),n.emit("peerconnection:setremotedescriptionfailed",e),new Error("peerconnection.setRemoteDescription() failed")})}).then(function(){if(n._status===j.STATUS_TERMINATED)throw new Error("terminated");!0===n._remoteHold&&!1===r?(n._remoteHold=!1,n._onunhold("remote")):!1===n._remoteHold&&!0===r&&(n._remoteHold=!0,n._onhold("remote"))}).then(function(){if(n._status===j.STATUS_TERMINATED)throw new Error("terminated");return n._createLocalDescription("answer",n._rtcAnswerConstraints).catch(function(){throw t.reply(500),new Error("_createLocalDescription() failed")})}),this._connectionPromiseQueue}},{key:"_receiveRefer",value:function(i){var n=this;if(F("receiveRefer()"),void 0===_typeof(i.refer_to))return F("no Refer-To header field present in REFER"),void i.reply(400);if(i.refer_to.uri.scheme!==D.SIP)return F("Refer-To header field points to a non-SIP URI scheme"),void i.reply(416);i.reply(202);var o=new d(this,i.cseq);F('emit "refer"'),this.emit("refer",{request:i,accept:function(e,t){(function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(e="function"==typeof e?e:null,this._status!==j.STATUS_WAITING_FOR_ACK&&this._status!==j.STATUS_CONFIRMED)return!1;var n=new s(this._ua);if(n.on("progress",function(e){var t=e.response;o.notify(t.status_code,t.reason_phrase)}),n.on("accepted",function(e){var t=e.response;o.notify(t.status_code,t.reason_phrase)}),n.on("failed",function(e){var t=e.message,n=e.cause;t?o.notify(t.status_code,t.reason_phrase):o.notify(487,n)}),i.refer_to.uri.hasHeader("replaces")){var r=decodeURIComponent(i.refer_to.uri.getHeader("replaces"));t.extraHeaders=N.cloneArray(t.extraHeaders),t.extraHeaders.push("Replaces: "+r)}n.connect(i.refer_to.uri.toAor(),t,e)}).call(n,e,t)},reject:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){(function(){o.notify(603)}).call(n)})})}},{key:"_receiveNotify",value:function(e){switch(F("receiveNotify()"),void 0===_typeof(e.event)&&e.reply(400),e.event.event){case"refer":var t=void 0,n=void 0;if(e.event.params&&e.event.params.id)t=e.event.params.id,n=this._referSubscribers[t];else{if(1!==Object.keys(this._referSubscribers).length)return void e.reply(400,"Missing event id parameter");n=this._referSubscribers[Object.keys(this._referSubscribers)[0]]}if(!n)return void e.reply(481,"Subscription does not exist");n.receiveNotify(e),e.reply(200);break;default:e.reply(489)}}},{key:"_receiveReplaces",value:function(r){var t=this;F("receiveReplaces()"),this.emit("replaces",{request:r,accept:function(e){(function(e){var t=this;if(this._status!==j.STATUS_WAITING_FOR_ACK&&this._status!==j.STATUS_CONFIRMED)return!1;var n=new s(this._ua);n.on("confirmed",function(){t.terminate()}),n.init_incoming(r,e)}).call(t,e)},reject:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}(function(){(function(){F("Replaced INVITE rejected by the user"),r.reply(486)}).call(t)})})}},{key:"_sendInitialRequest",value:function(e,t,n){var r=this,i=new o(this._ua,this._request,{onRequestTimeout:function(){r.onRequestTimeout()},onTransportError:function(){r.onTransportError()},onAuthenticated:function(e){r._request=e},onReceiveResponse:function(e){r._receiveInviteResponse(e)}});Promise.resolve().then(function(){return n||(e.audio||e.video?(r._localMediaStreamLocallyGenerated=!0,navigator.mediaDevices.getUserMedia(e).catch(function(e){if(r._status===j.STATUS_TERMINATED)throw new Error("terminated");throw r._failed("local",null,D.causes.USER_DENIED_MEDIA_ACCESS),U('emit "getusermediafailed" [error:%o]',e),r.emit("getusermediafailed"),e})):void 0)}).then(function(e){if(r._status===j.STATUS_TERMINATED)throw new Error("terminated");return(r._localMediaStream=e)&&r._connection.addStream(e),r._connecting(r._request),r._createLocalDescription("offer",t).catch(function(e){throw r._failed("local",null,D.causes.WEBRTC_ERROR),e})}).then(function(e){if(r._is_canceled||r._status===j.STATUS_TERMINATED)throw new Error("terminated");r._request.body=e,r._status=j.STATUS_INVITE_SENT,F('emit "sending" [request:%o]',r._request),r.emit("sending",{request:r._request}),i.send()}).catch(function(e){r._status!==j.STATUS_TERMINATED&&U(e)})}},{key:"_receiveInviteResponse",value:function(t){var n=this;if(F("receiveInviteResponse()"),this._dialog&&200<=t.status_code&&t.status_code<=299){if(this._dialog.id.call_id===t.call_id&&this._dialog.id.local_tag===t.from_tag&&this._dialog.id.remote_tag===t.to_tag)return void this.sendRequest(D.ACK);var e=new l(this,t,"UAC");return void 0!==e.error?void F(e.error):(this.sendRequest(D.ACK),void this.sendRequest(D.BYE))}if(this._is_canceled)100<=t.status_code&&t.status_code<200?this._request.cancel(this._cancel_reason):200<=t.status_code&&t.status_code<299&&this._acceptAndTerminate(t);else if(this._status===j.STATUS_INVITE_SENT||this._status===j.STATUS_1XX_RECEIVED)switch(!0){case/^100$/.test(t.status_code):this._status=j.STATUS_1XX_RECEIVED;break;case/^1[0-9]{2}$/.test(t.status_code):if(!t.to_tag){F("1xx response received without to tag");break}if(t.hasHeader("contact")&&!this._createDialog(t,"UAC",!0))break;if(this._status=j.STATUS_1XX_RECEIVED,this._progress("remote",t),!t.body)break;var r={originator:"remote",type:"answer",sdp:t.body};F('emit "sdp"'),this.emit("sdp",r);var i=new RTCSessionDescription({type:"answer",sdp:r.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return n._connection.setRemoteDescription(i)}).catch(function(e){U('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),n.emit("peerconnection:setremotedescriptionfailed",e)});break;case/^2[0-9]{2}$/.test(t.status_code):if(this._status=j.STATUS_CONFIRMED,!t.body){this._acceptAndTerminate(t,400,D.causes.MISSING_SDP),this._failed("remote",t,D.causes.BAD_MEDIA_DESCRIPTION);break}if(!this._createDialog(t,"UAC"))break;var o={originator:"remote",type:"answer",sdp:t.body};F('emit "sdp"'),this.emit("sdp",o);var s=new RTCSessionDescription({type:"answer",sdp:o.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){if("stable"===n._connection.signalingState)return n._connection.createOffer().then(function(e){return n._connection.setLocalDescription(e)}).catch(function(e){n._acceptAndTerminate(t,500,e.toString()),n._failed("local",t,D.causes.WEBRTC_ERROR)})}).then(function(){n._connection.setRemoteDescription(s).then(function(){n._handleSessionTimersInIncomingResponse(t),n._accepted("remote",t),n.sendRequest(D.ACK),n._confirmed("local",null)}).catch(function(e){n._acceptAndTerminate(t,488,"Not Acceptable Here"),n._failed("remote",t,D.causes.BAD_MEDIA_DESCRIPTION),U('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),n.emit("peerconnection:setremotedescriptionfailed",e)})});break;default:var a=N.sipErrorCause(t.status_code);this._failed("remote",t,a)}}},{key:"_sendReinvite",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};F("sendReinvite()");var n=N.cloneArray(e.extraHeaders),i=e.eventHandlers||{},r=e.rtcOfferConstraints||this._rtcOfferConstraints||null,o=!1;function s(e){i.failed&&i.failed(e)}n.push("Contact: "+this._contact),n.push("Content-Type: application/sdp"),this._sessionTimers.running&&n.push("Session-Expires: "+this._sessionTimers.currentExpires+";refresher="+(this._sessionTimers.refresher?"uac":"uas")),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return t._createLocalDescription("offer",r)}).then(function(e){e=t._mangleOffer(e),t.sendRequest(D.INVITE,{extraHeaders:n,body:e,eventHandlers:{onSuccessResponse:function(e){(function(e){var t=this;if(this._status!==j.STATUS_TERMINATED&&(this.sendRequest(D.ACK),!o))if(this._handleSessionTimersInIncomingResponse(e),e.body)if("application/sdp"===e.getHeader("Content-Type")){var n={originator:"remote",type:"answer",sdp:e.body};F('emit "sdp"'),this.emit("sdp",n);var r=new RTCSessionDescription({type:"answer",sdp:n.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return t._connection.setRemoteDescription(r)}).then(function(){i.succeeded&&i.succeeded(e)}).catch(function(e){s.call(t),U('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),t.emit("peerconnection:setremotedescriptionfailed",e)})}else s.call(this);else s.call(this)}).call(t,e),o=!0},onErrorResponse:function(e){s.call(t,e)},onTransportError:function(){t.onTransportError()},onRequestTimeout:function(){t.onRequestTimeout()},onDialogError:function(){t.onDialogError()}}})}).catch(function(){s()})}},{key:"_sendUpdate",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};F("sendUpdate()");var n=N.cloneArray(e.extraHeaders),i=e.eventHandlers||{},r=e.rtcOfferConstraints||this._rtcOfferConstraints||null,o=e.sdpOffer||!1,s=!1;function a(e){var t=this;if(this._status!==j.STATUS_TERMINATED&&!s)if(this._handleSessionTimersInIncomingResponse(e),o){if(!e.body)return void l.call(this);if("application/sdp"!==e.getHeader("Content-Type"))return void l.call(this);var n={originator:"remote",type:"answer",sdp:e.body};F('emit "sdp"'),this.emit("sdp",n);var r=new RTCSessionDescription({type:"answer",sdp:n.sdp});this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return t._connection.setRemoteDescription(r)}).then(function(){i.succeeded&&i.succeeded(e)}).catch(function(e){l.call(t),U('emit "peerconnection:setremotedescriptionfailed" [error:%o]',e),t.emit("peerconnection:setremotedescriptionfailed",e)})}else i.succeeded&&i.succeeded(e)}function l(e){i.failed&&i.failed(e)}n.push("Contact: "+this._contact),this._sessionTimers.running&&n.push("Session-Expires: "+this._sessionTimers.currentExpires+";refresher="+(this._sessionTimers.refresher?"uac":"uas")),o?(n.push("Content-Type: application/sdp"),this._connectionPromiseQueue=this._connectionPromiseQueue.then(function(){return t._createLocalDescription("offer",r)}).then(function(e){e=t._mangleOffer(e),t.sendRequest(D.UPDATE,{extraHeaders:n,body:e,eventHandlers:{onSuccessResponse:function(e){a.call(t,e),s=!0},onErrorResponse:function(e){l.call(t,e)},onTransportError:function(){t.onTransportError()},onRequestTimeout:function(){t.onRequestTimeout()},onDialogError:function(){t.onDialogError()}}})}).catch(function(){l.call(t)})):this.sendRequest(D.UPDATE,{extraHeaders:n,eventHandlers:{onSuccessResponse:function(e){a.call(t,e)},onErrorResponse:function(e){l.call(t,e)},onTransportError:function(){t.onTransportError()},onRequestTimeout:function(){t.onRequestTimeout()},onDialogError:function(){t.onDialogError()}}})}},{key:"_acceptAndTerminate",value:function(e,t,n){F("acceptAndTerminate()");var r=[];t&&(n=n||D.REASON_PHRASE[t]||"",r.push("Reason: SIP ;cause="+t+'; text="'+n+'"')),(this._dialog||this._createDialog(e,"UAC"))&&(this.sendRequest(D.ACK),this.sendRequest(D.BYE,{extraHeaders:r})),this._status=j.STATUS_TERMINATED}},{key:"_mangleOffer",value:function(e){if(!this._localHold&&!this._remoteHold)return e;if(e=_.parse(e),this._localHold&&!this._remoteHold){F("mangleOffer() | me on hold, mangling offer");var t=!0,n=!1,r=void 0;try{for(var i,o=e.media[Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;-1!==b.indexOf(s.type)&&(s.direction?"sendrecv"===s.direction?s.direction="sendonly":"recvonly"===s.direction&&(s.direction="inactive"):s.direction="sendonly")}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}}else if(this._localHold&&this._remoteHold){F("mangleOffer() | both on hold, mangling offer");var a=!0,l=!1,u=void 0;try{for(var c,d=e.media[Symbol.iterator]();!(a=(c=d.next()).done);a=!0){var f=c.value;-1!==b.indexOf(f.type)&&(f.direction="inactive")}}catch(e){l=!0,u=e}finally{try{!a&&d.return&&d.return()}finally{if(l)throw u}}}else if(this._remoteHold){F("mangleOffer() | remote on hold, mangling offer");var h=!0,p=!1,v=void 0;try{for(var g,m=e.media[Symbol.iterator]();!(h=(g=m.next()).done);h=!0){var y=g.value;-1!==b.indexOf(y.type)&&(y.direction?"sendrecv"===y.direction?y.direction="recvonly":"recvonly"===y.direction&&(y.direction="inactive"):y.direction="recvonly")}}catch(e){p=!0,v=e}finally{try{!h&&m.return&&m.return()}finally{if(p)throw v}}}return _.write(e)}},{key:"_setLocalMediaStatus",value:function(){var e=!0,t=!0;(this._localHold||this._remoteHold)&&(t=e=!1),this._audioMuted&&(e=!1),this._videoMuted&&(t=!1),this._toogleMuteAudio(!e),this._toogleMuteVideo(!t)}},{key:"_handleSessionTimersInIncomingRequest",value:function(e,t){if(this._sessionTimers.enabled){var n=void 0;e.session_expires&&e.session_expires>=D.MIN_SESSION_EXPIRES?(this._sessionTimers.currentExpires=e.session_expires,n=e.session_expires_refresher||"uas"):(this._sessionTimers.currentExpires=this._sessionTimers.defaultExpires,n="uas"),t.push("Session-Expires: "+this._sessionTimers.currentExpires+";refresher="+n),this._sessionTimers.refresher="uas"===n,this._runSessionTimer()}}},{key:"_handleSessionTimersInIncomingResponse",value:function(e){if(this._sessionTimers.enabled){var t=void 0;e.session_expires&&e.session_expires>=D.MIN_SESSION_EXPIRES?(this._sessionTimers.currentExpires=e.session_expires,t=e.session_expires_refresher||"uac"):(this._sessionTimers.currentExpires=this._sessionTimers.defaultExpires,t="uac"),this._sessionTimers.refresher="uac"===t,this._runSessionTimer()}}},{key:"_runSessionTimer",value:function(){var e=this,t=this._sessionTimers.currentExpires;this._sessionTimers.running=!0,clearTimeout(this._sessionTimers.timer),this._sessionTimers.refresher?this._sessionTimers.timer=setTimeout(function(){e._status!==j.STATUS_TERMINATED&&(F("runSessionTimer() | sending session refresh request"),e._sessionTimers.refreshMethod===D.UPDATE?e._sendUpdate():e._sendReinvite())},500*t):this._sessionTimers.timer=setTimeout(function(){e._status!==j.STATUS_TERMINATED&&(U("runSessionTimer() | timer expired, terminating the session"),e.terminate({cause:D.causes.REQUEST_TIMEOUT,status_code:408,reason_phrase:"Session Timer Expired"}))},1100*t)}},{key:"_toogleMuteAudio",value:function(e){var t=this._connection.getLocalStreams(),n=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value.getAudioTracks(),l=!0,u=!1,c=void 0;try{for(var d,f=a[Symbol.iterator]();!(l=(d=f.next()).done);l=!0)d.value.enabled=!e}catch(e){u=!0,c=e}finally{try{!l&&f.return&&f.return()}finally{if(u)throw c}}}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}}},{key:"_toogleMuteVideo",value:function(e){var t=this._connection.getLocalStreams(),n=!0,r=!1,i=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value.getVideoTracks(),l=!0,u=!1,c=void 0;try{for(var d,f=a[Symbol.iterator]();!(l=(d=f.next()).done);l=!0)d.value.enabled=!e}catch(e){u=!0,c=e}finally{try{!l&&f.return&&f.return()}finally{if(u)throw c}}}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}}},{key:"_newRTCSession",value:function(e,t){F("newRTCSession()"),this._ua.newRTCSession(this,{originator:e,session:this,request:t})}},{key:"_connecting",value:function(e){F("session connecting"),F('emit "connecting"'),this.emit("connecting",{request:e})}},{key:"_progress",value:function(e,t){F("session progress"),F('emit "progress"'),this.emit("progress",{originator:e,response:t||null})}},{key:"_accepted",value:function(e,t){F("session accepted"),this._start_time=new Date,F('emit "accepted"'),this.emit("accepted",{originator:e,response:t||null})}},{key:"_confirmed",value:function(e,t){F("session confirmed"),this._is_confirmed=!0,F('emit "confirmed"'),this.emit("confirmed",{originator:e,ack:t||null})}},{key:"_ended",value:function(e,t,n){F("session ended"),this._end_time=new Date,this._close(),F('emit "ended"'),this.emit("ended",{originator:e,message:t||null,cause:n})}},{key:"_failed",value:function(e,t,n){F("session failed"),this._close(),F('emit "failed"'),this.emit("failed",{originator:e,message:t||null,cause:n})}},{key:"_onhold",value:function(e){F("session onhold"),this._setLocalMediaStatus(),F('emit "hold"'),this.emit("hold",{originator:e})}},{key:"_onunhold",value:function(e){F("session onunhold"),this._setLocalMediaStatus(),F('emit "unhold"'),this.emit("unhold",{originator:e})}},{key:"_onmute",value:function(e){var t=e.audio,n=e.video;F("session onmute"),this._setLocalMediaStatus(),F('emit "muted"'),this.emit("muted",{audio:t,video:n})}},{key:"_onunmute",value:function(e){var t=e.audio,n=e.video;F("session onunmute"),this._setLocalMediaStatus(),F('emit "unmuted"'),this.emit("unmuted",{audio:t,video:n})}},{key:"C",get:function(){return j}},{key:"causes",get:function(){return D.causes}},{key:"id",get:function(){return this._id}},{key:"connection",get:function(){return this._connection}},{key:"contact",get:function(){return this._contact}},{key:"direction",get:function(){return this._direction}},{key:"local_identity",get:function(){return this._local_identity}},{key:"remote_identity",get:function(){return this._remote_identity}},{key:"start_time",get:function(){return this._start_time}},{key:"end_time",get:function(){return this._end_time}},{key:"data",get:function(){return this._data},set:function(e){this._data=e}},{key:"status",get:function(){return this._status}}]),s}()},{"./Constants":36,"./Dialog":37,"./Exceptions":40,"./RTCSession/DTMF":47,"./RTCSession/Info":48,"./RTCSession/ReferNotifier":49,"./RTCSession/ReferSubscriber":50,"./RequestSender":52,"./SIPMessage":53,"./Timers":55,"./Transactions":56,"./Utils":60,debug:12,events:11,"sdp-transform":17}],47:[function(e,t,n){var r=e("events").EventEmitter,o=e("../Constants"),s=e("../Exceptions"),a=e("../Utils"),i=e("debug")("PlivoSIP:RTCSession:DTMF");e("debug")("PlivoSIP:ERROR:RTCSession:DTMF").log=console.warn.bind(console);var l={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};t.exports=function(e){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t._session=e,t._direction=null,t._tone=null,t._duration=null,t._request=null,t}return _inherits(n,r),_createClass(n,[{key:"send",value:function(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(void 0===e)throw new TypeError("Not enough arguments");if(this._direction="outgoing",this._session.status!==this._session.C.STATUS_CONFIRMED&&this._session.status!==this._session.C.STATUS_WAITING_FOR_ACK)throw new s.InvalidStateError(this._session.status);var r=a.cloneArray(n.extraHeaders);if(this.eventHandlers=n.eventHandlers||{},"string"==typeof e)e=e.toUpperCase();else{if("number"!=typeof e)throw new TypeError("Invalid tone: "+e);e=e.toString()}if(!e.match(/^[0-9A-DR#*]$/))throw new TypeError("Invalid tone: "+e);this._tone=e,this._duration=n.duration,r.push("Content-Type: application/dtmf-relay");var i="Signal="+this._tone+"\r\n";i+="Duration="+this._duration,this._session.newDTMF({originator:"local",dtmf:this,request:this._request}),this._session.sendRequest(o.INFO,{extraHeaders:r,eventHandlers:{onSuccessResponse:function(e){t.emit("succeeded",{originator:"remote",response:e})},onErrorResponse:function(e){t.eventHandlers.onFailed&&t.eventHandlers.onFailed(),t.emit("failed",{originator:"remote",response:e})},onRequestTimeout:function(){t._session.onRequestTimeout()},onTransportError:function(){t._session.onTransportError()},onDialogError:function(){t._session.onDialogError()}},body:i})}},{key:"init_incoming",value:function(e){var t=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,n=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;if(this._direction="incoming",(this._request=e).reply(200),e.body){var r=e.body.split("\n");1<=r.length&&t.test(r[0])&&(this._tone=r[0].replace(t,"$2")),2<=r.length&&n.test(r[1])&&(this._duration=parseInt(r[1].replace(n,"$2"),10))}this._duration||(this._duration=l.DEFAULT_DURATION),this._tone?this._session.newDTMF({originator:"remote",dtmf:this,request:e}):i("invalid INFO DTMF received, discarded")}},{key:"tone",get:function(){return this._tone}},{key:"duration",get:function(){return this._duration}}]),n}(),t.exports.C=l},{"../Constants":36,"../Exceptions":40,"../Utils":60,debug:12,events:11}],48:[function(e,t,n){var r=e("events").EventEmitter;e("debug")("PlivoSIP:ERROR:RTCSession:Info").log=console.warn.bind(console);var o=e("../Constants"),s=e("../Exceptions"),a=e("../Utils");t.exports=function(e){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t._session=e,t._direction=null,t._contentType=null,t._body=null,t}return _inherits(n,r),_createClass(n,[{key:"send",value:function(e,t){var n=this,r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};if(this._direction="outgoing",void 0===e)throw new TypeError("Not enough arguments");if(this._session.status!==this._session.C.STATUS_CONFIRMED&&this._session.status!==this._session.C.STATUS_WAITING_FOR_ACK)throw new s.InvalidStateError(this._session.status);this._contentType=e,this._body=t;var i=a.cloneArray(r.extraHeaders);i.push("Content-Type: "+e),this._session.newInfo({originator:"local",info:this,request:this.request}),this._session.sendRequest(o.INFO,{extraHeaders:i,eventHandlers:{onSuccessResponse:function(e){n.emit("succeeded",{originator:"remote",response:e})},onErrorResponse:function(e){n.emit("failed",{originator:"remote",response:e})},onTransportError:function(){n._session.onTransportError()},onRequestTimeout:function(){n._session.onRequestTimeout()},onDialogError:function(){n._session.onDialogError()}},body:t})}},{key:"init_incoming",value:function(e){this._direction="incoming",(this.request=e).reply(200),this._contentType=e.getHeader("content-type"),this._body=e.body,this._session.newInfo({originator:"remote",info:this,request:e})}},{key:"contentType",get:function(){return this._contentType}},{key:"body",get:function(){return this._body}}]),n}()},{"../Constants":36,"../Exceptions":40,"../Utils":60,debug:12,events:11}],49:[function(e,t,n){var i=e("../Constants"),o=e("debug")("PlivoSIP:RTCSession:ReferNotifier"),s="refer",a="message/sipfrag;version=2.0",l=300;t.exports=function(){function r(e,t,n){_classCallCheck(this,r),this._session=e,this._id=t,this._expires=n||l,this._active=!0,this.notify(100)}return _createClass(r,[{key:"notify",value:function(e,t){if(o("notify()"),!1!==this._active){t=t||i.REASON_PHRASE[e]||"";var n=void 0;n=200<=e?"terminated;reason=noresource":"active;expires="+this._expires,this._session.sendRequest(i.NOTIFY,{extraHeaders:["Event: "+s+";id="+this._id,"Subscription-State: "+n,"Content-Type: "+a],body:"SIP/2.0 "+e+" "+t,eventHandlers:{onErrorResponse:function(){this._active=!1}}})}}}]),r}()},{"../Constants":36,debug:12}],50:[function(e,t,n){var r=e("events").EventEmitter,u=e("../Constants"),i=e("../Grammar"),c=e("../Utils"),d=e("debug")("PlivoSIP:RTCSession:ReferSubscriber");t.exports=function(e){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t._id=null,t._session=e,t}return _inherits(n,r),_createClass(n,[{key:"sendRefer",value:function(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};d("sendRefer()");var r=c.cloneArray(n.extraHeaders),i=n.eventHandlers||{};for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&this.on(o,i[o]);var s=null;n.replaces&&(s=n.replaces._request.call_id,s+=";to-tag="+n.replaces._to_tag,s+=";from-tag="+n.replaces._from_tag,s=encodeURIComponent(s));var a="Refer-To: <"+e+(s?"?Replaces="+s:"")+">";r.push(a),r.push("Contact: "+this._session.contact);var l=this._session.sendRequest(u.REFER,{extraHeaders:r,eventHandlers:{onSuccessResponse:function(e){t._requestSucceeded(e)},onErrorResponse:function(e){t._requestFailed(e,u.causes.REJECTED)},onTransportError:function(){t._requestFailed(null,u.causes.CONNECTION_ERROR)},onRequestTimeout:function(){t._requestFailed(null,u.causes.REQUEST_TIMEOUT)},onDialogError:function(){t._requestFailed(null,u.causes.DIALOG_ERROR)}}});this._id=l.cseq}},{key:"receiveNotify",value:function(e){if(d("receiveNotify()"),e.body){var t=i.parse(e.body.trim(),"Status_Line");if(-1!==t)switch(!0){case/^100$/.test(t.status_code):this.emit("trying",{request:e,status_line:t});break;case/^1[0-9]{2}$/.test(t.status_code):this.emit("progress",{request:e,status_line:t});break;case/^2[0-9]{2}$/.test(t.status_code):this.emit("accepted",{request:e,status_line:t});break;default:this.emit("failed",{request:e,status_line:t})}else d('receiveNotify() | error parsing NOTIFY body: "'+e.body+'"')}}},{key:"_requestSucceeded",value:function(e){d("REFER succeeded"),d('emit "requestSucceeded"'),this.emit("requestSucceeded",{response:e})}},{key:"_requestFailed",value:function(e,t){d("REFER failed"),d('emit "requestFailed"'),this.emit("requestFailed",{response:e||null,cause:t})}},{key:"id",get:function(){return this._id}}]),n}()},{"../Constants":36,"../Grammar":41,"../Utils":60,debug:12,events:11}],51:[function(e,t,n){var s=e("./Utils"),a=e("./Constants"),i=e("./SIPMessage"),l=e("./RequestSender"),u=e("debug")("PlivoSIP:Registrator");t.exports=function(){function n(e,t){_classCallCheck(this,n),this._ua=e,this._transport=t,this._registrar=e.configuration.registrar_server,this._expires=e.configuration.register_expires,this._call_id=s.createRandomToken(22),this._cseq=0,this._to_uri=e.configuration.uri,this._registrationTimer=null,this._registering=!1,this._registered=!1,this._contact=this._ua.contact.toString(),this._contact+=";+sip.ice",this._extraHeaders=[],this._extraContactParams="",this._contact+=";reg-id=1",this._contact+=';+sip.instance="<urn:uuid:'+this._ua.configuration.instance_id+'>"'}return _createClass(n,[{key:"setExtraHeaders",value:function(e){Array.isArray(e)||(e=[]),this._extraHeaders=e.slice()}},{key:"setExtraContactParams",value:function(e){for(var t in e instanceof Object||(e={}),this._extraContactParams="",e)if(Object.prototype.hasOwnProperty.call(e,t)){var n=e[t];this._extraContactParams+=";"+t,n&&(this._extraContactParams+="="+n)}}},{key:"register",value:function(){var o=this;if(this._registering)u("Register request in progress...");else{var e=this._extraHeaders.slice();e.push("Contact: "+this._contact+";expires="+this._expires+this._extraContactParams),e.push("Expires: "+this._expires);var t=new i.OutgoingRequest(a.REGISTER,this._registrar,this._ua,{to_uri:this._to_uri,call_id:this._call_id,cseq:this._cseq+=1},e),n=new l(this._ua,t,{onRequestTimeout:function(){o._registrationFailure(null,a.causes.REQUEST_TIMEOUT)},onTransportError:function(){o._registrationFailure(null,a.causes.CONNECTION_ERROR)},onAuthenticated:function(){o._cseq+=1},onReceiveResponse:function(e){var t=void 0,n=void 0,r=e.getHeaders("contact").length;if(e.cseq===o._cseq)switch(null!==o._registrationTimer&&(clearTimeout(o._registrationTimer),o._registrationTimer=null),!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):if(o._registering=!1,!r){u("no Contact header in response to REGISTER, response ignored");break}for(;r--;){if((t=e.parseHeader("contact",r)).uri.user===o._ua.contact.uri.user){n=t.getParam("expires");break}t=null}if(!t){u("no Contact header pointing to us, response ignored");break}!n&&e.hasHeader("expires")&&(n=e.getHeader("expires")),n||(n=o._expires),(n=Number(n))<10&&(n=10),o._registrationTimer=setTimeout(function(){o._registrationTimer=null,0===o._ua.listeners("registrationExpiring").length?o.register():o._ua.emit("registrationExpiring")},1e3*n-5e3),t.hasParam("temp-gruu")&&(o._ua.contact.temp_gruu=t.getParam("temp-gruu").replace(/"/g,"")),t.hasParam("pub-gruu")&&(o._ua.contact.pub_gruu=t.getParam("pub-gruu").replace(/"/g,"")),o._registered||(o._registered=!0,o._ua.registered({response:e}));break;case/^423$/.test(e.status_code):e.hasHeader("min-expires")?(o._expires=Number(e.getHeader("min-expires")),o._expires<10&&(o._expires=10),o.register()):(u("423 response received for REGISTER without Min-Expires"),o._registrationFailure(e,a.causes.SIP_FAILURE_CODE));break;default:var i=s.sipErrorCause(e.status_code);o._registrationFailure(e,i)}}});this._registering=!0,n.send()}}},{key:"unregister",value:function(){var n=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(this._registered){this._registered=!1,null!==this._registrationTimer&&(clearTimeout(this._registrationTimer),this._registrationTimer=null);var t=this._extraHeaders.slice();e.all?t.push("Contact: *"+this._extraContactParams):t.push("Contact: "+this._contact+";expires=0"+this._extraContactParams),t.push("Expires: 0");var r=new i.OutgoingRequest(a.REGISTER,this._registrar,this._ua,{to_uri:this._to_uri,call_id:this._call_id,cseq:this._cseq+=1},t);new l(this._ua,r,{onRequestTimeout:function(){n._unregistered(null,a.causes.REQUEST_TIMEOUT)},onTransportError:function(){n._unregistered(null,a.causes.CONNECTION_ERROR)},onAuthenticated:function(){n._cseq+=1},onReceiveResponse:function(e){switch(!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):n._unregistered(e);break;default:var t=s.sipErrorCause(e.status_code);n._unregistered(e,t)}}}).send()}else u("already unregistered")}},{key:"close",value:function(){this._registered&&this.unregister()}},{key:"onTransportClosed",value:function(){this._registering=!1,null!==this._registrationTimer&&(clearTimeout(this._registrationTimer),this._registrationTimer=null),this._registered&&(this._registered=!1,this._ua.unregistered({}))}},{key:"_registrationFailure",value:function(e,t){this._registering=!1,this._ua.registrationFailed({response:e||null,cause:t}),this._registered&&(this._registered=!1,this._ua.unregistered({response:e||null,cause:t}))}},{key:"_unregistered",value:function(e,t){this._registering=!1,this._registered=!1,this._ua.unregistered({response:e||null,cause:t||null})}},{key:"registered",get:function(){return this._registered}}]),n}()},{"./Constants":36,"./RequestSender":52,"./SIPMessage":53,"./Utils":60,debug:12}],52:[function(e,t,n){var o=e("./Constants"),s=e("./DigestAuthentication"),r=e("./Transactions"),a=e("debug")("PlivoSIP:RequestSender"),l={onRequestTimeout:function(){},onTransportError:function(){},onReceiveResponse:function(){},onAuthenticated:function(){}};t.exports=function(){function i(e,t,n){for(var r in _classCallCheck(this,i),this._ua=e,this._eventHandlers=n,this._method=t.method,this._request=t,this._auth=null,this._challenged=!1,this._staled=!1,l)Object.prototype.hasOwnProperty.call(l,r)&&(this._eventHandlers[r]||(this._eventHandlers[r]=l[r]));e.status!==e.C.STATUS_USER_CLOSED||this._method===o.BYE&&this._method===o.ACK||this._eventHandlers.onTransportError()}return _createClass(i,[{key:"send",value:function(){var t=this,e={onRequestTimeout:function(){t._eventHandlers.onRequestTimeout()},onTransportError:function(){t._eventHandlers.onTransportError()},onReceiveResponse:function(e){t._receiveResponse(e)}};switch(this._method){case"INVITE":this.clientTransaction=new r.InviteClientTransaction(this._ua,this._ua.transport,this._request,e);break;case"ACK":this.clientTransaction=new r.AckClientTransaction(this._ua,this._ua.transport,this._request,e);break;default:this.clientTransaction=new r.NonInviteClientTransaction(this._ua,this._ua.transport,this._request,e)}this.clientTransaction.send()}},{key:"_receiveResponse",value:function(e){var t=void 0,n=void 0,r=e.status_code;if(401!==r&&407!==r||null===this._ua.configuration.password&&null===this._ua.configuration.ha1)this._eventHandlers.onReceiveResponse(e);else{if(401===e.status_code?(t=e.parseHeader("www-authenticate"),n="authorization"):(t=e.parseHeader("proxy-authenticate"),n="proxy-authorization"),!t)return a(e.status_code+" with wrong or missing challenge, cannot authenticate"),void this._eventHandlers.onReceiveResponse(e);if(!this._challenged||!this._staled&&!0===t.stale){if(this._auth||(this._auth=new s({username:this._ua.configuration.authorization_user,password:this._ua.configuration.password,realm:this._ua.configuration.realm,ha1:this._ua.configuration.ha1})),!this._auth.authenticate(this._request,t))return void this._eventHandlers.onReceiveResponse(e);this._challenged=!0,this._ua.set("realm",this._auth.get("realm")),this._ua.set("ha1",this._auth.get("ha1")),t.stale&&(this._staled=!0),this._request=this._request.clone(),this._request.cseq+=1,this._request.setHeader("cseq",this._request.cseq+" "+this._method),this._request.setHeader(n,this._auth.toString()),this._eventHandlers.onAuthenticated(this._request),this.send()}else this._eventHandlers.onReceiveResponse(e)}}}]),i}()},{"./Constants":36,"./DigestAuthentication":39,"./Transactions":56,debug:12}],53:[function(e,t,n){var r=e("sdp-transform"),k=e("./Constants"),R=e("./Utils"),d=e("./NameAddrHeader"),o=e("./Grammar"),s=e("debug")("PlivoSIP:SIPMessage"),i=function(){function c(e,t,n,r,i,o){if(_classCallCheck(this,c),!e||!t||!n)return null;r=r||{},this.ua=n,this.headers={},this.method=e,this.ruri=t,this.body=o,this.extraHeaders=R.cloneArray(i),r.route_set?this.setHeader("route",r.route_set):n.configuration.use_preloaded_route&&this.setHeader("route","<"+n.transport.sip_uri+";lr>"),this.setHeader("via",""),this.setHeader("max-forwards",k.MAX_FORWARDS);var s=r.to_display_name||0===r.to_display_name?'"'+r.to_display_name+'" ':"";s+="<"+(r.to_uri||t)+">",s+=r.to_tag?";tag="+r.to_tag:"",this.to=d.parse(s),this.setHeader("to",s);var a=void 0;a=r.from_display_name||0===r.from_display_name?'"'+r.from_display_name+'" ':n.configuration.display_name?'"'+n.configuration.display_name+'" ':"",a+="<"+(r.from_uri||n.configuration.uri)+">;tag=",a+=r.from_tag||R.newTag(),this.from=d.parse(a),this.setHeader("from",a);var l=r.call_id||n.configuration.plivosip_id+R.createRandomToken(15);this.call_id=l,this.setHeader("call-id",l);var u=r.cseq||Math.floor(1e4*Math.random());this.cseq=u,this.setHeader("cseq",u+" "+e)}return _createClass(c,[{key:"setHeader",value:function(e,t){for(var n=new RegExp("^\\s*"+e+"\\s*:","i"),r=0;r<this.extraHeaders.length;r++)n.test(this.extraHeaders[r])&&this.extraHeaders.splice(r,1);this.headers[R.headerize(e)]=Array.isArray(t)?t:[t]}},{key:"getHeader",value:function(e){var t=this.headers[R.headerize(e)];if(t){if(t[0])return t[0]}else{var n=new RegExp("^\\s*"+e+"\\s*:","i"),r=!0,i=!1,o=void 0;try{for(var s,a=this.extraHeaders[Symbol.iterator]();!(r=(s=a.next()).done);r=!0){var l=s.value;if(n.test(l))return l.substring(l.indexOf(":")+1).trim()}}catch(e){i=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}}}},{key:"getHeaders",value:function(e){var t=this.headers[R.headerize(e)],n=[];if(t){var r=!0,i=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done);r=!0){var l=s.value;n.push(l)}}catch(e){i=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}var u=new RegExp("^\\s*"+e+"\\s*:","i"),c=!0,d=!1,f=void 0;try{for(var h,p=this.extraHeaders[Symbol.iterator]();!(c=(h=p.next()).done);c=!0){var v=h.value;u.test(v)&&n.push(v.substring(v.indexOf(":")+1).trim())}}catch(e){d=!0,f=e}finally{try{!c&&p.return&&p.return()}finally{if(d)throw f}}return n}},{key:"hasHeader",value:function(e){if(this.headers[R.headerize(e)])return!0;var t=new RegExp("^\\s*"+e+"\\s*:","i"),n=!0,r=!1,i=void 0;try{for(var o,s=this.extraHeaders[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var a=o.value;if(t.test(a))return!0}}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}return!1}},{key:"parseSDP",value:function(e){return!e&&this.sdp||(this.sdp=r.parse(this.body||"")),this.sdp}},{key:"toString",value:function(){var e=this.method+" "+this.ruri+" SIP/2.0\r\n";for(var t in this.headers)if(Object.prototype.hasOwnProperty.call(this.headers,t)){var n=!0,r=!1,i=void 0;try{for(var o,s=this.headers[t][Symbol.iterator]();!(n=(o=s.next()).done);n=!0)e+=t+": "+o.value+"\r\n"}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}}var a=!0,l=!1,u=void 0;try{for(var c,d=this.extraHeaders[Symbol.iterator]();!(a=(c=d.next()).done);a=!0)e+=c.value.trim()+"\r\n"}catch(e){l=!0,u=e}finally{try{!a&&d.return&&d.return()}finally{if(l)throw u}}var f=[];switch(this.method){case k.REGISTER:f.push("path","gruu");break;case k.INVITE:this.ua.configuration.session_timers&&f.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&f.push("gruu"),f.push("ice","replaces");break;case k.UPDATE:this.ua.configuration.session_timers&&f.push("timer"),f.push("ice")}f.push("outbound");var h=this.ua.configuration.user_agent||"plivowebsdk 2.0.20";return e+="Allow: "+k.ALLOWED_METHODS+"\r\n",e+="Supported: "+f+"\r\n",e+="User-Agent: "+h+"\r\n",this.body?(e+="Content-Length: "+R.str_utf8_length(this.body)+"\r\n\r\n",e+=this.body):e+="Content-Length: 0\r\n\r\n",e}},{key:"clone",value:function(){var t=new c(this.method,this.ruri,this.ua);return Object.keys(this.headers).forEach(function(e){t.headers[e]=this.headers[e].slice()},this),t.body=this.body,t.extraHeaders=R.cloneArray(this.extraHeaders),t.to=this.to,t.from=this.from,t.call_id=this.call_id,t.cseq=this.cseq,t}}]),c}(),a=function(e){function s(e,t,n,r,i){_classCallCheck(this,s);var o=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,k.INVITE,e,t,n,r,i));return o.transaction=null,o}return _inherits(s,i),_createClass(s,[{key:"cancel",value:function(e){this.transaction.cancel(e)}},{key:"clone",value:function(){var t=new s(this.ruri,this.ua);return Object.keys(this.headers).forEach(function(e){t.headers[e]=this.headers[e].slice()},this),t.body=this.body,t.extraHeaders=R.cloneArray(this.extraHeaders),t.to=this.to,t.from=this.from,t.call_id=this.call_id,t.cseq=this.cseq,t.transaction=this.transaction,t}}]),s}(),l=function(){function e(){_classCallCheck(this,e),this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null,this.sdp=null}return _createClass(e,[{key:"addHeader",value:function(e,t){var n={raw:t};e=R.headerize(e),this.headers[e]?this.headers[e].push(n):this.headers[e]=[n]}},{key:"getHeader",value:function(e){var t=this.headers[R.headerize(e)];if(t)return t[0]?t[0].raw:void 0}},{key:"getHeaders",value:function(e){var t=this.headers[R.headerize(e)],n=[];if(!t)return[];var r=!0,i=!1,o=void 0;try{for(var s,a=t[Symbol.iterator]();!(r=(s=a.next()).done);r=!0){var l=s.value;n.push(l.raw)}}catch(e){i=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}},{key:"hasHeader",value:function(e){return!!this.headers[R.headerize(e)]}},{key:"parseHeader",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;if(e=R.headerize(e),this.headers[e]){if(!(t>=this.headers[e].length)){var n=this.headers[e][t],r=n.raw;if(n.parsed)return n.parsed;var i=o.parse(r,e.replace(/-/g,"_"));return-1===i?(this.headers[e].splice(t,1),void s('error parsing "'+e+'" header field with value "'+r+'"')):n.parsed=i}s('not so many "'+e+'" headers present')}else s('header "'+e+'" not present')}},{key:"s",value:function(e,t){return this.parseHeader(e,t)}},{key:"setHeader",value:function(e,t){var n={raw:t};this.headers[R.headerize(e)]=[n]}},{key:"parseSDP",value:function(e){return!e&&this.sdp||(this.sdp=r.parse(this.body||"")),this.sdp}},{key:"toString",value:function(){return this.data}}]),e}(),u=function(e){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));return t.ua=e,t.headers={},t.ruri=null,t.transport=null,t.server_transaction=null,t}return _inherits(n,l),_createClass(n,[{key:"reply",value:function(e,t,n,r,i,o){var s=[],a=this.getHeader("To");if(t=t||null,!(e=e||null)||e<100||699<e)throw new TypeError("Invalid status_code: "+e);if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason_phrase: "+t);t=t||k.REASON_PHRASE[e]||"",n=R.cloneArray(n);var l="SIP/2.0 "+e+" "+t+"\r\n";if(this.method===k.INVITE&&100<e&&e<=200){var u=this.getHeaders("record-route"),c=!0,d=!1,f=void 0;try{for(var h,p=u[Symbol.iterator]();!(c=(h=p.next()).done);c=!0)l+="Record-Route: "+h.value+"\r\n"}catch(e){d=!0,f=e}finally{try{!c&&p.return&&p.return()}finally{if(d)throw f}}}var v=this.getHeaders("via"),g=!0,m=!1,y=void 0;try{for(var _,b=v[Symbol.iterator]();!(g=(_=b.next()).done);g=!0)l+="Via: "+_.value+"\r\n"}catch(e){m=!0,y=e}finally{try{!g&&b.return&&b.return()}finally{if(m)throw y}}!this.to_tag&&100<e?a+=";tag="+R.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(a+=";tag="+this.to_tag),l+="To: "+a+"\r\n",l+="From: "+this.getHeader("From")+"\r\n",l+="Call-ID: "+this.call_id+"\r\n",l+="CSeq: "+this.cseq+" "+this.method+"\r\n";var S=!0,C=!1,T=void 0;try{for(var w,E=n[Symbol.iterator]();!(S=(w=E.next()).done);S=!0)l+=w.value.trim()+"\r\n"}catch(e){C=!0,T=e}finally{try{!S&&E.return&&E.return()}finally{if(C)throw T}}switch(this.method){case k.INVITE:this.ua.configuration.session_timers&&s.push("timer"),(this.ua.contact.pub_gruu||this.ua.contact.temp_gruu)&&s.push("gruu"),s.push("ice","replaces");break;case k.UPDATE:this.ua.configuration.session_timers&&s.push("timer"),r&&s.push("ice"),s.push("replaces")}s.push("outbound"),this.method===k.OPTIONS?(l+="Allow: "+k.ALLOWED_METHODS+"\r\n",l+="Accept: "+k.ACCEPTED_BODY_TYPES+"\r\n"):405===e?l+="Allow: "+k.ALLOWED_METHODS+"\r\n":415===e&&(l+="Accept: "+k.ACCEPTED_BODY_TYPES+"\r\n"),l+="Supported: "+s+"\r\n",r?(l+="Content-Type: application/sdp\r\n",l+="Content-Length: "+R.str_utf8_length(r)+"\r\n\r\n",l+=r):l+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(e,l,i,o)}},{key:"reply_sl",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=this.getHeaders("via");if(!e||e<100||699<e)throw new TypeError("Invalid status_code: "+e);if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason_phrase: "+t);var r="SIP/2.0 "+e+" "+(t=t||k.REASON_PHRASE[e]||"")+"\r\n",i=!0,o=!1,s=void 0;try{for(var a,l=n[Symbol.iterator]();!(i=(a=l.next()).done);i=!0)r+="Via: "+a.value+"\r\n"}catch(e){o=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw s}}var u=this.getHeader("To");!this.to_tag&&100<e?u+=";tag="+R.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(u+=";tag="+this.to_tag),r+="To: "+u+"\r\n",r+="From: "+this.getHeader("From")+"\r\n",r+="Call-ID: "+this.call_id+"\r\n",r+="CSeq: "+this.cseq+" "+this.method+"\r\n",r+="Content-Length: 0\r\n\r\n",this.transport.send(r)}}]),n}(),c=function(e){function t(){_classCallCheck(this,t);var e=_possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.headers={},e.status_code=null,e.reason_phrase=null,e}return _inherits(t,l),t}();t.exports={OutgoingRequest:i,InitialOutgoingInviteRequest:a,IncomingRequest:u,IncomingResponse:c}},{"./Constants":36,"./Grammar":41,"./NameAddrHeader":44,"./Utils":60,debug:12,"sdp-transform":17}],54:[function(e,t,n){var r=e("./Utils"),i=e("./Grammar"),o=e("debug")("PlivoSIP:ERROR:Socket");o.log=console.warn.bind(console),n.isSocket=function(t){if(Array.isArray(t))return!1;if(void 0===t)return o("undefined JsSIP.Socket instance"),!1;try{if(!r.isString(t.url))throw o("missing or invalid JsSIP.Socket url property"),new Error;if(!r.isString(t.via_transport))throw o("missing or invalid JsSIP.Socket via_transport property"),new Error;if(-1===i.parse(t.sip_uri,"SIP_URI"))throw o("missing or invalid JsSIP.Socket sip_uri property"),new Error}catch(e){return!1}try{["connect","disconnect","send"].forEach(function(e){if(!r.isFunction(t[e]))throw o("missing or invalid JsSIP.Socket method: "+e),new Error})}catch(e){return!1}return!0}},{"./Grammar":41,"./Utils":60,debug:12}],55:[function(e,t,n){var r={T1:500,T2:4e3,T4:5e3,TIMER_B:32e3,TIMER_D:0,TIMER_F:32e3,TIMER_H:32e3,TIMER_I:0,TIMER_J:0,TIMER_K:0,TIMER_L:32e3,TIMER_M:32e3,PROVISIONAL_RESPONSE_INTERVAL:6e4};t.exports=r},{}],56:[function(e,t,n){var r=e("events").EventEmitter,i=e("./Constants"),o=e("./SIPMessage"),a=e("./Timers"),l=e("debug")("PlivoSIP:NonInviteClientTransaction"),u=e("debug")("PlivoSIP:InviteClientTransaction"),c=e("debug")("PlivoSIP:AckClientTransaction"),s=e("debug")("PlivoSIP:NonInviteServerTransaction"),d=e("debug")("PlivoSIP:InviteServerTransaction"),f={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7,NON_INVITE_CLIENT:"nict",NON_INVITE_SERVER:"nist",INVITE_CLIENT:"ict",INVITE_SERVER:"ist"},h=function(e){function s(e,t,n,r){_classCallCheck(this,s);var i=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));i.type=f.NON_INVITE_CLIENT,i.id="z9hG4bK"+Math.floor(1e7*Math.random()),i.ua=e,i.transport=t,i.request=n,i.eventHandlers=r;var o="SIP/2.0/"+t.via_transport;return o+=" "+e.configuration.via_host+";branch="+i.id,i.request.setHeader("via",o),i.ua.newTransaction(i),i}return _inherits(s,r),_createClass(s,[{key:"stateChanged",value:function(e){this.state=e,this.emit("stateChanged")}},{key:"send",value:function(){var e=this;this.stateChanged(f.STATUS_TRYING),this.F=setTimeout(function(){e.timer_F()},a.TIMER_F),this.transport.send(this.request)||this.onTransportError()}},{key:"onTransportError",value:function(){l("transport error occurred, deleting transaction "+this.id),clearTimeout(this.F),clearTimeout(this.K),this.stateChanged(f.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onTransportError()}},{key:"timer_F",value:function(){l("Timer F expired for transaction "+this.id),this.stateChanged(f.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onRequestTimeout()}},{key:"timer_K",value:function(){this.stateChanged(f.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"receiveResponse",value:function(e){var t=this,n=e.status_code;if(n<200)switch(this.state){case f.STATUS_TRYING:case f.STATUS_PROCEEDING:this.stateChanged(f.STATUS_PROCEEDING),this.eventHandlers.onReceiveResponse(e)}else switch(this.state){case f.STATUS_TRYING:case f.STATUS_PROCEEDING:this.stateChanged(f.STATUS_COMPLETED),clearTimeout(this.F),408===n?this.eventHandlers.onRequestTimeout():this.eventHandlers.onReceiveResponse(e),this.K=setTimeout(function(){t.timer_K()},a.TIMER_K)}}},{key:"C",get:function(){return f}}]),s}(),p=function(e){function s(e,t,n,r){_classCallCheck(this,s);var i=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));i.type=f.INVITE_CLIENT,i.id="z9hG4bK"+Math.floor(1e7*Math.random()),i.ua=e,i.transport=t,i.request=n,i.eventHandlers=r,n.transaction=i;var o="SIP/2.0/"+t.via_transport;return o+=" "+e.configuration.via_host+";branch="+i.id,i.request.setHeader("via",o),i.ua.newTransaction(i),i}return _inherits(s,r),_createClass(s,[{key:"stateChanged",value:function(e){this.state=e,this.emit("stateChanged")}},{key:"send",value:function(){var e=this;this.stateChanged(f.STATUS_CALLING),this.B=setTimeout(function(){e.timer_B()},a.TIMER_B),this.transport.send(this.request)||this.onTransportError()}},{key:"onTransportError",value:function(){clearTimeout(this.B),clearTimeout(this.D),clearTimeout(this.M),this.state!==f.STATUS_ACCEPTED&&(u("transport error occurred, deleting transaction "+this.id),this.eventHandlers.onTransportError()),this.stateChanged(f.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"timer_M",value:function(){u("Timer M expired for transaction "+this.id),this.state===f.STATUS_ACCEPTED&&(clearTimeout(this.B),this.stateChanged(f.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"timer_B",value:function(){u("Timer B expired for transaction "+this.id),this.state===f.STATUS_CALLING&&(this.stateChanged(f.STATUS_TERMINATED),this.ua.destroyTransaction(this),this.eventHandlers.onRequestTimeout())}},{key:"timer_D",value:function(){u("Timer D expired for transaction "+this.id),clearTimeout(this.B),this.stateChanged(f.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"sendACK",value:function(e){var t=this,n=new o.OutgoingRequest(i.ACK,this.request.ruri,this.ua,{route_set:this.request.getHeader("route"),call_id:this.request.getHeader("call-id"),cseq:this.request.cseq});n.setHeader("from",this.request.getHeader("from")),n.setHeader("via",this.request.getHeader("via")),n.setHeader("to",e.getHeader("to")),this.D=setTimeout(function(){t.timer_D()},a.TIMER_D),this.transport.send(n)}},{key:"cancel",value:function(e){if(this.state===f.STATUS_PROCEEDING){var t=new o.OutgoingRequest(i.CANCEL,this.request.ruri,this.ua,{route_set:this.request.getHeader("route"),call_id:this.request.getHeader("call-id"),cseq:this.request.cseq});t.setHeader("from",this.request.getHeader("from")),t.setHeader("via",this.request.getHeader("via")),t.setHeader("to",this.request.getHeader("to")),e&&t.setHeader("reason",e),this.transport.send(t)}}},{key:"receiveResponse",value:function(e){var t=this,n=e.status_code;if(100<=n&&n<=199)switch(this.state){case f.STATUS_CALLING:this.stateChanged(f.STATUS_PROCEEDING),this.eventHandlers.onReceiveResponse(e);break;case f.STATUS_PROCEEDING:this.eventHandlers.onReceiveResponse(e)}else if(200<=n&&n<=299)switch(this.state){case f.STATUS_CALLING:case f.STATUS_PROCEEDING:this.stateChanged(f.STATUS_ACCEPTED),this.M=setTimeout(function(){t.timer_M()},a.TIMER_M),this.eventHandlers.onReceiveResponse(e);break;case f.STATUS_ACCEPTED:this.eventHandlers.onReceiveResponse(e)}else if(300<=n&&n<=699)switch(this.state){case f.STATUS_CALLING:case f.STATUS_PROCEEDING:this.stateChanged(f.STATUS_COMPLETED),this.sendACK(e),this.eventHandlers.onReceiveResponse(e);break;case f.STATUS_COMPLETED:this.sendACK(e)}}},{key:"C",get:function(){return f}}]),s}(),v=function(e){function s(e,t,n,r){_classCallCheck(this,s);var i=_possibleConstructorReturn(this,(s.__proto__||Object.getPrototypeOf(s)).call(this));i.id="z9hG4bK"+Math.floor(1e7*Math.random()),i.transport=t,i.request=n,i.eventHandlers=r;var o="SIP/2.0/"+t.via_transport;return o+=" "+e.configuration.via_host+";branch="+i.id,i.request.setHeader("via",o),i}return _inherits(s,r),_createClass(s,[{key:"send",value:function(){this.transport.send(this.request)||this.onTransportError()}},{key:"onTransportError",value:function(){c("transport error occurred for transaction "+this.id),this.eventHandlers.onTransportError()}},{key:"C",get:function(){return f}}]),s}(),g=function(e){function i(e,t,n){_classCallCheck(this,i);var r=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return r.type=f.NON_INVITE_SERVER,r.id=n.via_branch,r.ua=e,r.transport=t,r.request=n,r.last_response="",(n.server_transaction=r).state=f.STATUS_TRYING,e.newTransaction(r),r}return _inherits(i,r),_createClass(i,[{key:"stateChanged",value:function(e){this.state=e,this.emit("stateChanged")}},{key:"timer_J",value:function(){s("Timer J expired for transaction "+this.id),this.stateChanged(f.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"onTransportError",value:function(){this.transportError||(this.transportError=!0,s("transport error occurred, deleting transaction "+this.id),clearTimeout(this.J),this.stateChanged(f.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"receiveResponse",value:function(e,t,n,r){var i=this;if(100===e)switch(this.state){case f.STATUS_TRYING:this.stateChanged(f.STATUS_PROCEEDING),this.transport.send(t)||this.onTransportError();break;case f.STATUS_PROCEEDING:this.last_response=t,this.transport.send(t)?n&&n():(this.onTransportError(),r&&r())}else if(200<=e&&e<=699)switch(this.state){case f.STATUS_TRYING:case f.STATUS_PROCEEDING:this.stateChanged(f.STATUS_COMPLETED),this.last_response=t,this.J=setTimeout(function(){i.timer_J()},a.TIMER_J),this.transport.send(t)?n&&n():(this.onTransportError(),r&&r())}}},{key:"C",get:function(){return f}}]),i}(),m=function(e){function i(e,t,n){_classCallCheck(this,i);var r=_possibleConstructorReturn(this,(i.__proto__||Object.getPrototypeOf(i)).call(this));return r.type=f.INVITE_SERVER,r.id=n.via_branch,r.ua=e,r.transport=t,r.request=n,r.last_response="",(n.server_transaction=r).state=f.STATUS_PROCEEDING,e.newTransaction(r),r.resendProvisionalTimer=null,n.reply(100),r}return _inherits(i,r),_createClass(i,[{key:"stateChanged",value:function(e){this.state=e,this.emit("stateChanged")}},{key:"timer_H",value:function(){d("Timer H expired for transaction "+this.id),this.state===f.STATUS_COMPLETED&&d("ACK not received, dialog will be terminated"),this.stateChanged(f.STATUS_TERMINATED),this.ua.destroyTransaction(this)}},{key:"timer_I",value:function(){this.stateChanged(f.STATUS_TERMINATED)}},{key:"timer_L",value:function(){d("Timer L expired for transaction "+this.id),this.state===f.STATUS_ACCEPTED&&(this.stateChanged(f.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"onTransportError",value:function(){this.transportError||(this.transportError=!0,d("transport error occurred, deleting transaction "+this.id),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),clearTimeout(this.L),clearTimeout(this.H),clearTimeout(this.I),this.stateChanged(f.STATUS_TERMINATED),this.ua.destroyTransaction(this))}},{key:"resend_provisional",value:function(){this.transport.send(this.last_response)||this.onTransportError()}},{key:"receiveResponse",value:function(e,t,n,r){var i=this;if(100<=e&&e<=199)switch(this.state){case f.STATUS_PROCEEDING:this.transport.send(t)||this.onTransportError(),this.last_response=t}if(100<e&&e<=199&&this.state===f.STATUS_PROCEEDING)null===this.resendProvisionalTimer&&(this.resendProvisionalTimer=setInterval(function(){i.resend_provisional()},a.PROVISIONAL_RESPONSE_INTERVAL));else if(200<=e&&e<=299)switch(this.state){case f.STATUS_PROCEEDING:this.stateChanged(f.STATUS_ACCEPTED),this.last_response=t,this.L=setTimeout(function(){i.timer_L()},a.TIMER_L),null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null);case f.STATUS_ACCEPTED:this.transport.send(t)?n&&n():(this.onTransportError(),r&&r())}else if(300<=e&&e<=699)switch(this.state){case f.STATUS_PROCEEDING:null!==this.resendProvisionalTimer&&(clearInterval(this.resendProvisionalTimer),this.resendProvisionalTimer=null),this.transport.send(t)?(this.stateChanged(f.STATUS_COMPLETED),this.H=setTimeout(function(){i.timer_H()},a.TIMER_H),n&&n()):(this.onTransportError(),r&&r())}}},{key:"C",get:function(){return f}}]),i}();t.exports={C:f,NonInviteClientTransaction:h,InviteClientTransaction:p,AckClientTransaction:v,NonInviteServerTransaction:g,InviteServerTransaction:m,checkTransaction:function(e,t){var n=e._transactions,r=void 0;switch(t.method){case i.INVITE:if(r=n.ist[t.via_branch]){switch(r.state){case f.STATUS_PROCEEDING:r.transport.send(r.last_response)}return!0}break;case i.ACK:if(!(r=n.ist[t.via_branch]))return!1;if(r.state===f.STATUS_ACCEPTED)return!1;if(r.state===f.STATUS_COMPLETED)return r.state=f.STATUS_CONFIRMED,r.I=setTimeout(function(){r.timer_I()},a.TIMER_I),!0;break;case i.CANCEL:return(r=n.ist[t.via_branch])?(t.reply_sl(200),r.state!==f.STATUS_PROCEEDING):(t.reply_sl(481),!0);default:if(r=n.nist[t.via_branch]){switch(r.state){case f.STATUS_TRYING:break;case f.STATUS_PROCEEDING:case f.STATUS_COMPLETED:r.transport.send(r.last_response)}return!0}}}}},{"./Constants":36,"./SIPMessage":53,"./Timers":55,debug:12,events:11}],57:[function(e,t,n){var r=e("./Socket"),i=e("debug")("PlivoSIP:Transport"),o=e("debug")("PlivoSIP:ERROR:Transport");o.log=console.warn.bind(console);var s={STATUS_CONNECTED:0,STATUS_CONNECTING:1,STATUS_DISCONNECTED:2,SOCKET_STATUS_READY:0,SOCKET_STATUS_ERROR:1,recovery_options:{min_interval:2,max_interval:30}};t.exports=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:s.recovery_options;if(_classCallCheck(this,n),i("new()"),this.status=s.STATUS_DISCONNECTED,this.socket=null,this.sockets=[],this.recovery_options=t,this.recover_attempts=0,this.recovery_timer=null,this.close_requested=!1,void 0===e)throw new TypeError("Invalid argument. undefined 'sockets' argument");e instanceof Array||(e=[e]),e.forEach(function(e){if(!r.isSocket(e.socket))throw new TypeError("Invalid argument. invalid 'JsSIP.Socket' instance");if(e.weight&&!Number(e.weight))throw new TypeError("Invalid argument. 'weight' attribute is not a number");this.sockets.push({socket:e.socket,weight:e.weight||0,status:s.SOCKET_STATUS_READY})},this),this._getSocket()}return _createClass(n,[{key:"connect",value:function(){i("connect()"),this.isConnected()?i("Transport is already connected"):this.isConnecting()?i("Transport is connecting"):(this.close_requested=!1,this.status=s.STATUS_CONNECTING,this.onconnecting({socket:this.socket,attempts:this.recover_attempts}),this.close_requested||(this.socket.onconnect=this._onConnect.bind(this),this.socket.ondisconnect=this._onDisconnect.bind(this),this.socket.ondata=this._onData.bind(this),this.socket.connect()))}},{key:"disconnect",value:function(){i("close()"),this.close_requested=!0,this.recover_attempts=0,this.status=s.STATUS_DISCONNECTED,null!==this.recovery_timer&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.socket.onconnect=function(){},this.socket.ondisconnect=function(){},this.socket.ondata=function(){},this.socket.disconnect(),this.ondisconnect({socket:this.socket,error:!1})}},{key:"send",value:function(e){if(i("send()"),!this.isConnected())return o("unable to send message, transport is not connected"),!1;var t=e.toString();return i("sending message:\n\n"+t+"\n"),this.socket.send(t)}},{key:"isConnected",value:function(){return this.status===s.STATUS_CONNECTED}},{key:"isConnecting",value:function(){return this.status===s.STATUS_CONNECTING}},{key:"_reconnect",value:function(){var e=this;this.recover_attempts+=1;var t=Math.floor(Math.random()*Math.pow(2,this.recover_attempts)+1);t<this.recovery_options.min_interval?t=this.recovery_options.min_interval:t>this.recovery_options.max_interval&&(t=this.recovery_options.max_interval),i("reconnection attempt: "+this.recover_attempts+". next connection attempt in "+t+" seconds"),this.recovery_timer=setTimeout(function(){e.close_requested||e.isConnected()||e.isConnecting()||(e._getSocket(),e.connect())},1e3*t)}},{key:"_getSocket",value:function(){var t=[];if(this.sockets.forEach(function(e){e.status!==s.SOCKET_STATUS_ERROR&&(0===t.length?t.push(e):e.weight>t[0].weight?t=[e]:e.weight===t[0].weight&&t.push(e))}),0===t.length)return this.sockets.forEach(function(e){e.status=s.SOCKET_STATUS_READY}),void this._getSocket();var e=Math.floor(Math.random()*t.length);this.socket=t[e].socket}},{key:"_onConnect",value:function(){this.recover_attempts=0,this.status=s.STATUS_CONNECTED,null!==this.recovery_timer&&(clearTimeout(this.recovery_timer),this.recovery_timer=null),this.onconnect({socket:this})}},{key:"_onDisconnect",value:function(e,t,n){this.status=s.STATUS_DISCONNECTED,this.ondisconnect({socket:this.socket,error:e,code:t,reason:n}),this.close_requested||(this.sockets.forEach(function(e){this.socket===e.socket&&(e.status=s.SOCKET_STATUS_ERROR)},this),this._reconnect(e))}},{key:"_onData",value:function(e){if("\r\n"!==e){if("string"!=typeof e){try{e=String.fromCharCode.apply(null,new Uint8Array(e))}catch(e){return void i("received binary message failed to be converted into string, message discarded")}i("received binary message:\n\n"+e+"\n")}else i("received text message:\n\n"+e+"\n");this.ondata({transport:this,message:e})}else i("received message with CRLF Keep Alive response")}},{key:"via_transport",get:function(){return this.socket.via_transport}},{key:"url",get:function(){return this.socket.url}},{key:"sip_uri",get:function(){return this.socket.sip_uri}}]),n}()},{"./Socket":54,debug:12}],58:[function(e,t,n){var r=e("events").EventEmitter,s=e("./Constants"),i=e("./Registrator"),o=e("./RTCSession"),a=e("./Message"),l=e("./Transactions"),u=e("./Transport"),c=e("./Utils"),d=e("./Exceptions"),f=e("./URI"),h=e("./Grammar"),p=e("./Parser"),v=e("./SIPMessage"),g=e("./sanityCheck"),m=e("./Config"),y=e("debug")("PlivoSIP:UA"),_=e("debug")("PlivoSIP:ERROR:UA");_.log=console.warn.bind(console);var b={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2};t.exports=function(e){function n(e){_classCallCheck(this,n);var t=_possibleConstructorReturn(this,(n.__proto__||Object.getPrototypeOf(n)).call(this));if(t._cache={credentials:{}},t._configuration=Object.assign({},m.settings),t._dynConfiguration={},t._dialogs={},t._applicants={},t._sessions={},t._transport=null,t._contact=null,t._status=b.STATUS_INIT,t._error=null,t._transactions={nist:{},nict:{},ist:{},ict:{}},t._data={},t._closeTimer=null,void 0===e)throw new TypeError("Not enough arguments");try{t._loadConfig(e)}catch(e){throw t._status=b.STATUS_NOT_READY,t._error=b.CONFIGURATION_ERROR,e}return t._registrator=new i(t),t}return _inherits(n,r),_createClass(n,null,[{key:"C",get:function(){return b}}]),_createClass(n,[{key:"start",value:function(){y("start()"),this._status===b.STATUS_INIT?this._transport.connect():this._status===b.STATUS_USER_CLOSED?(y("restarting UA"),null!==this._closeTimer&&(clearTimeout(this._closeTimer),this._closeTimer=null,this._transport.disconnect()),this._status=b.STATUS_INIT,this._transport.connect()):this._status===b.STATUS_READY?y("UA is in READY status, not restarted"):y("ERROR: connection is down, Auto-Recovery system is trying to reconnect"),this._dynConfiguration.register=this._configuration.register}},{key:"register",value:function(){y("register()"),this._dynConfiguration.register=!0,this._registrator.register()}},{key:"unregister",value:function(e){y("unregister()"),this._dynConfiguration.register=!1,this._registrator.unregister(e)}},{key:"registrator",value:function(){return this._registrator}},{key:"isRegistered",value:function(){return this._registrator.registered}},{key:"isConnected",value:function(){return this._transport.isConnected()}},{key:"call",value:function(e,t){y("call()");var n=new o(this);return n.connect(e,t),n}},{key:"sendMessage",value:function(e,t,n){y("sendMessage()");var r=new a(this);return r.send(e,t,n),r}},{key:"terminateSessions",value:function(e){for(var t in y("terminateSessions()"),this._sessions)this._sessions[t].isEnded()||this._sessions[t].terminate(e)}},{key:"stop",value:function(){var e=this;if(y("stop()"),this._dynConfiguration={},this._status!==b.STATUS_USER_CLOSED){this._registrator.close();var t=Object.keys(this._sessions).length;for(var n in this._sessions)if(Object.prototype.hasOwnProperty.call(this._sessions,n)){y("closing session "+n);try{this._sessions[n].terminate()}catch(e){}}for(var r in this._applicants)if(Object.prototype.hasOwnProperty.call(this._applicants,r))try{this._applicants[r].close()}catch(e){}this._status=b.STATUS_USER_CLOSED,0===Object.keys(this._transactions.nict).length+Object.keys(this._transactions.nist).length+Object.keys(this._transactions.ict).length+Object.keys(this._transactions.ist).length&&0===t?this._transport.disconnect():this._closeTimer=setTimeout(function(){e._closeTimer=null,e._transport.disconnect()},2e3)}else y("UA already closed")}},{key:"normalizeTarget",value:function(e){return c.normalizeTarget(e,this._configuration.hostport_params)}},{key:"get",value:function(e){switch(e){case"realm":return this._configuration.realm;case"ha1":return this._configuration.ha1;default:return void _('get() | cannot get "%s" parameter in runtime',e)}}},{key:"set",value:function(e,t){switch(e){case"password":this._configuration.password=String(t);break;case"realm":this._configuration.realm=String(t);break;case"ha1":this._configuration.ha1=String(t),this._configuration.password=null;break;case"display_name":if(-1===h.parse('"'+t+'"',"display_name"))return _('set() | wrong "display_name"'),!1;this._configuration.display_name=t;break;default:return _('set() | cannot set "%s" parameter in runtime',e),!1}return!0}},{key:"newTransaction",value:function(e){this._transactions[e.type][e.id]=e,this.emit("newTransaction",{transaction:e})}},{key:"destroyTransaction",value:function(e){delete this._transactions[e.type][e.id],this.emit("transactionDestroyed",{transaction:e})}},{key:"newDialog",value:function(e){this._dialogs[e.id]=e}},{key:"destroyDialog",value:function(e){delete this._dialogs[e.id]}},{key:"newMessage",value:function(e,t){this._applicants[e]=e,this.emit("newMessage",t)}},{key:"destroyMessage",value:function(e){delete this._applicants[e]}},{key:"newRTCSession",value:function(e,t){this._sessions[e.id]=e,this.emit("newRTCSession",t)}},{key:"destroyRTCSession",value:function(e){delete this._sessions[e.id]}},{key:"registered",value:function(e){this.emit("registered",e)}},{key:"unregistered",value:function(e){this.emit("unregistered",e)}},{key:"registrationFailed",value:function(e){this.emit("registrationFailed",e)}},{key:"receiveRequest",value:function(e){var t=e.method;if(e.ruri.user!==this._configuration.uri.user&&e.ruri.user!==this._contact.uri.user)return y("Request-URI does not point to us"),void(e.method!==s.ACK&&e.reply_sl(404));if(e.ruri.scheme!==s.SIPS){if(!l.checkTransaction(this,e)){if(t===s.INVITE?new l.InviteServerTransaction(this,this._transport,e):t!==s.ACK&&t!==s.CANCEL&&new l.NonInviteServerTransaction(this,this._transport,e),t===s.OPTIONS)e.reply(200);else if(t===s.MESSAGE){if(0===this.listeners("newMessage").length)return void e.reply(405);new a(this).init_incoming(e)}else if(t===s.INVITE&&!e.to_tag&&0===this.listeners("newRTCSession").length)return void e.reply(405);var n=void 0,r=void 0;if(e.to_tag)(n=this._findDialog(e.call_id,e.from_tag,e.to_tag))?n.receiveRequest(e):t===s.NOTIFY?(r=this._findSession(e))?r.receiveRequest(e):(y("received NOTIFY request for a non existent subscription"),e.reply(481,"Subscription does not exist")):t!==s.ACK&&e.reply(481);else switch(t){case s.INVITE:if(window.RTCPeerConnection)if(e.hasHeader("replaces")){var i=e.replaces;(n=this._findDialog(i.call_id,i.from_tag,i.to_tag))?(r=n.owner).isEnded()?e.reply(603):r.receiveRequest(e):e.reply(481)}else(r=new o(this)).init_incoming(e);else _("INVITE received but WebRTC is not supported"),e.reply(488);break;case s.BYE:e.reply(481);break;case s.CANCEL:(r=this._findSession(e))?r.receiveRequest(e):y("received CANCEL request for a non existent session");break;case s.ACK:break;default:e.reply(405)}}}else e.reply_sl(416)}},{key:"_findSession",value:function(e){var t=e.call_id,n=e.from_tag,r=e.to_tag,i=t+n,o=this._sessions[i],s=t+r,a=this._sessions[s];return o||a||null}},{key:"_findDialog",value:function(e,t,n){var r=e+t+n,i=this._dialogs[r];return i||(r=e+n+t,(i=this._dialogs[r])||null)}},{key:"_loadConfig",value:function(e){try{m.load(this._configuration,e)}catch(e){throw e}0===this._configuration.display_name&&(this._configuration.display_name="0"),this._configuration.instance_id||(this._configuration.instance_id=c.newUUID()),this._configuration.plivosip_id=c.createRandomToken(5);var t=this._configuration.uri.clone();t.user=null,this._configuration.hostport_params=t.toString().replace(/^sip:/i,"");try{this._transport=new u(this._configuration.sockets,{max_interval:this._configuration.connection_recovery_max_interval,min_interval:this._configuration.connection_recovery_min_interval}),this._transport.onconnecting=function(e){this.emit("connecting",e)}.bind(this),this._transport.onconnect=function(e){this._status!==b.STATUS_USER_CLOSED&&(this._status=b.STATUS_READY,this._error=null,this.emit("connected",e),this._dynConfiguration.register&&this._registrator.register())}.bind(this),this._transport.ondisconnect=function(e){var t=!0,n=!1,r=void 0;try{for(var i,o=["nict","ict","nist","ist"][Symbol.iterator]();!(t=(i=o.next()).done);t=!0){var s=i.value;for(var a in this._transactions[s])Object.prototype.hasOwnProperty.call(this._transactions[s],a)&&this._transactions[s][a].onTransportError()}}catch(e){n=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(n)throw r}}this.emit("disconnected",e),this._registrator.onTransportClosed(),this._status!==b.STATUS_USER_CLOSED&&(this._status=b.STATUS_NOT_READY,this._error=b.NETWORK_ERROR)}.bind(this),this._transport.ondata=function(e){var t=e.transport,n=e.message;if((n=p.parseMessage(n,this))&&!(this._status===b.STATUS_USER_CLOSED&&n instanceof v.IncomingRequest)&&g(n,this,t))if(n instanceof v.IncomingRequest)n.transport=t,this.receiveRequest(n);else if(n instanceof v.IncomingResponse){var r=void 0;switch(n.method){case s.INVITE:(r=this._transactions.ict[n.via_branch])&&r.receiveResponse(n);break;case s.ACK:break;default:(r=this._transactions.nict[n.via_branch])&&r.receiveResponse(n)}}}.bind(this)}catch(e){throw _(e),new d.ConfigurationError("sockets",this._configuration.sockets)}if(delete this._configuration.sockets,this._configuration.authorization_user||(this._configuration.authorization_user=this._configuration.uri.user),!this._configuration.registrar_server){var n=this._configuration.uri.clone();n.user=null,n.clearParams(),n.clearHeaders(),this._configuration.registrar_server=n}this._configuration.no_answer_timeout*=1e3,this._configuration.contact_uri?this._configuration.via_host=this._configuration.contact_uri.host:this._configuration.contact_uri=new f("sip",c.createRandomToken(8),this._configuration.via_host,null,{transport:"ws"}),this._contact={pub_gruu:null,temp_gruu:null,uri:this._configuration.contact_uri,toString:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.anonymous||null,n=e.outbound||null,r="<";return r+=t?this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":this.pub_gruu||this.uri.toString(),!n||(t?this.temp_gruu:this.pub_gruu)||(r+=";ob"),r+=">"}};var r=["password","realm","ha1","display_name","register"];for(var i in this._configuration)Object.prototype.hasOwnProperty.call(this._configuration,i)&&(-1!==r.indexOf(i)?Object.defineProperty(this._configuration,i,{writable:!0,configurable:!1}):Object.defineProperty(this._configuration,i,{writable:!1,configurable:!1}));for(var o in this._configuration)if(Object.prototype.hasOwnProperty.call(m.settings,o))switch(o){case"uri":case"registrar_server":break;case"password":case"ha1":y("- "+o+": NOT SHOWN")}}},{key:"C",get:function(){return b}},{key:"status",get:function(){return this._status}},{key:"contact",get:function(){return this._contact}},{key:"configuration",get:function(){return this._configuration}},{key:"transport",get:function(){return this._transport}}]),n}()},{"./Config":35,"./Constants":36,"./Exceptions":40,"./Grammar":41,"./Message":43,"./Parser":45,"./RTCSession":46,"./Registrator":51,"./SIPMessage":53,"./Transactions":56,"./Transport":57,"./URI":59,"./Utils":60,"./sanityCheck":62,debug:12,events:11}],59:[function(e,t,n){var u=e("./Constants"),c=e("./Utils"),r=e("./Grammar");t.exports=function(){function l(e,t,n,r){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{},o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:{};if(_classCallCheck(this,l),!n)throw new TypeError('missing or invalid "host" parameter');for(var s in this._parameters={},this._headers={},this._scheme=e||u.SIP,this._user=t,this._host=n,this._port=r,i)Object.prototype.hasOwnProperty.call(i,s)&&this.setParam(s,i[s]);for(var a in o)Object.prototype.hasOwnProperty.call(o,a)&&this.setHeader(a,o[a])}return _createClass(l,null,[{key:"parse",value:function(e){return-1!==(e=r.parse(e,"SIP_URI"))?e:void 0}}]),_createClass(l,[{key:"setParam",value:function(e,t){e&&(this._parameters[e.toLowerCase()]=null==t?null:t.toString())}},{key:"getParam",value:function(e){if(e)return this._parameters[e.toLowerCase()]}},{key:"hasParam",value:function(e){if(e)return!!this._parameters.hasOwnProperty(e.toLowerCase())}},{key:"deleteParam",value:function(e){if(e=e.toLowerCase(),this._parameters.hasOwnProperty(e)){var t=this._parameters[e];return delete this._parameters[e],t}}},{key:"clearParams",value:function(){this._parameters={}}},{key:"setHeader",value:function(e,t){this._headers[c.headerize(e)]=Array.isArray(t)?t:[t]}},{key:"getHeader",value:function(e){if(e)return this._headers[c.headerize(e)]}},{key:"hasHeader",value:function(e){if(e)return!!this._headers.hasOwnProperty(c.headerize(e))}},{key:"deleteHeader",value:function(e){if(e=c.headerize(e),this._headers.hasOwnProperty(e)){var t=this._headers[e];return delete this._headers[e],t}}},{key:"clearHeaders",value:function(){this._headers={}}},{key:"clone",value:function(){return new l(this._scheme,this._user,this._host,this._port,JSON.parse(JSON.stringify(this._parameters)),JSON.parse(JSON.stringify(this._headers)))}},{key:"toString",value:function(){var e=[],t=this._scheme+":";for(var n in this._user&&(t+=c.escapeUser(this._user)+"@"),t+=this._host,(this._port||0===this._port)&&(t+=":"+this._port),this._parameters)Object.prototype.hasOwnProperty.call(this._parameters,n)&&(t+=";"+n,null!==this._parameters[n]&&(t+="="+this._parameters[n]));for(var r in this._headers)if(Object.prototype.hasOwnProperty.call(this._headers,r)){var i=!0,o=!1,s=void 0;try{for(var a,l=this._headers[r][Symbol.iterator]();!(i=(a=l.next()).done);i=!0){var u=a.value;e.push(r+"="+u)}}catch(e){o=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw s}}}return 0<e.length&&(t+="?"+e.join("&")),t}},{key:"toAor",value:function(e){var t=this._scheme+":";return this._user&&(t+=c.escapeUser(this._user)+"@"),t+=this._host,e&&(this._port||0===this._port)&&(t+=":"+this._port),t}},{key:"scheme",get:function(){return this._scheme},set:function(e){this._scheme=e.toLowerCase()}},{key:"user",get:function(){return this._user},set:function(e){this._user=e}},{key:"host",get:function(){return this._host},set:function(e){this._host=e.toLowerCase()}},{key:"port",get:function(){return this._port},set:function(e){this._port=0===e?e:parseInt(e,10)||null}}]),l}()},{"./Constants":36,"./Grammar":41,"./Utils":60}],60:[function(e,t,n){var s=e("./Constants"),a=e("./URI"),r=e("./Grammar");n.str_utf8_length=function(e){return unescape(encodeURIComponent(e)).length};var c=n.isFunction=function(e){return void 0!==e&&"[object Function]"===Object.prototype.toString.call(e)};n.isString=function(e){return void 0!==e&&"[object String]"===Object.prototype.toString.call(e)},n.isDecimal=function(e){return!isNaN(e)&&parseFloat(e)===parseInt(e,10)},n.isEmpty=function(e){return null===e||""===e||void 0===e||Array.isArray(e)&&0===e.length||"number"==typeof e&&isNaN(e)},n.hasMethods=function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=!0,o=!1,s=void 0;try{for(var a,l=n[Symbol.iterator]();!(i=(a=l.next()).done);i=!0){var u=a.value;if(c(e[u]))return!1}}catch(e){o=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw s}}return!0};var i=n.createRandomToken=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:32,n=void 0,r="";for(n=0;n<e;n++)r+=(Math.random()*t|0).toString(t);return r};n.newTag=function(){return i(10)},n.newUUID=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},n.hostType=function(e){if(e)return-1!==(e=r.parse(e,"host"))?e.host_type:void 0};var l=n.escapeUser=function(e){return encodeURIComponent(decodeURIComponent(e)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")};n.normalizeTarget=function(e,t){if(e){if(e instanceof a)return e;if("string"==typeof e){var n,r=e.split("@"),i=void 0,o=void 0;switch(r.length){case 1:if(!t)return;i=e,o=t;break;case 2:i=r[0],o=r[1];break;default:i=r.slice(0,r.length-1).join("@"),o=r[r.length-1]}return i=i.replace(/^(sips?|tel):/i,""),/^[-.()]*\+?[0-9\-.()]+$/.test(i)&&(i=i.replace(/[-.()]/g,"")),e=s.SIP+":"+l(i)+"@"+o,(n=a.parse(e))?n:void 0}}},n.headerize=function(e){var t={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},n=e.toLowerCase().replace(/_/g,"-").split("-"),r="",i=n.length,o=void 0;for(o=0;o<i;o++)0!==o&&(r+="-"),r+=n[o].charAt(0).toUpperCase()+n[o].substring(1);return t[r]&&(r=t[r]),r},n.sipErrorCause=function(e){for(var t in s.SIP_ERROR_CAUSES)if(-1!==s.SIP_ERROR_CAUSES[t].indexOf(e))return s.causes[t];return s.causes.SIP_FAILURE_CODE},n.getRandomTestNetIP=function(){return"192.0.2."+(e=1,t=254,Math.floor(Math.random()*(t-e+1)+e));var e,t},n.calculateMD5=function(e){function l(e,t){return e<<t|e>>>32-t}function u(e,t){var n=2147483648&e,r=2147483648&t,i=1073741824&e,o=1073741824&t,s=(1073741823&e)+(1073741823&t);return i&o?2147483648^s^n^r:i|o?1073741824&s?3221225472^s^n^r:1073741824^s^n^r:s^n^r}function t(e,t,n,r,i,o,s){var a;return u(l(e=u(e,u(u((a=t)&n|~a&r,i),s)),o),t)}function n(e,t,n,r,i,o,s){var a;return u(l(e=u(e,u(u(t&(a=r)|n&~a,i),s)),o),t)}function r(e,t,n,r,i,o,s){return u(l(e=u(e,u(u(t^n^r,i),s)),o),t)}function i(e,t,n,r,i,o,s){return u(l(e=u(e,u(u(n^(t|~r),i),s)),o),t)}function o(e){var t="",n="",r=void 0;for(r=0;r<=3;r++)t+=(n="0"+(e>>>8*r&255).toString(16)).substr(n.length-2,2);return t}var s,a=void 0,c=void 0,d=void 0,f=void 0,h=void 0,p=void 0,v=void 0,g=void 0,m=void 0;for(s=function(e){for(var t=void 0,n=e.length,r=n+8,i=16*((r-r%64)/64+1),o=new Array(i-1),s=0,a=0;a<n;)s=a%4*8,o[t=(a-a%4)/4]=o[t]|e.charCodeAt(a)<<s,a++;return s=a%4*8,o[t=(a-a%4)/4]=o[t]|128<<s,o[i-2]=n<<3,o[i-1]=n>>>29,o}(e=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):(127<r&&r<2048?t+=String.fromCharCode(r>>6|192):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128)),t+=String.fromCharCode(63&r|128))}return t}(e)),p=1732584193,v=4023233417,g=2562383102,m=271733878,a=0;a<s.length;a+=16)v=i(v=i(v=i(v=i(v=r(v=r(v=r(v=r(v=n(v=n(v=n(v=n(v=t(v=t(v=t(v=t(d=v,g=t(f=g,m=t(h=m,p=t(c=p,v,g,m,s[a+0],7,3614090360),v,g,s[a+1],12,3905402710),p,v,s[a+2],17,606105819),m,p,s[a+3],22,3250441966),g=t(g,m=t(m,p=t(p,v,g,m,s[a+4],7,4118548399),v,g,s[a+5],12,1200080426),p,v,s[a+6],17,2821735955),m,p,s[a+7],22,4249261313),g=t(g,m=t(m,p=t(p,v,g,m,s[a+8],7,1770035416),v,g,s[a+9],12,2336552879),p,v,s[a+10],17,4294925233),m,p,s[a+11],22,2304563134),g=t(g,m=t(m,p=t(p,v,g,m,s[a+12],7,1804603682),v,g,s[a+13],12,4254626195),p,v,s[a+14],17,2792965006),m,p,s[a+15],22,1236535329),g=n(g,m=n(m,p=n(p,v,g,m,s[a+1],5,4129170786),v,g,s[a+6],9,3225465664),p,v,s[a+11],14,643717713),m,p,s[a+0],20,3921069994),g=n(g,m=n(m,p=n(p,v,g,m,s[a+5],5,3593408605),v,g,s[a+10],9,38016083),p,v,s[a+15],14,3634488961),m,p,s[a+4],20,3889429448),g=n(g,m=n(m,p=n(p,v,g,m,s[a+9],5,568446438),v,g,s[a+14],9,3275163606),p,v,s[a+3],14,4107603335),m,p,s[a+8],20,1163531501),g=n(g,m=n(m,p=n(p,v,g,m,s[a+13],5,2850285829),v,g,s[a+2],9,4243563512),p,v,s[a+7],14,1735328473),m,p,s[a+12],20,2368359562),g=r(g,m=r(m,p=r(p,v,g,m,s[a+5],4,4294588738),v,g,s[a+8],11,2272392833),p,v,s[a+11],16,1839030562),m,p,s[a+14],23,4259657740),g=r(g,m=r(m,p=r(p,v,g,m,s[a+1],4,2763975236),v,g,s[a+4],11,1272893353),p,v,s[a+7],16,4139469664),m,p,s[a+10],23,3200236656),g=r(g,m=r(m,p=r(p,v,g,m,s[a+13],4,681279174),v,g,s[a+0],11,3936430074),p,v,s[a+3],16,3572445317),m,p,s[a+6],23,76029189),g=r(g,m=r(m,p=r(p,v,g,m,s[a+9],4,3654602809),v,g,s[a+12],11,3873151461),p,v,s[a+15],16,530742520),m,p,s[a+2],23,3299628645),g=i(g,m=i(m,p=i(p,v,g,m,s[a+0],6,4096336452),v,g,s[a+7],10,1126891415),p,v,s[a+14],15,2878612391),m,p,s[a+5],21,4237533241),g=i(g,m=i(m,p=i(p,v,g,m,s[a+12],6,1700485571),v,g,s[a+3],10,2399980690),p,v,s[a+10],15,4293915773),m,p,s[a+1],21,2240044497),g=i(g,m=i(m,p=i(p,v,g,m,s[a+8],6,1873313359),v,g,s[a+15],10,4264355552),p,v,s[a+6],15,2734768916),m,p,s[a+13],21,1309151649),g=i(g,m=i(m,p=i(p,v,g,m,s[a+4],6,4149444226),v,g,s[a+11],10,3174756917),p,v,s[a+2],15,718787259),m,p,s[a+9],21,3951481745),p=u(p,c),v=u(v,d),g=u(g,f),m=u(m,h);return(o(p)+o(v)+o(g)+o(m)).toLowerCase()},n.closeMediaStream=function(t){if(t)try{var e=void 0;if(t.getTracks){e=t.getTracks();var n=!0,r=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0)o.value.stop()}catch(e){r=!0,i=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw i}}}else{e=t.getAudioTracks();var a=!0,l=!1,u=void 0;try{for(var c,d=e[Symbol.iterator]();!(a=(c=d.next()).done);a=!0)c.value.stop()}catch(e){l=!0,u=e}finally{try{!a&&d.return&&d.return()}finally{if(l)throw u}}e=t.getVideoTracks();var f=!0,h=!1,p=void 0;try{for(var v,g=e[Symbol.iterator]();!(f=(v=g.next()).done);f=!0)v.value.stop()}catch(e){h=!0,p=e}finally{try{!f&&g.return&&g.return()}finally{if(h)throw p}}}}catch(e){"function"!=typeof t.stop&&"object"!==_typeof(t.stop)||t.stop()}},n.cloneArray=function(e){return e&&e.slice()||[]}},{"./Constants":36,"./Grammar":41,"./URI":59}],61:[function(e,t,n){var r=e("./Grammar"),o=e("debug")("PlivoSIP:WebSocketInterface"),i=e("debug")("PlivoSIP:ERROR:WebSocketInterface");i.log=console.warn.bind(console),t.exports=function(){function n(e){_classCallCheck(this,n),o('new() [url:"%s"]',e),this._url=e,this._sip_uri=null,this._via_transport=null,this._ws=null;var t=r.parse(e,"absoluteURI");if(-1===t)throw i("invalid WebSocket URI: "+e),new TypeError("Invalid argument: "+e);if("wss"!==t.scheme&&"ws"!==t.scheme)throw i("invalid WebSocket URI scheme: "+t.scheme),new TypeError("Invalid argument: "+e);this._sip_uri="sip:"+t.host+(t.port?":"+t.port:"")+";transport=ws",this._via_transport=t.scheme.toUpperCase()}return _createClass(n,[{key:"connect",value:function(){if(o("connect()"),this.isConnected())o("WebSocket "+this._url+" is already connected");else if(this.isConnecting())o("WebSocket "+this._url+" is connecting");else{this._ws&&this.disconnect(),o("connecting to WebSocket "+this._url);try{this._ws=new WebSocket(this._url,"sip"),this._ws.binaryType="arraybuffer",this._ws.onopen=this._onOpen.bind(this),this._ws.onclose=this._onClose.bind(this),this._ws.onmessage=this._onMessage.bind(this),this._ws.onerror=this._onError.bind(this)}catch(e){this._onError(e)}}}},{key:"disconnect",value:function(){o("disconnect()"),this._ws&&(this._ws.onopen=function(){},this._ws.onclose=function(){},this._ws.onmessage=function(){},this._ws.onerror=function(){},this._ws.close(),this._ws=null)}},{key:"send",value:function(e){return o("send()"),this.isConnected()?(this._ws.send(e),!0):(i("unable to send message, WebSocket is not open"),!1)}},{key:"isConnected",value:function(){return this._ws&&this._ws.readyState===this._ws.OPEN}},{key:"isConnecting",value:function(){return this._ws&&this._ws.readyState===this._ws.CONNECTING}},{key:"_onOpen",value:function(){o("WebSocket "+this._url+" connected"),this.onconnect()}},{key:"_onClose",value:function(e){var t=e.wasClean,n=e.code,r=e.reason;o("WebSocket "+this._url+" closed"),!1===t&&o("WebSocket abrupt disconnection");var i={socket:this,error:!t,code:n,reason:r};this.ondisconnect(i)}},{key:"_onMessage",value:function(e){var t=e.data;o("received WebSocket message"),this.ondata(t)}},{key:"_onError",value:function(e){i("WebSocket "+this._url+" error: "+e)}},{key:"via_transport",get:function(){return this._via_transport},set:function(e){this._via_transport=e.toUpperCase()}},{key:"sip_uri",get:function(){return this._sip_uri}},{key:"url",get:function(){return this._url}}]),n}()},{"./Grammar":41,debug:12}],62:[function(e,t,n){var u=e("./Constants"),y=e("./SIPMessage"),c=e("./Utils"),s=e("debug")("PlivoSIP:sanityCheck"),_=[function(){var e=!0,t=!1,n=void 0;try{for(var r,i=["from","to","call_id","cseq","via"][Symbol.iterator]();!(e=(r=i.next()).done);e=!0){var o=r.value;if(!C.hasHeader(o))return s("missing mandatory header field : "+o+", dropping the response"),!1}}catch(e){t=!0,n=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}}],b=[function(){if("sip"!==C.s("to").uri.scheme)return a(416),!1},function(){if(!C.to_tag&&C.call_id.substr(0,5)===T.configuration.plivosip_id)return a(482),!1},function(){var e=c.str_utf8_length(C.body),t=C.getHeader("content-length");if(e<t)return a(400),!1},function(){var e=C.from_tag,t=C.call_id,n=C.cseq,r=void 0;if(!C.to_tag)if(C.method===u.INVITE){if(T._transactions.ist[C.via_branch])return!1;for(var i in T._transactions.ist)if(Object.prototype.hasOwnProperty.call(T._transactions.ist,i)&&(r=T._transactions.ist[i]).request.from_tag===e&&r.request.call_id===t&&r.request.cseq===n)return a(482),!1}else{if(T._transactions.nist[C.via_branch])return!1;for(var o in T._transactions.nist)if(Object.prototype.hasOwnProperty.call(T._transactions.nist,o)&&(r=T._transactions.nist[o]).request.from_tag===e&&r.request.call_id===t&&r.request.cseq===n)return a(482),!1}}],S=[function(){if(1<C.getHeaders("via").length)return s("more than one Via header field present in the response, dropping the response"),!1},function(){var e=c.str_utf8_length(C.body),t=C.getHeader("content-length");if(e<t)return s("message body length is lower than the value in Content-Length header field, dropping the response"),!1}],C=void 0,T=void 0,w=void 0;function a(e){var t=C.getHeaders("via"),n=void 0,r="SIP/2.0 "+e+" "+u.REASON_PHRASE[e]+"\r\n",i=!0,o=!1,s=void 0;try{for(var a,l=t[Symbol.iterator]();!(i=(a=l.next()).done);i=!0)r+="Via: "+a.value+"\r\n"}catch(e){o=!0,s=e}finally{try{!i&&l.return&&l.return()}finally{if(o)throw s}}n=C.getHeader("To"),C.to_tag||(n+=";tag="+c.newTag()),r+="To: "+n+"\r\n",r+="From: "+C.getHeader("From")+"\r\n",r+="Call-ID: "+C.call_id+"\r\n",r+="CSeq: "+C.cseq+" "+C.method+"\r\n",r+="\r\n",w.send(r)}t.exports=function(e,t,n){C=e,T=t,w=n;var r=!0,i=!1,o=void 0;try{for(var s,a=_[Symbol.iterator]();!(r=(s=a.next()).done);r=!0)if(!1===(0,s.value)())return!1}catch(e){i=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}if(C instanceof y.IncomingRequest){var l=!0,u=!1,c=void 0;try{for(var d,f=b[Symbol.iterator]();!(l=(d=f.next()).done);l=!0)if(!1===(0,d.value)())return!1}catch(e){u=!0,c=e}finally{try{!l&&f.return&&f.return()}finally{if(u)throw c}}}else if(C instanceof y.IncomingResponse){var h=!0,p=!1,v=void 0;try{for(var g,m=S[Symbol.iterator]();!(h=(g=m.next()).done);h=!0)if(!1===(0,g.value)())return!1}catch(e){p=!0,v=e}finally{try{!h&&m.return&&m.return()}finally{if(p)throw v}}}return!0}},{"./Constants":36,"./SIPMessage":53,"./Utils":60,debug:12}]},{},[2])(2);!function o(s,a,l){function u(t,e){if(!a[t]){if(!s[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(c)return c(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var i=a[t]={exports:{}};s[t][0].call(i.exports,function(e){return u(s[t][1][e]||e)},i,i.exports,o,s,a,l)}return a[t].exports}for(var c="function"==typeof require&&require,e=0;e<l.length;e++)u(l[e]);return u}({1:[function(e,n,r){(function($,E){!function(e){if("object"==(void 0===r?"undefined":_typeof(r))&&void 0!==n)n.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:void 0!==E?t=E:"undefined"!=typeof self&&(t=self),t.Promise=e()}}(function(){return function o(s,a,l){function u(t,e){if(!a[t]){if(!s[t]){var n="function"==typeof _dereq_&&_dereq_;if(!e&&n)return n(t,!0);if(c)return c(t,!0);var r=new Error("Cannot find module '"+t+"'");throw r.code="MODULE_NOT_FOUND",r}var i=a[t]={exports:{}};s[t][0].call(i.exports,function(e){return u(s[t][1][e]||e)},i,i.exports,o,s,a,l)}return a[t].exports}for(var c="function"==typeof _dereq_&&_dereq_,e=0;e<l.length;e++)u(l[e]);return u}({1:[function(e,t,n){t.exports=function(e){function t(e){var t=new r(e),n=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),n}var r=e._SomePromiseArray;e.any=function(e){return t(e)},e.prototype.any=function(){return t(this)}}},{}],2:[function(e,t,n){function r(){this._customScheduler=!1,this._isTickUsed=!1,this._lateQueue=new u(16),this._normalQueue=new u(16),this._haveDrainedQueues=!1,this._trampolineEnabled=!0;var e=this;this.drainQueues=function(){e._drainQueues()},this._schedule=l}function i(e,t,n){this._lateQueue.push(e,t,n),this._queueTick()}function o(e,t,n){this._normalQueue.push(e,t,n),this._queueTick()}function s(e){this._normalQueue._pushOne(e),this._queueTick()}var a;try{throw new Error}catch(e){a=e}var l=e("./schedule"),u=e("./queue"),c=e("./util");r.prototype.setScheduler=function(e){var t=this._schedule;return this._schedule=e,this._customScheduler=!0,t},r.prototype.hasCustomScheduler=function(){return this._customScheduler},r.prototype.enableTrampoline=function(){this._trampolineEnabled=!0},r.prototype.disableTrampolineIfNecessary=function(){c.hasDevTools&&(this._trampolineEnabled=!1)},r.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues},r.prototype.fatalError=function(e,t){t?($.stderr.write("Fatal "+(e instanceof Error?e.stack:e)+"\n"),$.exit(2)):this.throwLater(e)},r.prototype.throwLater=function(e,t){if(1===arguments.length&&(t=e,e=function(){throw t}),"undefined"!=typeof setTimeout)setTimeout(function(){e(t)},0);else try{this._schedule(function(){e(t)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}},c.hasDevTools?(r.prototype.invokeLater=function(e,t,n){this._trampolineEnabled?i.call(this,e,t,n):this._schedule(function(){setTimeout(function(){e.call(t,n)},100)})},r.prototype.invoke=function(e,t,n){this._trampolineEnabled?o.call(this,e,t,n):this._schedule(function(){e.call(t,n)})},r.prototype.settlePromises=function(e){this._trampolineEnabled?s.call(this,e):this._schedule(function(){e._settlePromises()})}):(r.prototype.invokeLater=i,r.prototype.invoke=o,r.prototype.settlePromises=s),r.prototype._drainQueue=function(e){for(;0<e.length();){var t=e.shift();if("function"==typeof t){var n=e.shift(),r=e.shift();t.call(n,r)}else t._settlePromises()}},r.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._haveDrainedQueues=!0,this._drainQueue(this._lateQueue)},r.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},r.prototype._reset=function(){this._isTickUsed=!1},t.exports=r,t.exports.firstLineError=a},{"./queue":26,"./schedule":29,"./util":36}],3:[function(e,t,n){t.exports=function(o,s,a,l){var u=!1,n=function(e,t){this._reject(t)},c=function(e,t){t.promiseRejectionQueued=!0,t.bindingPromise._then(n,n,null,this,e)},d=function(e,t){0==(50397184&this._bitField)&&this._resolveCallback(t.target)},f=function(e,t){t.promiseRejectionQueued||this._reject(e)};o.prototype.bind=function(e){u||(u=!0,o.prototype._propagateFrom=l.propagateFromFunction(),o.prototype._boundValue=l.boundValueFunction());var t=a(e),n=new o(s);n._propagateFrom(this,1);var r=this._target();if(n._setBoundTo(t),t instanceof o){var i={promiseRejectionQueued:!1,promise:n,target:r,bindingPromise:t};r._then(s,c,void 0,n,i),t._then(d,f,void 0,n,i),n._setOnCancel(t)}else n._resolveCallback(r);return n},o.prototype._setBoundTo=function(e){void 0!==e?(this._bitField=2097152|this._bitField,this._boundTo=e):this._bitField=-2097153&this._bitField},o.prototype._isBound=function(){return 2097152==(2097152&this._bitField)},o.bind=function(e,t){return o.resolve(t).bind(e)}}},{}],4:[function(e,t,n){var r;"undefined"!=typeof Promise&&(r=Promise);var i=e("./promise")();i.noConflict=function(){try{Promise===i&&(Promise=r)}catch(e){}return i},t.exports=i},{"./promise":22}],5:[function(e,t,n){var r=Object.create;if(r){var i=r(null),o=r(null);i[" size"]=o[" size"]=0}t.exports=function(i){function n(e){return function(e,t){var n;if(null!=e&&(n=e[t]),"function"!=typeof n){var r="Object "+s.classString(e)+" has no method '"+s.toString(t)+"'";throw new i.TypeError(r)}return n}(e,this.pop()).apply(e,this)}function r(e){return e[this]}function o(e){var t=+this;return t<0&&(t=Math.max(0,t+e.length)),e[t]}var s=e("./util"),a=s.canEvaluate;s.isIdentifier,i.prototype.call=function(e){var t=[].slice.call(arguments,1);return t.push(e),this._then(n,void 0,void 0,t,void 0)},i.prototype.get=function(e){var t;if("number"==typeof e)t=o;else if(a){var n=(void 0)(e);t=null!==n?n:r}else t=r;return this._then(t,void 0,void 0,e,void 0)}}},{"./util":36}],6:[function(l,e,t){e.exports=function(e,t,n,r){var i=l("./util"),o=i.tryCatch,s=i.errorObj,a=e._async;e.prototype.break=e.prototype.cancel=function(){if(!r.cancellation())return this._warn("cancellation is disabled");for(var e=this,t=e;e._isCancellable();){if(!e._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}var n=e._cancellationParent;if(null==n||!n._isCancellable()){e._isFollowing()?e._followee().cancel():e._cancelBranched();break}e._isFollowing()&&e._followee().cancel(),e._setWillBeCancelled(),t=e,e=n}},e.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--},e.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0},e.prototype._cancelBy=function(e){return e===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),!!this._enoughBranchesHaveCancelled()&&(this._invokeOnCancel(),!0))},e.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()},e.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),a.invoke(this._cancelPromises,this,void 0))},e.prototype._cancelPromises=function(){0<this._length()&&this._settlePromises()},e.prototype._unsetOnCancel=function(){this._onCancelField=void 0},e.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()},e.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()},e.prototype._doInvokeOnCancel=function(e,t){if(i.isArray(e))for(var n=0;n<e.length;++n)this._doInvokeOnCancel(e[n],t);else if(void 0!==e)if("function"==typeof e){if(!t){var r=o(e).call(this._boundValue());r===s&&(this._attachExtraTrace(r.e),a.throwLater(r.e))}}else e._resultCancelled(this)},e.prototype._invokeOnCancel=function(){var e=this._onCancel();this._unsetOnCancel(),a.invoke(this._doInvokeOnCancel,this,e)},e.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())},e.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(e,t,n){t.exports=function(d){var f=e("./util"),h=e("./es5").keys,p=f.tryCatch,v=f.errorObj;return function(l,u,c){return function(e){var t=c._boundValue();e:for(var n=0;n<l.length;++n){var r=l[n];if(r===Error||null!=r&&r.prototype instanceof Error){if(e instanceof r)return p(u).call(t,e)}else if("function"==typeof r){var i=p(r).call(t,e);if(i===v)return i;if(i)return p(u).call(t,e)}else if(f.isObject(e)){for(var o=h(r),s=0;s<o.length;++s){var a=o[s];if(r[a]!=e[a])continue e}return p(u).call(t,e)}}return d}}}},{"./es5":13,"./util":36}],8:[function(e,t,n){t.exports=function(o){function s(){this._trace=new s.CapturedTrace(a())}function a(){var e=n.length-1;if(0<=e)return n[e]}var l=!1,n=[];return o.prototype._promiseCreated=function(){},o.prototype._pushContext=function(){},o.prototype._popContext=function(){return null},o._peekContext=o.prototype._peekContext=function(){},s.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,n.push(this._trace))},s.prototype._popContext=function(){if(void 0!==this._trace){var e=n.pop(),t=e._promiseCreated;return e._promiseCreated=null,t}return null},s.CapturedTrace=null,s.create=function(){if(l)return new s},s.deactivateLongStackTraces=function(){},s.activateLongStackTraces=function(){var e=o.prototype._pushContext,t=o.prototype._popContext,n=o._peekContext,r=o.prototype._peekContext,i=o.prototype._promiseCreated;s.deactivateLongStackTraces=function(){o.prototype._pushContext=e,o.prototype._popContext=t,o._peekContext=n,o.prototype._peekContext=r,o.prototype._promiseCreated=i,l=!1},l=!0,o.prototype._pushContext=s.prototype._pushContext,o.prototype._popContext=s.prototype._popContext,o._peekContext=o.prototype._peekContext=a,o.prototype._promiseCreated=function(){var e=this._peekContext();e&&null==e._promiseCreated&&(e._promiseCreated=this)}},s}},{}],9:[function(X,e,t){e.exports=function(s,n){function e(e,t){return{promise:t}}function r(){return!1}function i(e,t,n){var r=this;try{e(t,n,function(e){if("function"!=typeof e)throw new TypeError("onCancel must be a function, got: "+I.toString(e));r._attachCancellationCallback(e)})}catch(e){return e}}function o(e){if(!this._isCancellable())return this;var t=this._onCancel();void 0!==t?I.isArray(t)?t.push(e):this._setOnCancel([t,e]):this._setOnCancel(e)}function a(){return this._onCancelField}function l(e){this._onCancelField=e}function u(){this._cancellationParent=void 0,this._onCancelField=void 0}function c(e,t){if(0!=(1&t)){var n=(this._cancellationParent=e)._branchesRemainingToCancel;void 0===n&&(n=0),e._branchesRemainingToCancel=n+1}0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)}function t(){var e=this._boundTo;return void 0!==e&&e instanceof s?e.isFulfilled()?e.value():void 0:e}function d(){this._trace=new S(this._peekContext())}function f(e,t){if(P(e)){var n=this._trace;if(void 0!==n&&t&&(n=n._parent),void 0!==n)n.attachExtraTrace(e);else if(!e.__stackCleaned__){var r=v(e);I.notEnumerableProp(e,"stack",r.message+"\n"+r.stack.join("\n")),I.notEnumerableProp(e,"__stackCleaned__",!0)}}}function h(e,t,n){if(J.warnings){var r,i=new R(e);if(t)n._attachExtraTrace(i);else if(J.longStackTraces&&(r=s._peekContext()))r.attachExtraTrace(i);else{var o=v(i);i.stack=o.message+"\n"+o.stack.join("\n")}W("warning",i)||g(i,"",!0)}}function p(e){for(var t=[],n=0;n<e.length;++n){var r=e[n],i="    (No stack trace)"===r||D.test(r),o=i&&z(r);i&&!o&&(N&&" "!==r.charAt(0)&&(r="    "+r),t.push(r))}return t}function v(e){var t=e.stack,n=e.toString();return t="string"==typeof t&&0<t.length?function(e){for(var t=e.stack.replace(/\s+$/g,"").split("\n"),n=0;n<t.length;++n){var r=t[n];if("    (No stack trace)"===r||D.test(r))break}return 0<n&&"SyntaxError"!=e.name&&(t=t.slice(n)),t}(e):["    (No stack trace)"],{message:n,stack:"SyntaxError"==e.name?t:p(t)}}function g(e,t,n){if("undefined"!=typeof console){var r;if(I.isObject(e)){var i=e.stack;r=t+x(i,e)}else r=t+String(e);"function"==typeof w?w(r,n):"function"!=typeof console.log&&"object"!=_typeof(console.log)||console.log(r)}}function m(e,t,n,r){var i=!1;try{"function"==typeof t&&(i=!0,"rejectionHandled"===e?t(r):t(n,r))}catch(e){k.throwLater(e)}"unhandledRejection"===e?W(e,n,r)||i||g(n,"Unhandled rejection "):W(e,r)}function y(e){var t,n;if("function"==typeof e)t="[function "+(e.name||"anonymous")+"]";else{if(t=e&&"function"==typeof e.toString?e.toString():I.toString(e),/\[object [a-zA-Z0-9$_]+\]/.test(t))try{t=JSON.stringify(e)}catch(e){}0===t.length&&(t="(empty array)")}return"(<"+((n=t).length<41?n:n.substr(0,38)+"...")+">, no stack trace)"}function _(){return"function"==typeof Q}function b(e){var t=e.match(K);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function S(e){this._parent=e,this._promisesCreated=0;var t=this._length=1+(void 0===e?0:e._length);Q(this,S),32<t&&this.uncycle()}var C,T,w,E=s._getDomain,k=s._async,R=X("./errors").Warning,I=X("./util"),P=I.canAttachTrace,A=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,O=/\((?:timers\.js):\d+:\d+\)/,M=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,D=null,x=null,N=!1,F=!(0==I.env("BLUEBIRD_DEBUG")),U=!(0==I.env("BLUEBIRD_WARNINGS")||!F&&!I.env("BLUEBIRD_WARNINGS")),j=!(0==I.env("BLUEBIRD_LONG_STACK_TRACES")||!F&&!I.env("BLUEBIRD_LONG_STACK_TRACES")),L=0!=I.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(U||!!I.env("BLUEBIRD_W_FORGOTTEN_RETURN"));s.prototype.suppressUnhandledRejections=function(){var e=this._target();e._bitField=-1048577&e._bitField|524288},s.prototype._ensurePossibleRejectionHandled=function(){if(0==(524288&this._bitField)){this._setRejectionIsUnhandled();var e=this;setTimeout(function(){e._notifyUnhandledRejection()},1)}},s.prototype._notifyUnhandledRejectionIsHandled=function(){m("rejectionHandled",C,void 0,this)},s.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField},s.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)},s.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var e=this._settledValue();this._setUnhandledRejectionIsNotified(),m("unhandledRejection",T,e,this)}},s.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField},s.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField},s.prototype._isUnhandledRejectionNotified=function(){return 0<(262144&this._bitField)},s.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField},s.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},s.prototype._isRejectionUnhandled=function(){return 0<(1048576&this._bitField)},s.prototype._warn=function(e,t,n){return h(e,t,n||this)},s.onPossiblyUnhandledRejection=function(e){var t=E();T="function"==typeof e?null===t?e:I.domainBind(t,e):void 0},s.onUnhandledRejectionHandled=function(e){var t=E();C="function"==typeof e?null===t?e:I.domainBind(t,e):void 0};var H=function(){};s.longStackTraces=function(){if(k.haveItemsQueued()&&!J.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!J.longStackTraces&&_()){var e=s.prototype._captureStackTrace,t=s.prototype._attachExtraTrace;J.longStackTraces=!0,H=function(){if(k.haveItemsQueued()&&!J.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");s.prototype._captureStackTrace=e,s.prototype._attachExtraTrace=t,n.deactivateLongStackTraces(),k.enableTrampoline(),J.longStackTraces=!1},s.prototype._captureStackTrace=d,s.prototype._attachExtraTrace=f,n.activateLongStackTraces(),k.disableTrampolineIfNecessary()}},s.hasLongStackTraces=function(){return J.longStackTraces&&_()};var B=function(){try{if("function"==typeof CustomEvent){var e=new CustomEvent("CustomEvent");return I.global.dispatchEvent(e),function(e,t){var n=new CustomEvent(e.toLowerCase(),{detail:t,cancelable:!0});return!I.global.dispatchEvent(n)}}if("function"==typeof Event){e=new Event("CustomEvent");return I.global.dispatchEvent(e),function(e,t){var n=new Event(e.toLowerCase(),{cancelable:!0});return n.detail=t,!I.global.dispatchEvent(n)}}return(e=document.createEvent("CustomEvent")).initCustomEvent("testingtheevent",!1,!0,{}),I.global.dispatchEvent(e),function(e,t){var n=document.createEvent("CustomEvent");return n.initCustomEvent(e.toLowerCase(),!1,!0,t),!I.global.dispatchEvent(n)}}catch(e){}return function(){return!1}}(),q=I.isNode?function(){return $.emit.apply($,arguments)}:I.global?function(e){var t="on"+e.toLowerCase(),n=I.global[t];return!!n&&(n.apply(I.global,[].slice.call(arguments,1)),!0)}:function(){return!1},G={promiseCreated:e,promiseFulfilled:e,promiseRejected:e,promiseResolved:e,promiseCancelled:e,promiseChained:function(e,t,n){return{promise:t,child:n}},warning:function(e,t){return{warning:t}},unhandledRejection:function(e,t,n){return{reason:t,promise:n}},rejectionHandled:e},W=function(e){var t=!1;try{t=q.apply(null,arguments)}catch(e){k.throwLater(e),t=!0}var n=!1;try{n=B(e,G[e].apply(null,arguments))}catch(e){k.throwLater(e),n=!0}return n||t};s.config=function(e){if("longStackTraces"in(e=Object(e))&&(e.longStackTraces?s.longStackTraces():!e.longStackTraces&&s.hasLongStackTraces()&&H()),"warnings"in e){var t=e.warnings;J.warnings=!!t,L=J.warnings,I.isObject(t)&&"wForgottenReturn"in t&&(L=!!t.wForgottenReturn)}if("cancellation"in e&&e.cancellation&&!J.cancellation){if(k.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");s.prototype._clearCancellationData=u,s.prototype._propagateFrom=c,s.prototype._onCancel=a,s.prototype._setOnCancel=l,s.prototype._attachCancellationCallback=o,s.prototype._execute=i,V=c,J.cancellation=!0}return"monitoring"in e&&(e.monitoring&&!J.monitoring?(J.monitoring=!0,s.prototype._fireEvent=W):!e.monitoring&&J.monitoring&&(J.monitoring=!1,s.prototype._fireEvent=r)),s},s.prototype._fireEvent=r,s.prototype._execute=function(e,t,n){try{e(t,n)}catch(e){return e}},s.prototype._onCancel=function(){},s.prototype._setOnCancel=function(e){},s.prototype._attachCancellationCallback=function(e){},s.prototype._captureStackTrace=function(){},s.prototype._attachExtraTrace=function(){},s.prototype._clearCancellationData=function(){},s.prototype._propagateFrom=function(e,t){};var V=function(e,t){0!=(2&t)&&e._isBound()&&this._setBoundTo(e._boundTo)},z=function(){return!1},K=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;I.inherits(S,Error),(n.CapturedTrace=S).prototype.uncycle=function(){var e=this._length;if(!(e<2)){for(var t=[],n={},r=0,i=this;void 0!==i;++r)t.push(i),i=i._parent;for(r=(e=this._length=r)-1;0<=r;--r){var o=t[r].stack;void 0===n[o]&&(n[o]=r)}for(r=0;r<e;++r){var s=n[t[r].stack];if(void 0!==s&&s!==r){0<s&&(t[s-1]._parent=void 0,t[s-1]._length=1),t[r]._parent=void 0,t[r]._length=1;var a=0<r?t[r-1]:this;s<e-1?(a._parent=t[s+1],a._parent.uncycle(),a._length=a._parent._length+1):(a._parent=void 0,a._length=1);for(var l=a._length+1,u=r-2;0<=u;--u)t[u]._length=l,l++;return}}}},S.prototype.attachExtraTrace=function(e){if(!e.__stackCleaned__){this.uncycle();for(var t=v(e),n=t.message,r=[t.stack],i=this;void 0!==i;)r.push(p(i.stack.split("\n"))),i=i._parent;(function(e){for(var t=e[0],n=1;n<e.length;++n){for(var r=e[n],i=t.length-1,o=t[i],s=-1,a=r.length-1;0<=a;--a)if(r[a]===o){s=a;break}for(a=s;0<=a;--a){var l=r[a];if(t[i]!==l)break;t.pop(),i--}t=r}})(r),function(e){for(var t=0;t<e.length;++t)(0===e[t].length||t+1<e.length&&e[t][0]===e[t+1][0])&&(e.splice(t,1),t--)}(r),I.notEnumerableProp(e,"stack",function(e,t){for(var n=0;n<t.length-1;++n)t[n].push("From previous event:"),t[n]=t[n].join("\n");return n<t.length&&(t[n]=t[n].join("\n")),e+"\n"+t.join("\n")}(n,r)),I.notEnumerableProp(e,"__stackCleaned__",!0)}};var Q=function(){var e=/^\s*at\s*/,t=function(e,t){return"string"==typeof e?e:void 0!==t.name&&void 0!==t.message?t.toString():y(t)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit+=6,D=e,x=t;var n=Error.captureStackTrace;return z=function(e){return A.test(e)},function(e,t){Error.stackTraceLimit+=6,n(e,t),Error.stackTraceLimit-=6}}var r,i=new Error;if("string"==typeof i.stack&&0<=i.stack.split("\n")[0].indexOf("stackDetection@"))return D=/@/,x=t,N=!0,function(e){e.stack=(new Error).stack};try{throw new Error}catch(e){r="stack"in e}return"stack"in i||!r||"number"!=typeof Error.stackTraceLimit?(x=function(e,t){return"string"==typeof e?e:"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t||void 0===t.name||void 0===t.message?y(t):t.toString()},null):(D=e,x=t,function(t){Error.stackTraceLimit+=6;try{throw new Error}catch(e){t.stack=e.stack}Error.stackTraceLimit-=6})}();"undefined"!=typeof console&&void 0!==console.warn&&(w=function(e){console.warn(e)},I.isNode&&$.stderr.isTTY?w=function(e,t){var n=t?"[33m":"[31m";console.warn(n+e+"[0m\n")}:I.isNode||"string"!=typeof(new Error).stack||(w=function(e,t){console.warn("%c"+e,t?"color: darkorange":"color: red")}));var J={warnings:U,longStackTraces:!1,cancellation:!1,monitoring:!1};return j&&s.longStackTraces(),{longStackTraces:function(){return J.longStackTraces},warnings:function(){return J.warnings},cancellation:function(){return J.cancellation},monitoring:function(){return J.monitoring},propagateFromFunction:function(){return V},boundValueFunction:function(){return t},checkForgottenReturns:function(e,t,n,r,i){if(void 0===e&&null!==t&&L){if(void 0!==i&&i._returnedNonUndefined())return;if(0==(65535&r._bitField))return;n&&(n+=" ");var o="",s="";if(t._trace){for(var a=t._trace.stack.split("\n"),l=p(a),u=l.length-1;0<=u;--u){var c=l[u];if(!O.test(c)){var d=c.match(M);d&&(o="at "+d[1]+":"+d[2]+":"+d[3]+" ");break}}if(0<l.length){var f=l[0];for(u=0;u<a.length;++u)if(a[u]===f){0<u&&(s="\n"+a[u-1]);break}}}var h="a promise was created in a "+n+"handler "+o+"but was not returned from it, see http://goo.gl/rRqMUw"+s;r._warn(h,!0,t)}},setBounds:function(e,t){if(_()){for(var n,r,i=e.stack.split("\n"),o=t.stack.split("\n"),s=-1,a=-1,l=0;l<i.length;++l)if(u=b(i[l])){n=u.fileName,s=u.line;break}for(l=0;l<o.length;++l){var u;if(u=b(o[l])){r=u.fileName,a=u.line;break}}s<0||a<0||!n||!r||n!==r||a<=s||(z=function(e){if(A.test(e))return!0;var t=b(e);return!!(t&&t.fileName===n&&s<=t.line&&t.line<=a)})}},warn:h,deprecated:function(e,t){var n=e+" is deprecated and will be removed in a future version.";return t&&(n+=" Use "+t+" instead."),h(n)},CapturedTrace:S,fireDomEvent:B,fireGlobalEvent:q}}},{"./errors":12,"./util":36}],10:[function(e,t,n){t.exports=function(n){function r(){return this.value}function i(){throw this.reason}n.prototype.return=n.prototype.thenReturn=function(e){return e instanceof n&&e.suppressUnhandledRejections(),this._then(r,void 0,void 0,{value:e},void 0)},n.prototype.throw=n.prototype.thenThrow=function(e){return this._then(i,void 0,void 0,{reason:e},void 0)},n.prototype.catchThrow=function(e){if(arguments.length<=1)return this._then(void 0,i,void 0,{reason:e},void 0);var t=arguments[1];return this.caught(e,function(){throw t})},n.prototype.catchReturn=function(e){if(arguments.length<=1)return e instanceof n&&e.suppressUnhandledRejections(),this._then(void 0,r,void 0,{value:e},void 0);var t=arguments[1];t instanceof n&&t.suppressUnhandledRejections();return this.caught(e,function(){return t})}}},{}],11:[function(e,t,n){t.exports=function(e,n){function r(){return t(this)}var i=e.reduce,t=e.all;e.prototype.each=function(e){return i(this,e,n,0)._then(r,void 0,void 0,this,void 0)},e.prototype.mapSeries=function(e){return i(this,e,n,n)},e.each=function(e,t){return i(e,t,n,0)._then(r,void 0,void 0,e,void 0)},e.mapSeries=function(e,t){return i(e,t,n,n)}}},{}],12:[function(e,t,n){function r(t,n){function r(e){if(!(this instanceof r))return new r(e);d(this,"message","string"==typeof e?e:n),d(this,"name",t),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this)}return c(r,Error),r}function i(e){if(!(this instanceof i))return new i(e);d(this,"name","OperationalError"),d(this,"message",e),this.cause=e,this.isOperational=!0,e instanceof Error?(d(this,"message",e.message),d(this,"stack",e.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var o,s,a=e("./es5"),l=a.freeze,u=e("./util"),c=u.inherits,d=u.notEnumerableProp,f=r("Warning","warning"),h=r("CancellationError","cancellation error"),p=r("TimeoutError","timeout error"),v=r("AggregateError","aggregate error");try{o=TypeError,s=RangeError}catch(e){o=r("TypeError","type error"),s=r("RangeError","range error")}for(var g="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),m=0;m<g.length;++m)"function"==typeof Array.prototype[g[m]]&&(v.prototype[g[m]]=Array.prototype[g[m]]);a.defineProperty(v.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),v.prototype.isOperational=!0;var y=0;v.prototype.toString=function(){var e=Array(4*y+1).join(" "),t="\n"+e+"AggregateError of:\n";y++,e=Array(4*y+1).join(" ");for(var n=0;n<this.length;++n){for(var r=this[n]===this?"[Circular AggregateError]":this[n]+"",i=r.split("\n"),o=0;o<i.length;++o)i[o]=e+i[o];t+=(r=i.join("\n"))+"\n"}return y--,t},c(i,Error);var _=Error.__BluebirdErrorTypes__;_||(_=l({CancellationError:h,TimeoutError:p,OperationalError:i,RejectionError:i,AggregateError:v}),a.defineProperty(Error,"__BluebirdErrorTypes__",{value:_,writable:!1,enumerable:!1,configurable:!1})),t.exports={Error:Error,TypeError:o,RangeError:s,CancellationError:_.CancellationError,OperationalError:_.OperationalError,TimeoutError:_.TimeoutError,AggregateError:_.AggregateError,Warning:f}},{"./es5":13,"./util":36}],13:[function(e,t,n){var r=function(){return void 0===this}();if(r)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:r,propertyIsWritable:function(e,t){var n=Object.getOwnPropertyDescriptor(e,t);return!(n&&!n.writable&&!n.set)}};else{var i={}.hasOwnProperty,o={}.toString,s={}.constructor.prototype,a=function(e){var t=[];for(var n in e)i.call(e,n)&&t.push(n);return t};t.exports={isArray:function(e){try{return"[object Array]"===o.call(e)}catch(e){return!1}},keys:a,names:a,defineProperty:function(e,t,n){return e[t]=n.value,e},getDescriptor:function(e,t){return{value:e[t]}},freeze:function(e){return e},getPrototypeOf:function(e){try{return Object(e).constructor.prototype}catch(e){return s}},isES5:r,propertyIsWritable:function(){return!0}}}},{}],14:[function(e,t,n){t.exports=function(e,r){var i=e.map;e.prototype.filter=function(e,t){return i(this,e,t,r)},e.filter=function(e,t,n){return i(e,t,n,r)}}},{}],15:[function(e,t,n){t.exports=function(a,s,l){function i(e,t,n){this.promise=e,this.type=t,this.handler=n,this.called=!1,this.cancelPromise=null}function u(e){this.finallyHandler=e}function c(e,t){return null!=e.cancelPromise&&(1<arguments.length?e.cancelPromise._reject(t):e.cancelPromise._cancel(),!(e.cancelPromise=null))}function d(){return h.call(this,this.promise._target()._settledValue())}function f(e){if(!c(this,e))return g.e=e,g}function h(e){var t=this.promise,n=this.handler;if(!this.called){this.called=!0;var r=this.isFinallyHandler()?n.call(t._boundValue()):n.call(t._boundValue(),e);if(r===l)return r;if(void 0!==r){t._setReturnedNonUndefined();var i=s(r,t);if(i instanceof a){if(null!=this.cancelPromise){if(i._isCancelled()){var o=new v("late cancellation observer");return t._attachExtraTrace(o),g.e=o,g}i.isPending()&&i._attachCancellationCallback(new u(this))}return i._then(d,f,void 0,this,void 0)}}}return t.isRejected()?(c(this),g.e=e,g):(c(this),e)}var p=e("./util"),v=a.CancellationError,g=p.errorObj,m=e("./catch_filter")(l);return i.prototype.isFinallyHandler=function(){return 0===this.type},u.prototype._resultCancelled=function(){c(this.finallyHandler)},a.prototype._passThrough=function(e,t,n,r){return"function"!=typeof e?this.then():this._then(n,r,void 0,new i(this,t,e),void 0)},a.prototype.lastly=a.prototype.finally=function(e){return this._passThrough(e,0,h,h)},a.prototype.tap=function(e){return this._passThrough(e,1,h)},a.prototype.tapCatch=function(e){var t=arguments.length;if(1===t)return this._passThrough(e,1,void 0,h);var n,r=new Array(t-1),i=0;for(n=0;n<t-1;++n){var o=arguments[n];if(!p.isObject(o))return a.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+p.classString(o)));r[i++]=o}r.length=i;var s=arguments[n];return this._passThrough(m(r,s,this),1,void 0,h)},i}},{"./catch_filter":7,"./util":36}],16:[function(n,e,t){e.exports=function(a,r,s,l,e,u){function c(e,t,n,r){if(u.cancellation()){var i=new a(s),o=this._finallyPromise=new a(s);this._promise=i.lastly(function(){return o}),i._captureStackTrace(),i._setOnCancel(this)}else(this._promise=new a(s))._captureStackTrace();this._stack=r,this._generatorFunction=e,this._receiver=t,this._generator=void 0,this._yieldHandlers="function"==typeof n?[n].concat(p):p,this._yieldedPromise=null,this._cancellationPhase=!1}var d=n("./errors").TypeError,t=n("./util"),f=t.errorObj,h=t.tryCatch,p=[];t.inherits(c,e),c.prototype._isResolved=function(){return null===this._promise},c.prototype._cleanup=function(){this._promise=this._generator=null,u.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)},c.prototype._promiseCancelled=function(){if(!this._isResolved()){var e;if(void 0!==this._generator.return)this._promise._pushContext(),e=h(this._generator.return).call(this._generator,void 0),this._promise._popContext();else{var t=new a.CancellationError("generator .return() sentinel");a.coroutine.returnSentinel=t,this._promise._attachExtraTrace(t),this._promise._pushContext(),e=h(this._generator.throw).call(this._generator,t),this._promise._popContext()}this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(e)}},c.prototype._promiseFulfilled=function(e){this._yieldedPromise=null,this._promise._pushContext();var t=h(this._generator.next).call(this._generator,e);this._promise._popContext(),this._continue(t)},c.prototype._promiseRejected=function(e){this._yieldedPromise=null,this._promise._attachExtraTrace(e),this._promise._pushContext();var t=h(this._generator.throw).call(this._generator,e);this._promise._popContext(),this._continue(t)},c.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof a){var e=this._yieldedPromise;this._yieldedPromise=null,e.cancel()}},c.prototype.promise=function(){return this._promise},c.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._promiseFulfilled(void 0)},c.prototype._continue=function(e){var t=this._promise;if(e===f)return this._cleanup(),this._cancellationPhase?t.cancel():t._rejectCallback(e.e,!1);var n=e.value;if(!0===e.done)return this._cleanup(),this._cancellationPhase?t.cancel():t._resolveCallback(n);var r=l(n,this._promise);if(r instanceof a||null!==(r=function(e,t,n){for(var r=0;r<t.length;++r){n._pushContext();var i=h(t[r])(e);if(n._popContext(),i===f){n._pushContext();var o=a.reject(f.e);return n._popContext(),o}var s=l(i,n);if(s instanceof a)return s}return null}(r,this._yieldHandlers,this._promise))){var i=(r=r._target())._bitField;0==(50397184&i)?(this._yieldedPromise=r)._proxy(this,null):0!=(33554432&i)?a._async.invoke(this._promiseFulfilled,this,r._value()):0!=(16777216&i)?a._async.invoke(this._promiseRejected,this,r._reason()):this._promiseCancelled()}else this._promiseRejected(new d("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(n))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")))},a.coroutine=function(r,e){if("function"!=typeof r)throw new d("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var i=Object(e).yieldHandler,o=c,s=(new Error).stack;return function(){var e=r.apply(this,arguments),t=new o(void 0,void 0,i,s),n=t.promise();return t._generator=e,t._promiseFulfilled(void 0),n}},a.coroutine.addYieldHandler=function(e){if("function"!=typeof e)throw new d("expecting a function but got "+t.classString(e));p.push(e)},a.spawn=function(e){if(u.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof e)return r("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var t=new c(e,this),n=t.promise();return t._run(a.spawn),n}}},{"./errors":12,"./util":36}],17:[function(a,e,t){e.exports=function(e,i,t,n,r,o){var s=a("./util");s.canEvaluate,s.tryCatch,s.errorObj,e.join=function(){var e,t=arguments.length-1;0<t&&"function"==typeof arguments[t]&&(e=arguments[t]);var n=[].slice.call(arguments);e&&n.pop();var r=new i(n).promise();return void 0!==e?r.spread(e):r}}},{"./util":36}],18:[function(t,e,n){e.exports=function(h,e,o,p,s,v){function a(e,t,n,r){this.constructor$(e),this._promise._captureStackTrace();var i=l();this._callback=null===i?t:u.domainBind(i,t),this._preservedValues=r===s?new Array(this.length()):null,this._limit=n,this._inFlight=0,this._queue=[],c.invoke(this._asyncInit,this,void 0)}function i(e,t,n,r){if("function"!=typeof t)return o("expecting a function but got "+u.classString(t));var i=0;if(void 0!==n){if("object"!=(void 0===n?"undefined":_typeof(n))||null===n)return h.reject(new TypeError("options argument must be an object but it is "+u.classString(n)));if("number"!=typeof n.concurrency)return h.reject(new TypeError("'concurrency' must be a number but it is "+u.classString(n.concurrency)));i=n.concurrency}return new a(e,t,i="number"==typeof i&&isFinite(i)&&1<=i?i:0,r).promise()}var l=h._getDomain,u=t("./util"),g=u.tryCatch,m=u.errorObj,c=h._async;u.inherits(a,e),a.prototype._asyncInit=function(){this._init$(void 0,-2)},a.prototype._init=function(){},a.prototype._promiseFulfilled=function(e,t){var n=this._values,r=this.length(),i=this._preservedValues,o=this._limit;if(t<0){if(n[t=-1*t-1]=e,1<=o&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(1<=o&&this._inFlight>=o)return n[t]=e,this._queue.push(t),!1;null!==i&&(i[t]=e);var s=this._promise,a=this._callback,l=s._boundValue();s._pushContext();var u=g(a).call(l,e,t,r),c=s._popContext();if(v.checkForgottenReturns(u,c,null!==i?"Promise.filter":"Promise.map",s),u===m)return this._reject(u.e),!0;var d=p(u,this._promise);if(d instanceof h){var f=(d=d._target())._bitField;if(0==(50397184&f))return 1<=o&&this._inFlight++,(n[t]=d)._proxy(this,-1*(t+1)),!1;if(0==(33554432&f))return 0!=(16777216&f)?this._reject(d._reason()):this._cancel(),!0;u=d._value()}n[t]=u}return++this._totalResolved>=r&&(null!==i?this._filter(n,i):this._resolve(n),!0)},a.prototype._drainQueue=function(){for(var e=this._queue,t=this._limit,n=this._values;0<e.length&&this._inFlight<t;){if(this._isResolved())return;var r=e.pop();this._promiseFulfilled(n[r],r)}},a.prototype._filter=function(e,t){for(var n=t.length,r=new Array(n),i=0,o=0;o<n;++o)e[o]&&(r[i++]=t[o]);r.length=i,this._resolve(r)},a.prototype.preservedValues=function(){return this._preservedValues},h.prototype.map=function(e,t){return i(this,e,t,null)},h.map=function(e,t,n,r){return i(e,t,n,r)}}},{"./util":36}],19:[function(t,e,n){e.exports=function(s,a,e,l,u){var c=t("./util"),d=c.tryCatch;s.method=function(r){if("function"!=typeof r)throw new s.TypeError("expecting a function but got "+c.classString(r));return function(){var e=new s(a);e._captureStackTrace(),e._pushContext();var t=d(r).apply(this,arguments),n=e._popContext();return u.checkForgottenReturns(t,n,"Promise.method",e),e._resolveFromSyncValue(t),e}},s.attempt=s.try=function(e){if("function"!=typeof e)return l("expecting a function but got "+c.classString(e));var t,n=new s(a);if(n._captureStackTrace(),n._pushContext(),1<arguments.length){u.deprecated("calling Promise.try with more than 1 argument");var r=arguments[1],i=arguments[2];t=c.isArray(r)?d(e).apply(i,r):d(e).call(i,r)}else t=d(e)();var o=n._popContext();return u.checkForgottenReturns(t,o,"Promise.try",n),n._resolveFromSyncValue(t),n},s.prototype._resolveFromSyncValue=function(e){e===c.errorObj?this._rejectCallback(e.e,!1):this._resolveCallback(e,!0)}}},{"./util":36}],20:[function(e,t,n){function s(e){var t,n;if((n=e)instanceof Error&&c.getPrototypeOf(n)===Error.prototype){(t=new u(e)).name=e.name,t.message=e.message,t.stack=e.stack;for(var r=c.keys(e),i=0;i<r.length;++i){var o=r[i];d.test(o)||(t[o]=e[o])}return t}return a.markAsOriginatingFromRejection(e),e}var a=e("./util"),l=a.maybeWrapAsError,u=e("./errors").OperationalError,c=e("./es5"),d=/^(?:name|message|stack|cause)$/;t.exports=function(i,o){return function(e,t){if(null!==i){if(e){var n=s(l(e));i._attachExtraTrace(n),i._reject(n)}else if(o){var r=[].slice.call(arguments,1);i._fulfill(r)}else i._fulfill(t);i=null}}}},{"./errors":12,"./es5":13,"./util":36}],21:[function(t,e,n){e.exports=function(e){function r(e,t){if(!s.isArray(e))return i.call(this,e,t);var n=l(t).apply(this._boundValue(),[null].concat(e));n===u&&a.throwLater(n.e)}function i(e,t){var n=this._boundValue(),r=void 0===e?l(t).call(n,null):l(t).call(n,null,e);r===u&&a.throwLater(r.e)}function o(e,t){if(!e){var n=new Error(e+"");n.cause=e,e=n}var r=l(t).call(this._boundValue(),e);r===u&&a.throwLater(r.e)}var s=t("./util"),a=e._async,l=s.tryCatch,u=s.errorObj;e.prototype.asCallback=e.prototype.nodeify=function(e,t){if("function"==typeof e){var n=i;void 0!==t&&Object(t).spread&&(n=r),this._then(n,o,void 0,this,e)}return this}}},{"./util":36}],22:[function(A,O,e){O.exports=function(){function a(){}function h(e){e!==y&&function(e,t){if(null==e||e.constructor!==h)throw new d("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof t)throw new d("expecting a function but got "+v.classString(t))}(this,e),this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolveFromExecutor(e),this._promiseCreated(),this._fireEvent("promiseCreated",this)}function e(e){this.promise._resolveCallback(e)}function t(e){this.promise._rejectCallback(e,!1)}function n(e){var t=new h(y);t._fulfillmentHandler0=e,t._rejectionHandler0=e,t._promise0=e,t._receiver0=e}var p,l=function(){return new d("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},u=function(){return new h.PromiseInspection(this._target())},s=function(e){return h.reject(new d(e))},c={},v=A("./util");p=v.isNode?function(){var e=$.domain;return void 0===e&&(e=null),e}:function(){return null},v.notEnumerableProp(h,"_getDomain",p);var r=A("./es5"),i=A("./async"),g=new i;r.defineProperty(h,"_async",{value:g});var o=A("./errors"),d=h.TypeError=o.TypeError;h.RangeError=o.RangeError;var m=h.CancellationError=o.CancellationError;h.TimeoutError=o.TimeoutError,h.OperationalError=o.OperationalError,h.RejectionError=o.OperationalError,h.AggregateError=o.AggregateError;var y=function(){},f={},_={},b=A("./thenables")(h,y),S=A("./promise_array")(h,y,b,s,a),C=A("./context")(h),T=C.create,w=A("./debuggability")(h,C),E=(w.CapturedTrace,A("./finally")(h,b,_)),k=A("./catch_filter")(_),R=A("./nodeback"),I=v.errorObj,P=v.tryCatch;return h.prototype.toString=function(){return"[object Promise]"},h.prototype.caught=h.prototype.catch=function(e){var t=arguments.length;if(1<t){var n,r=new Array(t-1),i=0;for(n=0;n<t-1;++n){var o=arguments[n];if(!v.isObject(o))return s("Catch statement predicate: expecting an object but got "+v.classString(o));r[i++]=o}return r.length=i,e=arguments[n],this.then(void 0,k(r,e,this))}return this.then(void 0,e)},h.prototype.reflect=function(){return this._then(u,u,void 0,this,void 0)},h.prototype.then=function(e,t){if(w.warnings()&&0<arguments.length&&"function"!=typeof e&&"function"!=typeof t){var n=".then() only accepts functions but was passed: "+v.classString(e);1<arguments.length&&(n+=", "+v.classString(t)),this._warn(n)}return this._then(e,t,void 0,void 0,void 0)},h.prototype.done=function(e,t){this._then(e,t,void 0,void 0,void 0)._setIsFinal()},h.prototype.spread=function(e){return"function"!=typeof e?s("expecting a function but got "+v.classString(e)):this.all()._then(e,void 0,void 0,f,void 0)},h.prototype.toJSON=function(){var e={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(e.fulfillmentValue=this.value(),e.isFulfilled=!0):this.isRejected()&&(e.rejectionReason=this.reason(),e.isRejected=!0),e},h.prototype.all=function(){return 0<arguments.length&&this._warn(".all() was passed arguments but it does not take any"),new S(this).promise()},h.prototype.error=function(e){return this.caught(v.originatesFromRejection,e)},h.getNewLibraryCopy=O.exports,h.is=function(e){return e instanceof h},h.fromNode=h.fromCallback=function(e){var t=new h(y);t._captureStackTrace();var n=1<arguments.length&&!!Object(arguments[1]).multiArgs,r=P(e)(R(t,n));return r===I&&t._rejectCallback(r.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},h.all=function(e){return new S(e).promise()},h.resolve=h.fulfilled=h.cast=function(e){var t=b(e);return t instanceof h||((t=new h(y))._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=e),t},h.reject=h.rejected=function(e){var t=new h(y);return t._captureStackTrace(),t._rejectCallback(e,!0),t},h.setScheduler=function(e){if("function"!=typeof e)throw new d("expecting a function but got "+v.classString(e));return g.setScheduler(e)},h.prototype._then=function(e,t,n,r,i){var o=void 0!==i,s=o?i:new h(y),a=this._target(),l=a._bitField;o||(s._propagateFrom(this,3),s._captureStackTrace(),void 0===r&&0!=(2097152&this._bitField)&&(r=0!=(50397184&l)?this._boundValue():a===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,s));var u=p();if(0!=(50397184&l)){var c,d,f=a._settlePromiseCtx;0!=(33554432&l)?(d=a._rejectionHandler0,c=e):0!=(16777216&l)?(d=a._fulfillmentHandler0,c=t,a._unsetRejectionIsUnhandled()):(f=a._settlePromiseLateCancellationObserver,d=new m("late cancellation observer"),a._attachExtraTrace(d),c=t),g.invoke(f,a,{handler:null===u?c:"function"==typeof c&&v.domainBind(u,c),promise:s,receiver:r,value:d})}else a._addCallbacks(e,t,s,r,u);return s},h.prototype._length=function(){return 65535&this._bitField},h.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},h.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},h.prototype._setLength=function(e){this._bitField=-65536&this._bitField|65535&e},h.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField,this._fireEvent("promiseFulfilled",this)},h.prototype._setRejected=function(){this._bitField=16777216|this._bitField,this._fireEvent("promiseRejected",this)},h.prototype._setFollowing=function(){this._bitField=67108864|this._bitField,this._fireEvent("promiseResolved",this)},h.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},h.prototype._isFinal=function(){return 0<(4194304&this._bitField)},h.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},h.prototype._setCancelled=function(){this._bitField=65536|this._bitField,this._fireEvent("promiseCancelled",this)},h.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},h.prototype._setAsyncGuaranteed=function(){g.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},h.prototype._receiverAt=function(e){var t=0===e?this._receiver0:this[4*e-4+3];if(t!==c)return void 0===t&&this._isBound()?this._boundValue():t},h.prototype._promiseAt=function(e){return this[4*e-4+2]},h.prototype._fulfillmentHandlerAt=function(e){return this[4*e-4+0]},h.prototype._rejectionHandlerAt=function(e){return this[4*e-4+1]},h.prototype._boundValue=function(){},h.prototype._migrateCallback0=function(e){var t=(e._bitField,e._fulfillmentHandler0),n=e._rejectionHandler0,r=e._promise0,i=e._receiverAt(0);void 0===i&&(i=c),this._addCallbacks(t,n,r,i,null)},h.prototype._migrateCallbackAt=function(e,t){var n=e._fulfillmentHandlerAt(t),r=e._rejectionHandlerAt(t),i=e._promiseAt(t),o=e._receiverAt(t);void 0===o&&(o=c),this._addCallbacks(n,r,i,o,null)},h.prototype._addCallbacks=function(e,t,n,r,i){var o=this._length();if(65531<=o&&(o=0,this._setLength(0)),0===o)this._promise0=n,this._receiver0=r,"function"==typeof e&&(this._fulfillmentHandler0=null===i?e:v.domainBind(i,e)),"function"==typeof t&&(this._rejectionHandler0=null===i?t:v.domainBind(i,t));else{var s=4*o-4;this[s+2]=n,this[s+3]=r,"function"==typeof e&&(this[s+0]=null===i?e:v.domainBind(i,e)),"function"==typeof t&&(this[s+1]=null===i?t:v.domainBind(i,t))}return this._setLength(o+1),o},h.prototype._proxy=function(e,t){this._addCallbacks(void 0,void 0,t,e,null)},h.prototype._resolveCallback=function(e,t){if(0==(117506048&this._bitField)){if(e===this)return this._rejectCallback(l(),!1);var n=b(e,this);if(!(n instanceof h))return this._fulfill(e);t&&this._propagateFrom(n,2);var r=n._target();if(r===this)return void this._reject(l());var i=r._bitField;if(0==(50397184&i)){var o=this._length();0<o&&r._migrateCallback0(this);for(var s=1;s<o;++s)r._migrateCallbackAt(this,s);this._setFollowing(),this._setLength(0),this._setFollowee(r)}else if(0!=(33554432&i))this._fulfill(r._value());else if(0!=(16777216&i))this._reject(r._reason());else{var a=new m("late cancellation observer");r._attachExtraTrace(a),this._reject(a)}}},h.prototype._rejectCallback=function(e,t,n){var r=v.ensureErrorObject(e),i=r===e;if(!i&&!n&&w.warnings()){var o="a promise was rejected with a non-error: "+v.classString(e);this._warn(o,!0)}this._attachExtraTrace(r,!!t&&i),this._reject(e)},h.prototype._resolveFromExecutor=function(e){if(e!==y){var t=this;this._captureStackTrace(),this._pushContext();var n=!0,r=this._execute(e,function(e){t._resolveCallback(e)},function(e){t._rejectCallback(e,n)});n=!1,this._popContext(),void 0!==r&&t._rejectCallback(r,!0)}},h.prototype._settlePromiseFromHandler=function(e,t,n,r){var i=r._bitField;if(0==(65536&i)){var o;r._pushContext(),t===f?n&&"number"==typeof n.length?o=P(e).apply(this._boundValue(),n):(o=I).e=new d("cannot .spread() a non-array: "+v.classString(n)):o=P(e).call(t,n);var s=r._popContext();0==(65536&(i=r._bitField))&&(o===_?r._reject(n):o===I?r._rejectCallback(o.e,!1):(w.checkForgottenReturns(o,s,"",r,this),r._resolveCallback(o)))}},h.prototype._target=function(){for(var e=this;e._isFollowing();)e=e._followee();return e},h.prototype._followee=function(){return this._rejectionHandler0},h.prototype._setFollowee=function(e){this._rejectionHandler0=e},h.prototype._settlePromise=function(e,t,n,r){var i=e instanceof h,o=this._bitField,s=0!=(134217728&o);0!=(65536&o)?(i&&e._invokeInternalOnCancel(),n instanceof E&&n.isFinallyHandler()?(n.cancelPromise=e,P(t).call(n,r)===I&&e._reject(I.e)):t===u?e._fulfill(u.call(n)):n instanceof a?n._promiseCancelled(e):i||e instanceof S?e._cancel():n.cancel()):"function"==typeof t?i?(s&&e._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,n,r,e)):t.call(n,r,e):n instanceof a?n._isResolved()||(0!=(33554432&o)?n._promiseFulfilled(r,e):n._promiseRejected(r,e)):i&&(s&&e._setAsyncGuaranteed(),0!=(33554432&o)?e._fulfill(r):e._reject(r))},h.prototype._settlePromiseLateCancellationObserver=function(e){var t=e.handler,n=e.promise,r=e.receiver,i=e.value;"function"==typeof t?n instanceof h?this._settlePromiseFromHandler(t,r,i,n):t.call(r,i,n):n instanceof h&&n._reject(i)},h.prototype._settlePromiseCtx=function(e){this._settlePromise(e.promise,e.handler,e.receiver,e.value)},h.prototype._settlePromise0=function(e,t,n){var r=this._promise0,i=this._receiverAt(0);this._promise0=void 0,this._receiver0=void 0,this._settlePromise(r,e,i,t)},h.prototype._clearCallbackDataAtIndex=function(e){var t=4*e-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},h.prototype._fulfill=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(e===this){var n=l();return this._attachExtraTrace(n),this._reject(n)}this._setFulfilled(),this._rejectionHandler0=e,0<(65535&t)&&(0!=(134217728&t)?this._settlePromises():g.settlePromises(this))}},h.prototype._reject=function(e){var t=this._bitField;if(!((117506048&t)>>>16)){if(this._setRejected(),this._fulfillmentHandler0=e,this._isFinal())return g.fatalError(e,v.isNode);0<(65535&t)?g.settlePromises(this):this._ensurePossibleRejectionHandled()}},h.prototype._fulfillPromises=function(e,t){for(var n=1;n<e;n++){var r=this._fulfillmentHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},h.prototype._rejectPromises=function(e,t){for(var n=1;n<e;n++){var r=this._rejectionHandlerAt(n),i=this._promiseAt(n),o=this._receiverAt(n);this._clearCallbackDataAtIndex(n),this._settlePromise(i,r,o,t)}},h.prototype._settlePromises=function(){var e=this._bitField,t=65535&e;if(0<t){if(0!=(16842752&e)){var n=this._fulfillmentHandler0;this._settlePromise0(this._rejectionHandler0,n,e),this._rejectPromises(t,n)}else{var r=this._rejectionHandler0;this._settlePromise0(this._fulfillmentHandler0,r,e),this._fulfillPromises(t,r)}this._setLength(0)}this._clearCancellationData()},h.prototype._settledValue=function(){var e=this._bitField;return 0!=(33554432&e)?this._rejectionHandler0:0!=(16777216&e)?this._fulfillmentHandler0:void 0},h.defer=h.pending=function(){return w.deprecated("Promise.defer","new Promise"),{promise:new h(y),resolve:e,reject:t}},v.notEnumerableProp(h,"_makeSelfResolutionError",l),A("./method")(h,y,b,s,w),A("./bind")(h,y,b,w),A("./cancel")(h,S,s,w),A("./direct_resolve")(h),A("./synchronous_inspection")(h),A("./join")(h,S,b,y,g,p),(h.Promise=h).version="3.5.1",A("./map.js")(h,S,s,b,y,w),A("./call_get.js")(h),A("./using.js")(h,s,b,T,y,w),A("./timers.js")(h,y,w),A("./generators.js")(h,s,y,b,a,w),A("./nodeify.js")(h),A("./promisify.js")(h,y),A("./props.js")(h,S,b,s),A("./race.js")(h,y,b,s),A("./reduce.js")(h,S,s,b,y,w),A("./settle.js")(h,S,w),A("./some.js")(h,S,s),A("./filter.js")(h,y),A("./each.js")(h,y),A("./any.js")(h),v.toFastProperties(h),v.toFastProperties(h.prototype),n({a:1}),n({b:2}),n({c:3}),n(1),n(function(){}),n(void 0),n(!1),n(new h(y)),w.setBounds(i.firstLineError,v.lastLineError),h}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(r,e,t){e.exports=function(a,n,l,s,e){function t(e){var t=this._promise=new a(n);e instanceof a&&t._propagateFrom(e,3),t._setOnCancel(this),this._values=e,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var u=r("./util");return u.isArray,u.inherits(t,e),t.prototype.length=function(){return this._length},t.prototype.promise=function(){return this._promise},t.prototype._init=function e(t,n){var r=l(this._values,this._promise);if(r instanceof a){var i=(r=r._target())._bitField;if(this._values=r,0==(50397184&i))return this._promise._setAsyncGuaranteed(),r._then(e,this._reject,void 0,this,n);if(0==(33554432&i))return 0!=(16777216&i)?this._reject(r._reason()):this._cancel();r=r._value()}if(null!==(r=u.asArray(r)))0!==r.length?this._iterate(r):-5===n?this._resolveEmptyArray():this._resolve(function(e){switch(e){case-2:return[];case-3:return{};case-6:return new Map}}(n));else{var o=s("expecting an array or an iterable object but got "+u.classString(r)).reason();this._promise._rejectCallback(o,!1)}},t.prototype._iterate=function(e){var t=this.getActualLength(e.length);this._length=t,this._values=this.shouldCopyValues()?new Array(t):this._values;for(var n=this._promise,r=!1,i=null,o=0;o<t;++o){var s=l(e[o],n);s instanceof a?i=(s=s._target())._bitField:i=null,r?null!==i&&s.suppressUnhandledRejections():null!==i?0==(50397184&i)?(s._proxy(this,o),this._values[o]=s):r=0!=(33554432&i)?this._promiseFulfilled(s._value(),o):0!=(16777216&i)?this._promiseRejected(s._reason(),o):this._promiseCancelled(o):r=this._promiseFulfilled(s,o)}r||n._setAsyncGuaranteed()},t.prototype._isResolved=function(){return null===this._values},t.prototype._resolve=function(e){this._values=null,this._promise._fulfill(e)},t.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},t.prototype._reject=function(e){this._values=null,this._promise._rejectCallback(e,!1)},t.prototype._promiseFulfilled=function(e,t){return this._values[t]=e,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},t.prototype._promiseCancelled=function(){return this._cancel(),!0},t.prototype._promiseRejected=function(e){return this._totalResolved++,this._reject(e),!0},t.prototype._resultCancelled=function(){if(!this._isResolved()){var e=this._values;if(this._cancel(),e instanceof a)e.cancel();else for(var t=0;t<e.length;++t)e[t]instanceof a&&e[t].cancel()}},t.prototype.shouldCopyValues=function(){return!0},t.prototype.getActualLength=function(e){return e},t}},{"./util":36}],24:[function(n,e,t){e.exports=function(u,c){function s(e){return!t.test(e)}function p(e){try{return!0===e.__isPromisified__}catch(e){return!1}}function h(e,t,n,r){for(var i=g.inheritedDataKeys(e),o=[],s=0;s<i.length;++s){var a=i[s],l=e[a],u=r===S||S(a,l,e);"function"!=typeof l||p(l)||(c=e,d=a,f=t,void 0,(h=g.getDataPropertyOrDefault(c,d+f,b))&&p(h))||!r(a,l,e,u)||o.push(a,l)}var c,d,f,h;return function(e,t,n){for(var r=0;r<e.length;r+=2){var i=e[r];if(n.test(i))for(var o=i.replace(n,""),s=0;s<e.length;s+=2)if(e[s]===o)throw new _("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",t))}}(o,t,n),o}function d(e,t,n,r,i){for(var o=new RegExp(C(t)+"$"),s=h(e,t,o,n),a=0,l=s.length;a<l;a+=2){var u=s[a],c=s[a+1],d=u+t;if(r===T)e[d]=T(u,v,u,c,t,i);else{var f=r(c,function(){return T(u,v,u,c,t,i)});g.notEnumerableProp(f,"__isPromisified__",!0),e[d]=f}}return g.toFastProperties(e),e}var v={},g=n("./util"),f=n("./nodeback"),m=g.withAppended,y=g.maybeWrapAsError,e=g.canEvaluate,_=n("./errors").TypeError,b={__isPromisified__:!0},t=new RegExp("^(?:"+["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"].join("|")+")$"),S=function(e){return g.isIdentifier(e)&&"_"!==e.charAt(0)&&"constructor"!==e},C=function(e){return e.replace(/([$])/,"\\$")},T=e?void 0:function(i,o,e,t,n,s){function r(){var e=o;o===v&&(e=this);var t=new u(c);t._captureStackTrace();var n="string"==typeof l&&this!==a?this[l]:i,r=f(t,s);try{n.apply(e,m(arguments,r))}catch(e){t._rejectCallback(y(e),!0,!0)}return t._isFateSealed()||t._setAsyncGuaranteed(),t}var a=function(){return this}(),l=i;return"string"==typeof l&&(i=t),g.notEnumerableProp(r,"__isPromisified__",!0),r};u.promisify=function(e,t){if("function"!=typeof e)throw new _("expecting a function but got "+g.classString(e));if(p(e))return e;var n,r=void 0===(t=Object(t)).context?v:t.context,i=!!t.multiArgs,o=T(n=e,r,void 0,n,null,i);return g.copyDescriptors(e,o,s),o},u.promisifyAll=function(e,t){if("function"!=typeof e&&"object"!=(void 0===e?"undefined":_typeof(e)))throw new _("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");var n=!!(t=Object(t)).multiArgs,r=t.suffix;"string"!=typeof r&&(r="Async");var i=t.filter;"function"!=typeof i&&(i=S);var o=t.promisifier;if("function"!=typeof o&&(o=T),!g.isIdentifier(r))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(var s=g.inheritedDataKeys(e),a=0;a<s.length;++a){var l=e[s[a]];"constructor"!==s[a]&&g.isClass(l)&&(d(l.prototype,r,i,o,n),d(l,r,i,o,n))}return d(e,r,i,o,n)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(d,e,t){e.exports=function(r,e,i,o){function s(e){var t,n=!1;if(void 0!==a&&e instanceof a)t=c(e),n=!0;else{var r=u.keys(e),i=r.length;t=new Array(2*i);for(var o=0;o<i;++o){var s=r[o];t[o]=e[s],t[o+i]=s}}this.constructor$(t),this._isMap=n,this._init$(void 0,n?-6:-3)}function t(e){var t,n=i(e);return l(n)?(t=n instanceof r?n._then(r.props,void 0,void 0,void 0,void 0):new s(n).promise(),n instanceof r&&t._propagateFrom(n,2),t):o("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var a,n=d("./util"),l=n.isObject,u=d("./es5");"function"==typeof Map&&(a=Map);var c=function(){function n(e,t){this[r]=e,this[r+i]=t,r++}var r=0,i=0;return function(e){i=e.size,r=0;var t=new Array(2*e.size);return e.forEach(n,t),t}}();n.inherits(s,e),s.prototype._init=function(){},s.prototype._promiseFulfilled=function(e,t){if(this._values[t]=e,++this._totalResolved>=this._length){var n;if(this._isMap)n=function(e){for(var t=new a,n=e.length/2|0,r=0;r<n;++r){var i=e[n+r],o=e[r];t.set(i,o)}return t}(this._values);else{n={};for(var r=this.length(),i=0,o=this.length();i<o;++i)n[this._values[i+r]]=this._values[i]}return this._resolve(n),!0}return!1},s.prototype.shouldCopyValues=function(){return!1},s.prototype.getActualLength=function(e){return e>>1},r.prototype.props=function(){return t(this)},r.props=function(e){return t(e)}}},{"./es5":13,"./util":36}],26:[function(e,t,n){function r(e){this._capacity=e,this._length=0,this._front=0}r.prototype._willBeOverCapacity=function(e){return this._capacity<e},r.prototype._pushOne=function(e){var t=this.length();this._checkCapacity(t+1),this[this._front+t&this._capacity-1]=e,this._length=t+1},r.prototype.push=function(e,t,n){var r=this.length()+3;if(this._willBeOverCapacity(r))return this._pushOne(e),this._pushOne(t),void this._pushOne(n);var i=this._front+r-3;this._checkCapacity(r);var o=this._capacity-1;this[i+0&o]=e,this[i+1&o]=t,this[i+2&o]=n,this._length=r},r.prototype.shift=function(){var e=this._front,t=this[e];return this[e]=void 0,this._front=e+1&this._capacity-1,this._length--,t},r.prototype.length=function(){return this._length},r.prototype._checkCapacity=function(e){this._capacity<e&&this._resizeTo(this._capacity<<1)},r.prototype._resizeTo=function(e){var t=this._capacity;this._capacity=e,function(e,t,n,r,i){for(var o=0;o<i;++o)n[o+r]=e[o+t],e[o+t]=void 0}(this,0,this,t,this._front+this._length&t-1)},t.exports=r},{}],27:[function(e,t,n){t.exports=function(u,c,d,f){function n(e,t){var n=d(e);if(n instanceof u)return p(n);if(null===(e=h.asArray(e)))return f("expecting an array or an iterable object but got "+h.classString(e));var r=new u(c);void 0!==t&&r._propagateFrom(t,3);for(var i=r._fulfill,o=r._reject,s=0,a=e.length;s<a;++s){var l=e[s];(void 0!==l||s in e)&&u.cast(l)._then(i,o,void 0,r,null)}return r}var h=e("./util"),p=function(t){return t.then(function(e){return n(e,t)})};u.race=function(e){return n(e,void 0)},u.prototype.race=function(){return n(this,void 0)}}},{"./util":36}],28:[function(t,e,n){e.exports=function(s,e,i,n,o,a){function l(e,t,n,r){this.constructor$(e);var i=f();this._fn=null===i?t:h.domainBind(i,t),void 0!==n&&(n=s.resolve(n))._attachCancellationCallback(this),this._initialValue=n,this._currentCancellable=null,this._eachValues=r===o?Array(this._length):0===r?null:void 0,this._promise._captureStackTrace(),this._init$(void 0,-5)}function u(e,t){this.isFulfilled()?t._resolve(e):t._reject(e)}function c(e,t,n,r){return"function"!=typeof t?i("expecting a function but got "+h.classString(t)):new l(e,t,n,r).promise()}function d(e){this.accum=e,this.array._gotAccum(e);var t=n(this.value,this.array._promise);return t instanceof s?(this.array._currentCancellable=t)._then(r,void 0,void 0,this,void 0):r.call(this,t)}function r(e){var t,n=this.array,r=n._promise,i=p(n._fn);r._pushContext(),(t=void 0!==n._eachValues?i.call(r._boundValue(),e,this.index,this.length):i.call(r._boundValue(),this.accum,e,this.index,this.length))instanceof s&&(n._currentCancellable=t);var o=r._popContext();return a.checkForgottenReturns(t,o,void 0!==n._eachValues?"Promise.each":"Promise.reduce",r),t}var f=s._getDomain,h=t("./util"),p=h.tryCatch;h.inherits(l,e),l.prototype._gotAccum=function(e){void 0!==this._eachValues&&null!==this._eachValues&&e!==o&&this._eachValues.push(e)},l.prototype._eachComplete=function(e){return null!==this._eachValues&&this._eachValues.push(e),this._eachValues},l.prototype._init=function(){},l.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)},l.prototype.shouldCopyValues=function(){return!1},l.prototype._resolve=function(e){this._promise._resolveCallback(e),this._values=null},l.prototype._resultCancelled=function(e){if(e===this._initialValue)return this._cancel();this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof s&&this._currentCancellable.cancel(),this._initialValue instanceof s&&this._initialValue.cancel())},l.prototype._iterate=function(e){var t,n,r=(this._values=e).length;if(void 0!==this._initialValue?(t=this._initialValue,n=0):(t=s.resolve(e[0]),n=1),!(this._currentCancellable=t).isRejected())for(;n<r;++n){var i={accum:null,value:e[n],index:n,length:r,array:this};t=t._then(d,void 0,void 0,i,void 0)}void 0!==this._eachValues&&(t=t._then(this._eachComplete,void 0,void 0,this,void 0)),t._then(u,u,void 0,t,this)},s.prototype.reduce=function(e,t){return c(this,e,t,null)},s.reduce=function(e,t,n,r){return c(e,t,n,r)}}},{"./util":36}],29:[function(e,t,n){var r,i=e("./util"),o=i.getNativePromise();if(i.isNode&&"undefined"==typeof MutationObserver){var s=E.setImmediate,a=$.nextTick;r=i.isRecentNode?function(e){s.call(E,e)}:function(e){a.call($,e)}}else if("function"==typeof o&&"function"==typeof o.resolve){var l=o.resolve();r=function(e){l.then(e)}}else r="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?"undefined"!=typeof setImmediate?function(e){setImmediate(e)}:"undefined"!=typeof setTimeout?function(e){setTimeout(e,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n")}:function(){var n=document.createElement("div"),r={attributes:!0},i=!1,o=document.createElement("div");new MutationObserver(function(){n.classList.toggle("foo"),i=!1}).observe(o,r);return function(e){var t=new MutationObserver(function(){t.disconnect(),e()});t.observe(n,r),i||(i=!0,o.classList.toggle("foo"))}}();t.exports=r},{"./util":36}],30:[function(o,e,t){e.exports=function(e,t,n){function r(e){this.constructor$(e)}var i=e.PromiseInspection;o("./util").inherits(r,t),r.prototype._promiseResolved=function(e,t){return this._values[e]=t,++this._totalResolved>=this._length&&(this._resolve(this._values),!0)},r.prototype._promiseFulfilled=function(e,t){var n=new i;return n._bitField=33554432,n._settledValueField=e,this._promiseResolved(t,n)},r.prototype._promiseRejected=function(e,t){var n=new i;return n._bitField=16777216,n._settledValueField=e,this._promiseResolved(t,n)},e.settle=function(e){return n.deprecated(".settle()",".reflect()"),new r(e).promise()},e.prototype.settle=function(){return e.settle(this)}}},{"./util":36}],31:[function(c,e,t){e.exports=function(e,t,i){function o(e){this.constructor$(e),this._howMany=0,this._unwrap=!1,this._initialized=!1}function n(e,t){if((0|t)!==t||t<0)return i("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var n=new o(e),r=n.promise();return n.setHowMany(t),n.init(),r}var r=c("./util"),s=c("./errors").RangeError,a=c("./errors").AggregateError,l=r.isArray,u={};r.inherits(o,t),o.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var e=l(this._values);!this._isResolved()&&e&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},o.prototype.init=function(){this._initialized=!0,this._init()},o.prototype.setUnwrap=function(){this._unwrap=!0},o.prototype.howMany=function(){return this._howMany},o.prototype.setHowMany=function(e){this._howMany=e},o.prototype._promiseFulfilled=function(e){return this._addFulfilled(e),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0)},o.prototype._promiseRejected=function(e){return this._addRejected(e),this._checkOutcome()},o.prototype._promiseCancelled=function(){return this._values instanceof e||null==this._values?this._cancel():(this._addRejected(u),this._checkOutcome())},o.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var e=new a,t=this.length();t<this._values.length;++t)this._values[t]!==u&&e.push(this._values[t]);return 0<e.length?this._reject(e):this._cancel(),!0}return!1},o.prototype._fulfilled=function(){return this._totalResolved},o.prototype._rejected=function(){return this._values.length-this.length()},o.prototype._addRejected=function(e){this._values.push(e)},o.prototype._addFulfilled=function(e){this._values[this._totalResolved++]=e},o.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},o.prototype._getRangeError=function(e){var t="Input array must contain at least "+this._howMany+" items but contains only "+e+" items";return new s(t)},o.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},e.some=function(e,t){return n(e,t)},e.prototype.some=function(e){return n(this,e)},e._SomePromiseArray=o}},{"./errors":12,"./util":36}],32:[function(e,t,n){t.exports=function(e){function t(e){void 0!==e?(e=e._target(),this._bitField=e._bitField,this._settledValueField=e._isFateSealed()?e._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var n=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},i=t.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},o=t.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},s=t.prototype.isPending=function(){return 0==(50397184&this._bitField)},a=t.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)},e.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)},e.prototype._isCancelled=function(){return this._target().__isCancelled()},e.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)},e.prototype.isPending=function(){return s.call(this._target())},e.prototype.isRejected=function(){return o.call(this._target())},e.prototype.isFulfilled=function(){return i.call(this._target())},e.prototype.isResolved=function(){return a.call(this._target())},e.prototype.value=function(){return n.call(this._target())},e.prototype.reason=function(){var e=this._target();return e._unsetRejectionIsUnhandled(),r.call(e)},e.prototype._value=function(){return this._settledValue()},e.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()},e.PromiseInspection=t}},{}],33:[function(e,t,n){t.exports=function(a,l){var u=e("./util"),c=u.errorObj,i=u.isObject,o={}.hasOwnProperty;return function(e,t){if(i(e)){if(e instanceof a)return e;var n=function(e){try{return e.then}catch(e){return c.e=e,c}}(e);if(n===c){t&&t._pushContext();var r=a.reject(n.e);return t&&t._popContext(),r}if("function"==typeof n)return function(e){try{return o.call(e,"_promise0")}catch(e){return!1}}(e)?(r=new a(l),e._then(r._fulfill,r._reject,void 0,r,null),r):function(e,t,n){var r=new a(l),i=r;n&&n._pushContext(),r._captureStackTrace(),n&&n._popContext();var o=!0,s=u.tryCatch(t).call(e,function(e){r&&(r._resolveCallback(e),r=null)},function(e){r&&(r._rejectCallback(e,o,!0),r=null)});return o=!1,r&&s===c&&(r._rejectCallback(s.e,!0,!0),r=null),i}(e,n,t)}return e}}},{"./util":36}],34:[function(e,t,n){t.exports=function(i,o,a){function l(e){this.handle=e}function n(e){return clearTimeout(this.handle),e}function r(e){throw clearTimeout(this.handle),e}var u=e("./util"),c=i.TimeoutError;l.prototype._resultCancelled=function(){clearTimeout(this.handle)};var s=function(e){return t(+this).thenReturn(e)},t=i.delay=function(e,t){var n,r;return void 0!==t?(n=i.resolve(t)._then(s,null,null,e,void 0),a.cancellation()&&t instanceof i&&n._setOnCancel(t)):(n=new i(o),r=setTimeout(function(){n._fulfill()},+e),a.cancellation()&&n._setOnCancel(new l(r)),n._captureStackTrace()),n._setAsyncGuaranteed(),n};i.prototype.delay=function(e){return t(e,this)};i.prototype.timeout=function(e,i){e=+e;var o,s,t=new l(setTimeout(function(){var e,t,n,r;o.isPending()&&(e=o,n=s,r="string"!=typeof(t=i)?t instanceof Error?t:new c("operation timed out"):new c(t),u.markAsOriginatingFromRejection(r),e._attachExtraTrace(r),e._reject(r),null!=n&&n.cancel())},e));return a.cancellation()?(s=this.then(),(o=s._then(n,r,void 0,t,void 0))._setOnCancel(t)):o=this._then(n,r,void 0,t,void 0),o}}},{"./util":36}],35:[function(s,e,t){e.exports=function(f,h,p,t,e,v){function u(e){setTimeout(function(){throw e},0)}function g(i,o){var s=0,a=i.length,l=new f(e);return function e(){if(a<=s)return l._fulfill();var t,n,r=(t=i[s++],(n=p(t))!==t&&"function"==typeof t._isDisposable&&"function"==typeof t._getDisposer&&t._isDisposable()&&n._setDisposable(t._getDisposer()),n);if(r instanceof f&&r._isDisposable()){try{r=p(r._getDisposer().tryDispose(o),i.promise)}catch(e){return u(e)}if(r instanceof f)return r._then(e,u,null,null,null)}e()}(),l}function m(e,t,n){this._data=e,this._promise=t,this._context=n}function n(e,t,n){this.constructor$(e,t,n)}function y(e){return m.isDisposer(e)?(this.resources[this.index]._setDisposable(e),e.promise()):e}function _(e){this.length=e,this.promise=null,this[e-1]=null}var b=s("./util"),r=s("./errors").TypeError,i=s("./util").inherits,S=b.errorObj,C=b.tryCatch,o={};m.prototype.data=function(){return this._data},m.prototype.promise=function(){return this._promise},m.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():o},m.prototype.tryDispose=function(e){var t=this.resource(),n=this._context;void 0!==n&&n._pushContext();var r=t!==o?this.doDispose(t,e):null;return void 0!==n&&n._popContext(),this._promise._unsetDisposable(),this._data=null,r},m.isDisposer=function(e){return null!=e&&"function"==typeof e.resource&&"function"==typeof e.tryDispose},i(n,m),n.prototype.doDispose=function(e,t){return this.data().call(e,e,t)},_.prototype._resultCancelled=function(){for(var e=this.length,t=0;t<e;++t){var n=this[t];n instanceof f&&n.cancel()}},f.using=function(){var e=arguments.length;if(e<2)return h("you must pass at least 2 arguments to Promise.using");var o=arguments[e-1];if("function"!=typeof o)return h("expecting a function but got "+b.classString(o));var t,s=!0;2===e&&Array.isArray(arguments[0])?(e=(t=arguments[0]).length,s=!1):(t=arguments,e--);for(var n=new _(e),r=0;r<e;++r){var i=t[r];if(m.isDisposer(i)){var a=i;(i=i.promise())._setDisposable(a)}else{var l=p(i);l instanceof f&&(i=l._then(y,null,null,{resources:n,index:r},void 0))}n[r]=i}var u=new Array(n.length);for(r=0;r<u.length;++r)u[r]=f.resolve(n[r]).reflect();var c=f.all(u).then(function(e){for(var t=0;t<e.length;++t){var n=e[t];if(n.isRejected())return S.e=n.error(),S;if(!n.isFulfilled())return void c.cancel();e[t]=n.value()}d._pushContext(),o=C(o);var r=s?o.apply(void 0,e):o(e),i=d._popContext();return v.checkForgottenReturns(r,i,"Promise.using",d),r}),d=c.lastly(function(){var e=new f.PromiseInspection(c);return g(n,e)});return(n.promise=d)._setOnCancel(n),d},f.prototype._setDisposable=function(e){this._bitField=131072|this._bitField,this._disposer=e},f.prototype._isDisposable=function(){return 0<(131072&this._bitField)},f.prototype._getDisposer=function(){return this._disposer},f.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField,this._disposer=void 0},f.prototype.disposer=function(e){if("function"==typeof e)return new n(e,this,t());throw new r}}},{"./errors":12,"./util":36}],36:[function(e,t,n){function r(){try{var e=c;return c=null,e.apply(this,arguments)}catch(e){return h.e=e,h}}function i(e){return null==e||!0===e||!1===e||"string"==typeof e||"number"==typeof e}function o(e,t,n){if(i(e))return e;var r={value:n,configurable:!0,enumerable:!1,writable:!0};return d.defineProperty(e,t,r),e}function s(e){try{return e+""}catch(e){return"[no string representation]"}}function a(e){return e instanceof Error||null!==e&&"object"==(void 0===e?"undefined":_typeof(e))&&"string"==typeof e.message&&"string"==typeof e.name}function l(e){return a(e)&&d.propertyIsWritable(e,"stack")}function u(e){return{}.toString.call(e)}var c,d=e("./es5"),f="undefined"==typeof navigator,h={e:{}},p="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==E?E:void 0!==this?this:null,v=function(){var i=[Array.prototype,Object.prototype,Function.prototype],a=function(e){for(var t=0;t<i.length;++t)if(i[t]===e)return!0;return!1};if(d.isES5){var l=Object.getOwnPropertyNames;return function(e){for(var t=[],n=Object.create(null);null!=e&&!a(e);){var r;try{r=l(e)}catch(e){return t}for(var i=0;i<r.length;++i){var o=r[i];if(!n[o]){n[o]=!0;var s=Object.getOwnPropertyDescriptor(e,o);null!=s&&null==s.get&&null==s.set&&t.push(o)}}e=d.getPrototypeOf(e)}return t}}var o={}.hasOwnProperty;return function(e){if(a(e))return[];var t=[];e:for(var n in e)if(o.call(e,n))t.push(n);else{for(var r=0;r<i.length;++r)if(o.call(i[r],n))continue e;t.push(n)}return t}}(),g=/this\s*\.\s*\S+\s*=/,m=/^[a-z$_][a-z$_0-9]*$/i,y="stack"in new Error?function(e){return l(e)?e:new Error(s(e))}:function(e){if(l(e))return e;try{throw new Error(s(e))}catch(e){return e}},_=function(e){return d.isArray(e)?e:null};if("undefined"!=typeof Symbol&&Symbol.iterator){var b="function"==typeof Array.from?function(e){return Array.from(e)}:function(e){for(var t,n=[],r=e[Symbol.iterator]();!(t=r.next()).done;)n.push(t.value);return n};_=function(e){return d.isArray(e)?e:null!=e&&"function"==typeof e[Symbol.iterator]?b(e):null}}var S,C=void 0!==$&&"[object process]"===u($).toLowerCase(),T=void 0!==$&&void 0!==$.env,w={isClass:function(e){try{if("function"==typeof e){var t=d.names(e.prototype),n=d.isES5&&1<t.length,r=0<t.length&&!(1===t.length&&"constructor"===t[0]),i=g.test(e+"")&&0<d.names(e).length;if(n||r||i)return!0}return!1}catch(e){return!1}},isIdentifier:function(e){return m.test(e)},inheritedDataKeys:v,getDataPropertyOrDefault:function(e,t,n){if(!d.isES5)return{}.hasOwnProperty.call(e,t)?e[t]:void 0;var r=Object.getOwnPropertyDescriptor(e,t);return null!=r?null==r.get&&null==r.set?r.value:n:void 0},thrower:function(e){throw e},isArray:d.isArray,asArray:_,notEnumerableProp:o,isPrimitive:i,isObject:function(e){return"function"==typeof e||"object"==(void 0===e?"undefined":_typeof(e))&&null!==e},isError:a,canEvaluate:f,errorObj:h,tryCatch:function(e){return c=e,r},inherits:function(t,n){function e(){for(var e in this.constructor=t,(this.constructor$=n).prototype)r.call(n.prototype,e)&&"$"!==e.charAt(e.length-1)&&(this[e+"$"]=n.prototype[e])}var r={}.hasOwnProperty;return e.prototype=n.prototype,t.prototype=new e,t.prototype},withAppended:function(e,t){var n,r=e.length,i=new Array(r+1);for(n=0;n<r;++n)i[n]=e[n];return i[n]=t,i},maybeWrapAsError:function(e){return i(e)?new Error(s(e)):e},toFastProperties:function(e){function t(){}t.prototype=e;for(var n=8;n--;)new t;return e},filledRange:function(e,t,n){for(var r=new Array(e),i=0;i<e;++i)r[i]=t+i+n;return r},toString:s,canAttachTrace:l,ensureErrorObject:y,originatesFromRejection:function(e){return null!=e&&(e instanceof Error.__BluebirdErrorTypes__.OperationalError||!0===e.isOperational)},markAsOriginatingFromRejection:function(e){try{o(e,"isOperational",!0)}catch(e){}},classString:u,copyDescriptors:function(e,t,n){for(var r=d.names(e),i=0;i<r.length;++i){var o=r[i];if(n(o))try{d.defineProperty(t,o,d.getDescriptor(e,o))}catch(e){}}},hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:C,hasEnvVariables:T,env:function(e){return T?$.env[e]:void 0},global:p,getNativePromise:function(){if("function"==typeof Promise)try{var e=new Promise(function(){});if("[object Promise]"==={}.toString.call(e))return Promise}catch(e){}},domainBind:function(e,t){return e.bind(t)}};w.isRecentNode=w.isNode&&(0===(S=$.versions.node.split(".").map(Number))[0]&&10<S[1]||0<S[0]),w.isNode&&w.toFastProperties($);try{throw new Error}catch(e){w.lastLineError=e}t.exports=w},{"./es5":13}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(this,e("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:15}],2:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PreCallTest=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=e("./turnConnection"),o=e("./tests/rttTest"),s=e("./tests/throughputTest"),a=e("./utility/resultsHandler"),l=e("./utility/onlineCheck"),u=e("./utility/stats/detectbrowser"),c=e("bluebird"),d="rtt",f="throughput",h=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.browserInfo=(0,u.detect)(),this.turnConnection=new i.TurnConnection(this.browserInfo),this.onlineCheck=new l.OnlineCheck,this.callsInProgress=0,this.turnTests=[d,f],this.active=!1,this.rtt=null,this.resultsHandler=null}return r(e,[{key:"start",value:function(e,t){if(this.browserInfo.browserName!==u.Constants.browserName.msie)if(this.iceServers=e,this.callback=t,this.active)this.callback&&this.callback(null,"Not started: already in progress");else if(0<this.callsInProgress)this.callback&&this.callback(null,"Not started: call in progress");else if(e){this.turnTestCounter=0,this.resultsHandler=new a.ResultsHandler;var n={type:"browser",os:this.browserInfo.os,osVersion:this.browserInfo.osVersion,buildName:this.browserInfo.browserName,buildVersion:this.browserInfo.browserVersion};this.resultsHandler.add("endpointInfo",n),this.onlineCheck.start(),this.active=!0,this._start()}else this.callback&&this.callback(null,"Not started: no ICE servers given");else this.callback&&this.callback(null,"Not started: disabled for IE")}},{key:"_start",value:function(){var r=this;this.active&&this.turnConnection.connect(this.iceServers).then(function(){r.active?r.startTurnTests().then(function(){r.stop()},function(e){r.stop()}):r.stop()},function(t){var e=t.continueFlag;if(r.resultsHandler.failure(t),!e){r.turnConnection.disconnect(),r.active=!1;var n="";try{n=t.stack}catch(e){n=t.toString()}return n&&""!==n||(n=t.toString()),void r.callback(null,n)}10<=r.resultsHandler.getFailureNumber()?r.stop():(r.turnConnection.disconnect(),setTimeout(function(){r._start()},0))})}},{key:"stop",value:function(){var t=this;if(this.browserInfo.browserName!==u.Constants.browserName.msie&&this.active){this.active=!1,this.activeTurnTest&&this.activeTurnTest.forceStop();var e=this.onlineCheck.stop();this.resultsHandler&&this.resultsHandler.add("onlineStatus",e),this.turnConnection.getIceResults().then(function(e){t.resultsHandler&&t.resultsHandler.add("ice",e),t.turnConnection.disconnect(),t.sendResults()},function(e){t.resultsHandler&&t.resultsHandler.failure(e),t.turnConnection.disconnect(),t.sendResults()})}}},{key:"sendResults",value:function(){this.resultsHandler||this.callback&&this.callback(null,"No results present");var e=this.resultsHandler.getResults();this.callback&&this.callback(e,null),this.resultsHandler=null}},{key:"callStarts",value:function(){this.callsInProgress+=1,this.stop()}},{key:"callFinished",value:function(){this.callsInProgress-=1}},{key:"getId",value:function(){return this.resultsHandler?this.resultsHandler.getId():null}},{key:"crashDisconnect",value:function(){try{this.turnConnection.disconnect()}catch(e){}}},{key:"startTurnTests",value:function(){var t=this;if(this.turnTestCounter>=this.turnTests.length)return new c(function(e,t){e()});var n=this.turnTests[this.turnTestCounter],r=null;switch(n){case d:r=new o.RttTest(this.turnConnection);break;case f:r=new s.ThroughputTest(this.turnConnection,this.rtt);break;default:return new c(function(e,t){t(new Error("Unknown test: "+n))})}return this.activeTurnTest=r,this.active?r.start().then(function(){return t.handleTestResults(n,r.getResults()),t.turnTestCounter+=1,t.activeTurnTest=null,t.startTurnTests()},function(e){return t.handleTestResults(n,r.getResults(),e),t.turnTestCounter+=1,t.activeTurnTest=null,t.startTurnTests()}):new c(function(e,t){t(new Error("Test trying to start while testing is not active"))})}},{key:"handleTestResults",value:function(e,t){null==(2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)&&e==d&&(this.rtt=t.median),this.resultsHandler&&this.resultsHandler.add(e,t)}}]),e}();n.PreCallTest=h},{"./tests/rttTest":3,"./tests/throughputTest":4,"./turnConnection":6,"./utility/onlineCheck":8,"./utility/resultsHandler":10,"./utility/stats/detectbrowser":11,bluebird:1}],3:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.RttTest=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/timestamps")),o=e("./turnTest"),s=function(e){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e));return t.sendTimer=null,t.countSent=0,t.rtts=[],t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,o.TurnTest),r(n,[{key:"initiate",value:function(){this.results.startTimestamp=i.getCurrent(),this.sendPing()}},{key:"handleMessage",value:function(e){if(this.isActive()){var t=parseInt(e,10),n=this.calculateRtt(t);this.rtts.push(n),this.countSent<10?this.sendPing():this.calculateMetrics()}}},{key:"handleError",value:function(e){this.fillResults(),this.failed(e)}},{key:"sendPing",value:function(){if(this.isActive()){var e=i.getCurrent();this.send(e.toString()),this.countSent+=1,this.sendTimer&&(clearTimeout(this.sendTimer),this.sendTimer=null),this.countSent<10?this.sendTimer=setTimeout(this.sendPing.bind(this),100):this.sendTimer=setTimeout(this.calculateMetrics.bind(this),500)}}},{key:"calculateRtt",value:function(e){return i.getCurrent()-e}},{key:"calculateMetrics",value:function(){this.sendTimer&&(clearTimeout(this.sendTimer),this.sendTimer=null),this.fillResults(),this.finished()}},{key:"fillResults",value:function(){this.results.sentMessages=this.countSent,this.results.unAckedMessages=this.countSent-this.rtts.length,this.results.maxMessages=10,this.results.forceStopped=this.forceStopped,this.results.median=this.median(),this.results.variance=this.variance(),this.results.endTimestamp=i.getCurrent()}},{key:"median",value:function(){if(0==this.rtts.length)return null;this.rtts.sort();var e=Math.floor(this.rtts.length/2);return this.rtts[e]}},{key:"variance",value:function(){if(0==this.rtts.length)return null;for(var e=0,t=this.median(),n=0;n<this.rtts.length;n++){var r=this.rtts[n];e+=Math.abs(r-t)}return e/this.rtts.length}},{key:"stop",value:function(){this.isActive()&&(function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(r):void 0}(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"stop",this).call(this),this.fillResults())}}]),n}();n.RttTest=s},{"../utility/timestamps":14,"./turnTest":5}],4:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ThroughputTest=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/timestamps")),o=e("../utility/messageMaker"),a=e("./turnTest"),i=function(e){function i(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e));if(n.sentBytes=0,n.receivedBytes=0,n.secondHalfBytes=0,n.secondHalfStart=null,n.bufferEmpty=0,n.chunkSize=1200,n.messageMaker=new o.MessageMaker(n.chunkSize),n.duration=5e3,null!=t){var r=50*t;n.duration=Math.max(Math.min(r,1e4),1e3)}return n.sendTimer=null,n.lastMessage=null,n.intervals=[],n.intervalStart=0,n.intervalLength=100,n.intervalBytes=0,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,a.TurnTest),r(i,[{key:"initiate",value:function(){window&&window.csioReactNative?this.handleError(new Error("Not running throughput test for react-native")):this.startSend()}},{key:"handleMessage",value:function(e){var t=this;if(this.isActive()){this.lastMessage=e,this.receivedBytes+=e.length;var n=s.getCurrent();if(this.sendTimer||(this.results.startTimestamp=n,this.sendTimer=setTimeout(function(){t.stop(),t.finished()},this.duration)),0==this.intervalStart&&(this.intervalStart=n),this.intervalBytes+=e.length,n-this.intervalStart>=this.intervalLength){var r=n-this.intervalStart,i=this.averageThroughput(this.intervalBytes,r),o=null;try{o=n-JSON.parse(this.lastMessage).timestamp}catch(e){}this.intervals.push({startTimestamp:this.intervalStart,endTimestamp:n,bytesReceived:this.intervalBytes,average:i,rtt:o}),this.intervalStart=n,this.intervalBytes=0}this.results.startTimestamp&&n-this.results.startTimestamp>this.duration/2&&(this.secondHalfStart||(this.secondHalfStart=n),this.secondHalfBytes+=e.length)}}},{key:"handleError",value:function(e){this.stop(),this.failed(e)}},{key:"averageThroughput",value:function(e,t){return e/(t/1e3)*8/1024}},{key:"bufferListener",value:function(){this.sendChannel.removeEventListener("bufferedamountlow",this.bufferListener.bind(this)),this.fillBuffer()}},{key:"fillBuffer",value:function(){for(0==this.sendChannel.bufferedAmount&&(this.bufferEmpty+=1);this.isActive();){if(this.sendChannel.bufferedAmount>this.bufferFullThreshold)return void(this.usePolling?setTimeout(this.fillBuffer.bind(this),250):this.sendChannel.addEventListener("bufferedamountlow",this.bufferListener.bind(this)));var e=this.messageMaker.make(this.sentBytes);this.sentBytes+=e.length,this.send(e)}this.sendChannel.removeEventListener("bufferedamountlow",this.bufferListener.bind(this))}},{key:"startSend",value:function(){this.isActive()&&(this.bufferFullThreshold=1e3*this.chunkSize,this.sendChannel=this.connection.sendChannel,this.usePolling=!0,"number"==typeof this.sendChannel.bufferedAmountLowThreshold&&(this.usePolling=!1,this.sendChannel.bufferedAmountLowThreshold=this.bufferFullThreshold/10),setTimeout(this.fillBuffer.bind(this),0))}},{key:"fillResults",value:function(){this.results.endTimestamp=s.getCurrent(),this.results.maxDuration=this.duration,this.results.forceStopped=this.forceStopped,this.results.bufferEmpty=this.bufferEmpty,this.results.intervals=this.intervals,this.results.bytesPrepared=this.sentBytes,this.results.bytesReceived=this.receivedBytes;var e=0,t=0;this.secondHalfStart&&(e=this.results.endTimestamp-this.secondHalfStart,t=this.averageThroughput(this.secondHalfBytes,e));var n=this.results.endTimestamp-this.results.startTimestamp,r=this.averageThroughput(this.receivedBytes,n);t<r&&(t=r),this.results.average=t;var i=null;try{i=JSON.parse(this.lastMessage)}catch(e){return}if(i){var o=i.sentBytes+this.lastMessage.length;this.results.bytesSent=o,this.results.fractionLostBytes=1-this.receivedBytes/o}else this.results.bytesSent=-1,this.results.fractionLostBytes=-1}},{key:"stop",value:function(){this.isActive()&&(clearTimeout(this.sendTimer),this.sendTimer=null,function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(r):void 0}(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"stop",this).call(this),this.fillResults())}}]),i}();n.ThroughputTest=i},{"../utility/messageMaker":7,"../utility/timestamps":14,"./turnTest":5}],5:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=e("bluebird"),o=function(){function t(e){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,t),this.connection=e,this.active=!1,this.results={}}return r(t,[{key:"getResults",value:function(){return this.results}},{key:"start",value:function(){var n=this,e=new i(function(e,t){n.resolveCb=e,n.rejectCb=t});return this.connection.setMessageCallback(this.handleMessage.bind(this)),this.connection.setErrorCallback(this.handleError.bind(this)),this.active=!0,this.forceStopped=!1,this.initiate(),e}},{key:"stop",value:function(){this.active=!1}},{key:"forceStop",value:function(){this.forceStopped=!0,this.stop(),this.finished()}},{key:"isActive",value:function(){return this.active}},{key:"initiate",value:function(){}},{key:"handleMessage",value:function(e){}},{key:"handleError",value:function(e){}},{key:"send",value:function(e){this.connection.send(e)}},{key:"finished",value:function(){this.active=!1,this.resolveCb&&(this.resolveCb(),this.resolveCb=null)}},{key:"failed",value:function(e){this.active=!1,this.rejectCb&&(this.rejectCb(e),this.rejectCb=null)}}]),t}();n.TurnTest=o},{bluebird:1}],6:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TurnConnection=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=e("./utility/parsedIceCandidate"),o=e("./utility/stats/getstatshandler"),s=e("./utility/stats/detectbrowser"),a=e("bluebird"),l=function(){function t(e){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,t),this.reset(),this.statshandler=new o.GetStatsHandler(e)}return r(t,[{key:"reset",value:function(){this.disconnect(),this.iceServers=null,this.pctpc1=null,this.pctpc2=null,this.sendChannel=null,this.messageCallback=null,this.errorCallback=null,this.parsedIceResults={},this.resolveCb=null,this.rejectCb=null}},{key:"setMessageCallback",value:function(e){this.messageCallback=e}},{key:"setErrorCallback",value:function(e){this.errorCallback=e}},{key:"send",value:function(e){if(this.sendChannel)try{this.sendChannel.send(e)}catch(e){this.raiseSendError(e)}else this.raiseSendError(new Error("No send channel"))}},{key:"raiseSendError",value:function(e){this.errorCallback&&this.errorCallback(e)}},{key:"assignEvent",value:function(e,t,n){e.addEventListener?e.addEventListener(t,n.bind(this),!1):e.attachEvent&&(t="on"+t,e.attachEvent(t,n.bind(this)))}},{key:"connect",value:function(e){var n=this;this.reset();var t=new a(function(e,t){n.resolveCb=e,n.rejectCb=t});this.iceServers=e;var r=null;try{if(RTCPeerConnection?r=RTCPeerConnection:webkitRTCPeerConnection?r=webkitRTCPeerConnection:mozRTCPeerConnection?r=mozRTCPeerConnection:window&&window.RTCPeerConnection&&(r=window.RTCPeerConnection),!r){var i=new Error("RTCPeerConnection not found");return i.continueFlag=!1,this.rejectCb(i),t}}catch(i){return i.continueFlag=!1,this.rejectCb(i),t}var o={iceTransportPolicy:"all",iceServers:this.iceServers};try{this.pctpc1=new r(o),this.pctpc2=new r(o)}catch(i){return this.rejectDisconnect(!1,i),t}this.connectionTimer=setTimeout(function(){delete n.connectionTimer,n.rejectDisconnect(!1,new Error("Connection timeout"))},3e4);try{this.sendChannel=this.pctpc1.createDataChannel("precalltest",{ordered:!1,maxRetransmits:0}),this.sendChannel.binaryType="arraybuffer",this.assignEvent(this.sendChannel,"error",function(e){n.raiseSendError(e),n.rejectDisconnect(!0,e)}),this.assignEvent(this.pctpc2,"datachannel",function(e){var t=e.channel;n.assignEvent(t,"open",function(e){n.resolveCb&&(n.resolveCb(),n.resolveCb=null)}),n.assignEvent(t,"close",function(e){n&&n.disconnect&&n.disconnect()}),n.assignEvent(t,"message",function(e){n.messageCallback&&n.messageCallback(e.data)}),n.assignEvent(t,"error",function(e){n.errorCallback&&n.errorCallback(e),n.rejectDisconnect(!0,e)})})}catch(i){return this.rejectDisconnect(!1,i),t}try{this.assignEvent(this.pctpc1,"icecandidate",function(e){n.onIceCandidate(n.pctpc1,e)}),this.assignEvent(this.pctpc1,"iceconnectionstatechange",function(e){n.onIceStateChange(n.pctpc1,e)}),this.assignEvent(this.pctpc2,"icecandidate",function(e){n.onIceCandidate(n.pctpc2,e)}),this.assignEvent(this.pctpc2,"iceconnectionstatechange",function(e){n.onIceStateChange(n.pctpc2,e)}),this.pctpc1.createOffer().then(function(e,t){n.onCreateOfferSuccess(e)},function(e){n.onCreateOfferError(n.pctpc1,e)})}catch(i){return this.rejectDisconnect(!1,i),t}return t}},{key:"rejectDisconnect",value:function(e,t){this.disconnect(),this.rejectCb&&(t.continueFlag=e,this.rejectCb(t)),this.resolveCb=null,this.rejectCb=null}},{key:"disconnect",value:function(){if(clearTimeout(this.connectionTimer),clearTimeout(this.iceTimer),this.pctpc1)try{this.pctpc1.close()}catch(e){}if(this.pctpc1=null,this.pctpc2)try{this.pctpc2.close()}catch(e){}this.pctpc2=null}},{key:"getName",value:function(e){return e===this.pctpc1?"pctpc1":"pctpc2"}},{key:"getOtherPc",value:function(e){return e===this.pctpc1?this.pctpc2:this.pctpc1}},{key:"onCreateOfferError",value:function(e,t){this.rejectDisconnect(!1,t)}},{key:"onCreateAnswerError",value:function(e,t){this.rejectDisconnect(!1,t)}},{key:"onCreateOfferSuccess",value:function(e){var t=this;try{this.pctpc1.setLocalDescription(e).then(function(){t.onSetLocalSuccess(t.pctpc1)},function(e){t.onSetSessionDescriptionError(t.pctpc1,e)}),this.pctpc2.setRemoteDescription(e).then(function(){t.onSetRemoteSuccess(t.pctpc2)},function(e){t.onSetRemoteSessionDescriptionError(t.pctpc2,e)}),this.pctpc2.createAnswer().then(function(e){t.onCreateAnswerSuccess(e)},function(e){t.onCreateAnswerError(t.pctpc2,e)})}catch(e){this.rejectDisconnect(!1,e)}}},{key:"onSetLocalSuccess",value:function(e){}},{key:"onSetRemoteSuccess",value:function(e){}},{key:"onSetSessionDescriptionError",value:function(e,t){this.rejectDisconnect(!1,t)}},{key:"onSetRemoteSessionDescriptionError",value:function(e,t){this.rejectDisconnect(!1,t)}},{key:"onCreateAnswerSuccess",value:function(e){var t=this;try{this.pctpc2.setLocalDescription(e).then(function(){t.onSetLocalSuccess(t.pctpc2)},function(e){t.onSetSessionDescriptionError(t.pctpc2,e)}),this.pctpc1.setRemoteDescription(e).then(function(){t.onSetRemoteSuccess(t.pctpc1)},function(e){t.onSetRemoteSessionDescriptionError(t.pctpc1,e)})}catch(e){this.rejectDisconnect(!1,e)}}},{key:"onIceCandidate",value:function(t,e){var n=this;try{if(!e.candidate)return;var r=new i.ParsedIceCandidate(e.candidate);if(t==this.pctpc1&&this.statshandler.codeBase==s.Constants.codeBaseType.chrome&&(r.isRelay()&&(r.isTypeTransportUdp()&&(this.parsedIceResults.relayUdpGathered=!0),r.isTypeTransportTcp()&&(this.parsedIceResults.relayTcpGathered=!0),r.isTypeTransportTls()&&(this.parsedIceResults.relayTlsGathered=!0)),r.isServerReflexive()&&(this.parsedIceResults.srflxGathered=!0)),!r.isRelay())return;this.getOtherPc(t).addIceCandidate(e.candidate).then(function(){n.onAddIceCandidateSuccess(t)},function(e){n.onAddIceCandidateError(t,e,r.isRelay())})}catch(t){this.rejectDisconnect(!1,t)}}},{key:"onAddIceCandidateSuccess",value:function(e){}},{key:"onAddIceCandidateError",value:function(e,t,n){n&&this.rejectDisconnect(!1,t)}},{key:"onIceStateChange",value:function(e,t){var n=this;try{var r="(?)";e&&(r=e.iceConnectionState),"failed"===r&&this.rejectDisconnect(!0,new Error("ICE failure")),"checking"!==r||this.iceTimer||(this.iceTimer=setTimeout(function(){delete n.iceTimer,n.rejectDisconnect(!0,new Error("ICE timeout"))},1e4)),"completed"!==r&&"connected"!==r||(clearTimeout(this.iceTimer),delete this.iceTimer)}catch(e){this.rejectDisconnect(!1,e)}}},{key:"getIceResults",value:function(){var o=this;return new a(function(h,t){for(var e=JSON.parse(JSON.stringify(o.iceServers)),n=0;n<e.length;n++){var r=e[n];e.hasOwnProperty(r)||delete r.credential}var p={turnIpAddress:"",turnIpVersion:"",turnTransport:"",iceServers:e,ipv6Supported:!1,ipv4Supported:!1,relayTlsGathered:!1,relayTcpGathered:!1,relayUdpGathered:!1,srflxGathered:!1,relayTlsSuccess:!1,relayTcpSuccess:!1,relayUdpSuccess:!1,srflxSuccess:!1};for(var i in o.parsedIceResults)o.parsedIceResults.hasOwnProperty(i)&&(p[i]=o.parsedIceResults[i]);o.pctpc1?o.statshandler.getIceCandidates(o.pctpc1).then(function(e){for(var t=0;t<e.iceCandidatePairs.length;t++){var n=e.iceCandidatePairs[t];if(n.googActiveConnection||n.selected)for(var r=0;r<e.localCandidates.length;r++){var i=e.localCandidates[r],o=null;if(o=i.ip?i.ip:i.ipAddress,i.id==n.localCandidateId){var s=-1!==(p.turnIpAddress=o).indexOf(":");p.turnIpVersion=s?"ipv6":"ipv4",p.turnTransport=i.mozLocalTransport}"relay"!==i.candidateType&&"relayed"!==i.candidateType||("udp"===i.mozLocalTransport&&(p.relayUdpSuccess=!0),"tcp"===i.mozLocalTransport&&(p.relayTcpSuccess=!0),"tls"===i.mozLocalTransport&&(p.relayTlsSuccess=!0)),-1!==o.indexOf(":")?p.ipv6Supported=!0:p.ipv4Supported=!0}}for(var a=0;a<e.localCandidates.length;a++){var l=e.localCandidates[a];"relay"!==l.candidateType&&"relayed"!==l.candidateType||("udp"===l.mozLocalTransport&&(p.relayUdpGathered=!0),"tcp"===l.mozLocalTransport&&(p.relayTcpGathered=!0),"tls"===l.mozLocalTransport&&(p.relayTlsGathered=!0)),"srflx"!==l.candidateType&&"serverreflexive"!==l.candidateType||(p.srflxGathered=!0)}for(var u=0;u<e.iceCandidatePairs.length;u++){var c=e.iceCandidatePairs[u];if("succeeded"===c.state)for(var d=0;d<e.localCandidates.length;d++){var f=e.localCandidates[d];f.id==c.localCandidateId&&("relay"!==f.candidateType&&"relayed"!==f.candidateType||("udp"===f.mozLocalTransport&&(p.relayUdpSuccess=!0),"tcp"===f.mozLocalTransport&&(p.relayTcpSuccess=!0),"tls"===f.mozLocalTransport&&(p.relayTlsSuccess=!0)),"srflx"!==f.candidateType&&"serverreflexive"!==f.candidateType||(p.srflxSuccess=!0))}}h(p)},function(e){t(e)}):t(new Error("PC not available for stats"))},function(e){reject(e)})}}]),t}();n.TurnConnection=l},{"./utility/parsedIceCandidate":9,"./utility/stats/detectbrowser":11,"./utility/stats/getstatshandler":12,bluebird:1}],7:[function(e,t,n){function r(e){for(var t="",n=0;n<e;n++)t+=String.fromCharCode(35+58*Math.random());return t}Object.defineProperty(n,"__esModule",{value:!0}),n.randomAsciiString=n.MessageMaker=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/timestamps")),s=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1200;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,n),this.message={timestamp:"",sentBytes:1e4,padding:""};var t=r(e-o.getCurrent().toString().length-JSON.stringify(this.message).length);this.message.padding=t}return i(n,[{key:"make",value:function(e){return this.message.timestamp=o.getCurrent(),this.message.sentBytes=e,JSON.stringify(this.message)}}]),n}();n.MessageMaker=s,n.randomAsciiString=r},{"../utility/timestamps":14}],8:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.OnlineCheck=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("./timestamps")),o=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.active=!1}return r(e,[{key:"start",value:function(){var e=this;this.active=!0,this.onlineCheck=[],window&&window.addEventListener&&"function"==typeof window.addEventListener&&(window.addEventListener("offline",function(){e.addEntry()}),window.addEventListener("online",function(){e.addEntry()}),this.addEntry())}},{key:"addEntry",value:function(){if(this.active){var e=i.getCurrent();if(navigator&&navigator.onLine){var t=navigator.onLine;this.onlineCheck.push({timestamp:e,online:t})}}}},{key:"stop",value:function(){var e=this;return this.active=!1,window&&window.removeEventListener&&"function"==typeof window.removeEventListener&&(window.removeEventListener("offline",function(){e.addEntry()}),window.removeEventListener("online",function(){e.addEntry()})),this.onlineCheck}}]),e}();n.OnlineCheck=o},{"./timestamps":14}],9:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=function(){function t(e){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,t),this.iceCandidateStr=e.candidate,this.parse()}return r(t,[{key:"parse",value:function(){var e=this.iceCandidateStr.split(" ");e.length<8||(this.protocol="1"===e[1]?"rtp":"rtcp",this.transport=e[2],this.typeTransport=this.extractTypeTransport(e[3]),this.ipv6=-1!==e[4].indexOf(":"),this.ipAddress=e[4],this.port=e[5],this.type=e[7])}},{key:"extractTypeTransport",value:function(e){var t="None",n=e>>24;if("rtp"===this.protocol&&0<=n&&n<=2)switch(n){case 0:t="TLS";break;case 1:t="TCP";break;case 2:t="UDP"}return t}},{key:"getString",value:function(){return this.iceCandidateStr}},{key:"getType",value:function(){return this.type}},{key:"isHost",value:function(){return"host"===this.type.toLowerCase()}},{key:"isServerReflexive",value:function(){return"srflx"===this.type.toLowerCase()}},{key:"isPeerReflexive",value:function(){return"prflx"===this.type.toLowerCase()}},{key:"isRelay",value:function(){return"relay"===this.type.toLowerCase()||"relayed"===this.type.toLowerCase()}},{key:"getTypeTransport",value:function(){return this.typeTransport}},{key:"isTypeTransportUdp",value:function(){return"UDP"===this.typeTransport}},{key:"isTypeTransportTcp",value:function(){return"TCP"===this.typeTransport}},{key:"isTypeTransportTls",value:function(){return"TLS"===this.typeTransport}},{key:"getTransport",value:function(){return this.transport}},{key:"isUdp",value:function(){return"udp"===this.transport.toLowerCase()}},{key:"isTcp",value:function(){return"tcp"===this.transport.toLowerCase()}},{key:"getProtocol",value:function(){return this.protocol}},{key:"isRtp",value:function(){return"rtp"===this.protocol}},{key:"isRtcp",value:function(){return"rtcp"===this.protocol}},{key:"isIpv6",value:function(){return this.ipv6}},{key:"getIpAddress",value:function(){return this.ipAddress}},{key:"getPort",value:function(){return this.port}}]),t}();n.ParsedIceCandidate=i},{}],10:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ResultsHandler=void 0;var r="function"==typeof Symbol&&"symbol"==_typeof(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof(e)},i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("./timestamps")),s=e("./messageMaker"),a=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.start=o.getCurrent(),this.id=Math.trunc(this.start)+"-"+(0,s.randomAsciiString)(20),this.version="1.2.0",this.failures=[],this.results={},this.forceStopped=!1}return i(e,[{key:"getResults",value:function(){return{id:this.id,version:this.version,forceStopped:this.forceStopped,startTimestamp:this.start,endTimestamp:o.getCurrent(),failures:this.failures,tests:this.results}}},{key:"getFailureNumber",value:function(){return this.failures.length}},{key:"getId",value:function(){return this.id}},{key:"add",value:function(e,t){(this.results[e]=t).forceStopped&&!0===t.forceStopped&&(this.forceStopped=!0)}},{key:"failure",value:function(e){"object"===(void 0===e?"undefined":r(e))&&(e=e.toString());var t={timestamp:o.getCurrent(),reason:e};this.failures.push(t)}}]),e}();n.ResultsHandler=a},{"./messageMaker":7,"./timestamps":14}],11:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.detect=function(){var e=f.browserName.chrome,t=null,n=null,r=null,i=f.codeBaseType.chrome;if(window&&(!window.navigator||!window.navigator.userAgent||window.csioReactNative))return window&&window.csioGetOsName&&(t=window.csioGetOsName()),window&&window.csioGetOsVer&&(n=window.csioGetOsVer()),window&&window.csioReactNative&&(r="react-native"),{browserName:e,codeBase:i,os:t,osVersion:n,userAgent:r};var o=(r=navigator.userAgent).toLowerCase(),s=navigator.appVersion,a=""+parseFloat(navigator.appVersion),l=void 0;-1!==(l=o.indexOf("opera"))?(e=f.browserName.opera,a=o.substring(l+6),-1!==(l=o.indexOf("Version"))&&(a=o.substring(l+8)),i=f.codeBaseType.chrome):-1!==(l=o.indexOf("opr"))?(e=f.browserName.opera,a=o.substring(l+4),-1!==(l=o.indexOf("Version"))&&(a=o.substring(l+8)),i=f.codeBaseType.chrome):-1!==(l=o.indexOf("msie"))?(e=f.browserName.msie,a=o.substring(l+5),i=f.codeBaseType.chrome):-1!==(l=o.indexOf("edge"))?(e=f.browserName.edge,a=o.substring(l+5),i=f.codeBaseType.edge):-1!==(l=o.indexOf("chrome"))?(e=f.browserName.chrome,a=o.substring(l+7),i=f.codeBaseType.chrome):-1!==(l=o.indexOf("safari"))?(e=f.browserName.safari,a=o.substring(l+7),-1!==(l=o.indexOf("Version"))&&(a=o.substring(l+8)),i=f.codeBaseType.chrome):-1!==(l=o.indexOf("firefox"))?(e=f.browserName.firefox,a=o.substring(l+8),i=f.codeBaseType.firefox):-1!==(l=o.indexOf("trident"))&&(e=f.browserName.msie,l=o.indexOf("rv"),a=o.substring(l+3,l+7),i=f.codeBaseType.chrome);var u=[{s:"Windows 3.11",r:/win16/},{s:"Windows 95",r:/(windows 95|win95|windows_95)/},{s:"Windows ME",r:/(win 9x 4.90|windows me)/},{s:"Windows 98",r:/(windows 98|win98)/},{s:"Windows CE",r:/windows ce/},{s:"Windows 2000",r:/(windows nt 5.0|windows 2000)/},{s:"Windows XP",r:/(windows nt 5.1|windows xp)/},{s:"Windows Server 2003",r:/windows nt 5.2/},{s:"Windows Vista",r:/windows nt 6.0/},{s:"Windows 7",r:/(windows 7|windows nt 6.1)/},{s:"Windows 8.1",r:/(windows 8.1|windows nt 6.3)/},{s:"Windows 8",r:/(windows 8|windows nt 6.2)/},{s:"Windows 10",r:/(windows 10|windows nt 10.0)/},{s:"Windows NT 4.0",r:/(windows nt 4.0|winnt4.0|winnt|windows nt)/},{s:"Windows ME",r:/windows me/},{s:"Android",r:/android/},{s:"Open BSD",r:/openbsd/},{s:"Sun OS",r:/sunos/},{s:"Linux",r:/(linux|x11)/},{s:"iOS",r:/(iphone|ipad|ipod)/},{s:"Mac OS X",r:/mac os x/},{s:"Mac OS",r:/(macppc|macintel|mac_powerpc|macintosh)/},{s:"QNX",r:/qnx/},{s:"UNIX",r:/unix/},{s:"BeOS",r:/beos/},{s:"OS/2",r:/os\/2/},{s:"Search Bot",r:/(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\/teoma|ia_archiver)/}],c=void 0,d=void 0;for(c in u)if(u.hasOwnProperty(c)&&(d=u[c]).r.test(o)){t=d.s;break}switch(t&&/Windows/.test(t)&&(n=/Windows (.*)/.exec(t)[1],t=f.osName.windows),t){case f.osName.mac:n=/mac os x (10[\.\_\d]+)/.exec(o)[1];break;case f.osName.android:n=/android ([\.\_\d]+)/.exec(o)[1];break;case f.osName.ios:n=(n=/os (\d+)_(\d+)_?(\d+)?/.exec(s))[1]+"."+n[2]+"."+(0|n[3])}return{browserName:e,browserVersion:a.toString(),os:t,osVersion:n,codeBase:i,userAgent:r}};var f=n.Constants={codeBaseType:{chrome:"Chrome",firefox:"Firefox",edge:"Edge",plugin:"Plugin"},browserName:{chrome:"Chrome",firefox:"Firefox",edge:"Edge",msie:"Microsoft Internet Explorer",safari:"Safari"},osName:{windows:"Windows",mac:"Mac OS X",android:"Android",ios:"iOS"}}},{}],12:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.GetStatsHandler=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),a=e("./detectbrowser"),i=e("./statsadapter"),o=e("bluebird"),s=function(){function t(e){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,t),this.codeBase=e.codeBase,this.browserName=e.browserName,this.adapter=new i.StatsAdapter(this.codeBase,this.browserName),this.isPromiseBased=!0}return r(t,[{key:"getIceCandidates",value:function(n){var r=this;return new o(function(t,e){r.csioGetStats(r.iceCandidatesHandler.bind(r),n,function(e){t(e)})})}},{key:"iceCandidatesHandler",value:function(e,t){t(this.adapter.getIceCandidates(e))}},{key:"csioGetStats",value:function(e,t,n){var r=a.Constants.codeBaseType.firefox,i=a.Constants.codeBaseType.chrome,o=a.Constants.codeBaseType.edge,s=a.Constants.browserName.safari;t&&(this.codeBase===r?this.getStatsFirefox(e,t,n):this.browserName===s?this.getStatsSafari(e,t,n):this.codeBase===i?this.getStatsChrome(e,t,n):this.codeBase===o&&this.getStatsEdge(e,t,n))}},{key:"getStatsFirefox",value:function(t,n,r){var i=this;if(i.isPromiseBased)try{n.getStats().then(function(e){t(e,r)}).catch(function(e){i.isPromiseBased=!1,n.getStats(null,function(e){t(e,r)},function(){})})}catch(e){i.isPromiseBased=!1,n.getStats(null,function(e){t(e,r)},function(){})}else n.getStats(null,function(e){t(e,r)},function(){})}},{key:"getStatsChrome",value:function(t,n,r){var i=this;if(window&&window.csioReactNative)n.getStats(null,function(e){t(e,r)},function(e){});else if(i.isPromiseBased)try{n.getStats().then(function(e){t(e,r)}).catch(function(e){i.isPromiseBased=!1,n.getStats(function(e){t(e,r)})})}catch(i){isPromiseBased=!1,n.getStats(function(e){t(e,r)})}else n.getStats(function(e){t(e,r)})}},{key:"getStatsEdge",value:function(t,e,n){e.getStats().then(function(e){t(e,n)}).catch(function(e){})}},{key:"getStatsSafari",value:function(t,e,n){e.getStats().then(function(e){t(e,n)}).catch(function(e){})}}]),t}();n.GetStatsHandler=s},{"./detectbrowser":11,"./statsadapter":13,bluebird:1}],13:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.StatsAdapter=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),s=e("./detectbrowser"),i=function(){function n(e,t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,n),this.codeBase=e,this.browser=t}return r(n,[{key:"getIceCandidates",value:function(e){if(!e)return null;var t=this.extractRawStats(e);return this.processRawStatsForIceInfo(t)}},{key:"extractRawStats",value:function(e){var t=[],n=void 0,r=s.Constants.codeBaseType.firefox,i=s.Constants.codeBaseType.chrome,o=s.Constants.browserName.safari;if(this.codeBase===r&&this.browser!==o)e.forEach(function(e){t.push(e)});else if(this.codeBase===i&&this.browser!==o)e&&e.result?t=e.result():e&&e.forEach&&(t=[],e.forEach(function(e){t.push(e)}));else for(n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}},{key:"processRawStatsForIceInfo",value:function(e){var t=[],n=[],r=[],i=void 0;if(!e)return null;for(var o=0;o<e.length;++o){var s=this.getParsedStats(e[o]),a=this.statsClassifier(s);if(a.candidatePair)r.push(a.candidatePair);else if(a.transportStats){if("transport"===a.transportStats.type){i=a.transportStats.selectedCandidatePairId;continue}r.push(a.transportStats)}else if(a.localCandidate){var l=a.localCandidate;if("relay"==l.candidateType||"relayed"==l.candidateType){if(!l.mozLocalTransport){var u=l.priority>>24;l.mozLocalTransport=this.formatRelayType(u)}l.mozLocalTransport=l.mozLocalTransport.toLowerCase()}t.push(l)}else a.remoteCandidate&&n.push(a.remoteCandidate)}if(i)for(var c=0;c<r.length;++c)r[c].id===i&&(r[c].googActiveConnection="true");return{localCandidates:t,remoteCandidates:n,iceCandidatePairs:r}}},{key:"getParsedStats",value:function(e){var t={};if(e.timestamp instanceof Date&&(t.timestamp=e.timestamp.getTime().toString()),e.type&&(t.type=e.type),e.names)for(var n=e.names(),r=0;r<n.length;++r)t[n[r]]=e.stat(n[r]);else Object.assign(t,e);if(t.values){for(var i=0;i<t.values.length;i++){var o=t.values[i];Object.assign(t,o)}delete t.values}return t}},{key:"statsClassifier",value:function(o){var e={},t=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var r=0;r<t.length;r++){var i=t[r];if(o.type===i)return!0}return!1},n=t("inbound-rtp","inboundrtp"),r="true"===o.isRemote||!0===o.isRemote;return n||t("outbound-rtp","outboundrtp")?(e.tracks={},e.tracks.data=o,e.tracks.ssrc=o.ssrc,e.tracks.streamType=n?"inbound":"outbound",e.tracks.reportType="local",void 0!==o.isRemote&&(e.tracks.reportType=r?"remote":"local")):t("candidatepair")&&o.selected?e.transportStats=o:t("localcandidate","local-candidate")?e.localCandidate=o:t("remotecandidate","remote-candidate")?e.remoteCandidate=o:t("transport","googCandidatePair")?e.transportStats=o:t("VideoBwe")?e.bwe=o:t("track")?e.trackStats=o:t("candidate-pair")?e.candidatePair=o:t("codec")?e.codec=o:t("ssrc")&&(e.tracks={},e.tracks.data=o,e.tracks.ssrc=o.ssrc,e.tracks.reportType="local",e.tracks.streamType=o.bytesSent?"outbound":"inbound"),e}},{key:"formatRelayType",value:function(e){var t="none";switch(e){case 0:t="tls";break;case 1:t="tcp";break;case 2:t="udp"}return t}}]),n}();n.StatsAdapter=i},{"./detectbrowser":11}],14:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getCurrent=function(){return window&&window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now()}},{}],15:[function(e,t,n){function r(){throw new Error("setTimeout has not been defined")}function i(){throw new Error("clearTimeout has not been defined")}function o(t){if(c===setTimeout)return setTimeout(t,0);if((c===r||!c)&&setTimeout)return c=setTimeout,setTimeout(t,0);try{return c(t,0)}catch(e){try{return c.call(null,t,0)}catch(e){return c.call(this,t,0)}}}function s(){v&&h&&(v=!1,h.length?p=h.concat(p):g=-1,p.length&&a())}function a(){if(!v){var e=o(s);v=!0;for(var t=p.length;t;){for(h=p,p=[];++g<t;)h&&h[g].run();g=-1,t=p.length}h=null,v=!1,function(t){if(d===clearTimeout)return clearTimeout(t);if((d===i||!d)&&clearTimeout)return d=clearTimeout,clearTimeout(t);try{d(t)}catch(e){try{return d.call(null,t)}catch(e){return d.call(this,t)}}}(e)}}function l(e,t){this.fun=e,this.array=t}function u(){}var c,d,f=t.exports={};!function(){try{c="function"==typeof setTimeout?setTimeout:r}catch(e){c=r}try{d="function"==typeof clearTimeout?clearTimeout:i}catch(e){d=i}}();var h,p=[],v=!1,g=-1;f.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];p.push(new l(e,t)),1!==p.length||v||o(a)},l.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=u,f.addListener=u,f.once=u,f.off=u,f.removeListener=u,f.removeAllListeners=u,f.emit=u,f.prependListener=u,f.prependOnceListener=u,f.listeners=function(e){return[]},f.binding=function(e){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(e){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],16:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=function(){function e(){var t=this;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.batteryManager=null,"function"==typeof navigator.getBattery&&navigator.getBattery().then(function(e){t.batteryManager=e})}return r(e,[{key:"getLevel",value:function(){return this.batteryManager?this.batteryManager.level:-1}},{key:"getCharging",value:function(){return this.batteryManager?this.batteryManager.charging:null}}]),e}();n.Battery=i},{}],17:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.detect=function(){var e=f.browserName.chrome,t=null,n=null,r=null,i=f.codeBaseType.chrome;if(!window.navigator.userAgent||window.csioReactNative)return window&&window.csioGetOsName&&(t=window.csioGetOsName()),window&&window.csioGetOsVer&&(n=window.csioGetOsVer()),window&&window.csioReactNative&&(r="react-native"),{browserName:e,codeBase:i,os:t,osVersion:n,userAgent:r,browserVersion:null};var o=(r=navigator.userAgent).toLowerCase(),s=navigator.appVersion.toLowerCase(),a=""+parseFloat(s),l=void 0;-1!==(l=o.indexOf("opera"))?(e=f.browserName.opera,a=o.substring(l+6),-1!==(l=o.indexOf("Version"))&&(a=o.substring(l+8)),i=f.codeBaseType.chrome):-1!==(l=o.indexOf("opr"))?(e=f.browserName.opera,a=o.substring(l+4),-1!==(l=o.indexOf("Version"))&&(a=o.substring(l+8)),i=f.codeBaseType.chrome):-1!==(l=o.indexOf("msie"))?(e=f.browserName.msie,a=o.substring(l+5),i=f.codeBaseType.chrome):-1!==(l=o.indexOf("edge"))?(e=f.browserName.edge,a=o.substring(l+5),i=f.codeBaseType.edge):-1!==(l=o.indexOf("chrome"))?(e=f.browserName.chrome,a=o.substring(l+7),i=f.codeBaseType.chrome):-1!==(l=o.indexOf("safari"))?(e=f.browserName.safari,a=o.substring(l+7),-1!==(l=o.indexOf("Version"))&&(a=o.substring(l+8)),i=f.codeBaseType.chrome):-1!==(l=o.indexOf("firefox"))?(e=f.browserName.firefox,a=o.substring(l+8),i=f.codeBaseType.firefox):-1!==(l=o.indexOf("trident"))&&(e=f.browserName.msie,l=o.indexOf("rv"),a=o.substring(l+3,l+7),i=f.codeBaseType.chrome);var u=[{s:"Windows 3.11",r:/win16/},{s:"Windows 95",r:/(windows 95|win95|windows_95)/},{s:"Windows ME",r:/(win 9x 4.90|windows me)/},{s:"Windows 98",r:/(windows 98|win98)/},{s:"Windows CE",r:/windows ce/},{s:"Windows 2000",r:/(windows nt 5.0|windows 2000)/},{s:"Windows XP",r:/(windows nt 5.1|windows xp)/},{s:"Windows Server 2003",r:/windows nt 5.2/},{s:"Windows Vista",r:/windows nt 6.0/},{s:"Windows 7",r:/(windows 7|windows nt 6.1)/},{s:"Windows 8.1",r:/(windows 8.1|windows nt 6.3)/},{s:"Windows 8",r:/(windows 8|windows nt 6.2)/},{s:"Windows 10",r:/(windows 10|windows nt 10.0)/},{s:"Windows NT 4.0",r:/(windows nt 4.0|winnt4.0|winnt|windows nt)/},{s:"Windows ME",r:/windows me/},{s:"Android",r:/android/},{s:"Open BSD",r:/openbsd/},{s:"Sun OS",r:/sunos/},{s:"Linux",r:/(linux|x11)/},{s:"iOS",r:/(iphone|ipad|ipod)/},{s:"Mac OS X",r:/mac os x/},{s:"Mac OS",r:/(macppc|macintel|mac_powerpc|macintosh)/},{s:"QNX",r:/qnx/},{s:"UNIX",r:/unix/},{s:"BeOS",r:/beos/},{s:"OS/2",r:/os\/2/},{s:"Search Bot",r:/(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\/teoma|ia_archiver)/}],c=void 0,d=void 0;for(c in u)if(u.hasOwnProperty(c)&&(d=u[c]).r.test(o)){t=d.s;break}switch(t&&/Windows/.test(t)&&(n=/Windows (.*)/.exec(t)[1],t=f.osName.windows),t){case f.osName.mac:n=/mac os x (10[\.\_\d]+)/.exec(o)[1];break;case f.osName.android:n=/android ([\.\_\d]+)/.exec(o)[1];break;case f.osName.ios:if(!(n=/os (\d+)_(\d+)_?(\d+)?/.exec(s)))break;n=n[1]+"."+n[2]+"."+(0|n[3])}return{browserName:e,browserVersion:a.toString(),os:t,osVersion:n,codeBase:i,userAgent:r}};var f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../config/constants"))},{"../config/constants":32}],18:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.Devices=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=r(e("../config/constants")),s=e("../utility/registry"),a=r(e("../utility/csiologger")),l=r(e("../utility/utils")),u=function(){function n(e,t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,n),this.conferenceId=e,this.pc=t,this.devices=null,this.emb=s.Registry.getEventMessageBuilder()}return i(n,[{key:"collectConnected",value:function(){var n=this;if(navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices){var r=this;navigator.mediaDevices.enumerateDevices().then(function(e){var t=l.normalizeMediaDeviceList(e);r.sendConnected(t),setTimeout(n.collectConnected.bind(r),1e4)}).catch(function(e){setTimeout(n.collectConnected.bind(r),1e4)})}}},{key:"sendConnected",value:function(e){this.devices&&this.compare(e)||(this.devices=e,this.send())}},{key:"compare",value:function(e){return self.devices.sort().toString()===e.sort().toString()}},{key:"send",value:function(){var e={mediaDeviceList:this.devices};a.log("sending connectedDevice",o.internalFabricEvent.connectedDeviceList,e),this.emb.make(o.internalFabricEvent.connectedDeviceList,this.conferenceId,this.pc,e)}}]),n}();n.Devices=u},{"../config/constants":32,"../utility/csiologger":87,"../utility/registry":94,"../utility/utils":100}],19:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.store=function(e,t){if(t)try{window&&window.localStorage&&window.localStorage.setItem(e,t)}catch(e){return}},n.get=function(e){try{if(window&&window.localStorage)return window.localStorage.getItem(e)}catch(e){return null}return null},n.remove=function(e){try{window&&window.localStorage&&window.localStorage.removeItem(e)}catch(e){return}}},{}],20:[function(e,t,n){function r(e,t){if(t)try{window&&window.sessionStorage&&window.sessionStorage.setItem(e,t)}catch(e){return}}function i(e){try{if(window&&window.sessionStorage)return window.sessionStorage.getItem(e)}catch(e){return null}return null}Object.defineProperty(n,"__esModule",{value:!0}),n.store=r,n.get=i,n.remove=function(e){try{window&&window.sessionStorage&&window.sessionStorage.removeItem(e)}catch(e){return}},n.storeUcId=function(e,t){if(e){var n=JSON.parse(i("csio_ucid_data"));n||(n={}),n[e]||(n[e]={}),n[e].ucID=t,r("csio_ucid_data",JSON.stringify(n))}},n.getUcId=function(e){if(!e)return null;var t=JSON.parse(i("csio_ucid_data"));return t&&t[e]?t[e].ucID:null}},{}],21:[function(l,u,e){(function(t){function e(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function g(e,t){var n={};return n.status=e,t&&(n.message=t),n}function m(e,t){return e+": "+t+" "+(2<arguments.length&&void 0!==arguments[2]?arguments[2]:"")}function y(e){if(null===e)return!1;var t=C.Registry.getEndpoint().getCodeBase();if(t===_.codeBaseType.firefox)return"undefined"!=typeof mozRTCPeerConnection&&e instanceof mozRTCPeerConnection||"undefined"!=typeof RTCPeerConnection&&e instanceof RTCPeerConnection;if(t===_.codeBaseType.edge||"function"==typeof e)return!0;var n,r,i=(n=null,"Firefox"===(r=C.Registry.getEndpoint().getBrowserName())?n=mozRTCPeerConnection:"Chrome"===r||"Opera"===r?n=webkitRTCPeerConnection:"Safari"===r?T.log("Browser type Safari"):"Edge"===r&&(n=window.RTCPeerConnection),n);return null!==i&&e instanceof i||void 0!==e.createOffer}var s="function"==typeof Symbol&&"symbol"==_typeof(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof(e)},n=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),_=e(l("./config/constants")),r=e(l("./config/settings")),b=l("./config/callstatserrors"),S=l("./fsm/mainfsm"),C=l("./utility/registry"),T=e(l("./utility/csiologger")),i=e(l("./utility/onerroreventlistner")),o=e(l("./utility/utils"));i.setErrorEventListener(),o.assignPollyfill(),o.isIntegerPollyfill();var w=null,a=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),w=new S.MainFSM}return n(e,[{key:"initialize",value:function(e,t,n,r,i,o){if(!e||!n||!t){var s=m("initialize",b.csErrorStrings.argumentError);return T.error(s),g(_.callstatsAPIReturnStatus.failure,s)}if(r&&"function"!=typeof r){var a=m("initialize",b.csErrorStrings.argumentError);T.warn(a),r=null}if(i&&"function"!=typeof i){var l=m("initialize",b.csErrorStrings.argumentError);T.warn(l),i=null}if("function"!=typeof t&&!(window.crypto&&(window.crypto.subtle||window.crypto.webkitSubtle)||window.msCrypto&&window.msCrypto.subtle||window.csioReactNative)){var u=m("initialize",b.csErrorStrings.cryptoError);return T.error(u),r&&r(b.csError.tokenGenerationError,b.csErrorStrings.cryptoError),g(_.callstatsAPIReturnStatus.failure,u)}try{w.fire(S.MainEvents.onInitialize,e,n,t,r,i,o),w.run()}catch(e){C.Registry.getGenericEventHandler().sendEvent(_.logEvents.error,{msg:"initialize: Error",error:e.message+":"+e.stack}),T.error("initialize: Error",e)}return g(_.callstatsAPIReturnStatus.success)}},{key:"addNewFabric",value:function(e,t,n,r,i,o){var s=null,a=_.endpointType.peer,l=_.transmissionDirection.sendrecv;if(r||(r=_.tmpConferenceId),!e||!n){var u=m("addNewFabric",b.csErrorStrings.argumentError);return T.error(u),g(_.callstatsAPIReturnStatus.failure,u)}if(o&&"function"==typeof o&&(s=o),i&&"function"==typeof i&&(s=i),i&&"function"!=typeof i){if(i.remoteEndpointType){if(!_.endpointType.hasOwnProperty(i.remoteEndpointType)){var c=m("addNewFabric",b.csErrorStrings.invalidEndPointType,i.remoteEndpointType);return T.error(c),g(_.callstatsAPIReturnStatus.failure,c)}a=i.remoteEndpointType}if(i.fabricTransmissionDirection){if(!_.transmissionDirection.hasOwnProperty(i.fabricTransmissionDirection)){var d=m("addNewFabric",b.csErrorStrings.invalidTransmissionDirection,i.fabricTransmissionDirection);return T.error(d),g(_.callstatsAPIReturnStatus.failure,d)}l=i.fabricTransmissionDirection}}if(!_.fabricUsage.hasOwnProperty(n)||n instanceof Function){var f=m("addNewFabric",b.csErrorStrings.fabricUsageInvalid,n);return T.error(f),g(_.callstatsAPIReturnStatus.failure,f)}if(!y(e)){var h=m("addNewFabric",b.csErrorStrings.pcInvalid);return T.error(h),g(_.callstatsAPIReturnStatus.failure,h)}var p=C.Registry.getConferenceManager().get(r);if(p&&p.getPeerConnectionManager().getPcHandler(e))return g(_.callstatsAPIReturnStatus.success);if(!C.Registry.getCredentials().getAppId()||!C.Registry.getCredentials().getUserId()){var v=m("addNewFabric",b.csErrorStrings.notInitialized);return T.error(v),g(_.callstatsAPIReturnStatus.failure,v)}try{w.fire(S.MainEvents.onAddNewFabric,e,t,n,r,a,l,s),w.run()}catch(e){C.Registry.getGenericEventHandler().sendEvent(_.logEvents.error,{msg:"addNewFabric: Error",error:e.message+":"+e.stack}),T.error("addNewFabric: Error",e)}return g(_.callstatsAPIReturnStatus.success)}},{key:"sendFabricEvent",value:function(e,t,n,r){if(T.log("sendFabricEvent ",t),n||(n=_.tmpConferenceId),!e||!t){var i=m("sendFabricEvent",b.csErrorStrings.argumentError);return T.error(i),g(_.callstatsAPIReturnStatus.failure,i)}if(t===_.fabricEvent.fabricSetupFailed){var o=m("sendFabricEvent",b.csErrorStrings.fabricEventUnsupported,t);return T.error(o),g(_.callstatsAPIReturnStatus.failure,o)}if(!_.fabricEvent.hasOwnProperty(t)&&!_.internalFabricEvent.hasOwnProperty(t)){var s=m("sendFabricEvent",b.csErrorStrings.fabricEventInvalid,t);return T.error(s),g(_.callstatsAPIReturnStatus.failure,s)}if(!(t!==_.fabricEvent.activeDeviceList||r&&r.deviceList)){var a=m("sendFabricEvent ",b.csErrorStrings.argumentError);return T.error(a),g(_.callstatsAPIReturnStatus.failure,a)}var l=C.Registry.getConferenceManager().get(n);if(!C.Registry.getCredentials().getAppId()||!C.Registry.getCredentials().getUserId()||!l){var u=m("sendFabricEvent ",b.csErrorStrings.notInitialized);return T.error(u),g(_.callstatsAPIReturnStatus.failure,u)}if(!l.getPeerConnectionManager().getPcHandler(e)){var c=m("sendFabricEvent ",b.csErrorStrings.pcInvalid);return T.error(c),g(_.callstatsAPIReturnStatus.failure,c)}try{w.fire(S.MainEvents.onSendFabricEvent,e,t,n,r),w.run()}catch(e){C.Registry.getGenericEventHandler().sendEvent(_.logEvents.error,{msg:"sendFabricEvent: Error",error:e.message+":"+e.stack}),T.error("sendFabricEvent: Error",e)}return g(_.callstatsAPIReturnStatus.success)}},{key:"sendUserFeedback",value:function(e,t,n){if(!t||!e){var r=m("sendUserFeedback",b.csErrorStrings.argumentError);return T.error(r),g(_.callstatsAPIReturnStatus.failure,r)}if("object"!==(void 0===t?"undefined":s(t))){var i=m("sendUserFeedback",b.csErrorStrings.argumentError);return T.error(i),g(_.callstatsAPIReturnStatus.failure,i)}if(0===Object.keys(t).length){var o=m("sendUserFeedback",b.csErrorStrings.argumentError);return T.error(o),g(_.callstatsAPIReturnStatus.failure,o)}try{w.fire(S.MainEvents.onSendUserFeedback,e,t,n),w.run()}catch(e){C.Registry.getGenericEventHandler().sendEvent(_.logEvents.error,{msg:"sendUserFeedback: Error",error:e.message+":"+e.stack}),T.error("sendUserFeedback: Error",e)}return g(_.callstatsAPIReturnStatus.success)}},{key:"associateMstWithUserID",value:function(e,t,n,r,i,o){if(n||(n=_.tmpConferenceId),!e||!r||!i){var s=m("associateMstWithUserID",b.csErrorStrings.argumentError);return T.error(s),g(_.callstatsAPIReturnStatus.failure,s)}if(!y(e)){var a=m("associateMstWithUserID",b.csErrorStrings.pcInvalid);return T.error(a),g(_.callstatsAPIReturnStatus.failure,a)}var l=C.Registry.getConferenceManager().get(n);if(!l){var u=m("associateMstWithUserID",b.csErrorStrings.confereneDoesNotExist);return T.error(u),g(_.callstatsAPIReturnStatus.failure,u)}if(!l.getPeerConnectionManager().getPcHandler(e)){var c=m("associateMstWithUserID",b.csErrorStrings.pcInvalid);return T.error(c),g(_.callstatsAPIReturnStatus.failure,c)}o&&"string"!=typeof o&&(T.error("associateMstWithUserID: Invalid videoTag"),o=null);try{w.fire(S.MainEvents.onAssociateMstWithUserID,e,t,n,r,i,o),w.run()}catch(e){C.Registry.getGenericEventHandler().sendEvent(_.logEvents.error,{msg:"associateMstWithUserID: Error",error:e.message+":"+e.stack}),T.error("associateMstWithUserID: Error",e)}return g(_.callstatsAPIReturnStatus.success)}},{key:"reportError",value:function(e,t,n,r,i,o){if(t||(t=_.tmpConferenceId),void 0===e||!n){var s=m("reportError",b.csErrorStrings.argumentError);return T.error(s),g(_.callstatsAPIReturnStatus.failure,s)}if(!_.webRTCFunctions.hasOwnProperty(n)){var a=m("reportError",b.csErrorStrings.webRTCFunctionsInvalid,n);return T.error(a),g(_.callstatsAPIReturnStatus.failure,a)}if(void 0===r&&T.warn("reportError: Missing DOM error parameter"),!C.Registry.getCredentials().getAppId()||!C.Registry.getCredentials().getUserId()){var l=m("reportError",b.csErrorStrings.notInitialized);return T.error(l),g(_.callstatsAPIReturnStatus.failure,l)}try{w.fire(S.MainEvents.onReportError,e,t,n,r,i,o),w.run()}catch(e){C.Registry.getGenericEventHandler().sendEvent(_.logEvents.error,{msg:"reportError: Error",error:e.message+":"+e.stack}),T.error("reportError: Error",e)}return g(_.callstatsAPIReturnStatus.success)}},{key:"setProxyConfig",value:function(e){if(window&&!window.csioproxy){var t=m("setProxyConfig",b.csErrorStrings.setProxyConfigInvokeError);return T.error(t),g(_.callstatsAPIReturnStatus.failure,t)}if(!e){var n=m("setProxyConfig",b.csErrorStrings.argumentError);return T.error(n),g(_.callstatsAPIReturnStatus.failure,n)}try{w.fire(S.MainEvents.onSetProxyConfig,e),w.run()}catch(e){C.Registry.getGenericEventHandler().sendEvent(_.logEvents.error,{msg:"setProxyConfig: Error",error:e.message+":"+e.stack}),T.error("setProxyConfig: Error",e)}return g(_.callstatsAPIReturnStatus.success)}},{key:"attachWifiStatsHandler",value:function(e){if(!e){var t=m("attachWifiStatsHandler",b.csErrorStrings.argumentError);return T.error(t),g(_.callstatsAPIReturnStatus.failure,t)}if("function"!=typeof e){var n=m("attachWifiStatsHandler",b.csErrorStrings.argumentError);return T.error(n),g(_.callstatsAPIReturnStatus.failure,n)}try{w.fire(S.MainEvents.onAttachWifiStatsHandler,e),w.run()}catch(e){C.Registry.getGenericEventHandler().sendEvent(_.logEvents.error,{msg:"attachWifiStatsHandler: Error",error:e.message+":"+e.stack}),T.error("attachWifiStatsHandler: Error",e)}return g(_.callstatsAPIReturnStatus.success)}},{key:"setIdentifiers",value:function(e,t){if(!e){var n=m("setIdentifiers",b.csErrorStrings.argumentError);return T.error(n),g(_.callstatsAPIReturnStatus.failure,n)}try{w.fire(S.MainEvents.onSetIdentifiers,e,t),w.run()}catch(e){C.Registry.getGenericEventHandler().sendEvent(_.logEvents.error,{msg:"setIdentifiers: Error",error:e.message+":"+e.stack}),T.error("setIdentifiers: Error",e)}return g(_.callstatsAPIReturnStatus.success)}},{key:"makePrecallTest",value:function(){if(!C.Registry.getAuthenticator().getToken()||!C.Registry.getCredentials().getAppId()){var e=m("makePrecallTest",b.csErrorStrings.notInitialized);return T.error(e),g(_.callstatsAPIReturnStatus.failure,e)}if(!C.Registry.getAuthenticator().getIceServers()){var t=m("makePrecallTest",b.csErrorStrings.notInitialized);return T.error(t),g(_.callstatsAPIReturnStatus.failure,t)}if(!C.Registry.getCredentials().getCollectSDP()){var n=m("makePrecallTest",b.csErrorStrings.apiaccesserror);return T.error(n),g(_.callstatsAPIReturnStatus.failure,n)}try{w.fire(S.MainEvents.onMakePrecallTest),w.run()}catch(e){C.Registry.getGenericEventHandler().sendEvent(_.logEvents.error,{msg:"on: Error",error:e.message+":"+e.stack}),T.error("makePrecallTest: Error",e)}return g(_.callstatsAPIReturnStatus.success)}},{key:"on",value:function(e,t){if(!t||"function"!=typeof t){var n=m("on",b.csErrorStrings.argumentError);return T.error(n),g(_.callstatsAPIReturnStatus.failure,n)}if(!e||!_.callbackFunctions.hasOwnProperty(e)){var r=m("on",b.csErrorStrings.argumentError);return T.error(r),g(_.callstatsAPIReturnStatus.failure,r)}try{w.fire(S.MainEvents.onOn,e,t),w.run()}catch(e){C.Registry.getGenericEventHandler().sendEvent(_.logEvents.error,{msg:"on: Error",error:e.message+":"+e.stack}),T.error("on: Error",e)}return g(_.callstatsAPIReturnStatus.success)}},{key:"fabricUsage",get:function(){return this.constructor.fabricUsage}},{key:"fabricEvent",get:function(){return this.constructor.fabricEvent}},{key:"webRTCFunctions",get:function(){return this.constructor.webRTCFunctions}},{key:"csError",get:function(){return this.constructor.csError}},{key:"qualityRating",get:function(){return this.constructor.qualityRating}},{key:"callStatsAPIReturnStatus",get:function(){return this.constructor.callStatsAPIReturnStatus}},{key:"version",get:function(){return this.constructor.version}},{key:"userIDType",get:function(){return this.constructor.userIDType}},{key:"transmissionDirection",get:function(){return this.constructor.transmissionDirection}},{key:"endpointType",get:function(){return this.constructor.endpointType}}]),e}();a.fabricUsage=_.fabricUsage,a.fabricEvent=_.fabricEvent,a.webRTCFunctions=_.webRTCFunctions,a.csError=b.csError,a.qualityRating=_.qualityRating,a.callStatsAPIReturnStatus=_.callstatsAPIReturnStatus,a.version=r.version,a.userIDType=_.userIdType,a.endpointType=_.endpointType,a.transmissionDirection=_.transmissionDirection,function(){function e(){return new a}"function"==typeof define&&define.amd?define("callstats",[],e):t.callstats=e,u.exports=e}("undefined"!=typeof window&&window)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./config/callstatserrors":31,"./config/constants":32,"./config/settings":33,"./fsm/mainfsm":34,"./utility/csiologger":87,"./utility/onerroreventlistner":93,"./utility/registry":94,"./utility/utils":100}],22:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.BinaryTree=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=e("./binarytreenode.js"),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/csiologger")),o=function(){function t(e){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,t),this.root=null,this.top=null,this.bottom=null,this.comparator=e,this.node_counter=0,this.duplicate_counter=0}return r(t,[{key:"getTopNode",value:function(){return this.top}},{key:"getTopValue",value:function(){return null===this.top?null:this.top.peek()}},{key:"getBottomValue",value:function(){return null===this.bottom?null:this.bottom.peek()}},{key:"getBottomNode",value:function(){return this.bottom}},{key:"getDuplicatedCounter",value:function(){return this.duplicate_counter}},{key:"getNodeCounter",value:function(){return this.node_counter}},{key:"getSize",value:function(){return this.duplicate_counter+this.node_counter}},{key:"insertNodeAtTop",value:function(e){e&&this.inserting(e.getValues(),this.top)}},{key:"insertNodeAtBottom",value:function(e){e&&this.inserting(e.getValues(),this.bottom)}},{key:"insert",value:function(e){this.inserting([e],this.root)}},{key:"createNode",value:function(e){var t=new(Function.prototype.bind.apply(i.BinaryTreeNode,[null].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(e))));return null===this.top?this.top=t:this.comparator(this.top.peek(),t.peek())<0&&(this.top=t),null===this.bottom?this.bottom=t:this.comparator(t.peek(),this.bottom.peek())<0&&(this.bottom=t),t}},{key:"inserting",value:function(e,t){if(null===this.root)return this.root=this.createNode(e),this.node_counter=1,void(this.duplicate_counter+=e.length-1);for(var n=null,r=t,i=0;null!==r;){if(0===(i=this.comparator(e[0],r.peek())))return r.concat(e),this.duplicate_counter+=e.length,void r.find(e[0]);n=r,r=i<0?r.getLeft():r.getRight()}++this.node_counter,this.duplicate_counter+=e.length-1,r=this.createNode(e),i<0?n.setLeft(r):n.setRight(r)}},{key:"getRightist",value:function(e){for(var t=null;null!==e.right;)e=(t=e).right;return[e,t]}},{key:"getLeftist",value:function(e){for(var t=null;null!==e.getLeft();)e=(t=e).getLeft();return[e,t]}},{key:"popBottomNode",value:function(){if(null===this.bottom)return null;var e=this.search(this.bottom.peek()),t=e[0],n=e[1];return this.replaceNode(t,n,t.getRight()),this.disposeNode(t),--this.node_counter,this.duplicate_counter-=t.getLength()-1,t.setRight(null),t}},{key:"popTopNode",value:function(){if(null===this.top)return null;var e=this.search(this.top.peek()),t=e[0],n=e[1];return null===t?null:(this.replaceNode(t,n,t.getLeft()),this.disposeNode(t),--this.node_counter,this.duplicate_counter-=t.getLength()-1,t.setLeft(null),t)}},{key:"search",value:function(e){for(var t=this.root,n=null,r=void 0;null!==t;){if(0===(r=this.comparator(e,t.peek())))return t.find(e)?[t,n]:[null,null];n=t,t=r<0?t.getLeft():t.getRight()}return[null,null]}},{key:"replaceNode",value:function(e,t,n){null!==t?t.left===e?t.left=n:t.right=n:this.root=n}},{key:"disposeNode",value:function(e){if(null!==this.root){if(0===this.comparator(this.top.peek(),e.peek())){var t=this.getRightist(this.root);this.top=t[0]}if(0===this.comparator(this.bottom.peek(),e.peek())){var n=this.getLeftist(this.root);this.bottom=n[0]}}else this.bottom=this.top=null}},{key:"delete",value:function(e){var t=this.search(e),n=t[0],r=t[1];if(null===n)return!1;if(1<n.getLength())return n.remove(e),--this.duplicate_counter,!0;if(--this.node_counter,null===n.getLeft()&&null===n.getRight())this.replaceNode(n,r,null);else if(null===n.getLeft())this.replaceNode(n,r,n.getRight());else if(null===n.getRight())this.replaceNode(n,r,n.getLeft());else{for(var i=n.getLeft(),o=n;null!==i.getRight();i=(o=i).getRight());var s=i.getLeft();o===n?o.setLeft(s):o.setRight(s),n.setValues(i.getValues())}return this.disposeNode(n),!0}},{key:"logging",value:function(){null!==this.root?(s.log("Size of the tree: "+this.getSize()+" Node: "+this.getNodeCounter()+" Duplicates: "+this.getDuplicatedCounter()+" Top: "+this.getTopNode().toString()+" Bottom: "+this.getBottomNode().toString()),function e(t,n,r){if(null!==t){for(var i="-",o=0;o<n;++o)i+="--";s.log(i+"> ("+r+") ["+t.toString()+"]"),null!==t.getLeft()&&e(t.getLeft(),n+1,"Left"),null!==t.getRight()&&e(t.getRight(),n+1,"Right")}}(this.root,0,"Root")):s.log("This tree is empty Duplicate Counter: "+this.duplicate_counter)}}]),t}();n.BinaryTree=o},{"../utility/csiologger":87,"./binarytreenode.js":23}],23:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),r=function(){function r(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];this.values=t,this.left=null,this.right=null}return i(r,[{key:"getRight",value:function(){return this.right}},{key:"setRight",value:function(e){this.right=e}},{key:"getLeft",value:function(){return this.left}},{key:"setLeft",value:function(e){this.left=e}},{key:"push",value:function(e){this.values.push(e)}},{key:"concat",value:function(e){this.values=this.values.concat(e)}},{key:"pop",value:function(){return this.values.length<1?null:this.values.shift()}},{key:"remove",value:function(e){this.values.splice(this.values.indexOf(e),1)}},{key:"setValues",value:function(e){this.values=e}},{key:"getValues",value:function(){return this.values}},{key:"hasValue",value:function(){return 0<this.values.length}},{key:"getLength",value:function(){return this.values.length}},{key:"peek",value:function(){return this.values.length<1?null:this.values[0]}},{key:"find",value:function(t){return this.values.find(function(e){return e===t})}},{key:"toString",value:function(){return this.values.toString()}}]),r}();n.BinaryTreeNode=r},{}],24:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.Cache=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/csiologger")),o=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.queue=[],this.priority=[]}return r(e,[{key:"add",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];1e6<this.length()?i.error("Maximum cached items reached, dropping."):t?this.priority.push(e):this.queue.push(e)}},{key:"pop",value:function(){return 0<this.priority.length?this.priority.shift():this.queue.shift()}},{key:"peak",value:function(){return 0<this.priority.length?this.priority[0]:0<this.queue.length?this.queue[0]:null}},{key:"length",value:function(){return this.queue.length+this.priority.length}},{key:"updateConferenceId",value:function(e){for(var t=0;t<this.queue.length;++t)this.queue[t].updateConferenceId(e);for(var n=0;n<this.priority.length;++n)this.priority[n].updateConferenceId(e)}}]),e}();n.Cache=o},{"../utility/csiologger":87}],25:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.Component=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=e("./port"),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/csiologger")),s=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"Unknown";(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,t),this.name=e,this.ports=new Map}return r(t,[{key:"bindPort",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this;this.ports.has(e)?o.warn("Port ("+e+") for "+this.name+" already exists."):this.ports.set(e,new i.Port(t,n))}},{key:"declarePort",value:function(e){this.ports.has(e)?o.warn("Port ("+e+") for "+this.name+" already exists."):this.ports.set(e,null)}},{key:"getPort",value:function(e){return this.ports.get(e)}},{key:"isConnected",value:function(e){return!!this.ports.has(e)&&null!==this.ports.get(e)}},{key:"connect",value:function(e,t){this.ports.has(e)?this.ports.set(e,t):o.warn("Port ("+e+") for "+this.name+" does not exists.")}},{key:"transmit",value:function(e){var t=this.ports.get(e);if(void 0!==t)if(null!==t){for(var n=arguments.length,r=Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];t.transmit(r)}else o.warn("Port ("+e+") for "+this.name+" is not connected.");else o.warn("Port ("+e+") for "+this.name+" does not exists.")}},{key:"request",value:function(e){var t=this.ports.get(e);if(void 0===t)return o.warn("Port ("+e+") for "+this.name+" does not exists."),null;if(null===t)return o.warn("Port ("+e+") for "+this.name+" is not connected."),null;for(var n=arguments.length,r=Array(1<n?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];return t.request(r)}}]),t}();n.Component=s},{"../utility/csiologger":87,"./port":26}],26:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,n),this.target=e,this.object=t}return r(n,[{key:"transmit",value:function(e){this.target.apply(this.object,e)}},{key:"request",value:function(e){return this.target.apply(this.object,e)}}]),n}();n.Port=i},{}],27:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SlidingWindow=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=e("./switem"),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/timestamps")),s=function(){function n(e,t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,n),this.items=[],this.plugins=[],this.postProcesses=[],this.preProcesses=[],this.timeoutInMs=t,this.maxItemsNum=e,this.minItemsNum=0}return r(n,[{key:"setMaxItemsNum",value:function(e){this.maxItemsNum=e}},{key:"setTimeoutInMs",value:function(e){this.timeoutInMs=e}},{key:"setMinItemsNum",value:function(e){this.minItemsNum=e}},{key:"refresh",value:function(){var e=o.getCurrent();if(!(this.items.length<=this.minItemsNum)){for(;0<this.maxItemsNum&&this.maxItemsNum<=this.items.length;)this.remove();this.timeoutInMs&&this.timeoutInMs<e-this.items[0].getCreated()&&(this.remove(),this.refresh())}}},{key:"getLength",value:function(){return this.items.length}},{key:"add",value:function(e){this.refresh(),this.items.push(new i.SWItem(e));for(var t=0;t<this.preProcesses.length;t++)(0,this.preProcesses[t])(e);for(var n=0;n<this.plugins.length;n++)this.plugins[n].add(e);for(var r=0;r<this.postProcesses.length;r++)(0,this.postProcesses[r])(e)}},{key:"remove",value:function(){for(var e=this.items.shift(),t=0;t<this.plugins.length;t++)this.plugins[t].remove(e.value)}},{key:"peek",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;return this.items.length<=e?null:this.items[this.items.length-e-1].getValue()}},{key:"attach",value:function(e){this.plugins.push(e)}},{key:"addPreProcess",value:function(e){this.preProcesses.push(e)}},{key:"addPostProcess",value:function(e){this.postProcesses.push(e)}},{key:"detach",value:function(t){this.plugins=this.plugins.filter(function(e){return e!==t})}}]),n}();n.SlidingWindow=s},{"../utility/timestamps":98,"./switem":28}],28:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SWItem=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/timestamps")),o=function(){function t(e){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,t),this.value=e,this.created=i.getCurrent()}return r(t,[{key:"getValue",value:function(){return this.value}},{key:"getCreated",value:function(){return this.created}},{key:"toString",value:function(){return""}}]),t}();n.SWItem=o},{"../utility/timestamps":98}],29:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.Conference=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=e("../peerconnection/peerconnectionmanager"),s=r(e("../config/settings")),a=e("../utility/registry"),l=r(e("../browserapi/sessionstorage")),u=function(){function n(e,t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,n),this.conferenceId=e,this.startTime,this.peerConnectionManager=new o.PeerConnectionManager,this.credentials=t,this.ucId=null,this.url=null,this.userJoinedSent=!1}return i(n,[{key:"getCredentials",value:function(){return this.credentials}},{key:"getUcId",value:function(){return this.ucId}},{key:"setUcId",value:function(e){this.ucId=e,this.url=s.conferenceBaseUrl+a.Registry.getCredentials().getAppId()+"/conferences/"+encodeURIComponent(this.conferenceId)+"/"+e+"/general",l.storeUcId(this.conferenceId,e)}},{key:"getPeerConnectionManager",value:function(){return this.peerConnectionManager}},{key:"getUrl",value:function(){return this.url}},{key:"updateConferenceId",value:function(e){this.conferenceId=e,this.peerConnectionManager.updateConferenceId(e)}},{key:"close",value:function(e){}}]),n}();n.Conference=u},{"../browserapi/sessionstorage":20,"../config/settings":33,"../peerconnection/peerconnectionmanager":41,"../utility/registry":94}],30:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ConferenceManager=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=e("./conference"),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../config/constants")),s=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.conferenceMap=new Map}return r(e,[{key:"add",value:function(e,t){if(!this.get(e)){var n=new i.Conference(e,t);this.conferenceMap.set(e,n)}}},{key:"get",value:function(e){return this.conferenceMap.get(e)}},{key:"getConferenceForPc",value:function(r){var i=null;return r&&this.conferenceMap.forEach(function(e,t){var n=e.getPeerConnectionManager().getPcHandler(r);n&&n.getConferenceId()===t&&(i=e)}),i}},{key:"getConferenceForPcHash",value:function(r){var i=null;return r&&this.conferenceMap.forEach(function(e,t){var n=e.getPeerConnectionManager().getPcHandlerByHash(r);n&&n.getConferenceId()===t&&(i=e)}),i}},{key:"updateConferenceId",value:function(e){var t=o.tmpConferenceId,n=this.get(t);n&&(n.updateConferenceId(e),this.conferenceMap.set(e,n),this.conferenceMap.delete(t))}},{key:"getConferenceIds",value:function(){var n=[];return this.conferenceMap.forEach(function(e,t){n.push(t)}),n}}]),e}();n.ConferenceManager=s},{"../config/constants":32,"./conference":29}],31:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.csError={httpError:"httpError",authError:"authError",wsChannelFailure:"wsChannelFailure",success:"success",csProtoError:"csProtoError",appConnectivityError:"appConnectivityError",tokenGenerationError:"tokenGenerationError",ok:"OK",authOngoing:"authOngoing",invalidWebRTCFunctionName:"Invalid WebRTC function name",invalidEndPointType:"Invalid EndPoint Type",invalidTransmissionDirection:"Invalid fabric transmission direction"},n.csErrorStrings={argumentError:"Argument missing/invalid",cryptoError:"Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API",fabricEventUnsupported:"Unsupported fabricEvent",fabricEventInvalid:"Invalid fabricEvents value",fabricUsageInvalid:"Invalid fabricUsage value",notInitialized:"SDK is not initialized or no Fabrics added",pcInvalid:"Invalid PeerConnection object passed",confereneDoesNotExist:"conferenceId does not exist",webRTCFunctionsInvalid:"Invalid webRTC functionName value",setProxyConfigInvokeError:"cannot be called if window.csioproxy is false",invalidWebRTCFunctionName:"Invalid WebRTC function name",invalidEndPointType:"Invalid EndPoint Type",invalidTransmissionDirection:"Invalid fabric transmission direction",apiaccesserror:"API access Error"},n.csErrorReason={csProtoError:"Protocol fields cannot be empty.",csNoAuthState:"Authentication state unavailable in server."},n.internalErrors={authOngoing:"authOngoing"},n.authErrorActions={RETRY:0,GET_NEW_TOKEN:1,REPORT_ERROR:2}},{}],32:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.logEvents={stateMachine:"stateMachine",log:"log",timing:"timing",error:"error",getStatsError:"getStatsError",restResponseError:"restResponseError"},n.fabricEvent={fabricSetupFailed:"fabricSetupFailed",fabricHold:"fabricHold",fabricResume:"fabricResume",audioMute:"audioMute",audioUnmute:"audioUnmute",videoPause:"videoPause",videoResume:"videoResume",fabricUsageEvent:"fabricUsageEvent",fabricTerminated:"fabricTerminated",screenShareStart:"screenShareStart",screenShareStop:"screenShareStop",dominantSpeaker:"dominantSpeaker",activeDeviceList:"activeDeviceList",applicationErrorLog:"applicationErrorLog"},n.internalFabricEvent={fabricSetup:"fabricSetup",fabricSetupFailed:"fabricSetupFailed",userJoined:"userJoined",userLeft:"userLeft",userAlive:"userAlive",ssrcMap:"ssrcMap",mediaPlaybackStart:"mediaPlaybackStart",mediaPlaybackSuspended:"mediaPlaybackSuspended",mediaPlaybackStalled:"mediaPlaybackStalled",oneWayMedia:"oneWayMedia",fabricStateChange:"fabricStateChange",iceDisruptionStart:"iceDisruptionStart",iceDisruptionEnd:"iceDisruptionEnd",fabricTransportSwitch:"fabricTransportSwitch",iceConnectionDisruptionStart:"iceConnectionDisruptionStart",iceConnectionDisruptionEnd:"iceConnectionDisruptionEnd",iceAborted:"iceAborted",iceTerminated:"iceTerminated",iceFailed:"iceFailed",iceRestarted:"iceRestarted",fabricDropped:"fabricDropped",connectedDeviceList:"connectedDeviceList",sdpSubmission:"sdpSubmissionEvent",sendingThroughputObservations:"sendingThroughputObservations",limitationObservations:"limitationObservations",userDetails:"userDetails"},n.callstatsChannels={sdpSubmission:"sdpSubmissionEvent",processedStats:"processedStats",callstatsEvent:"callStatsEvent",userFeedback:"userFeedbackEvent",preCallTest:"preCallTest",senderConfiguration:"senderConfiguration"},n.precalltestEvents={results:"preCallTestResults",associate:"preCallTestAssociate"},n.callstatsAPIReturnStatus={success:"success",failure:"failure"},n.fabricUsage={audio:"audio",video:"video",data:"data",screen:"screen",multiplex:"multiplex",unbundled:"unbundled"},n.userIdType={local:"local",remote:"remote"},n.qualityRating={excellent:5,good:4,fair:3,poor:2,bad:1},n.reportType={local:"local",remote:"remote",inbound:"inbound",outbound:"outbound"},n.avQualityRatings={excellent:"excellent",fair:"fair",bad:"bad",unknown:"unknown"},n.fabricState={established:"established",initializing:"initializing",failed:"failed",disrupted:"disrupted",hold:"hold",checkingDisrupted:"checkingDisrupted",terminated:"terminated"},n.webRTCFunctions={createOffer:"createOffer",createAnswer:"createAnswer",setLocalDescription:"setLocalDescription",setRemoteDescription:"setRemoteDescription",addIceCandidate:"addIceCandidate",getUserMedia:"getUserMedia",iceConnectionFailure:"iceConnectionFailure",signalingError:"signalingError",applicationError:"applicationError",applicationLog:"applicationLog"},n.callFailureReasons={mediaConfigError:"MediaConfigError",negotiationFailure:"NegotiationFailure",sdpError:"SDPGenerationError",iceFailure:"IceConnectionFailure",transportFailure:"TransportFailure",signalingError:"SignalingError",applicationError:"ApplicationError",applicationLog:"ApplicationLog",invalidWebRTCFunctionName:"Invalid WebRTC function name"},n.throughputThreshold={video:{green:1024,red:256},audio:{green:30,red:8}},n.currOverPrevFrameRateThreshold={video:{green:.8,red:.3}},n.rttThreshold={video:{green:400,red:1e3}},n.fractionalLossThreshold={video:{green:.1,red:.5},audio:{green:.15,red:.3}},n.eModelThreshold={audio:{green:240,red:400}},n.codeBaseType={chrome:"Chrome",firefox:"Firefox",edge:"Edge",plugin:"Plugin"},n.browserName={chrome:"Chrome",firefox:"Firefox",edge:"Edge",msie:"Microsoft Internet Explorer",safari:"Safari",opera:"Opera"},n.osName={windows:"Windows",mac:"Mac OS X",android:"Android",ios:"iOS"},n.mediaType={audio:"audio",video:"video"},n.streamType={inbound:"inbound",outbound:"outbound"},n.fabricStateChangeType={signalingState:"signalingState",iceConnectionState:"iceConnectionState",iceGatheringState:"iceGatheringState"},n.transportType={rest:"rest",ws:"ws"},n.wsConnectionState={initiated:"initiated",connected:"connected",closed:"closed"},n.csCallBackMessages={authSuccessful:"SDK authentication successful.",authFailed:"SDK authentication failed.",authProtocolInvalid:"Fatal authentication error. Invalid auth protocol message.",authOngoing:"Authentication on going.",wsConnected:"WebSocket establishment successful.",wsClosed:"WebSocket server closed.",wsFailed:"WebSocket establishment failed."},n.oneWayMediaTypes={audio:"audio",video:"video",screen:"screen"},n.limitationType={cpu:"cpu",network:"network"},n.qualityDisruptionTypes={qpchange:"qpchange"},n.callbackFunctions={stats:"stats",defaultConfig:"defaultConfig",recommendedConfig:"recommendedConfig",preCallTestResults:"preCallTestResults"},n.endpointType={peer:"peer",server:"server"},n.transmissionDirection={sendonly:"sendonly",receiveonly:"receiveonly",sendrecv:"sendrecv",inactive:"inactive"},n.tmpConferenceId="csio-conf-id-tmp"},{}],33:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.setConfigServiceUrl=function(e){n.configServiceUrl=e},n.setAuthServiceUrl=function(e){n.authServiceUrl=e},n.setConferenceBaseUrl=function(e){n.conferenceBaseUrl=e},n.setWsUrl=function(e){n.wsUrl=e},n.setRestEventUrl=function(e){n.restEventUrl=e},n.setRestStatsUrl=function(e){n.restStatsUrl=e},n.setBaseUrl=function(e){n.baseUrl=e},n.setQmodelThresholdsAPIUrl=function(e){n.qmodelThresholdsAPIUrl=e},n.setTransportType=function(e){n.transportType=e};n.version="3.50.3",n.configServiceUrl="https://appsettings.callstats.io/v1/apps/",n.authServiceUrl="https://auth.callstats.io/",n.authRetryTimeout=5e3,n.conferenceBaseUrl="https://dashboard.callstats.io/apps/",n.wsUrl="wss://collector.callstats.io:443/csiows/collectCallStats",n.restEventUrl="https://events.callstats.io/v1/apps/",n.restStatsUrl="https://stats.callstats.io/v1/apps/",n.baseUrl="https://collector.callstats.io:443/",n.qmodelThresholdsAPIUrl="https://dashboard.callstats.io/api-internal/v1/qmodelthresholds",n.csioDebug="false",n.transportType="@@transportType"},{}],34:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.MainFSM=n.MainEvents=void 0;var o="function"==typeof Symbol&&"symbol"==_typeof(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof(e)},s=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),a=e("./statemachine"),d=e("../utility/registry"),f=r(e("../utility/csiologger")),l=r(e("../utility/utils")),h=r(e("../utility/timestamps")),p=r(e("../config/constants")),u=r(e("../config/settings")),c=r(e("./utility")),v=e("../statspipeline/statsadapter"),g=e("../statspipeline/statsparser"),m=e("../statspipeline/statsmonitor"),y=e("../statspipeline/statstransmitter"),_=e("../statspipeline/statsassembler"),b="Created",S="Initializing",C="Idle",T="Run",w=n.MainEvents={onStart:"onStart",onInitialize:"onInitialize",onAddNewFabric:"onAddNewFabric",onSendFabricEvent:"onSendFabricEvent",onReportError:"onReportError",onAssociateMstWithUserID:"onAssociateMstWithUserID",onSetProxyConfig:"onSetProxyConfig",onAttachWifiStatsHandler:"onAttachWifiStatsHandler",onSendUserFeedback:"onSendUserFeedback",onOn:"onOn",onSetIdentifiers:"onSetIdentifiers",onMakePrecallTest:"onMakePrecallTest"},E="onServicesFinished",k=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,b));return f.log("FSM:",e.getState()),e.fire(w.onStart),e.run(),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(e){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined");if("function"!=typeof e)throw new TypeError("predicate must be a function");for(var t=Object(this),n=t.length>>>0,r=arguments[1],i=void 0,o=0;o<n;o++)if(i=t[o],e.call(r,i,o,t))return i}}),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a.StateMachine),s(t,[{key:"proceed",value:function(e,t){switch(this.getState()){case b:switch(e){case w.onStart:this.onStart.apply(this,i(t));break;case w.onInitialize:this.setState(S),f.log("FSM:",this.getState()),this.onInitialize.apply(this,i(t));break;case w.onOn:this.onOn.apply(this,i(t))}break;case S:switch(e){case E:this.onServicesFinished()&&(this.setState(C),f.log("FSM:",this.getState()));break;case w.onAddNewFabric:this.onAddNewFabric.apply(this,i(t));break;case w.onSendFabricEvent:this.onSendFabricEvent.apply(this,i(t));break;case w.onReportError:this.onReportError.apply(this,i(t));break;case w.onAssociateMstWithUserID:this.onAssociateMstWithUserID.apply(this,i(t));break;case w.onSendUserFeedback:this.onSendUserFeedback.apply(this,i(t));break;case w.onAttachWifiStatsHandler:this.onAttachWifiStatsHandler.apply(this,i(t));break;case w.onOn:this.onOn.apply(this,i(t));break;case w.onMakePrecallTest:this.onMakePrecallTest();break;case w.onSetIdentifiers:this.onSetIdentifiers.apply(this,i(t))}break;case C:case T:switch(e){case w.onAddNewFabric:this.onAddNewFabric.apply(this,i(t));break;case w.onSendFabricEvent:this.onSendFabricEvent.apply(this,i(t));break;case w.onReportError:this.onReportError.apply(this,i(t));break;case w.onAssociateMstWithUserID:this.onAssociateMstWithUserID.apply(this,i(t));break;case w.onSendUserFeedback:this.onSendUserFeedback.apply(this,i(t));break;case w.onAttachWifiStatsHandler:this.onAttachWifiStatsHandler.apply(this,i(t));break;case w.onOn:this.onOn.apply(this,i(t));break;case w.onMakePrecallTest:this.onMakePrecallTest();break;case w.onSetIdentifiers:this.onSetIdentifiers.apply(this,i(t))}}}},{key:"onStart",value:function(){d.Registry.getEndpoint().setup(),this.authenticator=d.Registry.getAuthenticator(),this.configservicewrapper=d.Registry.getConfigServiceWrapper(),this.precalltest=d.Registry.getPreCallTest(),this.precalltestIds=[];var e=d.Registry.getStatsAdapter(),t=d.Registry.getStatsParser(),n=d.Registry.getStatsMonitor(),r=d.Registry.getStatsTransmitter(),i=d.Registry.getStatsAssembler();e.connect(v.StatsAdapterIO.RawStatsOut,t.getPort(g.StatsParserIO.RawStatsIn)),t.connect(g.StatsParserIO.PcStatsTupleOut,n.getPort(m.StatsMonitorIO.PcStatsTupleIn)),n.connect(m.StatsMonitorIO.StatsTupleOut,i.getPort(_.StatsAssemblerIO.StatsTupleIn)),i.connect(_.StatsAssemblerIO.CallstatsOut,r.getPort(y.StatsTransmitterIO.CallstatsIn)),e.connect(v.StatsAdapterIO.UnprocessedOut,r.getPort(y.StatsTransmitterIO.UnprocessedIn))}},{key:"setupConnection",value:function(){var e=this;this.connectionManager=d.Registry.getConnectionManager(),this.connectionManager.setupCollectorConnection(d.Registry.getCredentials().getTransportType()),this.connectionManager.setup().then(function(){f.log("Connected to connectionManager"),e.fire(E),e.run()}).catch(function(e){return f.log("Could not connect to connectionManager",e)})}},{key:"setup",value:function(){var e=this;this.clocksync=d.Registry.getClockSync(),this.clocksync.initiate().then(function(){f.log("Clocksync completed"),e.fire(E),e.run()}).catch(function(e){return f.log("Could not finish ClockSync",e)})}},{key:"onInitialize",value:function(e,t,n,r,i,o){var s=this,a=d.Registry.getCredentials();a.setAppId(e),a.setUserId(t),d.Registry.getCallbacks().set(p.callbackFunctions.stats,i),this.doPrecalltest=!0,d.Registry.getGenericEventHandler().sendEvent(p.logEvents.log,{msg:"callstats initialize in progress"}),o&&(!0===o.disableBeforeUnloadHandler&&this.setBeforeUnloadHandler(),o.applicationVersion&&d.Registry.getEndpoint().setAppVersion(o.applicationVersion),o.transportType&&u.setTransportType(o.transportType),o.disablePrecalltest&&(this.doPrecalltest=!1)),this.setup(),this.authenticator.initiate(n,r).then(function(e){f.log("Authentication complete"),s.setupConnection();var t=d.Registry.getCredentials().getStatsSubmissionInterval();d.Registry.getStatsMonitor().setIntervals(t,t),s.fire(E),s.run();var n=s.authenticator.getIceServers();n&&s.doPrecalltest&&s.precalltest.start(n,s.precalltestCallback.bind(s)),s.configservicewrapper.initiateInternalConfig().then(function(){f.log("ConfigService internal config:",s.configservicewrapper.getInternalConfig()),s.fire(E),s.run()},function(e){return f.log(e)}),s.configservicewrapper.initiateAppConfig().then(function(){var e=d.Registry.getCallbacks().get(p.callbackFunctions.defaultConfig),t=s.configservicewrapper.getAppDefaultConfig();e&&t&&e(t);var n=d.Registry.getCallbacks().get(p.callbackFunctions.recommendedConfig),r=s.configservicewrapper.getAppRecommendedConfig();n&&r&&n(r),s.fire(E),s.run()},function(e){return f.log(e)})},function(e){f.log(e)}),this.genericevent=d.Registry.getGenericEventHandler(),this.genericevent.sendEvent(p.logEvents.log,{msg:"callstats initialize in progress"})}},{key:"precalltestCallback",value:function(e,t){var n=d.Registry.getCallbacks().get(p.callbackFunctions.preCallTestResults);if(n){if(t){var r={msg:"precalltest error: "+t};return f.warn("backendlog",r),this.genericevent.sendEvent(p.logEvents.log,r),void n(p.callstatsAPIReturnStatus.failure,null)}var i=c.getPublicPrecalltestResults(e);n(p.callstatsAPIReturnStatus.success,i)}e&&(this.precalltestIds.push(e.id),e.tests&&e.tests.ice&&(""===e.tests.ice.turnIpAddress&&delete e.tests.ice.turnIpAddress,""===e.tests.ice.turnIpVersion&&delete e.tests.ice.turnIpVersion,""===e.tests.ice.turnTransport&&delete e.tests.ice.turnTransport),f.log("sending preCallTest results",e),d.Registry.getEventMessageBuilder().make(p.precalltestEvents.results,null,null,{results:e}))}},{key:"setBeforeUnloadHandler",value:function(){window&&window.addEventListener&&(f.log("setBeforeUnloadHandler"),window.addEventListener("beforeunload",function(e){return d.Registry.getConferenceManager().conferenceMap.forEach(function(e,t){e&&e.getPeerConnectionManager().pcHandlers.forEach(function(e,t){d.Registry.getEventMessageBuilder().make(p.internalFabricEvent.userLeft,e.getConferenceId(),e.getPeerConnection())})}),"Are you sure you want to close the call?"}))}},{key:"onServicesFinished",value:function(){return!!(this.connectionManager&&this.connectionManager.isReady()&&this.clocksync.isCompleted()&&this.authenticator.isCompleted())&&(d.Registry.getTransmissionManager().trySend(),!0)}},{key:"onAddNewFabric",value:function(e,t,n,r,i,o,s){f.warn("FSM onAddNewFabric"),d.Registry.getConferenceManager().add(r,d.Registry.getCredentials());var a=d.Registry.getConferenceManager().get(r);a.getPeerConnectionManager().addPcHandler(e,t,n,r,i,o,s);var l={endpointInfo:d.Registry.getEndpoint().serialize()};d.Registry.getCredentials().getUserIdObject()&&(l.localUserIDObject=d.Registry.getCredentials().getUserIdObject()),a.userJoinedSent||(d.Registry.getEventMessageBuilder().make(p.internalFabricEvent.userJoined,r,e,l),a.userJoinedSent=!0,d.Registry.getCredentials().getTransportType()===p.transportType.rest&&l.localUserIDObject&&l.localUserIDObject.userName&&d.Registry.getEventMessageBuilder().make(p.internalFabricEvent.userDetails,r,e,{userName:String(l.localUserIDObject.userName)}));var u=this.precalltestIds;this.precalltestIds=[];var c=this.precalltest.getId();c&&u.push(c),0<u.length&&d.Registry.getEventMessageBuilder().make(p.precalltestEvents.associate,r,e,{ids:u})}},{key:"onSendFabricEvent",value:function(e,t,n,r){f.warn("FSM onSendFabricEvent");var i={};r&&(i=r),t===p.fabricEvent.activeDeviceList&&(i={mediaDeviceList:l.normalizeMediaDeviceList(r.deviceList)}),d.Registry.getEventMessageBuilder().make(t,n,e,i);var o=d.Registry.getConferenceManager().get(n);if(o){var s=o.getPeerConnectionManager().getPcHandler(e);t!==p.fabricEvent.fabricTerminated&&t!==p.internalFabricEvent.fabricSetupFailed||(s.stopUserAliveHandler(),s.setPcState(p.fabricState.terminated),s.stopStatsPolling()),t===p.fabricEvent.fabricHold&&(s.setPcState(p.fabricState.hold),s.stopStatsPolling()),t===p.fabricEvent.fabricResume&&(s.setPcState(p.fabricState.established),s.startStatsPolling())}}},{key:"onReportError",value:function(e,t,n,r,i,o){f.warn("FSM onReportError");var s={failureDelay:0,reason:this.callFailureClassifier(n),function:n,magicKey:d.Registry.getEndpoint().getMagicKey(),endpoint:d.Registry.getEndpoint().serialize(),level:"debug"};if(r){var a=this.formatDomError(r);s.message=a.message,s.messageType=a.messageType,s.name=r.name,s.stack=r.stack}if(e){var l=d.Registry.getConferenceManager().get(t),u=void 0;if(l&&(u=l.getPeerConnectionManager().getPcHandler(e)),!u)return void f.error("onReportError: No handler found for given PeerConnection!");if(s.failureDelay=h.getCurrent()-u.getStartTime(),s.fabricState=u.getPcState(),s.iceConnectionState=u.getIceConnectionState(),(i||o||e&&"closed"!==e.signalingState)&&d.Registry.getCredentials().getCollectSDP()&&n===p.fabricEvent.fabricSetupFailed){var c={};c.localSDP=this.pickSDP(e,i,"localDescription"),c.remoteSDP=this.pickSDP(e,o,"remoteDescription"),d.Registry.getEventMessageBuilder().make(p.callstatsChannels.sdpSubmission,t,e,c)}}n===p.webRTCFunctions.applicationLog||n===p.webRTCFunctions.applicationError?d.Registry.getEventMessageBuilder().make(p.fabricEvent.applicationErrorLog,t,e,s):d.Registry.getEventMessageBuilder().make(p.fabricEvent.fabricSetupFailed,t,e,s)}},{key:"onAssociateMstWithUserID",value:function(e,t,n,r,i,o){var s=d.Registry.getConferenceManager().get(n);s&&("string"!=typeof r&&(r+=""),s.getPeerConnectionManager().getPcHandler(e).updateSSRCInfo(r,t,i,o))}},{key:"onAttachWifiStatsHandler",value:function(e){d.Registry.getWifiStatsExecutor().setGetWifiStatsMethod(e)}},{key:"onSetProxyConfig",value:function(e){e.collectorURL&&u.setBaseUrl(e.collectorURL),e.authServiceURL&&u.setAuthServiceUrl(e.authServiceURL),e.csioInternalAPIURL&&u.setQmodelThresholdsAPIUrl(e.csioInternalAPIURL),e.wsURL&&u.setWsUrl(e.wsURL),e.restEventUrl&&u.setRestEventUrl(e.restEventURL),e.restStatsUrl&&u.setRestStatsUrl(e.restStatsURL),this.setup()}},{key:"onSendUserFeedback",value:function(e,t,n){var r={feedback:{overallRating:t.overall}};t.video&&(r.feedback.videoQualityRating=t.video),t.audio&&(r.feedback.audioQualityRating=t.audio),t.comment&&(r.feedback.comments=t.comment),d.Registry.getEventMessageBuilder().make(p.callstatsChannels.userFeedback,e,null,r)}},{key:"onOn",value:function(e,t){d.Registry.getCallbacks().set(e,t)}},{key:"onSetIdentifiers",value:function(e,t){if(e.conferenceID&&(d.Registry.getConferenceManager().updateConferenceId(e.conferenceID),d.Registry.getTransmissionManager().updateConferenceId(e.conferenceID),d.Registry.getTransmissionManager().trySend()),e.remoteUserID&&t){var n=d.Registry.getConferenceManager().getConferenceForPc(t);if(!n)return void f.log("onSetIdentifiers conference not found");var r=n.getPeerConnectionManager().getPcHandler(t);if(!r)return void f.log("pcHandler not found");r.updateRemoteId(e.remoteUserID),d.Registry.getTransmissionManager().trySend()}}},{key:"onMakePrecallTest",value:function(){var e=this.authenticator.getIceServers();this.precalltest.start(e,this.precalltestCallback.bind(this))}},{key:"callFailureClassifier",value:function(e){var t=void 0;return p.webRTCFunctions.hasOwnProperty(e)?e===p.webRTCFunctions.createOffer||e===p.webRTCFunctions.createAnswer||e===p.webRTCFunctions.setRemoteDescription?t=p.callFailureReasons.negotiationFailure:e===p.webRTCFunctions.setLocalDescription?t=p.callFailureReasons.sdpError:e===p.webRTCFunctions.addIceCandidate?t=p.callFailureReasons.sdpError:e===p.webRTCFunctions.getUserMedia?t=p.callFailureReasons.mediaConfigError:e===p.webRTCFunctions.iceConnectionFailure?t=p.callFailureReasons.iceFailure:e===p.webRTCFunctions.signalingError?t=p.callFailureReasons.signalingError:(e===p.webRTCFunctions.applicationLog||p.webRTCFunctions.applicationError)&&(t=p.callFailureReasons.applicationLog):t=p.callFailureReasons.invalidWebRTCFunctionName,t}},{key:"formatDomError",value:function(e){var t={},n={};e&&(window.DOMException&&e instanceof window.DOMException?(n.message=e.message,n.name=e.name,t.messageType="domError"):"object"===(void 0===e?"undefined":o(e))?(e.message&&(n.message=e.message),e.name&&(n.name=e.name),e.constraintName&&(n.name=e.constraintName),e.stack&&(n.stack=e.stack),t.messageType="json"):(n=e,t.messageType="text"));var r=this.truncateLog(n);return"object"===(void 0===r?"undefined":o(r))?t.message=JSON.stringify(r):t.message=r,t}},{key:"pickSDP",value:function(e,t,n){return t||(e&&e[n]?e[n].sdp:"")}},{key:"truncateString",value:function(e){return 2e4<e.length&&(f.log("Log exceeds 20kb, It will be truncated"),e=e.substring(0,2e4)),e}},{key:"truncateLog",value:function(e){return e&&("string"==typeof e?e=this.truncateString(e):"object"===(void 0===e?"undefined":o(e))&&e.message&&(e.message=this.truncateString(e.message))),e}}]),t}();n.MainFSM=k},{"../config/constants":32,"../config/settings":33,"../statspipeline/statsadapter":68,"../statspipeline/statsassembler":69,"../statspipeline/statsmonitor":71,"../statspipeline/statsparser":72,"../statspipeline/statstransmitter":73,"../utility/csiologger":87,"../utility/registry":94,"../utility/timestamps":98,"../utility/utils":100,"./statemachine":36,"./utility":37}],35:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=function(){function n(e,t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,n),this.type=e,this.args=void 0!==t?t:null}return r(n,[{key:"getType",value:function(){return this.type}},{key:"getArgs",value:function(){return this.args}}]),n}();n.ProgramEvent=i},{}],36:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.StateMachine=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=e("./programevent"),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/csiologger")),s=function(){function t(e){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,t),this.events=[],this.state=e}return r(t,[{key:"fire",value:function(e){for(var t=arguments.length,n=Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=new o.ProgramEvent(e,n);this.events.push(i)}},{key:"proceed",value:function(e,t){i.warn("You need to overwrite the proceed function inan extended StateMachine")}},{key:"setState",value:function(e){this.state=e}},{key:"getState",value:function(){return this.state}},{key:"run",value:function(){if(!(this.events.length<1)){var e=this.events.shift();this.proceed(e.getType(),e.getArgs())}}}]),t}();n.StateMachine=s},{"../utility/csiologger":87,"./programevent":35}],37:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getPublicPrecalltestResults=function(e){var t={mediaConnectivity:!1,throughput:null,fractionalLoss:null,rtt:null};return e&&e.tests&&(e.tests.rtt&&(t.rtt=e.tests.rtt.median,t.mediaConnectivity=!0),e.tests.throughput&&(t.throughput=e.tests.throughput.average,t.fractionalLoss=Math.max(e.tests.throughput.fractionLostBytes,0),t.mediaConnectivity=!0),e.tests.ice&&(e.tests.ice.relayTcpSuccess||e.tests.ice.relayTlsSuccess||e.tests.ice.relayUdpSuccess)&&(t.mediaConnectivity=!0)),t}},{}],38:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.GetStatsHandler=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),s=r(e("../config/constants")),a=e("../statspipeline/statsadapter"),l=e("../utility/registry"),u=e("../utility/rttregistry"),c=r(e("../utility/csiologger")),o=function(){function o(e,t,n,r,i){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,o),this.pc=e,this.interval=n,this.codeBase=r,this.browserName=i,this.getStatsTimer=null,this.isPromiseBased=!0,this.pcHash=t,this.genericevent=l.Registry.getGenericEventHandler()}return i(o,[{key:"startStatsPolling",value:function(){var e=this;e.getStatsTimer||(c.log("startStatsPolling for ",e.pcHash),this.getStatsTimer=setInterval(function(){e.csioGetStats(e.statsHandler,e.pcHash)},e.interval))}},{key:"stopStatsPolling",value:function(){this.getStatsTimer&&(clearInterval(this.getStatsTimer),this.getStatsTimer=null)}},{key:"csioGetStats",value:function(e,t){var n=s.codeBaseType.firefox,r=s.codeBaseType.chrome,i=s.codeBaseType.edge,o=s.browserName.safari;if(this.pc)try{this.isTemaSys()?this.getStatsTemasys(e,t):this.codeBase===n?this.getStatsFirefox(e,t):this.browserName===o?this.getStatsSafari(e,t):this.codeBase===r?this.getStatsChrome(e,t):this.codeBase===i&&this.getStatsEdge(e,t)}catch(e){c.log("csioGetStats: Error ",e)}}},{key:"getStatsTemasys",value:function(t,n){this.pc.getStats(null,function(e){t(e,n)},function(e){c("getStatsTemasys error",e)})}},{key:"getStatsFirefox",value:function(t,n){var r=this,i=this.pc;if(r.isPromiseBased)try{i.getStats().then(function(e){t(e,n)}).catch(function(e){r.isPromiseBased=!1,i.getStats(null,function(e){t(e,n)})})}catch(e){r.isPromiseBased=!1,r.genericevent.sendEvent(s.logEvents.getStatsError,{msg:"Firefox getStats reports error ",error:e.message+":"+e.stack}),i.getStats(null,function(e){t(e,n)})}else i.getStats(null,function(e){t(e,n)})}},{key:"getStatsChrome",value:function(t,n){var r=this,i=r.pc;if(window&&window.csioReactNative)i.getStats(null,function(e){t(e,n)},function(e){r.genericevent.sendEvent(s.logEvents.getStatsError,{msg:"react-native getStats reports error",error:e.message+":"+e.stack})});else if(r.isPromiseBased)try{i.getStats().then(function(e){(0,u.getRTTRegistry)().update(i),t(e,n)}).catch(function(e){c.log("Chrome getStats Error ",e),r.isPromiseBased=!1,r.genericevent.sendEvent(s.logEvents.getStatsError,{msg:"Chrome getStats reports error",error:e.message+":"+e.stack}),i.getStats(function(e){t(e,n)})})}catch(e){r.isPromiseBased=!1,r.genericevent.sendEvent(s.logEvents.getStatsError,{msg:"Chrome getStats reports error",error:e.message+":"+e.stack}),i.getStats(function(e){t(e,n)})}else i.getStats(function(e){t(e,n)})}},{key:"getStatsEdge",value:function(t,n){var r=this;r.pc.getStats().then(function(e){t(e,n)}).catch(function(e){t({},n),e?r.genericevent.sendEvent(s.logEvents.getStatsError,{msg:"Edge getStats reports error",error:e.message+":"+e.stack}):r.genericevent.sendEvent(s.logEvents.getStatsError,{msg:"Edge getStats reports error"})})}},{key:"getStatsSafari",value:function(t,n){var r=this;r.pc.getStats().then(function(e){t(e,n)}).catch(function(e){r.genericevent.sendEvent(s.logEvents.getStatsError,{msg:"Safari getStats reports error",error:e.message+":"+e.stack})})}},{key:"statsHandler",value:function(e,t){var n=l.Registry.getStatsAdapter();if(e&&n)try{n.transmit(a.StatsAdapterIO.RawStatsIn,e,t)}catch(e){c.log("statsHandler 123: Error ",e),l.Registry.getGenericEventHandler().sendEvent(s.logEvents.error,{msg:"statsHandler: Error",error:e.message+":"+e.stack})}}},{key:"iceCandidatesHandler",value:function(e,t){t(l.Registry.getStatsAdapter().getIceCandidates(e))}},{key:"getIceCandidates",value:function(){var n=this;return new Promise(function(t,e){n.csioGetStats(n.iceCandidatesHandler,function(e){t(e)})})}},{key:"isTemaSys",value:function(){return!!(window&&window.AdapterJS&&window.AdapterJS.WebRTCPlugin&&window.AdapterJS.WebRTCPlugin.plugin)}}]),o}();n.GetStatsHandler=o},{"../config/constants":32,"../statspipeline/statsadapter":68,"../utility/csiologger":87,"../utility/registry":94,"../utility/rttregistry":95}],39:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.PcCallbackHandler=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),l=r(e("../config/constants")),u=e("../utility/registry"),c=r(e("../utility/timestamps")),o=r(e("../config/callstatserrors")),d=r(e("../utility/csiologger")),s=function(){function a(e,t,n,r,i,o){var s=this;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,a),t&&(this.conferenceId=e,this.pc=t,this.getStatsHandler=n,this.userAlive=r,this.callback=o,this.remoteId=i,this.clocksync=u.Registry.getClockSync(),this.emb=u.Registry.getEventMessageBuilder(),this.precalltest=u.Registry.getPreCallTest(),this.genericevent=u.Registry.getGenericEventHandler(),this.iceCandidates=[],this.iceConnectionState=t.iceConnectionState,this.iceGatheringState=t.iceGatheringState,this.signalingState=t.signalingState,this.oldIceConnectionState="",this.oldIceGatheringState="",this.iceConnectionStateTS="",this.negotiationNeeded=0,this.pcState=l.fabricState.initializing,this.disruptedTS=0,this.startTime=c.getCurrent(),this.established=!1,this.activeIceCandidatePair=null,this.prevActiveIceCandidatePair=null,this.localIceCandidates=[],this.remoteIceCandidates=[],this.iceCandidatePairs=[],this.iceConnectivityDelay=0,this.iceGatheringDelay=0,this.fabricSetupSent=!1,this.pc&&this.pc.addEventListener?(this.pc.addEventListener("icecandidate",this.iceCandidateCallback.bind(this),!1),this.pc.addEventListener("iceconnectionstatechange",this.iceConnectionStateChangeCallback.bind(this),!1),this.pc.addEventListener("signalingstatechange",this.pcSignalingStateChangeCallback.bind(this),!1),this.pc.addEventListener("negotiationneeded",this.pcNegotiationNeededCallback.bind(this),!1)):this.pc&&this.pc.attachEvent?(d.info("attachEvent"),this.pc.attachEvent("onicecandidate",this.iceCandidateCallback.bind(this)),this.pc.attachEvent("oniceconnectionstatechange",this.iceConnectionStateChangeCallback.bind(this)),this.pc.attachEvent("onsignalingstatechange",this.pcSignalingStateChangeCallback.bind(this)),this.pc.attachEvent("onnegotiationneeded",this.pcNegotiationNeededCallback.bind(this))):d.error("callstats cannot monitor or collect stats"),!t||"connected"!==t.iceConnectionState&&"completed"!==t.iceConnectionState||(this.pcState=l.fabricState.established,this.getStatsHandler.getIceCandidates().then(function(e){s.localIceCandidates=e.localIceCandidates,s.remoteIceCandidates=e.remoteIceCandidates,s.iceCandidatePairs=e.iceCandidatePairs,s.prevActiveIceCandidatePair=s.activeIceCandidatePair,s.activeIceCandidatePair=s.getActiveIceCandidatePair(),s.sendfabricSetup(),s.startStatsPolling()})))}return i(a,[{key:"iceCandidateCallback",value:function(e){if(e&&e.candidate){var t=e.candidate.candidate.split(" ");if("0"!==t[4]&&"0"!==t[5]){var n=-1!==t[4].indexOf(":"),r="1"===t[1]?"rtp":"rtcp",i={transport:t[2],protocol:r,typePreference:t[3],address:n?"["+t[4]+"]:"+t[5]:t[4]+":"+t[5],type:t[7],media:e.candidate.sdpMid};-1===this.iceCandidates.indexOf(i)&&(this.iceCandidates.push(i),d.warn("CALLBACK: ICE candidate",i))}}}},{key:"iceConnectionStateChangeCallback",value:function(e){var t=this;if(e){d.log("pc states ",this.pc.iceGatheringState,this.pc.iceConnectionState),this.iceConnectionStateTS=this.clocksync.getSynchronizedTimestamp(),this.handleIceGatheringState(),this.handleIceConnectionState(),d.log("states ",this.iceGatheringState,this.iceConnectionState),"complete"===this.iceGatheringState&&"checking"===this.iceConnectionState&&this.handleIceChecking();var n={prevIceConnectionState:this.oldIceConnectionState,currIceConnectionState:this.iceConnectionState},r=this.iceConnectionState;this.getStatsHandler.getIceCandidates().then(function(e){t.localIceCandidates=e.localIceCandidates,t.remoteIceCandidates=e.remoteIceCandidates,t.iceCandidatePairs=e.iceCandidatePairs,t.prevActiveIceCandidatePair=t.activeIceCandidatePair,t.activeIceCandidatePair=t.getActiveIceCandidatePair(),"connected"===r||"completed"===r?t.handleIceConnectedOrCompleted(n):"failed"===r?t.handleIceFailed(n):"disconnected"===r?t.handleIceDisconnected(n):"closed"===r?t.handleIceClosed(n):"new"===r&&t.handleIceRestart(n)})}}},{key:"sendFabricStateChange",value:function(e){this.emb.make(l.internalFabricEvent.fabricStateChange,this.conferenceId,this.pc,e)}},{key:"handleIceConnectionState",value:function(){this.oldIceConnectionState=this.iceConnectionState,this.iceConnectionState=this.pc.iceConnectionState,d.warn("CALLBACK: ICE connection state change",this.oldIceConnectionState,"->",this.iceConnectionState);var e={changedState:l.fabricStateChangeType.iceConnectionState,prevState:this.oldIceConnectionState,newState:this.iceConnectionState};this.sendFabricStateChange(e)}},{key:"handleIceGatheringState",value:function(){if(this.iceGatheringState!==this.pc.iceGatheringState){"complete"===this.pc.iceGatheringState&&(this.iceGatheringDelay=c.getCurrent()-this.startTime),this.oldIceGatheringState=this.iceGatheringState,this.iceGatheringState=this.pc.iceGatheringState,d.warn("CALLBACK: ICE gathering state change",this.oldIceGatheringState,"->",this.iceGatheringState);var e={changedState:l.fabricStateChangeType.iceGatheringState,prevState:this.oldIceGatheringState,newState:this.iceGatheringState};this.sendFabricStateChange(e)}}},{key:"handleIceChecking",value:function(){if("disconnected"===this.oldIceConnectionState&&this.pcState===l.fabricState.checkingDisrupted){var e={prevIceConnectionState:this.oldIceConnectionState,currIceConnectionState:this.iceConnectionState,disruptionDelay:c.getCurrent()-this.disruptedTS};this.emb.make(l.internalFabricEvent.iceConnectionDisruptionEnd,this.conferenceId,this.pc,e)}}},{key:"handleIceConnectedOrCompleted",value:function(e){var t=c.getCurrent();this.pcState===l.fabricState.disrupted&&(e.prevIceCandidatePair=this.prevActiveIceCandidatePair,e.currIceCandidatePair=this.activeIceCandidatePair,e.disruptionDelay=t-this.disruptedTS,this.emb.make(l.internalFabricEvent.iceDisruptionEnd,this.conferenceId,this.pc,e)),this.iceConnectivityDelay=t-this.startTime,this.established=!0,this.pcState=l.fabricState.established,this.sendfabricSetup(),this.startStatsPolling()}},{key:"sendfabricSetup",value:function(){if(this.fabricSetupSent)d.log("fabricSetup has been sent already");else{var e={delay:c.getCurrent()-this.startTime,iceGatheringDelay:this.iceGatheringDelay,iceConnectivityDelay:this.iceConnectivityDelay,localIceCandidates:this.localIceCandidates,remoteIceCandidates:this.remoteIceCandidates,iceCandidatePairs:this.iceCandidatePairs};this.fabricSetupSent=!0;var t=void 0;this.conferenceId&&(t=u.Registry.getConferenceManager().get(this.conferenceId).getPeerConnectionManager().getPcHandler(this.pc),e.remoteEndpointType=t.getRemoteEndpointType(),e.fabricTransmissionDirection=t.getFabricTransmissionDirection()),this.pcState=l.fabricState.established,this.emb.make(l.internalFabricEvent.fabricSetup,this.conferenceId,this.pc,e)}}},{key:"isFabricSetupSent",value:function(){return this.fabricSetupSent}},{key:"startStatsPolling",value:function(){this.getStatsHandler.startStatsPolling()}},{key:"stopStatsPolling",value:function(){this.getStatsHandler.stopStatsPolling()}},{key:"handleIceFailed",value:function(e){e.currIceCandidatePair=this.activeIceCandidatePair,e.failureDelay=c.getCurrent()-this.startTime,e.delay=c.getCurrent()-this.startTime,this.pcState=l.fabricState.failed,"checking"===this.oldIceConnectionState?this.sendIceFailed(e):"completed"===this.oldIceConnectionState||"connected"===this.oldIceConnectionState?this.emb.make(l.internalFabricEvent.fabricDropped,this.conferenceId,this.pc,e):"disconnected"===this.oldIceConnectionState&&this.established?this.emb.make(l.internalFabricEvent.fabricDropped,this.conferenceId,this.pc,e):"disconnected"===this.oldIceConnectionState&&this.sendIceFailed(e)}},{key:"getActiveIceCandidatePair",value:function(){var e=null,t=this.iceCandidatePairs;if(t&&0<t.length){var n=t.filter(function(e){return"true"===e.selected||"true"===e.googActiveConnection||!0===e.selected||!0===e.googActiveConnection});0<n.length&&(e=n[0])}return e}},{key:"sendIceFailed",value:function(e){e.localIceCandidates=this.localIceCandidates,e.remoteIceCandidates=this.remoteIceCandidates,e.iceCandidatePairs=this.iceCandidatePairs,d.log("sending icefailed ",e),this.emb.make(l.internalFabricEvent.iceFailed,this.conferenceId,this.pc,e)}},{key:"sendFabricTransportSwitch",value:function(e){var t=this,n={};n.prevIceCandidatePair=t.activeIceCandidatePair,n.relayType=e,n.currIceConnectionState=t.iceConnectionState,n.prevIceConnectionState=t.oldIceConnectionState,n.switchDelay=null,t.getStatsHandler.getIceCandidates().then(function(e){t.localIceCandidates=e.localIceCandidates,t.remoteIceCandidates=e.remoteIceCandidates,t.iceCandidatePairs=e.iceCandidatePairs,t.activeIceCandidatePair=t.getActiveIceCandidatePair(),n.currIceCandidatePair=t.activeIceCandidatePair,n.localIceCandidates=t.localIceCandidates,n.remoteIceCandidates=t.remoteIceCandidates,d.log("sending fabric transport switch ",n),"completed"!==n.currIceConnectionState&&"connected"!==n.currIceConnectionState||"completed"!==n.prevIceConnectionState&&"connected"!==n.prevIceConnectionState||t.emb.make(l.internalFabricEvent.fabricTransportSwitch,t.conferenceId,t.pc,n)})}},{key:"handleIceDisconnected",value:function(e){var t=c.getCurrent();this.startTime=t,e.prevIceConnectionStateTs=this.iceConnectionStateTS,e.currIceCandidatePair=this.activeIceCandidatePair,"connected"===this.oldIceConnectionState||"completed"===this.oldIceConnectionState?(this.pcState=l.fabricState.disrupted,this.disruptedTS=t,this.emb.make(l.internalFabricEvent.iceDisruptionStart,this.conferenceId,this.pc,e),this.callback&&this.callback(o.csError.appConnectivityError,"Connectivity check for PC object to "+this.remoteId+" failed.")):"checking"===this.oldIceConnectionState&&(this.pcState=l.fabricState.checkingDisrupted,this.disruptedTS=t,this.emb.make(l.internalFabricEvent.iceConnectionDisruptionStart,this.conferenceId,this.pc,e),this.callback&&this.callback(o.csError.appConnectivityError,"Connectivity check for PC object to "+this.remoteId+" failed."))}},{key:"handleIceClosed",value:function(e){"new"===this.oldIceConnectionState||"checking"===this.oldIceConnectionState?(e.failureDelay=c.getCurrent()-this.startTime,e.localIceCandidates=this.localIceCandidates,e.remoteIceCandidates=this.remoteIceCandidates,e.iceCandidatePairs=this.iceCandidatePairs,this.emb.make(l.internalFabricEvent.iceAborted,this.conferenceId,this.pc,e)):(e.currIceCandidatePair=this.activeIceCandidatePair,this.emb.make(l.internalFabricEvent.iceTerminated,this.conferenceId,this.pc,e),this.stopStatsPolling())}},{key:"handleIceRestart",value:function(e){e.prevIceCandidatePair=this.prevActiveIceCandidatePair,"new"!==this.oldIceConnectionState&&(d.log("iceRestarted sending"),this.established=!1,this.emb.make(l.internalFabricEvent.iceRestarted,this.conferenceId,this.pc,e))}},{key:"pcSignalingStateChangeCallback",value:function(e){var n=this;if(e){var t=this.signalingState;this.signalingState=this.pc.signalingState,d.warn("CALLBACK: signaling state change",t,"->",this.signalingState);var r={changedState:l.fabricStateChangeType.signalingState,prevState:t,newState:this.signalingState};this.sendFabricStateChange(r),"have-remote-offer"!==this.signalingState&&"stable"!==this.signalingState||(this.precalltest.callStarts(),this.genericevent.sendEvent(l.logEvents.log,{msg:"precalltest told to stop "})),"closed"===this.signalingState&&(this.emb.make(l.fabricEvent.fabricTerminated,this.conferenceId,this.pc),this.userAlive.stop(),this.precalltest.callFinished(),this.stopStatsPolling(),this.genericevent.sendEvent(l.logEvents.log,{msg:"precalltest finished "})),"have-local-offer"!==this.signalingState&&"have-local-pranswer"!==this.signalingState&&"stable"!==this.signalingState||(d.log(this.signalingState,".. requesting sender config."),u.Registry.getConfigServiceWrapper().initiateSenderConfig(this.pc).then(function(){var e=u.Registry.getConfigServiceWrapper().getSenderConfig();d.log("Sender config:",e);var t=l.callstatsChannels.senderConfiguration;u.Registry.getEventMessageBuilder().make(t,n.conferenceId,n.pc,e)}).catch(function(e){d.warn(e)}))}}},{key:"pcNegotiationNeededCallback",value:function(e){e&&(this.negotiationNeeded++,this.startTime=c.getCurrent(),d.warn("CALLBACK: negotiation needed",this.negotiationNeeded))}}]),a}();n.PcCallbackHandler=s},{"../config/callstatserrors":31,"../config/constants":32,"../utility/csiologger":87,"../utility/registry":94,"../utility/timestamps":98}],40:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.PeerConnectionHandler=void 0;var o=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),l=e("../utility/registry"),s=e("../peerconnection/pccallbackhandler"),a=e("../browserapi/devices"),u=e("./useralivehandler"),c=e("./getstatshandler"),d=r(e("../config/constants")),f=r(e("../utility/timestamps")),h=r(e("../utility/csiologger")),p=function(){function n(e){i(this,n),this.pc=e.pc,this.remoteId=e.remoteId,this.fabricUsage=e.fabricUsage,this.callback=e.callback,this.conferenceId=e.conferenceId,this.remoteEndpointType=e.remoteEndpointType,this.fabricTransmissionDirection=e.fabricTransmissionDirection,this.clocksync=l.Registry.getClockSync(),this.startTime=this.clocksync.getSynchronizedTimestamp(),this.credentials=l.Registry.getCredentials(),this.pcHash=this.generatePcHash(),this.ssrcMap=new Map,this.localSdp=null,this.remoteSdp=null,this.transportInfo=null,this.userAliveHandler=new u.UserAliveHandler(this.conferenceId,this.pc),this.userAliveHandler.start(),this.emb=l.Registry.getEventMessageBuilder(),this.devices=new a.Devices(this.conferenceId,this.pc);var t=l.Registry.getEndpoint();this.getStatsHandler=new c.GetStatsHandler(this.pc,this.pcHash,5e3,t.getCodeBase(),t.getBrowserName()),this.pcCallbackHandler=new s.PcCallbackHandler(this.conferenceId,this.pc,this.getStatsHandler,this.userAliveHandler,this.remoteId,this.callback),this.devices.collectConnected(),this.fabricTransmissionDirection||(this.fabricTransmissionDirection="sendrecv"),this.remoteEndpointType||(this.remoteEndpointType="peer")}return o(n,[{key:"getFabricTransmissionDirection",value:function(){return this.fabricTransmissionDirection}},{key:"getRemoteEndpointType",value:function(){return this.remoteEndpointType}},{key:"stopUserAliveHandler",value:function(){this.userAliveHandler.stop()}},{key:"getPcState",value:function(){return this.pcCallbackHandler.pcState}},{key:"stopStatsPolling",value:function(){this.getStatsHandler.stopStatsPolling()}},{key:"startStatsPolling",value:function(){this.getStatsHandler.startStatsPolling()}},{key:"setPcState",value:function(e){e in d.fabricState?this.pcCallbackHandler.pcState=e:h.error("setPcState: Invalid state")}},{key:"getAppId",value:function(){return this.credentials.getAppId()}},{key:"getLocalId",value:function(){return this.credentials.getUserId()}},{key:"getConferenceId",value:function(){return this.conferenceId}},{key:"getPeerConnection",value:function(){return this.pc}},{key:"getRemoteId",value:function(){return this.remoteId}},{key:"isFabricSetupSent",value:function(){return this.pcCallbackHandler.isFabricSetupSent()}},{key:"getStartTime",value:function(){return this.startTime}},{key:"getCallback",value:function(){return this.callback}},{key:"getPcHash",value:function(){return this.pcHash}},{key:"getIceCandidates",value:function(){return this.pcCallbackHandler?this.pcCallbackHandler.iceCandidates:null}},{key:"getIceConnectionState",value:function(){return this.pcCallbackHandler?this.pcCallbackHandler.iceConnectionState:null}},{key:"getNegotiationsNumber",value:function(){return this.pcCallbackHandler?this.pcCallbackHandler.negotiationNeeded:0}},{key:"sendFabricTransportSwitch",value:function(e){this.pcCallbackHandler&&this.pcCallbackHandler.sendFabricTransportSwitch(e)}},{key:"getSdp",value:function(){return{localSdp:this.localSdp,remoteSdp:this.remoteSdp}}},{key:"setSdp",value:function(e,t){this.localSdp=e,this.remoteSdp=t}},{key:"generatePcHash",value:function(){var e=(Math.random()+1).toString(36);return e.substring(2,e.length)}},{key:"getTransportInfo",value:function(){return this.transportInfo}},{key:"setTransportInfo",value:function(e){this.transportInfo=e}},{key:"updateSDP",value:function(e){var r=this,t=this.pc.localDescription.sdp,n=this.pc.remoteDescription.sdp;if(t&&n&&(t!==this.localSdp||n!==this.remoteSdp)){this.parseSDP(t,d.streamType.outbound),this.parseSDP(n,d.streamType.inbound);var i={localSDP:t!==this.localSdp?t:"",remoteSDP:n!==this.remoteSdp?n:""};""===t&&""===remoteSDP||!l.Registry.getCredentials().getCollectSDP()||this.emb.make(d.internalFabricEvent.sdpSubmission,this.conferenceId,this.pc,i),e&&e.forEach(function(e){var t=String(e.data.ssrc),n=r.ssrcMap.get(t);n||(n={}),n.mediaType=e.data.mediaType,n.reportType=e.data.isRemote?"remote":"local",n.ssrc=t,r.ssrcMap.set(t,n)});var o=[];this.ssrcMap.forEach(function(e,t){o.push(e)});for(var s={ssrcData:o},a=0;a<s.ssrcData.length;a+=1)s.ssrcData[a].userID=l.Registry.getCredentials().getUserId();this.emb.make(d.internalFabricEvent.ssrcMap,this.conferenceId,this.pc,s),this.setSdp(t,n)}}},{key:"parseSDP",value:function(e,l){var u=this,t=RegExp.prototype.test.bind(/^([a-z])=(.*)/),c=/^ssrc:(\d*) ([\w_]*):(.*)/,d=/^ssrc-group:SIM (\d*)/;e.split(/(\r\n|\r|\n)/).filter(t).forEach(function(e){var t=e[0],n=e.slice(2);if("a"===t&&c.test(n)){var r=n.match(c),i=r[1],o=r[2],s=r[3],a=u.ssrcMap.get(i);if(a||(a={}),a.ssrc=i,a[o]=s,a.localStartTime=f.getCurrent(),a.syncedStartTime=u.clocksync.getSynchronizedTimestamp(),a.streamType=l,!d.test(n))return void u.ssrcMap.set(i,a);a.ssrcGroup={},a.ssrcGroup[l]={},a.ssrcGroup[l].simulcastGroup=n.match(/\d+/g),u.ssrcMap.set(i,a)}})}},{key:"getSSRCInfo",value:function(e){return this.ssrcMap.get(e)}},{key:"setupVideoTagMethods",value:function(e,t){var n=this,r=document.getElementById(e);r&&(r.oncanplay=function(){var e={ssrc:String(t),highResTs:f.getCurrent()};n.emb.make(d.internalFabricEvent.mediaPlaybackStart,n.conferenceId,n.pc,e)},r.onsuspend=function(){var e={ssrc:String(t),highResTs:f.getCurrent()};n.emb.make(d.internalFabricEvent.mediaPlaybackSuspended,n.conferenceId,n.pc,e)})}},{key:"updateSSRCInfo",value:function(e,t,n,r){var i=this.ssrcMap.get(e);i||(i={}),i.ssrc=e,i.remoteUserID=t,i.usageLabel=n,i.associatedVideoTag=r,this.ssrcMap.set(e,i),r&&t!==this.credentials.getUserId()&&this.setupVideoTagMethods(r,e)}},{key:"updateConferenceId",value:function(e){this.conferenceId=e,this.userAliveHandler.updateConferenceId(e)}},{key:"updateRemoteId",value:function(e){this.remoteId=e}}],[{key:"Builder",get:function(){return function(){function e(){i(this,e)}return o(e,[{key:"withPc",value:function(e){return this.pc=e,this}},{key:"withRemoteId",value:function(e){return this.remoteId=e,this}},{key:"withFabricUsage",value:function(e){return this.fabricUsage=e,this}},{key:"withConferenceId",value:function(e){return this.conferenceId=e,this}},{key:"withRemoteEndpointType",value:function(e){return this.remoteEndpointType=e,this}},{key:"withFabricTransmissionDirection",value:function(e){return this.fabricTransmissionDirection=e,this}},{key:"withCallback",value:function(e){return this.callback=e,this}},{key:"make",value:function(){return new n(this)}}]),e}()}}]),n}();n.PeerConnectionHandler=p},{"../browserapi/devices":18,"../config/constants":32,"../peerconnection/pccallbackhandler":39,"../utility/csiologger":87,"../utility/registry":94,"../utility/timestamps":98,"./getstatshandler":38,"./useralivehandler":42}],41:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.PeerConnectionManager=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),l=e("./peerconnectionhandler"),i=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.pcHandlers=new Map}return r(e,[{key:"addPcHandler",value:function(e,t,n,r,i,o,s){if(!this.getPcHandler(e)){var a=(new l.PeerConnectionHandler.Builder).withPc(e).withRemoteId(t).withFabricUsage(n).withConferenceId(r).withRemoteEndpointType(i).withFabricTransmissionDirection(o).withCallback(s).make();this.pcHandlers.set(a.getPcHash(),a)}}},{key:"getPcHandler",value:function(n){var r=null;return n&&this.pcHandlers.forEach(function(e,t){e&&e.getPeerConnection()===n&&(r=e)}),r}},{key:"getPcHandlerByHash",value:function(e){return e&&this.pcHandlers.has(e)?this.pcHandlers.get(e):null}},{key:"updateConferenceId",value:function(n){this.pcHandlers.forEach(function(e,t){e.updateConferenceId(n)})}}]),e}();n.PeerConnectionManager=i},{"./peerconnectionhandler":40}],42:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.UserAliveHandler=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../config/constants")),s=e("../utility/timeoutprocess"),a=e("../utility/registry"),r=function(e){function r(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,1e4));return n.emb=a.Registry.getEventMessageBuilder(),n.pc=t,n.conferenceId=e,n.setCallback(n.send),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,s.TimeoutProcess),i(r,[{key:"send",value:function(){this.conferenceId!==o.tmpConferenceId&&this.pc&&this.emb.make(o.internalFabricEvent.userAlive,this.conferenceId,this.pc)}},{key:"updateConferenceId",value:function(e){this.conferenceId=e}}]),r}();n.UserAliveHandler=r},{"../config/constants":32,"../utility/registry":94,"../utility/timeoutprocess":97}],43:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.Authenticator=void 0;var o=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),s=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(r):void 0},a=e("./jwt/jwt"),l=e("./jwt/jwttoken"),u=r(e("../config/settings")),c=r(e("../utility/base64")),d=r(e("../config/callstatserrors")),f=r(e("../config/constants")),h=r(e("../browserapi/localstorage")),p=r(e("../utility/json")),v=e("./xmlhttp"),g=e("./xmlhttpservice"),m=e("../utility/registry"),y=r(e("../utility/csiologger")),_=u.authRetryTimeout,i=function(e){function i(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,"Authenticator"));return e.clockSync=m.Registry.getClockSync(),e.credentials=m.Registry.getCredentials(),e.url=u.authServiceUrl,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,g.XMLHttpService),o(i,[{key:"initiate",value:function(e,t){var r=this;return this.inProgress?(t&&t(d.csError.authOngoing,null),new Promise(function(e,t){t(new Error(r.name+": in progress"))})):this.credentials.getAppId()&&this.credentials.getUserId()?(this.initCallback=t,"function"==typeof e?(this.setTokenGenerator(e),s(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"initiate",this).call(this)):new Promise(function(t,n){r.createTokenGenerator(e).then(function(e){r.setTokenGenerator(e),s(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"initiate",r).call(r).then(function(){t()},function(e){n(e)})},function(e){n(new Error(r.name+": tokenGenerator creation problem ("+e+")"))})})):new Promise(function(e,t){t(new Error(r.name+": credentials not set"))})}},{key:"getToken",value:function(){var e=null;return this.token&&(e=this.token.getToken()),e}},{key:"isTokenValid",value:function(){return!!this.token&&this.token.isValid(this.credentials)}},{key:"getElapsed",value:function(){return this.isCompleted()?this.elapsed:null}},{key:"getIceServers",value:function(){return this.iceServers}},{key:"reset",value:function(){this.token=null,this.reauthTimer=null,this.renew=!1,this.credentials=null,this.jwt=new a.Jwt,this.tokenGenerator=function(e,t){t("Token generator is not set")},this.elapsed=0,this.iceServers=null,s(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"reset",this).call(this)}},{key:"setupToken",value:function(e){h.store("csio_auth_data",JSON.stringify(e)),this.token=new l.JwtToken(e,this.clockSync)}},{key:"clearReauthTimer",value:function(){null!==this.reauthTimer&&(clearTimeout(this.reauthTimer),this.reauthTimer=null)}},{key:"setupReauthTimer",value:function(e){var t=this;t.clearReauthTimer(),t.reauthTimer=setTimeout(function(){t.reAuthenticate()},e)}},{key:"reAuthenticate",value:function(){this.inProgress||(this.inProgress=!0,this.token=null,this.sendRequest())}},{key:"handleErrorActions",value:function(e){if(0!==e.length){var t=e.shift();if(t.action===d.authErrorActions.RETRY){var n=t.params.timeout?t.params.timeout:u.authRetryTimeout;this.setupReauthTimer(n),this.handleErrorActions(e)}t.action===d.authErrorActions.GET_NEW_TOKEN&&(this.renew=!0,this.handleErrorActions(e)),t.action===d.authErrorActions.REPORT_ERROR&&(y.error(this.name+": "+t.params.errorReason),this.handleErrorActions(e))}}},{key:"setTokenGenerator",value:function(e){this.tokenGenerator=e}},{key:"handleResponse",value:function(e){var t=e.getXhr(),n=e.getElapsed(),r=p.parse(t.response);if(!r)return y.error(this.name+": invalid authentication response"),void this.sendNextRequest();if(r["urn:x-callstats:auth:errorActions"]&&0<r["urn:x-callstats:auth:errorActions"].length)this.handleErrorActions(r["urn:x-callstats:auth:errorActions"]);else{if(200===t.status){if("bearer"!==r.token_type)return y.error(this.name+": successful, but token type was not bearer. Scheduling retry."),void this.sendNextRequest();this.setupToken(r.access_token),r.iceServers&&(this.iceServers=r.iceServers);var i=parseInt(1e3*parseInt(r.expires_in)*.9);return this.setupReauthTimer(i),this.renew=!1,this.initCallback&&this.initCallback(d.csError.success,f.csCallBackMessages.authSuccessful),this.elapsed=n,void this.completeProcess()}y.error("Authentication failed, but no error actions were defined in response."),this.sendNextRequest()}}},{key:"request",value:function(){var i=this;this.clearReauthTimer();var e=new Promise(function(e,t){i.tempResolve=e,i.tempReject=t});return this.tokenGenerator(this.renew,function(e,t){if(null!==e)return i.initCallback&&i.initCallback(d.csError.tokenGenerationError,e.toString()),i.rejectCb(new Error(i.name+": tokenGenerationError")),y.error("tokenGenerationError ",e),null;var n=i.url+"authenticate",r={client_id:i.credentials.userId+"@"+i.credentials.getAppId(),code:t,grant_type:"authorization_code"};(0,v.sendPostRequest)(n,{"Content-Type":"application/x-www-form-urlencoded"},_,r).then(function(e){i.tempResolve(e)},function(e){i.tempReject(e)})}),e}},{key:"tokenGeneratorCreator",value:function(o,s){var a=this;return function(e,t){var n=null;if(!e&&null!==n)return t(null,n);var r=a.credentials,i={userID:r.getUserId(),appID:r.getAppId()};s&&(i.keyId=s),a.jwt.sign({alg:"HS256"},i,o).then(function(e){t(null,n=e)}).catch(function(e){t(e)})}}},{key:"createTokenGenerator",value:function(i){var o=this;return new Promise(function(n,t){var r=null;-1<i.indexOf(":")&&(r=c.strtohex(i.split(":")[0]),i=i.split(":")[1]),o.jwt.importKey(i).then(function(e){i=null;var t=o.tokenGeneratorCreator(e,r);n(t)}).catch(function(e){y.error(o.name+": could not import key ("+e+")"),t(e)})})}}]),i}();n.Authenticator=i},{"../browserapi/localstorage":19,"../config/callstatserrors":31,"../config/constants":32,"../config/settings":33,"../utility/base64":84,"../utility/csiologger":87,"../utility/json":92,"../utility/registry":94,"./jwt/jwt":51,"./jwt/jwttoken":52,"./xmlhttp":57,"./xmlhttpservice":58}],44:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.GenericEventHandler=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),s=r(e("../config/settings")),a=e("./xmlhttp"),o=e("../utility/registry"),l=r(e("../utility/csiologger")),u=s.baseUrl+"generics",c=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.credentials=o.Registry.getCredentials(),this.enabled=!1}return i(e,[{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1}},{key:"sendEvent",value:function(e,t){this.send(e,t).then(function(e){l.log("Got generic response: %o",e)}).catch(function(e){l.log("Got error for generic request",e)})}},{key:"send",value:function(r,i){if(!this.enabled)return new Promise(function(e,t){t(new Error("GenericEvent Error: not enabled"))});var o=this;return new Promise(function(t,n){var e={appID:o.credentials.appId,userID:encodeURIComponent(o.credentials.userId),version:s.version,eventType:r,data:i};(0,a.sendPostRequest)(u,{"Content-Type":"application/json"},5e3,e).then(function(e){t(e.getXhr().response)},function(e){n(e)})})}}]),e}();n.GenericEventHandler=c},{"../config/settings":33,"../utility/csiologger":87,"../utility/registry":94,"./xmlhttp":57}],45:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.ClockSync=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(r):void 0},s=r(e("../config/settings")),a=e("./xmlhttp"),l=r(e("../utility/timestamps")),u=e("./xmlhttpservice"),c=e("../utility/registry"),d=r(e("../config/constants")),f=s.baseUrl+"clockSync",h=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ClockSync"));return e.currentOffset=0,e.completed=!1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,u.XMLHttpService),i(t,[{key:"initiate",value:function(){return this.startTime=l.getCurrent(),c.Registry.getGenericEventHandler().sendEvent(d.logEvents.log,{msg:"Starting clocksync"}),o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initiate",this).call(this)}},{key:"getSynchronizedTimestamp",value:function(){return l.getCurrent()+this.currentOffset}},{key:"getElapsed",value:function(){return this.isCompleted()?this.endTime-this.startTime:null}},{key:"getOffset",value:function(){return this.currentOffset}},{key:"reset",value:function(){this.currentOffset=0,this.offsetResults=[],this.startTime=0,this.endTime=0,o(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this)}},{key:"request",value:function(){return(0,a.sendGetRequest)(f,null,5e3)}},{key:"handleResponse",value:function(e){var t=e.getXhr(),n=e.getElapsed(),r=JSON.parse(t.response),i=l.getCurrent();this.handleMessage(r,n,i)}},{key:"handleMessage",value:function(e,t,n){var r=t/2;6e4<r?(this.offsetResults=[],c.Registry.getGenericEventHandler().sendEvent(d.logEvents.log,{msg:"clockSync restarting"})):this.addOffset(e,r,n),5<=this.offsetResults.length?(this.calculateOffset(),this.endTime=l.getCurrent(),this.completeProcess()):this.sendRequest()}},{key:"isCompleted",value:function(){return this.completed}},{key:"addOffset",value:function(e,t,n){var r=e.now+t,i=r-n;this.offsetResults.push(i),c.Registry.getGenericEventHandler().sendEvent(d.logEvents.log,{msg:"clockSync Info: serverTime "+r+" responseRecvTs: "+n})}},{key:"calculateOffset",value:function(){var e=this.offsetResults.reduce(function(e,t){return e+t});this.currentOffset=e/this.offsetResults.length,this.currentOffset=isNaN(this.currentOffset)?0:this.currentOffset,c.Registry.getGenericEventHandler().sendEvent(d.logEvents.log,{msg:"clockSync Done, offset is: "+this.currentOffset+"results length"+this.offsetResults.length}),this.offsetResults=[],this.completed=!0}}]),t}();n.ClockSync=h},{"../config/constants":32,"../config/settings":33,"../utility/registry":94,"../utility/timestamps":98,"./xmlhttp":57,"./xmlhttpservice":58}],46:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.connected=!1,this.reconnected=!1,this.conferenceUrl={}}return r(e,[{key:"setup",value:function(){return new Promise(function(e,t){e()})}},{key:"isReady",value:function(){return this.connected}},{key:"send",value:function(e){}}]),e}();n.CollectorConnection=i},{}],47:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ConfigServiceGet=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(r):void 0},o=e("../xmlhttp"),s=e("../xmlhttpservice"),a=e("../../utility/registry"),l=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"ConfigService"))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.XMLHttpService),r(t,[{key:"initiate",value:function(e){var n=this;return this.url=e,this.authToken=a.Registry.getAuthenticator().getToken(),this.authToken?i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"initiate",this).call(this):new Promise(function(e,t){t(new Error(n.name+": authToken has to be string"))})}},{key:"getConfig",value:function(){return this.config}},{key:"getElapsed",value:function(){return this.isCompleted()?this.elapsed:null}},{key:"reset",value:function(){this.authToken=null,this.url=null,this.config=null,this.elapsed=0,i(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this)}},{key:"request",value:function(){var e={Authorization:"Bearer "+this.authToken};return(0,o.sendGetRequest)(this.url,e,2e3)}},{key:"handleResponse",value:function(e){var t=e.getXhr(),n=e.getElapsed();this.config=JSON.parse(t.response),this.elapsed=n,this.completeProcess()}}]),t}();n.ConfigServiceGet=l},{"../../utility/registry":94,"../xmlhttp":57,"../xmlhttpservice":58}],48:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ConfigServicePost=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=e("../xmlhttp"),o=e("./configserviceget"),s=function(e){function n(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,o.ConfigServiceGet),r(n,[{key:"initiate",value:function(e,t){return this.body=t,function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(r):void 0}(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"initiate",this).call(this,e)}},{key:"request",value:function(){var e={Authorization:"Bearer "+this.authToken,"Content-Type":"application/json"};return(0,i.sendPostRequest)(this.url,e,2e3,this.body)}}]),n}();n.ConfigServicePost=s},{"../xmlhttp":57,"./configserviceget":47}],49:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.ConfigServiceWrapper=void 0;var l="function"==typeof Symbol&&"symbol"==_typeof(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof(e)},i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=e("./configserviceget"),s=e("./configservicepost"),a=r(e("../../config/settings")),u=e("../../utility/registry"),c=r(e("../../utility/csiologger")),d=a.configServiceUrl,f=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.internalConfigService=new o.ConfigServiceGet,this.appConfigService=new o.ConfigServiceGet,this.senderConfigService=new s.ConfigServicePost,this.defaultSenderConfig=null}return i(e,[{key:"initiateInternalConfig",value:function(){var n=this,e=u.Registry.getCredentials().getAppId();if(!e)return new Promise(function(e,t){c.log("appId has to be string"),t(new Error(n.internalConfigService.name+": appId has to be string"))});var t=d+e;return this.internalConfigService.initiate(t+"/configurations/internal")}},{key:"initiateAppConfig",value:function(){var n=this,e=u.Registry.getCredentials().getAppId();if(!e)return new Promise(function(e,t){c.log("appId has to be string"),t(new Error(n.appConfigService.name+": appId has to be string"))});var t=d+e;return this.appConfigService.initiate(t+"/configurations")}},{key:"initiateSenderConfig",value:function(e){var n=this;if(this.senderConfigService.getConfig())return new Promise(function(e,t){c.log("sender config already present"),t(new Error(n.senderConfigService.name+": sender config already present"))});var t=u.Registry.getCredentials().getAppId(),r=u.Registry.getCredentials().getUserId();if(!t||!r)return new Promise(function(e,t){c.log("appId and userId have to be string"),t(new Error(n.senderConfigService.name+": appId and userId have to be string"))});if(this.defaultSenderConfig=this.getCurrentVideoSenderConfig(e),!this.defaultSenderConfig)return new Promise(function(e,t){c.log("Could not obtain a sender config"),t(new Error(n.senderConfigService.name+": Could not obtain a sender config"))});var i=d+t,o={app_id:t,local_id:r,rtc_rtp_parameters:this.defaultSenderConfig};return this.senderConfigService.initiate(i+"/configurations",o)}},{key:"getInternalConfig",value:function(){return this.internalConfigService.getConfig()}},{key:"getAppDefaultConfig",value:function(){var e=this.appConfigService.getConfig(),t={peerConnection:null,media:null};return e.default&&(e.default.peerConnection&&(t.peerConnection=e.default.peerConnection),e.default.media&&(t.media=e.default.media)),t}},{key:"getAppRecommendedConfig",value:function(){var e=this.appConfigService.getConfig(),t={};return e.recommended&&(e.recommended.peerConnection&&(t.peerConnection=e.recommended.peerConnection),e.recommended.media&&(t.media=e.recommended.media)),t}},{key:"getSenderConfig",value:function(){var e=this.senderConfigService.getConfig();return e&&e.recommended&&e.recommended.sender?e.recommended.sender:null}},{key:"getDefaultSenderConfig",value:function(){return this.defaultSenderConfig?this.defaultSenderConfig:null}},{key:"getInternalElapsed",value:function(){return this.internalConfigService.getElapsed()}},{key:"getAppElapsed",value:function(){return this.appConfigService.getElapsed()}},{key:"getSenderElapsed",value:function(){return this.senderConfigService.getElapsed()}},{key:"getCurrentVideoSenderConfig",value:function(e){var t={encodings:[{maxBitrate:0}]},n=u.Registry.getConferenceManager().getConferenceForPc(e);if(!n)return c.warn("No conference found for PC, skipping"),null;if(1<n.getPeerConnectionManager().pcHandlers.size)return c.warn("Multiple PCs found, skipping"),null;if(!e.getSenders||"function"!=typeof e.getSenders)return c.warn("Get senders error"),t;for(var r=e.getSenders(),i=void 0,o=0;o<r.length;o+=1){var s=r[o];if("object"!==(void 0===s?"undefined":l(s))||!s.track||"object"!==l(s.track)||!s.track.kind)return c.warn("Access senders error"),null;if("video"===s.track.kind){if(i)return c.warn("Multiple video sender, skipping"),null;i=s}}if(!i)return c.warn("No video sender found"),null;if(!i.getParameters||"function"!=typeof i.getParameters)return c.warn("Sender getParameters error"),t;var a=i.getParameters();return"object"!==(void 0===a?"undefined":l(a))?null:("encodings"in a||(a.encodings=[]),0===a.encodings.length&&a.encodings.push({maxBitrate:0}),a)}}]),e}();n.ConfigServiceWrapper=f},{"../../config/settings":33,"../../utility/csiologger":87,"../../utility/registry":94,"./configserviceget":47,"./configservicepost":48}],50:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.ConnectionManager=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../config/constants")),o=e("./wscollectorconnection"),s=e("./restcollectorconnection"),a=e("../utility/registry"),l=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.connection=null}return r(e,[{key:"setupCollectorConnection",value:function(e){e===i.transportType.rest?this.connection=new s.RestCollectorConnection:this.connection=new o.WsCollectorConnection}},{key:"setup",value:function(){return this.connection?this.connection.setup():new Promise(function(e,t){t()})}},{key:"isReady",value:function(){return!!this.connection&&this.connection.isReady()}},{key:"send",value:function(e){this.connection?this.connection.send(e):a.Registry.getGenericEventHandler().sendEvent(i.logEvents.error,{msg:"Connection not available to the collector"})}}]),e}();n.ConnectionManager=l},{"../config/constants":32,"../utility/registry":94,"./restcollectorconnection":53,"./wscollectorconnection":56}],51:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.Jwt=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),f=r(e("../../utility/base64")),h=r(e("../../utility/csiologger")),o=e("../../utility/registry"),p=r(e("../../config/constants")),s=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.cryptotype=null,window.crypto&&window.crypto.subtle?(this.cryptotype="standard",this.subtlecrypto=window.crypto.subtle):window.crypto&&!window.crypto.subtle&&window.crypto.webkitSubtle?(this.cryptotype="webkit",this.subtlecrypto=window.crypto.webkitSubtle):window.msCrypto&&window.msCrypto.subtle?(this.cryptotype="ie",this.subtlecrypto=window.msCrypto.subtle):(this.subtlecrypto=null,h.info("WebCryptography API not supported in this browser.")),this.browserName=o.Registry.getEndpoint().getBrowserName()}return i(e,[{key:"sign",value:function(l,u,c){var d=this;return new Promise(function(n,r){"HS256"!==l.alg&&r("Use header.alg=HS256"),l=JSON.stringify(l),"string"!=typeof u&&(u=JSON.stringify(u));var t=f.urlencodeUnicode(l)+"."+f.urlencodeUnicode(u);window.csioReactNative&&window.csiosign(t,c,function(e,t){if(e)return h.log("Token sign error",e),void r(error);n(t)});var e=new ArrayBuffer(t.length),i=new Uint8Array(e),o={name:"HMAC"};"ie"!==d.cryptotype&&"webkit"!==d.cryptotype&&d.browserName!==p.browserName.edge||(o.hash={name:"sha-256"});for(var s=t.length-1;0<=s;s--)i[s]=t.charCodeAt(s);var a=d.subtlecrypto.sign(o,c,i);"ie"===d.cryptotype?(a.onerror=r,a.oncomplete=function(e){t=d.buildToken(e.target.result,t),n(t)}):a.then(function(e){t=d.buildToken(e,t),n(t)}).catch(function(e){r(e)})})}},{key:"buildToken",value:function(e,t){for(var n="",r=new Uint8Array(e),i=r.byteLength,o=0;o<i;o++)n+=String.fromCharCode(r[o]);return t+"."+f.urlencode(n)}},{key:"decode",value:function(e){try{var t=e.split(".")[1],n=f.decode(t);return JSON.parse(n)}catch(e){return h.error("Could not decode token. "),null}}},{key:"importKey",value:function(a){var l=this;return new Promise(function(t,e){if(window.csioReactNative)t(a);else{if("webkit"===l.cryptotype)for(;a.length<32;)a+="\0";var n={kty:"oct",k:f.urlencode(a),alg:"HS256"},r={name:"HMAC",hash:{name:"SHA-256"}};if("ie"===l.cryptotype?n.extractable=!1:n.ext=!1,"webkit"===l.cryptotype&&(r=null,n.use="sig"),"ie"===l.cryptotype||"webkit"===l.cryptotype){var i=JSON.stringify(n);n=new Uint8Array(i.length);for(var o=0;o<i.length;o++)n[o]=i.charCodeAt(o)}var s=l.subtlecrypto.importKey("jwk",n,r,!1,["sign"]);"ie"===l.cryptotype?(s.onerror=e,s.oncomplete=function(e){t(e.target.result)}):s.then(t).catch(e)}})}}]),e}();n.Jwt=s},{"../../config/constants":32,"../../utility/base64":84,"../../utility/csiologger":87,"../../utility/registry":94}],52:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.JwtToken=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=e("./jwt"),s=e("../../utility/registry"),a=r(e("../../config/constants")),l=r(e("../../utility/csiologger")),u=function(){function t(e){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,t),this.token=e,this.statsSubmissionInterval=15e3,this.collectSDP=!1,this.appId=null,this.userId=null,this.tokenPayload=null,this.jwt=new o.Jwt,this.expires=null,this.clockSync=s.Registry.getClockSync(),this.adaptiveInterval=!1,this.transportType=a.transportType.rest,this.setupTokenPayload(),this.restApiTransport=!1}return i(t,[{key:"getToken",value:function(){return this.token}},{key:"setupTokenPayload",value:function(){var e=this.jwt.decode(this.token);if(this.statsSubmissionInterval=parseInt(e.submissionInterval,10),this.collectSDP=e.collectSDP,this.adaptiveInterval=e.adaptiveInterval,this.appId=e.appID,this.userId=e.userID,this.restApiTransport=e.restApiTransport,navigator.mozGetUserMedia){var t=e.expiry.split(" ").join("T");this.expires=Date.parse(t)}else this.expires=new Date(e.expiry);this.restApiTransport?this.transportType=a.transportType.rest:this.transportType=a.transportType.ws,l.info("transportType is ",this.transportType,this.restApiTransport),s.Registry.getCredentials().setStatsSubmissionInterval(this.statsSubmissionInterval),s.Registry.getCredentials().setCollectSDP(this.collectSDP),s.Registry.getCredentials().setTransportType(this.transportType),s.Registry.getCredentials().setAdaptiveInterval(this.adaptiveInterval)}},{key:"isValid",value:function(e){var t=!1;return null!==this.token&&this.appId===e.appId&&this.userId===encodeURIComponent(e.userId)&&new Date(this.clockSync.getSynchronizedTimestamp())<this.expires&&(t=!0),t}}]),t}();n.JwtToken=u},{"../../config/constants":32,"../../utility/csiologger":87,"../../utility/registry":94,"./jwt":51}],53:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.RestCollectorConnection=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),l=e("../utility/registry"),u=e("./xmlhttp"),o=e("./collectorconnection"),s=e("./restrelays"),a=r(e("../config/constants")),c=r(e("../utility/csiologger")),d=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.relays=new s.RestRelays,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.CollectorConnection),i(t,[{key:"isReady",value:function(){return!0}},{key:"send",value:function(e){var t={"Content-Type":"application/json",Authorization:"Bearer "+l.Registry.getAuthenticator().getToken()},n=e.eventType,r=e.confID,i=e.ucID,o=this.relays,s=o.getRequestUrl(n,r,i);if(s){var a=this.getMessage(n,e);c.log("sending ",s,e),(0,u.sendPostRequest)(s,t,5e3,a).then(function(e){o.handleResponse(n,e,r)},function(e){c.error(e)})}else c.warn("No action for message type: "+n)}},{key:"getMessage",value:function(e,t){delete t.confID,delete t.channel,delete t.token,delete t.appID,delete t.action,delete t.ucID,delete t.version;var n=decodeURIComponent(t.localID);t.localID=n;var r=decodeURIComponent(t.remoteID);return t.remoteID=r,e===a.callstatsChannels.processedStats&&(t.eventType="stats"),t}}]),t}();n.RestCollectorConnection=d},{"../config/constants":32,"../utility/csiologger":87,"../utility/registry":94,"./collectorconnection":46,"./restrelays":54,"./xmlhttp":57}],54:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null;return function(e,t){if(e&&e.xhr){var n=e.xhr.response,r=JSON.parse(n);r.conferenceId=t,"success"===r.status?i&&i(r):o?o(r):(u.Registry.getGenericEventHandler().sendEvent(a.logEvents.restResponseError,{msg:"response failure "+r.msg+":"+r.status}),d.error("Response error:",r.msg,n))}else d.log("Response for request is null")}}Object.defineProperty(n,"__esModule",{value:!0}),n.RestRelays=void 0;var s=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),a=r(e("../config/constants")),l=r(e("../config/settings")),u=e("../utility/registry"),c=e("../utility/url"),d=r(e("../utility/csiologger")),f=function(){function t(){var e;i(this,t),this.items=(e=o(),new Map([[a.fabricEvent.fabricTerminated,new h(l.restEventUrl,"/events/fabric/terminated",e)],[a.fabricEvent.audioMute,new h(l.restEventUrl,"/events/media/actions",e)],[a.fabricEvent.audioUnmute,new h(l.restEventUrl,"/events/media/actions",e)],[a.fabricEvent.videoPause,new h(l.restEventUrl,"/events/media/actions",e)],[a.fabricEvent.videoResume,new h(l.restEventUrl,"/events/media/actions",e)],[a.fabricEvent.screenShareStart,new h(l.restEventUrl,"/events/media/actions",e)],[a.fabricEvent.screenShareStop,new h(l.restEventUrl,"/events/media/actions",e)],[a.fabricEvent.activeDeviceList,new h(l.restEventUrl,"/events/devices/list",e)],[a.fabricEvent.applicationErrorLog,new h(l.restEventUrl,"/events/app/logs",e)],[a.fabricEvent.dominantSpeaker,new h(l.restEventUrl,"/events/dominantspeaker",e)],[a.fabricEvent.fabricHold,new h(l.restEventUrl,"/events/fabric/actions",e)],[a.fabricEvent.fabricResume,new h(l.restEventUrl,"/events/fabric/actions",e)],[a.internalFabricEvent.fabricSetup,new h(l.restEventUrl,"/events/fabric/setup",e)],[a.fabricEvent.fabricSetupFailed,new h(l.restEventUrl,"/events/fabric/setupfailed",e)],[a.internalFabricEvent.userJoined,new h(l.restEventUrl,"",o(function(e){if("success"===e.status){var t=decodeURIComponent(e.conferenceId),n=u.Registry.getConferenceManager().get(t);n&&(d.log("UcId =",e.ucID,t),n.setUcId(e.ucID),u.Registry.getTransmissionManager().trySend())}else u.Registry.getGenericEventHandler().sendEvent(a.logEvents.restResponseError,{msg:"userJoined response failure"+e.msg+":"+e.status})}))],[a.internalFabricEvent.userLeft,new h(l.restEventUrl,"/events/user/left",e)],[a.internalFabricEvent.userAlive,new h(l.restEventUrl,"/events/user/alive",e)],[a.internalFabricEvent.fabricTransportSwitch,new h(l.restEventUrl,"/events/fabric/transportchange",e)],[a.internalFabricEvent.mediaPlaybackStart,new h(l.restEventUrl,"/events/media/pipeline",e)],[a.internalFabricEvent.mediaPlaybackSuspended,new h(l.restEventUrl,"/events/media/pipeline",e)],[a.internalFabricEvent.mediaPlaybackStalled,new h(l.restEventUrl,"/events/media/pipeline",e)],[a.internalFabricEvent.ssrcMap,new h(l.restEventUrl,"/events/ssrcmap",e)],[a.internalFabricEvent.connectedDeviceList,new h(l.restEventUrl,"/events/devices/list",e)],[a.internalFabricEvent.sdpSubmission,new h(l.restEventUrl,"/events/sdp",e)],[a.internalFabricEvent.iceDisruptionStart,new h(l.restEventUrl,"/events/ice/status",e)],[a.internalFabricEvent.iceDisruptionEnd,new h(l.restEventUrl,"/events/ice/status",e)],[a.internalFabricEvent.iceConnectionDisruptionStart,new h(l.restEventUrl,"/events/ice/status",e)],[a.internalFabricEvent.iceConnectionDisruptionEnd,new h(l.restEventUrl,"/events/ice/status",e)],[a.internalFabricEvent.iceAborted,new h(l.restEventUrl,"/events/ice/status",e)],[a.internalFabricEvent.iceTerminated,new h(l.restEventUrl,"/events/ice/status",e)],[a.internalFabricEvent.iceFailed,new h(l.restEventUrl,"/events/ice/status",e)],[a.internalFabricEvent.iceRestarted,new h(l.restEventUrl,"/events/ice/status",e)],[a.internalFabricEvent.fabricDropped,new h(l.restEventUrl,"/events/fabric/status",e)],[a.callstatsChannels.processedStats,new h(l.restStatsUrl,"/stats",e)],[a.internalFabricEvent.fabricStateChange,new h(l.restEventUrl,"/events/fabric/statechange",e)],[a.callstatsChannels.userFeedback,new h(l.restEventUrl,"/events/feedback",e)],[a.precalltestEvents.results,new h(l.restEventUrl,"/events/precall",e)],[a.precalltestEvents.associate,new h(l.restEventUrl,"/events/precall",e)],[a.internalFabricEvent.userDetails,new h(l.restEventUrl,"/events/userdetails",e)]]))}return s(t,[{key:"getRequestUrl",value:function(e,t,n){return this.items.has(e)?this.items.get(e).getRequestUrl(e,t,n):(d.warn("EventType Unsupported ",e),null)}},{key:"handleResponse",value:function(e,t,n){this.items.has(e)?this.items.get(e).handleResponse(t,n):d.warn("No response handler for event type "+e)}}]),t}(),h=function(){function r(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;i(this,r),this.baseUrl=e,this.urlAppendix=t,this.responseHandler=n}return s(r,[{key:"getRequestUrl",value:function(e,t,n){return this.makeRequestUrl(e,t,n),this.requestUrl.toString()}},{key:"makeRequestUrl",value:function(e,t,n){e===a.precalltestEvents.results?this.requestUrl=new c.Url(this.baseUrl,u.Registry.getCredentials().getAppId(),this.urlAppendix):(e===a.internalFabricEvent.userJoined&&n&&(n=""),this.requestUrl=new c.Url(this.baseUrl,u.Registry.getCredentials().getAppId()+"/conferences/"+t,n,this.urlAppendix))}},{key:"handleResponse",value:function(e,t){this.responseHandler(e,t)}}]),r}();n.RestRelays=f},{"../config/constants":32,"../config/settings":33,"../utility/csiologger":87,"../utility/registry":94,"../utility/url":99}],55:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.TransmissionManager=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=r(e("../utility/timestamps")),s=e("../collections/cache"),a=e("../utility/registry"),l=r(e("../config/constants")),u=r(e("../utility/csiologger")),c=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.cache=[],this.connectionManager=a.Registry.getConnectionManager(),this.lastTS=0,this.timerStarted=!1}return i(e,[{key:"send",value:function(e){(e.isCachable()||e.canBeSent())&&(this.cache[e.getConferenceId()]||(this.cache[e.getConferenceId()]=new s.Cache),this.cache[e.getConferenceId()].add(e,e.isPriority()),this.trySend())}},{key:"trySend",value:function(){if(this.connectionManager.isReady())return this.timerStarted?void 0:this.timeToSend()?void(this.sendMessage()&&this.startTimer()):void(0<this.getCacheLength()&&this.startTimer());this.setupConnection()}},{key:"setupConnection",value:function(){this.connectionManager.setup().then(function(){u.log("Connected to connectionManager")}).catch(function(e){return u.log("Could not connect to connectionManager",e)})}},{key:"sendMessage",value:function(){var e=void 0,t=void 0;if(0===this.getCacheLength())return!1;for(var n in this.cache)if(this.cache.hasOwnProperty(n)&&(t=n,(e=this.cache[t].peak())&&e.canBeSent()))break;return!(!e||!e.canBeSent()||(u.log("sending message type :",e.toJson().action,e.toJson()),e=this.cache[t].pop(),this.lastTS=o.getCurrent(),this.connectionManager.send(e.toJson()),0))}},{key:"startTimer",value:function(){var e=this;this.timerStarted||0!=this.getCacheLength()&&(this.timerStarted=!0,setTimeout(function(){e.timerStarted=!1,e.trySend()},200))}},{key:"timeToSend",value:function(){return o.getCurrent()>=this.lastTS+200}},{key:"getCacheLength",value:function(){var e=0;for(var t in this.cache)this.cache.hasOwnProperty(t)&&(e+=this.cache[t].length());return e}},{key:"updateConferenceId",value:function(e){var t=l.tmpConferenceId;this.cache[t]&&this.cache[t].updateConferenceId(e)}}]),e}();n.TransmissionManager=c},{"../collections/cache":24,"../config/constants":32,"../utility/csiologger":87,"../utility/registry":94,"../utility/timestamps":98}],56:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.WsCollectorConnection=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=r(e("../config/callstatserrors")),s=r(e("../config/constants")),a=r(e("../config/settings")),l=e("../utility/registry"),u=r(e("../utility/csiologger")),c=e("./collectorconnection"),d=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.wsConnection=null,e.wsUrl=a.wsUrl,e.wsConnectionState=s.wsConnectionState.closed,e.connected=!1,e.reconnected=!1,e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,c.CollectorConnection),i(t,[{key:"onOpenHandler",value:function(){this.wsConnectionState=s.wsConnectionState.connected,this.connected?this.reconnected=!0:this.connected=!0,this.reconnected=!1}},{key:"onCloseHandler",value:function(){this.wsConnectionState=s.wsConnectionState.closed,u.log("**** Connection to the backend closed."),this.wsConnection&&(this.wsConnection=null)}},{key:"onErrorHandler",value:function(e){this.wsConnectionState=s.wsConnectionState.closed,u.log("**** Connection establishment to the backend failed."),this.callback&&this.callback(o.csError.wsChannelFailure,"WebSocket establishment failed.",e)}},{key:"onMessageHandler",value:function(e){var t=e.data,n=JSON.parse(t);if("200 OK"===n.status){if("feedback"===n.event)window.localStorage.removeItem("feedback");else if(n.event===s.internalFabricEvent.userJoined){var r=l.Registry.getConferenceManager().get(decodeURIComponent(n.conferenceID));r&&r.setUcId(n.ucID),u.log("UcId =",n.ucID),l.Registry.getTransmissionManager().trySend()}}else u.error("Collector error:",n.reason)}},{key:"setup",value:function(){var n=this;return new Promise(function(e,t){if(n.wsConnectionState===s.wsConnectionState.initiated||n.wsConnectionState===s.wsConnectionState.connected)return u.log("setupWebSocketConnection is called when already connected!"),n.callback&&n.callback(o.csError.success,s.csCallBackMessages.wsConnected),void e();n.wsConnectionState=s.wsConnectionState.initiated,u.log("creating new WebSocket",n.wsUrl),n.wsConnection=new WebSocket(n.wsUrl,"echo-protocol"),n.wsConnection.onopen=function(){e(),n.onOpenHandler()},n.wsConnection.onclose=function(){n.onCloseHandler()},n.wsConnection.onerror=function(e){t(e),n.onErrorHandler(e)},n.wsConnection.onmessage=function(e){n.onMessageHandler(e)}})}},{key:"isReady",value:function(){return!(!this.wsConnection||1!==this.wsConnection.readyState)}},{key:"getState",value:function(){return this.wsConnection?this.wsConnection.readyState:-1}},{key:"send",value:function(e){this.wsConnection.send(JSON.stringify(e))}}]),t}();n.WsCollectorConnection=d},{"../config/callstatserrors":31,"../config/constants":32,"../config/settings":33,"../utility/csiologger":87,"../utility/registry":94,"./collectorconnection":46}],57:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(c,d,f,h,p){return new Promise(function(t,e){var n,r=null,i=new XMLHttpRequest,o=m.Registry.getEndpoint().getBrowserName();if(i){for(var s in n=v.getCurrent(),i.open(c,d),o!==g.browserName.msie&&(i.timeout=h),f)f.hasOwnProperty(s)&&i.setRequestHeader(s,f[s]);var a=null;if("POST"===c){if("application/x-www-form-urlencoded"===f["Content-Type"]){var l=[];for(var u in p)p.hasOwnProperty(u)&&l.push(encodeURIComponent(u)+"="+encodeURIComponent(p[u]));a=l.join("&")}"application/json"===f["Content-Type"]&&(a=JSON.stringify(p))}i.onload=function(){r=v.getCurrent();var e=new y(i,r-n);t(e)},i.ontimeout=function(){e(new Error("connection timeout"))},i.onreadystatechange=function(){4===i.readyState&&0===i.status&&e(new Error("no server response received"))},i.send(a)}else e(new Error("creating instance failed"))})}Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();n.sendGetRequest=function(e,t,n){return i("GET",e,t,n,null)},n.sendPostRequest=function(e,t,n,r){return i("POST",e,t,n,r)};var v=r(e("../utility/timestamps")),g=r(e("../config/constants")),m=e("../utility/registry"),y=function(){function n(e,t){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,n),this.xhr=e,this.elapsed=t}return o(n,[{key:"getXhr",value:function(){return this.xhr}},{key:"getElapsed",value:function(){return this.elapsed}}]),n}()},{"../config/constants":32,"../utility/registry":94,"../utility/timestamps":98}],58:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.XMLHttpService=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=e("../utility/sigmoid"),s=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../utility/csiologger")),r=function(){function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"XMLHttpService",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:100,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1e4;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,r),this.name=e,this.minRetryTimeout=t,this.sigmoid=new o.Sigmoid(n-t,15,.5),this.reset()}return i(r,[{key:"reset",value:function(){this.inProgress=!1,this.completed=!1,this.resolveCb&&this.rejectCb(new Error(this.name+": resetting")),this.resolveCb=null,this.rejectCb=null}},{key:"initiate",value:function(){var n=this;if(this.inProgress)return new Promise(function(e,t){t(new Error(n.name+": in progress"))});var e=new Promise(function(e,t){n.resolveCb=e,n.rejectCb=t});return this.inProgress=!0,this.sendRequest(),e}},{key:"isCompleted",value:function(){return this.completed}},{key:"handleSendError",value:function(e){s.log(this.name+": send next request ("+e+")"),this.sendNextRequest()}},{key:"handleResponseProxy",value:function(e){this.handleResponse(e),this.resetTimeout()}},{key:"handleResponse",value:function(e){s.error(this.name+": handleResponse() not implemented"),this.completeProcess()}},{key:"completeProcess",value:function(){this.inProgress=!1,this.completed=!0,this.resolveCb.apply(this,arguments)}},{key:"request",value:function(){return s.error(this.name+": request() not implemented!"),new Promise(function(e,t){e()})}},{key:"sendRequest",value:function(){if(this.inProgress){var e=this.request();e&&e.then(this.handleResponseProxy.bind(this),this.handleSendError.bind(this))}}},{key:"sendNextRequest",value:function(){setTimeout(this.sendRequest.bind(this),this.getTimeout())}},{key:"resetTimeout",value:function(){this.sigmoid.reset()}},{key:"getTimeout",value:function(){return this.minRetryTimeout+this.sigmoid.getActual()}}]),r}();n.XMLHttpService=r},{"../utility/csiologger":87,"../utility/sigmoid":96}],59:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.Measurement=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),b=e("./resolution"),S=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("./validator")),i=function(){function _(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,_),this.pcHash=null,this.ssrc=null,this.streamType=null,this.mediaType=null,this.resolution=null,this.frameRateReceived=null,this.frameHeight=null,this.frameWidth=null,this.droppedFramesNum=null,this.rtt=null,this.jitter=null,this.lostPackets=-1,this.receivedPackets=-1,this.sentPackets=-1,this.discardedPackets=-1,this.sentBytes=-1,this.receivedBytes=-1,this.track=null,this.fractionLost=0}return r(_,null,[{key:"make",value:function(e,t,n,r,i,o,s,a,l,u,c,d,f,h,p,v,g){var m=new _,y=function(e,t){-1===[void 0,null].indexOf(t)&&(m[e]=t)};return y("pcHash",e),y("ssrc",t),y("streamType",n),y("mediaType",r),y("frameRateReceived",i),y("frameHeight",S.checkForNan(parseInt(o,10))),y("frameWidth",S.checkForNan(parseInt(s,10))),y("droppedFramesNum",a),y("rtt",l),y("jitter",u),y("lostPackets",c),y("receivedPackets",d),y("sentPackets",f),y("discardedPackets",h),y("sentBytes",p),y("receivedBytes",v),y("track",g),m.resolution=void 0!==i&&void 0!==s&&void 0!==o&&0<s&&0<o?new b.Resolution(s,o,i):null,m}}]),r(_,[{key:"getPcHash",value:function(){return this.pcHash}},{key:"getSSRC",value:function(){return this.ssrc}},{key:"getStreamType",value:function(){return this.streamType}},{key:"getMediaType",value:function(){return this.mediaType}},{key:"getResolution",value:function(){return this.resolution?this.resolution.toString():null}},{key:"getFrameRateReceived",value:function(){return this.frameRateReceived}},{key:"getFrameHeight",value:function(){return this.frameHeight}},{key:"getFrameWidth",value:function(){return this.frameWidth}},{key:"getDroppedFramesNum",value:function(){return this.droppedFramesNum}},{key:"getJitter",value:function(){return this.jitter}},{key:"getRTT",value:function(){return this.rtt}},{key:"getLostPackets",value:function(){return this.lostPackets}},{key:"getDiscardedPackets",value:function(){return this.discardedPackets}},{key:"getReceivedPackets",value:function(){return this.receivedPackets}},{key:"getSentPackets",value:function(){return this.sentPackets}},{key:"getSentBytes",value:function(){return this.sentBytes}},{key:"getReceivedBytes",value:function(){return this.receivedBytes}},{key:"setFractionLost",value:function(e){this.fractionLost=void 0===e?null:e}},{key:"getFractionLost",value:function(){return this.fractionLost}},{key:"extractTrack",value:function(){var e=this.track;return this.track=null,e}},{key:"toString",value:function(){return"pcHash: "+this.pcHash+", ssrc: "+this.ssrc+", streamType: "+this.streamType+", mediaType: "+this.mediaType+", frameRateReceived: "+this.frameRateReceived+", frameHeight: "+this.frameHeight+", frameWidth: "+this.frameWidth+", droppedFramesNum: "+this.droppedFramesNum+", rtt: "+this.rtt+", jitter: "+this.jitter+", lostPackets: "+this.lostPackets+", receivedPackets: "+this.receivedPackets+", sentPackets: "+this.sentPackets+", discardedPackets: "+this.discardedPackets+", sentBytes: "+this.sentBytes+", receivedBytes: "+this.receivedBytes}}]),_}();n.Measurement=i},{"./resolution":67,"./validator":82}],60:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.CPULimitationObserver=void 0;var o=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),s=r(e("../../config/constants")),a=r(e("../../utility/timestamps")),l=function(){function e(){i(this,e),this.ewmaDiscardedPackets=0,this.ewmaLostPackets=0,this.ewmaDroppedFrames=0,this.last=0,this.noticed=0}return o(e,[{key:"test",value:function(e){var t=e.discardedPackets,n=e.lostPackets;if(!n||n<1||!t||t<1)return!1;if(0===this.last)return this.last=a.getCurrent(),this.ewmaLostPackets=n,this.ewmaDiscardedPackets=t,!1;var r=a.getCurrent(),i=Math.max(r-this.last,1),o=Math.min((5e3-i)/5e3,.9),s=e.droppedFrames;return this.ewmaLostPackets=this.ewmaLostPackets*o+n,this.ewmaDroppedFrames=this.ewmaDroppedFrames*o+s,this.ewmaDiscardedPackets=this.ewmaDiscardedPackets*o+t,!(!s||s<1||1<this.ewmaLostPackets||1<this.ewmaDiscardedPackets||r-this.noticed<1e4||this.ewmaDroppedFrames<1||(this.noticed=r,0))}}]),e}(),u=function(){function t(e){i(this,t),this.notifyCallback=e,this.inbVideoTesters=new Map}return o(t,[{key:"accept",value:function(e){for(var t=e.filter(function(e){return e.getMediaType()===s.mediaType.video&&e.getStreamType()===s.streamType.inbound}),n=0;n<t.length;++n){var r=t[n];this.checkInboundVideo(r)}}},{key:"checkInboundVideo",value:function(e){var t=e.peek(),n=e.getSSRC();if(this.inbVideoTesters.has(n)||this.inbVideoTesters.set(n,new l),this.inbVideoTesters.get(n).test(t)){var r={reason:s.limitationType.cpu,ssrc:n};this.notifyCallback(r)}}},{key:"toString",value:function(){return"CPULimitationObserver"}}]),t}();n.CPULimitationObserver=u},{"../../config/constants":32,"../../utility/timestamps":98}],61:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.OneWayMediaObserver=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),s=r(e("../../config/constants")),a=e("../onewaymediadisruption"),l=r(e("../../utility/timestamps")),o=function(){function t(e){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,t),this.notifierCallback=e,this.inbOneWayAudioDisruption={sent:!1,started:0,hasTrafficTs:0},this.outbOneWayAudioDisruption={sent:!1,started:0,hasTrafficTs:0}}return i(t,[{key:"accept",value:function(e){var t=e.filter(function(e){return e.getMediaType()==s.mediaType.audio&&e.getStreamType()===s.streamType.inbound}),n=e.filter(function(e){return e.getMediaType()==s.mediaType.audio&&e.getStreamType()===s.streamType.outbound}),r=[this.getInbOneWayAudioDisruption(t,n),this.getOutbOneWayAudioDisruption(t,n)].filter(function(e){return null!==e});0<r.length&&this.notifierCallback(r)}},{key:"toString",value:function(){return"DisruptionObserver"}},{key:"getInbOneWayAudioDisruption",value:function(e,t){var n=this.inbOneWayAudioDisruption;if(n.sent)return null;var r=t.filter(function(e){return 0===e.getStartTime()}).length<1,i=t.filter(function(e){return!e.hasTraffic()}).length<1;if(!r||i)return null;var o=e.filter(function(e){return!e.hasTraffic()}).length<1;return 0<e.length&&o?(n.started=0,null):0===n.started?(n.started=l.getCurrent(),null):l.getCurrent()-5e3<n.started?null:(n.sent=!0,new a.OneWayMediaDisruption(s.oneWayMediaTypes.audio))}},{key:"getOutbOneWayAudioDisruption",value:function(e,t){var n=this.outbOneWayAudioDisruption;if(n.sent)return null;var r=e.filter(function(e){return 0===e.getStartTime()}).length<1,i=e.filter(function(e){return!e.hasTraffic()}).length<1;if(!r||!i)return null;var o=t.filter(function(e){return!e.hasTraffic()}).length<1;return 0<t.length&&o?(n.started=0,null):0===n.started?(n.started=l.getCurrent(),null):l.getCurrent()-5e3<n.started?null:(n.sent=!0,new a.OneWayMediaDisruption(s.oneWayMediaTypes.audio))}}]),t}();n.OneWayMediaObserver=o},{"../../config/constants":32,"../../utility/timestamps":98,"../onewaymediadisruption":65}],62:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.QPSumObserver=void 0;var o=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),s=r(e("../../config/constants")),a=r(e("../../utility/timestamps")),l=function(){function t(e){i(this,t),this.lastQpSum=null,this.qpAvg=null,this.noticed=0}return o(t,[{key:"test",value:function(e){var t=e.getTrack();if(!t||!t.data||!t.data.qpSum)return!1;if(!this.lastQpSum)return this.lastQpSum=t.data.qpSum,!1;var n=t.data.qpSum-this.lastQpSum;this.lastQpSum=t.data.qpSum,null===this.qpAvg?this.qpAvg=n:this.qpAvg=.2*n+.8*this.qpAvg;var r=Math.max(2*this.qpAvg,1);if(n<this.qpAvg+r)return!1;var i=a.getCurrent();return this.noticed<i-1e4}}]),t}(),u=function(){function t(e){i(this,t),this.notifyCallback=e,this.testers=new Map}return o(t,[{key:"accept",value:function(e){for(var t=0;t<e.length;++t){var n=e[t];if(n.getMediaType()===s.mediaType.video){var r=n.getSSRC();if(this.testers.has(r)||this.testers.set(r,new l(n)),this.testers.get(r).test(n)){var i={reason:s.qualityDisruptionTypes.qpchange};this.notifyCallback(i)}}}}},{key:"toString",value:function(){return"QPSumObserver"}}]),t}();n.QPSumObserver=u},{"../../config/constants":32,"../../utility/timestamps":98}],63:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.SendingTrigger=void 0;var o=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),a=r(e("../../utility/timestamps")),l=r(e("../validator")),s=function(){function r(e,t,n){i(this,r),this.last=null,this.actual=0,this.name=e,this.alpha=t,this.supplier=n}return o(r,[{key:"update",value:function(e){if(null!==this.last){var t=Math.abs(e-this.last);this.actual=t*this.alpha+this.actual*(1-this.alpha),this.last=e}else this.last=e}},{key:"doTest",value:function(e){var t=this.last;return this.update(e),null!==t&&t+this.supplier(this.actual)<e}}]),r}(),u=function(){function e(){i(this,e);var t=this;this.marginFactor=1,this.rttTester=new s("RTT Tester",.2,function(e){return Math.max(50,e)*t.marginFactor}),this.throughputTester=new s("Throughput Tester",.1,function(e){return Math.max(100,e)*t.marginFactor}),this.FLTester=new s("FL Tester",.1,function(e){return Math.max(.2,e)*t.marginFactor}),this.lastDecreased=a.getCurrent()}return o(e,[{key:"test",value:function(e){var t=e.peek();if(!t)return!1;var n=e.getTrack().data,r=t.getRTT(),i=l.checkForNan(parseInt(n.csioIntBRKbps,10)),o=t.getFractionLost();if(this.rttTester.doTest(r)||this.throughputTester.doTest(i)||this.FLTester.doTest(o))return this.marginFactor=Math.min(2*this.marginFactor,15),!0;var s=a.getCurrent();return 3e3<s-this.lastChanged&&(this.marginFactor=Math.max(this.marginFactor-.5,1),this.lastDecreased=s),!1}}]),e}(),c=function(){function t(e){i(this,t),this.notifyCallback=e,this.minInterval=1e3,this.maxInterval=3e4,this.notified=0,this.testers=new Map}return o(t,[{key:"setup",value:function(e,t){this.minInterval=e,this.maxInterval=t}},{key:"accept",value:function(e){var t=a.getCurrent(),n=t-this.notified;if(this.minInterval!==this.maxInterval){if(!(n<this.minInterval)){if(n<this.maxInterval&&!1===this.doSend(e))return;this.notifyCallback(),this.notified=t}}else this.minInterval<=n&&(this.notifyCallback(),this.notified=t)}},{key:"setIntervals",value:function(e,t){this.minInterval=e,this.maxInterval=t}},{key:"toString",value:function(){return"SendingTrigger"}},{key:"doSend",value:function(e){for(var t=0;t<e.length;++t){var n=e[t],r=n.getSSRC();if(this.testers.has(r)||this.testers.set(r,new u),this.testers.get(r).test(n))return!0}return!1}}]),t}();n.SendingTrigger=c},{"../../utility/timestamps":98,"../validator":82}],64:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.ThroughputObserver=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=r(e("../../config/constants")),l=r(e("../../utility/timestamps")),s=function(){function t(e){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,t),this.notifierCallback=e,this.observations=new Map}return i(t,[{key:"accept",value:function(e){var t=e.filter(function(e){return e.getMediaType()===o.mediaType.video&&e.getStreamType()===o.streamType.outbound});if(!(t.length<1)){var n=this;t.forEach(function(e){n.observe(e)})}}},{key:"toString",value:function(){return"ThroughputObserver"}},{key:"getObservations",value:function(e){if(this.observations.has(e))return this.observations.get(e);return this.observations.set(e,{ssrc:0,started:0,max:0,maxTs:0,stable:0,stableTs:0,ready:!1,maxVerified:!1,stableVerified:!1}),this.observations.get(e)}},{key:"observe",value:function(e){var t=e.getSSRC(),n=this.getObservations(t),r=l.getCurrent();if(!0!==n.ready){if(0===n.started)return n.ssrc=t,void(n.started=r);var i=e.getTrack().data,o=i.csioIntBRKbps,s=Math.min(50,.05*o);if(n.max<o?(n.max=o,n.maxTs=r):1e4<r-n.maxTs&&(n.maxVerified=!0),!(r-n.started<15e3)&&(o-s<i.csioAvgBRKbps&&i.csioAvgBRKbps<o+s&&(n.stableTs=r,n.stable=o,n.stableVerified=!0),n.stableVerified&&n.maxVerified)){var a={ssrc:String(n.ssrc),maxsendingKBitrate:n.max,timeToMaxSendingKBitrate:n.maxTs-n.started,stablesendingKBitrate:n.stable,timeToStableSendingKBitrate:n.stableTs-n.started};this.notifierCallback(a),n.ready=!0}}}}]),t}();n.ThroughputObserver=s},{"../../config/constants":32,"../../utility/timestamps":98}],65:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=function(){function n(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"0";(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,n),this.mediaType=e,this.ssrc=t}return r(n,[{key:"getContent",value:function(){return{mediaType:this.mediaType,ssrc:this.ssrc}}}]),n}();n.OneWayMediaDisruption=i},{}],66:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=function(){function s(e,t,n,r,i,o){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,s),this.candidatePair=e,this.codec=t,this.pcHash=n,this.trackStats=r,this.transportStats=i,this.measurements=o}return r(s,[{key:"getCandidatePair",value:function(){return this.candidatePair}},{key:"getCodec",value:function(){return this.codec}},{key:"getPcHash",value:function(){return this.pcHash}},{key:"getTrackStats",value:function(){return this.trackStats}},{key:"getTransportStats",value:function(){return this.transportStats}},{key:"getMeasurements",value:function(){return this.measurements}}]),s}();n.PcStats=i},{}],67:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),r=function(){function r(e,t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,r),this.width=e,this.height=t,this.frameRate=n}return i(r,[{key:"getWidth",value:function(){return this.width}},{key:"getHeight",value:function(){return this.height}},{key:"getFrameRate",value:function(){return this.frameRate}},{key:"toString",value:function(){return this.width&&this.height&&this.frameRate?this.width.toString()+"X"+this.height.toString()+"X"+this.frameRate.toString():null}}]),r}();n.Resolution=r},{}],68:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.StatsAdapter=n.StatsAdapterIO=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),c=r(e("../config/constants")),o=e("../collections/component"),d=e("../utility/registry"),s=r(e("../utility/hash")),a=n.StatsAdapterIO={RawStatsIn:"RawStatsIn",RawStatsOut:"RawStatsOut",UnprocessedOut:"UnprocessedOut"},l=function(e){function r(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,"StatsAdapter"));return n.bindPort(a.RawStatsIn,n.receiveRawData,n),n.declarePort(a.RawStatsOut),n.declarePort(a.UnprocessedOut),n.codeBase=e,n.browser=t,n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(r,o.Component),i(r,[{key:"receiveRawData",value:function(e,t){if(e){var n=this.extractRawStats(e);if(n){window&&window.csioReactNative&&(n=this.removeValues(n)),this.isConnected(a.UnprocessedOut)&&this.transmit(a.UnprocessedOut,n);var r=this.processRawStats(n,t);if(r&&r.transportStats)for(var i=0;i<r.transportStats.length;i++)r.transportStats[i].hash=this.getTransportHash(r.transportStats[i]);r&&r.transportStats&&this.checkTransportStatsUpdates(r.transportStats,t),r&&r.trackStats&&(r=this.backFillTrackStats(r)),r&&r.transportStats&&r.candidatePair&&(r=this.backFillCandidatePairStats(r)),r.pcHash=t,this.transmit(a.RawStatsOut,r)}}}},{key:"removeValues",value:function(e){for(var t=0;t<e.length;++t){var n=e[t];if(n&&n.values){for(var r=0;r<n.values.length;++r)Object.assign(n,n.values[r]);delete n.values}}return e}},{key:"getIceCandidates",value:function(e){if(!e)return null;var t=this.extractRawStats(e);return this.processRawStatsForIceInfo(t)}},{key:"extractRawStats",value:function(e){var t=[];if(e&&e.result)t=e.result();else if(e&&e.forEach)e.forEach(function(e){t.push(e)});else for(var n in e)e.hasOwnProperty(n)&&t.push(e[n]);return t}},{key:"normalizeIceCandidates",value:function(e){for(var t=0;t<e.length;t+=1){var n=e[t];n.transport=n.protocol?n.protocol:"udp",n.ip=n.ip?n.ip:n.ipAddress,n.port=n.portNumber?Number(n.portNumber):n.port,"ssltcp"===n.transport&&(n.transport="tcp")}return e}},{key:"normalizeCanidatePairs",value:function(e){for(var t=0;t<e.length;t+=1){var n=e[t];"in-progress"===n.state&&(n.state="inprogress"),n.state||(n.state="succeeded"),n.nominated||(n.nominated="true"===n.googActiveConnection),n.priority||(n.priority=123)}return e}},{key:"processRawStatsForIceInfo",value:function(e){var t=[],n=[],r=[],i=void 0;if(!e)return null;for(var o=0;o<e.length;++o){var s=this.getParsedStats(e[o]),a=this.statsClassifier(s);if(a.candidatePair)r.push(a.candidatePair);else if(a.transportStats){if("transport"===a.transportStats.type){i=a.transportStats.selectedCandidatePairId;continue}r.push(a.transportStats)}else a.localCandidate?t.push(a.localCandidate):a.remoteCandidate&&n.push(a.remoteCandidate)}if(i)for(var l=0;l<r.length;++l)r[l].id===i&&(r[l].googActiveConnection="true");return{localIceCandidates:this.normalizeIceCandidates(t),remoteIceCandidates:this.normalizeIceCandidates(n),iceCandidatePairs:this.normalizeCanidatePairs(r)}}},{key:"processRawStats",value:function(e,t){var n={},r={},i={};n.tracks=[],n.candidatePair=[],n.transportStats=[],n.trackStats=[],n.codec=[];for(var o=0;o<e.length;o++){var s=this.getParsedStats(e[o]),a=this.statsClassifier(s);a.tracks?n.tracks.push(a.tracks):a.candidatePair?n.candidatePair.push(a.candidatePair):a.transportStats?this.codeBase!==c.codeBaseType.firefox?(0<parseInt(a.transportStats.bytesReceived,10)||0<parseInt(a.transportStats.bytesSent,10))&&(n.transportStats.push(a.transportStats),"true"!==a.transportStats.googActiveConnection&&!0!==a.transportStats.googActiveConnection||(n.activeConnectionIndex=a.transportStats.length)):"true"!==a.transportStats.selected&&!0!==a.transportStats.selected||(n.transportStats.push(a.transportStats),n.activeConnectionIndex=a.transportStats.length):a.bwe?n.bwe=a.bwe:a.trackStats?n.trackStats.push(a.trackStats):a.codec?n.codec.push(a.codec):a.localCandidate?r[a.localCandidate.id]=a.localCandidate:a.remoteCandidate&&(i[a.remoteCandidate.id]=a.remoteCandidate)}if(n.tracks){var l=d.Registry.getConferenceManager().getConferenceForPcHash(t),u=void 0;l&&(u=l.getPeerConnectionManager().getPcHandlerByHash(t)),n.tracks.forEach(function(e){var t=u.getSSRCInfo(e.data.ssrc);void 0!==t&&t.localStartTime||u&&(u.updateSDP(n.tracks),t=u.getSSRCInfo(e.data.ssrc)),t&&(e.cname=t.cname,e.msid=t.msid,e.associatedVideoTag=t.associatedVideoTag,e.usageLabel=t.usageLabel)})}return n.transportStats&&this.codeBase===c.codeBaseType.firefox&&(n.transportStats=this.getAddressInfoFromCandidates(n.transportStats,r,i)),n}},{key:"getParsedStats",value:function(e){var t={};if(e.timestamp instanceof Date&&(t.timestamp=e.timestamp.getTime().toString()),e.type&&(t.type=e.type),e.names){for(var n=e.names(),r=0;r<n.length;++r)t[n[r]]=e.stat(n[r]);e.id&&(t.id=e.id)}else Object.assign(t,e);if(t.values){for(var i=0;i<t.values.length;++i)Object.assign(t,t.values[i]);delete t.values}return t}},{key:"statsClassifier",value:function(r){var e={},t=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return-1!==t.indexOf(r.type)},n=t("inbound-rtp","inboundrtp"),i="true"===r.isRemote||!0===r.isRemote;return n||t("outbound-rtp","outboundrtp")?(e.tracks={},e.tracks.data=r,e.tracks.ssrc=r.ssrc,e.tracks.streamType=n?"inbound":"outbound",e.tracks.reportType="local",void 0!==r.isRemote&&(e.tracks.reportType=i?"remote":"local")):t("candidatepair")&&r.selected?e.transportStats=r:t("localcandidate","local-candidate")?e.localCandidate=r:t("remotecandidate","remote-candidate")?e.remoteCandidate=r:t("transport","googCandidatePair")?e.transportStats=r:t("VideoBwe")?e.bwe=r:t("track")?e.trackStats=r:t("candidate-pair")?e.candidatePair=r:t("codec")?e.codec=r:t("ssrc")&&(e.tracks={},e.tracks.data=r,e.tracks.ssrc=r.ssrc,e.tracks.reportType="local",e.tracks.streamType=r.bytesSent?"outbound":"inbound"),e}},{key:"getAddressInfoFromCandidates",value:function(e,t,n){for(var r=void 0,i=void 0,o=0;o<e.length;o++)r=t[e[o].localCandidateId],i=n[e[o].remoteCandidateId],r&&i&&(e[o].localAddr=r.ipAddress+":"+r.portNumber,e[o].remoteAddr=i.ipAddress+":"+i.portNumber,e[o].localAddrType=r.candidateType,e[o].remoteAddrType=i.candidateType,e[o].transportType=r.transport);return e}},{key:"getTransportHash",value:function(e){var t=void 0;return e&&(this.codeBase===c.codeBaseType.chrome?e.googLocalAddress?(t=e.googLocalAddress).concat(":",e.googRemoteAddress):e.selectedCandidatePairId&&(t=e.selectedCandidatePairId):this.codeBase===c.codeBaseType.firefox&&(t=e.localAddr).concat(":",e.remoteAddr)),s.generateHash(t)}},{key:"backFillTrackStats",value:function(e){for(var t=e.tracks.length,n=void 0,r=void 0,i=void 0,o=0;o<t;o++)(n=e.tracks[o]).data.trackId&&(r=this.getStatsForId(e.trackStats,n.data.trackId))&&(e.tracks[o].data=this.mergeObjects(e.tracks[o].data,r)),n.data.codecId&&(i=this.getStatsForId(e.codec,n.data.codecId))&&(e.tracks[o].data=this.mergeObjects(e.tracks[o].data,i));return e}},{key:"backFillCandidatePairStats",value:function(e){for(var t=e.transportStats.length,n=void 0,r=void 0,i=0;i<t;i++)(r=e.transportStats[i]).selectedCandidatePairId&&(n=this.getStatsForId(e.candidatePair,r.selectedCandidatePairId))&&(e.transportStats[i]=this.mergeObjects(e.transportStats[i],n));return e}},{key:"mergeObjects",value:function(e,t){for(var n in t)t.hasOwnProperty(n)&&"id"!==n&&"type"!==n&&(e[n]=t[n]);return e}},{key:"getStatsForId",value:function(e,t){if(e){var n=e.filter(function(e){return e.id===t});if(0<n.length)return n[0]}}},{key:"formatRelayType",value:function(e){var t="None";switch(e){case 0:t="TURN/TLS";break;case 1:t="TURN/TCP";break;case 2:t="TURN/UDP"}return t}},{key:"getRelayType",value:function(n,e){var r=this,i=void 0;return e.getIceCandidates().some(function(e){if(e.typePreference){var t=e.typePreference>>24;return"rtp"===e.protocol&&e.address===n&&(0<=t&&t<=2&&(i=r.formatTypePreference(t)),!0)}return!1}),i}},{key:"getTransportInfo",value:function(e,t){for(var n={},r=!1,i=0;i<e.length;i++){var o=e[i];if(navigator.mozGetUserMedia&&"candidatepair"===o.type&&("true"===o.selected||!0===o.selected)){n.foundActive=!0,n.localAddr=o.localAddr,n.remoteAddr=o.remoteAddr,n.localAddrType=o.localAddrType,n.remoteAddrType=o.remoteAddrType,n.transportType=o.transportType,n.localCandidateId=o.localCandidateId,n.remoteCandidateId=o.remoteCandidateId;break}if("googCandidatePair"===o.type&&("true"===o.googActiveConnection||!0===o.googActiveConnection)){n.foundActive=!0,n.localAddr=o.googLocalAddress,n.remoteAddr=o.googRemoteAddress,n.localAddrType=o.googLocalCandidateType,n.remoteAddrType=o.googRemoteCandidateType,n.transportType=o.googTransportType;break}if("transport"===o.type){r=!0,o.selectedCandidatePairId&&(n.selectedCandidatePairId=o.selectedCandidatePairId);break}}return r&&n.localAddr&&(n.ipv6=0===n.localAddr.indexOf("["),n.relayType=getRelayType(n.localAddr,t)),n}},{key:"sendFabricTransportSwitch",value:function(e,t){e.sendFabricTransportSwitch(t)}},{key:"checkTransportStatsUpdates",value:function(e,t){var n=d.Registry.getConferenceManager().getConferenceForPcHash(t);if(n){var r=n.getPeerConnectionManager().getPcHandlerByHash(t);if(r){var i=this.getTransportInfo(e,r),o=r.getTransportInfo();o&&(o.localAddr===i.localAddr&&o.remoteAddr===i.remoteAddr&&o.transportType===i.transportType&&o.selectedCandidatePairId===i.selectedCandidatePairId&&o.localCandidateId===i.localCandidateId&&o.remoteCandidateId===i.remoteCandidateId||(r.setTransportInfo(i),this.sendFabricTransportSwitch(r,i.relayType)))}}}}]),r}();n.StatsAdapter=l},{"../collections/component":25,"../config/constants":32,"../utility/hash":91,"../utility/registry":94}],69:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.StatsAssembler=n.StatsAssemblerIO=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=e("../collections/component"),u=n.StatsAssemblerIO={StatsTupleIn:"StatsTupleIn",CallstatsOut:"CallstatsOut"},o=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"StatsAssembler"));return e.pcHashes=[],e.bindPort(u.StatsTupleIn,e.receiveStats,e),e.declarePort(u.CallstatsOut),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,i.Component),r(t,[{key:"receiveStats",value:function(n){for(var r=this,e=0;e<n.tracks.length;e++)!function(e){var t=n.tracks[e];if(r.pcHashes.find(function(e){return e===t.pcHash}))return;r.pcHashes.push(t.pcHash)}(e);var t=n.getTransportStats();for(e=0;e<this.pcHashes.length;e++){var i=this.pcHashes[e],o={};o.codec=n.getCodec(),o.trackStats=n.getTrackStats(),o.tracks=[];for(var s=0;s<n.tracks.length;s++){var a=n.tracks[s];a.pcHash===i&&o.tracks.push(a)}var l=t.get(i);1==l.length?o.Transport=l[0]:o.Transport=l,this.transmit(u.CallstatsOut,i,o)}}}]),t}();n.StatsAssembler=o},{"../collections/component":25}],70:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.StatsCallbackBuilder=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=e("../utility/registry"),o=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.callback=null}return r(e,[{key:"setCallback",value:function(e){this.callback=e}},{key:"buildStats",value:function(e,t){this.callback&&this.buildFromUnifiedFormat(e,t)}},{key:"getConnectionState",value:function(){return!0===navigator.onLine?"online":"offline"}},{key:"buildConferenceUrl",value:function(e){var t=e.getConferenceId(),n=i.Registry.getConferenceManager().get(t);return n?n.getUrl():null}},{key:"buildFromUnifiedFormat",value:function(e,t){var n={};n.connectionState=this.getConnectionState(),n.conferenceURL=this.buildConferenceUrl(t),n.fabricState=t.getPcState(),n.streams={};for(var r=0;r<e.length;r++){var i=e[r];if("inbound-rtp"===i.type||"outbound-rtp"===i.type){var o={ssrc:i.ssrc,statsType:i.type,fractionLoss:i.csioIntFL,bitrate:i.csioIntBRKbps,quality:i.csioMark,mediaType:i.csioMediaType,jitter:i.jitter,audioOutputLevel:i.audioOutputLevel,audioIntputLevel:i.audioIntputLevel,audioLevel:i.audioLevel,averageRTT:i.csioAvgRtt,averageJitter:i.csioAvgJitter,packetLossPercentage:i.csioPktLossPercentage,rtt:i.roundTripTime,remoteUserID:t.getRemoteId()},s=t.getSSRCInfo(i.ssrc+"");s&&(o.cname=s.cname,o.msid=s.msid,o.usageLabel=s.usageLabel,o.associatedVideoTag=s.associatedVideoTag),i.hasOwnProperty("googRtt")&&(o.rtt=i.googRtt),i.hasOwnProperty("mozRtt")&&(o.rtt=i.mozRtt),i.hasOwnProperty("googJitterReceived")&&(o.jitter=i.googJitterReceived),n.streams[i.ssrc]=o}}this.callback(n)}}]),e}();n.StatsCallbackBuilder=o},{"../utility/registry":94}],71:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.StatsMonitor=n.StatsMonitorIO=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=e("../collections/component"),s=e("./tracksmonitor"),a=e("./transportsmonitor"),l=e("./statstuple"),u=e("../utility/registry"),c=e("./monitorhooks/sendingtrigger"),d=e("./monitorhooks/onewaymediaobserver"),f=e("./monitorhooks/throughputobserver"),h=e("./monitorhooks/cpulimitationobserver"),p=e("./monitorhooks/qpsumobserver"),v=r(e("../config/constants")),g=r(e("../utility/csiologger")),m=n.StatsMonitorIO={PcStatsTupleIn:"PcStatsTupleIn",StatsTupleOut:"StatsTupleOut"},y=function(e){function n(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var t=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,"StatsMonitor"));return t.bindPort(m.PcStatsTupleIn,t.receive,t),t.declarePort(m.StatsTupleOut),t.lastPcStats=null,t.lastPcHash=null,t.tracksmonitor=new s.TracksMonitor,t.transportsmonitor=new a.TransportsMonitor(e),t.candidatepairs=new Map,t.monitorhooks=[],t.sendingTrigger=new c.SendingTrigger(t.sendStatsTuple.bind(t)),t.oneWayMediaObserver=new d.OneWayMediaObserver(t.sendDisruptions.bind(t)),t.throughputObserver=new f.ThroughputObserver(t.sendThroughputObservations.bind(t)),t.cpuLimitationObserver=new h.CPULimitationObserver(t.sendCPULimitationObservations.bind(t)),t.qpSumObserver=new p.QPSumObserver(t.sendQPSumDistortions.bind(t)),t.setupHooks(),t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(n,o.Component),i(n,[{key:"setupHooks",value:function(){this.monitorhooks.push(this.sendingTrigger.accept.bind(this.sendingTrigger)),this.monitorhooks.push(this.oneWayMediaObserver.accept.bind(this.oneWayMediaObserver)),this.monitorhooks.push(this.throughputObserver.accept.bind(this.throughputObserver)),this.monitorhooks.push(this.cpuLimitationObserver.accept.bind(this.cpuLimitationObserver)),this.monitorhooks.push(this.qpSumObserver.accept.bind(this.qpSumObserver))}},{key:"setIntervals",value:function(e,t){this.sendingTrigger.setup(e,t)}},{key:"receive",value:function(e){var t=e.getPcHash(),n=e.getMeasurements();this.candidatepairs.set(t,e.getCandidatePair()),this.transportsmonitor.set(t,e.getTransportStats());for(var r=0;r<n.length;r++){var i=n[r],o=this.tracksmonitor.getMonitor(i);o?o.add(i):g.warn("No monitor for ssrc "+i.getSSRC())}this.lastPcStats=e,this.lastPcHash=t;for(var s=this.tracksmonitor.getMonitors(),a=this.monitorhooks,l=0;l<a.length;l++)(0,a[l])(s)}},{key:"getCandidatePairs",value:function(){var r=[];return this.candidatepairs.forEach(function(e,t){var n=[t,e];r.push(n)}),r}},{key:"sendStatsTuple",value:function(){var e=new l.StatsTuple(this.getCandidatePairs(),this.lastPcStats.getCodec(),this.lastPcStats.getTrackStats(),this.transportsmonitor.getIntervalStats(),this.tracksmonitor.extractTracks());this.transmit(m.StatsTupleOut,e)}},{key:"sendDisruptions",value:function(e){var t=this;e.forEach(function(e){t.sendEventMsg(v.internalFabricEvent.oneWayMedia,e.getContent())})}},{key:"sendCPULimitationObservations",value:function(e){}},{key:"sendQPSumDistortions",value:function(e){}},{key:"sendThroughputObservations",value:function(e){this.sendEventMsg(v.internalFabricEvent.sendingThroughputObservations,e)}},{key:"sendEventMsg",value:function(e,t){if(this.lastPcHash){var n=u.Registry.getConferenceManager().getConferenceForPcHash(this.lastPcHash);if(n){var r=n.getPeerConnectionManager().getPcHandlerByHash(this.lastPcHash),i=r.getPeerConnection(),o=r.getConferenceId();u.Registry.getEventMessageBuilder().make(e,o,i,t)}}}}]),n}();n.StatsMonitor=y},{"../collections/component":25,"../config/constants":32,"../utility/csiologger":87,"../utility/registry":94,"./monitorhooks/cpulimitationobserver":60,"./monitorhooks/onewaymediaobserver":61,"./monitorhooks/qpsumobserver":62,"./monitorhooks/sendingtrigger":63,"./monitorhooks/throughputobserver":64,"./statstuple":74,"./tracksmonitor":80,"./transportsmonitor":81}],72:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.StatsParser=n.StatsParserIO=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=e("../collections/component"),a=e("./measurement"),l=e("./pcstats"),s=e("../utility/rttregistry"),u=r(e("./validator")),c=r(e("../config/constants")),d=r(e("../utility/csiologger")),f=n.StatsParserIO={RawStatsIn:"RawStatsIn",PcStatsTupleOut:"PcStatsTupleOut"},h=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"StatsParser"));return e.bindPort(f.RawStatsIn,e.receive,e),e.declarePort(f.PcStatsTupleOut),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),i(t,[{key:"receive",value:function(e){if(null!==e){for(var t=e.tracks,n=[],r=0;r<t.length;++r){var i=t[r];if(i&&i.data){var o=a.Measurement.make(e.pcHash,this.getSSRC(i),this.getStreamType(i),this.getMediaType(i),this.getFrameRateReceived(i),this.getFrameHeight(i),this.getFrameWidth(i),this.getDroppedFramesNum(i),this.getRTT(i),this.getJitter(i),this.getLostPackets(i),this.getReceivedPackets(i),this.getSentPackets(i),this.getDiscardedPackets(i),this.getSentBytes(i),this.getReceivedBytes(i),i);n.push(o)}else d.log("No track or track.data.")}var s=new l.PcStats(e.candidatePair,e.codec,e.pcHash,e.trackStats,e.transportStats,n);this.transmit(f.PcStatsTupleOut,s)}else d.warn("Stats object can not be null")}},{key:"getSSRC",value:function(e){return e.ssrc}},{key:"getStreamType",value:function(e){return e.streamType===c.streamType.inbound?c.streamType.inbound:e.streamType===c.streamType.outbound?c.streamType.outbound:void 0}},{key:"getSentBytes",value:function(e){if(void 0===e.data.bytesSent)return-1;var t=u.checkForNan(parseInt(e.data.bytesSent,10));return null!==t?t:-1}},{key:"getReceivedBytes",value:function(e){if(void 0===e.data.bytesReceived)return-1;var t=u.checkForNan(parseInt(e.data.bytesReceived,10));return null!==t?t:-1}},{key:"getReceivedPackets",value:function(e){if(void 0===e.data.packetsReceived)return-1;var t=u.checkForNegativeValue(parseInt(e.data.packetsReceived,10));return null!==t?t:-1}},{key:"getSentPackets",value:function(e){if(void 0===e.data.packetsSent)return-1;var t=u.checkForNegativeValue(parseInt(e.data.packetsSent,10));return null!==t?t:-1}},{key:"getDiscardedPackets",value:function(e){if(void 0===e.data.discardedPackets)return-1;var t=u.checkForNan(parseInt(e.data.discardedPackets,10));return null!==t?t:-1}},{key:"getLostPackets",value:function(e){if(void 0===e.data.packetsLost)return-1;var t=u.checkForNegativeValue(parseInt(e.data.packetsLost,10));return null!==t?t:-1}},{key:"getDroppedFramesNum",value:function(e){if(void 0===e.data.droppedFrames)return-1;var t=u.checkForNegativeValue(parseInt(e.data.droppedFrames,10));return null!==t?t:-1}},{key:"getFrameRateReceived",value:function(e){var t=null;return void 0!==e.data.googFrameRateOutput?t=parseInt(e.data.googFrameRateOutput,10):void 0!==e.data.googFrameRateDecoded?t=parseInt(e.data.googFrameRateDecoded,10):void 0!==e.data.googFrameRateReceived?t=parseInt(e.data.googFrameRateReceived,10):void 0!==e.data.googFrameRateSent?t=parseInt(e.data.googFrameRateSent,10):void 0!==e.data.framerateMean&&(t=parseInt(e.data.framerateMean,10)),void 0!==t&&(t=u.checkForNegativeValue(t)),t}},{key:"getFrameHeight",value:function(e){var t=void 0;return void 0!==e.data.googFrameHeightReceived?t=e.data.googFrameHeightReceived:void 0!==e.data.googFrameHeightSent?t=e.data.googFrameHeightSent:void 0!==e.data.frameHeight&&(t=e.data.frameHeight),t}},{key:"getJitter",value:function(e){return void 0!==e.data.googJitterReceived?u.checkForNan(parseInt(e.data.googJitterReceived,10)):void 0!==e.data.jitter?u.checkForNan(parseInt(e.data.jitter,10)):void 0}},{key:"getFrameWidth",value:function(e){return void 0!==e.data.googFrameWidthReceived?e.data.googFrameWidthReceived:void 0!==e.data.googFrameWidthSent?e.data.googFrameWidthSent:void 0!==e.data.frameWidth?e.data.frameWidth:void 0}},{key:"getRTT",value:function(e){var t=function(e){return isNaN(e)||e<0?null:e};if(void 0!==e.data.googRtt)return t(parseInt(e.data.googRtt,10));if(void 0!==e.data.mozRtt)return t(parseInt(e.data.mozRtt,10));if(e.data.roundTripTime)return t(parseInt(e.data.roundTripTime,10));var n=this.getSSRC(e),r=(0,s.getRTTRegistry)().getRTT(n);return r&&(e.data.roundTripTime=r),r}},{key:"getMediaType",value:function(e){var t=c.mediaType.unknown;return e.data&&void 0!==e.data.mediaType?e.data.mediaType:(void 0!==e.data.googFrameRateReceived||void 0!==e.data.googFrameRateSent?t=c.mediaType.video:void 0!==e.data.audioInputLevel||void 0!==e.data.audioOutputLevel?t=c.mediaType.audio:e.data.mediaType?t=e.data.mediaType:void 0!==e.data.framerateMean&&(t=c.mediaType.video),t)}}]),t}();n.StatsParser=h},{"../collections/component":25,"../config/constants":32,"../utility/csiologger":87,"../utility/rttregistry":95,"./measurement":59,"./pcstats":66,"./validator":82}],73:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.StatsTransmitter=n.StatsTransmitterIO=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=e("../collections/component"),u=e("../utility/registry"),s=r(e("../config/constants")),a=r(e("../utility/csiologger")),l=n.StatsTransmitterIO={CallstatsIn:"CallstatsIn",UnprocessedIn:"UnprocessedIn"},c=function(e){function t(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var e=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"StatsTransmitter"));return e.pcHashes=[],e.battery=u.Registry.getBattery(),e.lastUnprocessed=null,e.bindPort(l.CallstatsIn,e.receiveCallstats,e),e.bindPort(l.UnprocessedIn,e.receiveUnprocessed,e),e}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),i(t,[{key:"receiveUnprocessed",value:function(e){this.lastUnprocessed=e}},{key:"receiveCallstats",value:function(e,t){var n;(n=this.getUnifiedFormat(t))?this.send(e,n):a.warn("Content can not be sent")}},{key:"send",value:function(e,t){var n=u.Registry.getConferenceManager().getConferenceForPcHash(e);if(n){var r=n.getPeerConnectionManager().getPcHandlerByHash(e);r&&(u.Registry.getEventMessageBuilder().make(s.callstatsChannels.processedStats,r.getConferenceId(),r.getPeerConnection(),t),this.sendToStatsCallback(t.stats,r))}}},{key:"sendToStatsCallback",value:function(e,t){var n=u.Registry.getStatsCallbackBuilder();n&&n.buildStats(e,t)}},{key:"getUnifiedFormat",value:function(r){for(var e=this.lastUnprocessed,t=[],n=0;n<e.length;n++){var i=e[n],o={};i.id&&(o.id=i.id),i.timestamp&&(o.timestamp=i.timestamp),i.type&&(o.type=i.type),Object.assign(o,i);var s=function(e){for(var t=0;t<r.tracks.length;t++){var n=r.tracks[t];if(n.data.id===e.id&&n.data.type===e.type)return n.data}return e.id===r.Transport.id&&e.type===r.Transport.type?r.Transport:null}(i);if(s){for(var a in s)if(s.hasOwnProperty(a)){if("id"===a||"type"===a||"timestamp"===a)continue;o[a]=s[a]}t.push(o)}else t.push(o)}var l={stats:t};return l.wifiStats=u.Registry.getWifiStatsExecutor().getWifiStats(),l.batteryStatus={},l.batteryStatus.batteryLevel=this.battery.getLevel(),l.batteryStatus.isBatteryCharging=this.battery.getCharging(),l}}]),t}();n.StatsTransmitter=c},{"../collections/component":25,"../config/constants":32,"../utility/csiologger":87,"../utility/registry":94}],74:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=function(){function o(e,t,n,r,i){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,o),this.candidatePairs=e,this.codec=t,this.trackStats=n,this.transportStats=r,this.tracks=i}return r(o,[{key:"getCandidatePairs",value:function(){return this.candidatePairs}},{key:"getCodec",value:function(){return this.codec}},{key:"getTrackStats",value:function(){return this.trackStats}},{key:"getTransportStats",value:function(){return this.transportStats}},{key:"getTracks",value:function(){return this.tracks}}]),o}();n.StatsTuple=i},{}],75:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SWAvg=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=e("./swplugin"),i=function(e){function i(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e,t,n));return r.sum=0,r.counter=0,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,o.SWPlugin),r(i,[{key:"add",value:function(e){this.filter(e)&&(this.sum+=this.extract(e),++this.counter,this.calculate())}},{key:"remove",value:function(e){this.filter(e)&&(this.sum-=this.extract(e),--this.counter,this.calculate())}},{key:"calculate",value:function(){var e=0;this.counter<1||(e=this.sum/this.counter),this.notify(e)}}]),i}();n.SWAvg=i},{"./swplugin":78}],76:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SWBTreePercentile=void 0;var f=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],r=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(r=(s=a.next()).done)&&(n.push(s.value),!t||n.length!==t);r=!0);}catch(e){i=!0,o=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=e("./swplugin"),u=e("../../collections/binarytree"),o=function(e){function l(e,t,n,r){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:null,o=5<arguments.length&&void 0!==arguments[5]?arguments[5]:null,s=6<arguments.length&&void 0!==arguments[6]?arguments[6]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,l);var a=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,(l.__proto__||Object.getPrototypeOf(l)).call(this,n,r,o));if(99<e||e<1)throw new RangeError("Percentile parameter must be between 1 and 99");return a.comparator=t,a.percentile=e,a.meanCalcer=s,a.estimator=i,a.ratio=e/(100-e),a.maxtree=new u.BinaryTree(t),a.mintree=new u.BinaryTree(t),a.ratio<1?a.required=1/a.ratio+1:1<a.ratio?a.required=a.ratio+1:a.required=2,a.result=null,a}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(l,i.SWPlugin),r(l,[{key:"add",value:function(e){if(this.filter(e)){if(this.maxtree.getNodeCounter()<1)return this.maxtree.insert(e),void this.calculate();this.comparator(e,this.maxtree.getTopValue())<=0?this.maxtree.insert(e):this.mintree.insert(e),this.balancing(),this.calculate()}}},{key:"remove",value:function(e){if(this.filter(e)){var t=this.mintree.getNodeCounter();this.maxtree.getNodeCounter()<1?this.mintree.delete(e):t<1?this.maxtree.delete(e):this.comparator(e,this.maxtree.getTopValue())<=0?this.maxtree.delete(e):this.mintree.delete(e),this.calculate()}}},{key:"getThresholds",value:function(){var e=this.mintree.getSize(),t=this.maxtree.getSize(),n=e+1,r=t+1;return 1<this.ratio?(n=Math.ceil(e*this.ratio),r=Math.floor(t/this.ratio)+1):this.ratio<1&&(n=Math.floor(e*this.ratio)+1,r=Math.ceil(t/this.ratio)),[n,r]}},{key:"balancing",value:function(){var e=this.mintree,t=this.maxtree,n=e.getSize(),r=t.getSize();if(!(r+n<this.required)){if(n<1)return void e.insertNodeAtBottom(t.popTopNode());for(r<1&&t.insertNodeAtTop(e.popBottomNode());;){var i=1<e.getNodeCounter(),o=1<t.getNodeCounter(),s=e.getBottomNode().getLength(),a=t.getTopNode().getLength();if(e.getNodeCounter()<1||t.getNodeCounter()<1)break;var l=this.getThresholds(),u=f(l,2),c=u[0],d=u[1];if(o&=n+a<=d,i&=r+s<=c,n=e.getSize(),c<(r=t.getSize())&&o)e.insertNodeAtBottom(t.popTopNode());else{if(!(d<n&&i))break;t.insertNodeAtTop(e.popBottomNode())}}}}},{key:"getMean",value:function(e,t){return this.meanCalcer?this.meanCalcer(e,t):e}},{key:"estimate",value:function(e,t){return this.estimator?this.estimator(e,t):null}},{key:"calculate",value:function(){var e=null,t=this.mintree,n=this.maxtree,r=t.getSize(),i=n.getSize(),o=i+r;if(!(o<1)){if(o<this.required||r<1||i<1){if(0==o)return;var s=void 0,a=void 0;r<1?(s=this.maxtree.getBottomValue(),a=this.maxtree.getTopValue()):i<1?(s=this.mintree.getBottomValue(),a=this.mintree.getTopValue()):(a=this.mintree.getTopValue(),s=this.maxtree.getBottomValue());var l=this.estimate(s,a);return void this.notify(l)}var u=n.getTopNode(),c=t.getBottomNode();if(u||c){if(!u){var d=this.extract(c);return void this.notify(d)}if(!c){var f=this.extract(u);return void this.notify(f)}var h=o*(this.percentile/100);if(Number.isInteger(h)){var p=Math.floor(h);e=Math.ceil(h+1)<=i?u.peek():p<=i?this.getMean(u.peek(),c.peek()):c.peek()}else{var v=i/r;e=this.ratio<v?u.peek():v<this.ratio?c.peek():this.ratio<1?c.peek():u.peek()}var g=this.extract(e);this.notify(g)}}}}]),l}();n.SWBTreePercentile=o},{"../../collections/binarytree":22,"./swplugin":78}],77:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SWFunctor=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=e("./swplugin"),i=function(e){function i(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i);var r=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,null,null,n));return r.addFunc=e,r.remFunc=t,r}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(i,o.SWPlugin),r(i,[{key:"add",value:function(e){this.filter(e)&&this.addFunc&&this.addFunc(e)}},{key:"remove",value:function(e){this.filter(e)&&this.remFunc&&this.remFunc(e)}},{key:"toString",value:function(){return"SWFuncPlugin"}}]),i}();n.SWFunctor=i},{"./swplugin":78}],78:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.SWPlugin=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../../utility/csiologger")),r=function(){function r(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,r),this.extractorFnc=e,this.notifierFnc=t,this.filterFunc=n}return i(r,[{key:"notify",value:function(e){this.notifierFnc?this.notifierFnc(e):o.warn("Failed notification for "+this.toString())}},{key:"extract",value:function(e){return this.extractorFnc?this.extractorFnc(e):(o.warn(this.toString()+" tried to extract without extractorFnc"),null)}},{key:"filter",value:function(e){return!this.filterFunc||this.filterFunc(e)}},{key:"add",value:function(e){o.log("Abstract method is called width value: "+e)}},{key:"remove",value:function(e){o.log("Abstract method is called with value: "+e)}},{key:"toString",value:function(){return"SWPlugin"}}]),r}();n.SWPlugin=r},{"../../utility/csiologger":87}],79:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){return t.green<=e?p.avQualityRatings.excellent:t.red<e?p.avQualityRatings.fair:p.avQualityRatings.bad}function a(e,t){return t.red<e?p.avQualityRatings.bad:t.green<=e?p.avQualityRatings.fair:p.avQualityRatings.excellent}Object.defineProperty(n,"__esModule",{value:!0}),n.TrackMonitor=void 0;var l=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var s=i.get;return void 0!==s?s.call(r):void 0},u=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),m=e("../utility/registry"),c=e("../collections/slidingwindow"),d=e("../statspipeline/swplugins/swavg"),f=e("../statspipeline/swplugins/swbtreepercentile"),h=e("../statspipeline/swplugins/swfunctor"),y=r(e("../utility/timestamps")),p=r(e("../config/constants")),v=r(e("../utility/csiologger")),g=function(){function e(){o(this,e),this.evaluators=[]}return u(e,[{key:"addEvaluator",value:function(e){var t={processFnc:e,weight:1<arguments.length&&void 0!==arguments[1]?arguments[1]:1};this.evaluators.push(t)}},{key:"getQuality",value:function(e){for(var t=0,n=[],r=0,i=0;i<this.evaluators.length;i++){var o=this.evaluators[i],s=0,a=o.processFnc?o.processFnc(e):0;if(a){if(a===p.avQualityRatings.bad)s=p.qualityRating.bad;else if(a===p.avQualityRatings.fair)s=p.qualityRating.fair;else if(a===p.avQualityRatings.excellent)s=p.qualityRating.excellent;else if(a===p.avQualityRatings.unknown)continue;t+=o.weight,n.push({result:s,weight:o.weight})}}for(var l=0;l<n.length;l++){var u=n[l];r+=u.result*(u.weight/t)}return(r=Math.floor(r))===p.qualityRating.excellent?p.avQualityRatings.excellent:r===p.qualityRating.good?p.avQualityRatings.fair:r===p.qualityRating.fair?p.avQualityRatings.fair:r===p.qualityRating.poor?p.avQualityRatings.fair:r===p.qualityRating.bad?p.avQualityRatings.bad:void 0}}]),e}(),s=function(e){function s(e,t,n,r){o(this,s);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=(void 0===t?"undefined":_typeof(t))&&"function"!=typeof t?e:t}(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e,t));return i.thresholds=[],i.enableThresholds=!1,i.requestTime=0,i.started=0,i.created=y.getCurrent(),i.mediaType=r,i.streamType=n,i.qualityHelper=new g,i.metrics=i.makeTrack(),i.lastTrack={},i.prevFrameRateMean=null,i.ssrc=null,i.scsHelper={total:0,above:0,ccDriven:0,sumMaxBitrateDiff:0,sumThroughputDiff:0,prevCsioAvgBRKbps:0},i}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":_typeof(t)));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(s,c.SlidingWindow),u(s,null,[{key:"make",value:function(e,t,n,r){var i=new s(e,t,n,r),o=i.metrics;return i.attach(new d.SWAvg(function(e){return e.getJitter()},function(e){o.csioAvgJitter=e},function(e){var t=e.getJitter();return null!=t})),i.attach(new d.SWAvg(function(e){return e.getRTT()},function(e){o.csioAvgRtt=e},function(e){var t=e.getRTT();return null!=t})),i.attach(new f.SWBTreePercentile(95,function(e,t){var n=e.getJitter(),r=t.getJitter();return n==r?0:n<r?-1:1},function(e){return e.getJitter()},function(e){o.csioPercentileJitter=e},function(e,t){return t?t.getJitter():e?e.getJitter():void 0},function(e){var t=e.getJitter();return null!=t},function(e,t){return e})),i.attach(new f.SWBTreePercentile(95,function(e,t){var n=e.getRTT(),r=t.getRTT();return n==r?0:n<r?-1:1},function(e){return e.getRTT()},function(e){o.csioSig2Latency=e,o.csioeM=e+40},function(e,t){return t?t.getRTT():e?e.getRTT():void 0},function(e){var t=e.getRTT();return null!=t},function(e,t){return e})),n===p.streamType.inbound?s.setupInboundMonitor(i):n===p.streamType.outbound?s.setupOutboundMonitor(i):v.warn("Unrecognized streamType ("+n+") at TrackMonitor"),r===p.mediaType.audio?s.setupAudioMonitor(i):r===p.mediaType.video?s.setupVideoMonitor(i):v.warn("Unrecognized mediaType ("+r+") at TrackMonitor"),n===p.streamType.inbound&&r===p.mediaType.audio?s.setupInbAudioQualityEvaluator(i):n===p.streamType.inbound&&r===p.mediaType.video?s.setupInbVideoQualityEvaluator(i):n===p.streamType.outbound&&r===p.mediaType.audio?s.setupOutbAudioQualityEvaluator(i):n===p.streamType.outbound&&r===p.mediaType.video&&(s.setupOutbVideoQualityEvaluator(i),s.setupSCSValidator(i)),i.addPostProcess(function(e){o.csioMark=i.getQuality(e)}),i}},{key:"setupInbAudioQualityEvaluator",value:function(e){var t=e.metrics;e.addQualityEvaluator(function(e){return void 0===t.csioIntBRKbps||null===t.csioIntBRKbps||t.csioIntBRKbps<0?p.avQualityRatings.unknown:i(t.csioIntBRKbps,p.throughputThreshold.audio)}),e.addQualityEvaluator(function(e){return void 0===t.csioIntFL||null===t.csioIntFL||t.csioIntFL<0?p.avQualityRatings.unknown:a(t.csioIntFL,p.fractionalLossThreshold.audio)}),e.addQualityEvaluator(function(e){return void 0===t.csioeM||null===t.csioeM?p.avQualityRatings.unknown:a(t.csioeM,p.eModelThreshold.audio)})}},{key:"setupOutbAudioQualityEvaluator",value:function(e){var t=e.metrics;e.addQualityEvaluator(function(e){return void 0===t.csioIntBRKbps||null===t.csioIntBRKbps||t.csioIntBRKbps<0?p.avQualityRatings.unknown:i(t.csioIntBRKbps,p.throughputThreshold.audio)}),e.addQualityEvaluator(function(e){return void 0===t.csioeM||null===t.csioeM?p.avQualityRatings.unknown:a(t.csioeM,p.eModelThreshold.audio)})}},{key:"setupInbVideoQualityEvaluator",value:function(t){var n=t.metrics;t.addQualityEvaluator(function(e){return void 0===n.csioIntBRKbps||null===n.csioIntBRKbps||n.csioIntBRKbps<0?p.avQualityRatings.unknown:i(n.csioIntBRKbps,p.throughputThreshold.video)}),t.addQualityEvaluator(function(e){return void 0===n.csioFrameRateMean||null===n.csioFrameRateMean?p.avQualityRatings.unknown:n.csioFrameRateMean&&t.prevFrameRateMean?i(n.csioFrameRateMean/t.prevFrameRateMean,p.currOverPrevFrameRateThreshold.video):p.avQualityRatings.bad}),t.addQualityEvaluator(function(e){return void 0===n.csioSig2Latency||null===n.csioSig2Latency?p.avQualityRatings.unknown:a(n.csioSig2Latency,p.rttThreshold.video)})}},{key:"setupOutbVideoQualityEvaluator",value:function(t){var n=t.metrics;t.addQualityEvaluator(function(e){return null==n.csioIntBRKbps||null==n.csioIntBRKbps?p.avQualityRatings.unknown:i(n.csioIntBRKbps,p.throughputThreshold.video)}),t.addQualityEvaluator(function(e){return void 0===n.csioFrameRateMean||null===n.csioFrameRateMean?p.avQualityRatings.unknown:n.csioFrameRateMean&&t.prevFrameRateMean?i(n.csioFrameRateMean/t.prevFrameRateMean,p.currOverPrevFrameRateThreshold.video):p.avQualityRatings.bad}),t.addQualityEvaluator(function(e){return void 0===n.csioSig2Latency||null===n.csioSig2Latency?p.avQualityRatings.unknown:a(n.csioSig2Latency,p.rttThreshold.video)})}},{key:"setupInboundMonitor",value:function(v){var g=v.metrics;v.addPreProcess(function(e){var t=e.getLostPackets(),n=e.getReceivedPackets(),r=v.getRequestedMeasurement(),i=0,o=0;r?(i=t-r.getLostPackets(),o=n-r.getReceivedPackets()):(i=t,o=n);var s=0;(0<i||0<o)&&(s=i/(o+i)),g.csioIntPktLoss=i,g.csioIntFL=s,e.setFractionLost(s)}),v.attach(new h.SWFunctor(function(e){var t=y.getCurrent(),n=e.getResolution(),r=v.getRequestedMeasurement(),i=v.getRequestTime(),o=e.getLostPackets(),s=8*e.getReceivedBytes(),a=e.getReceivedPackets(),l=t-v.getStartTime(),u=0,c=0,d=0,f=0,h=1e3,p=Math.max(t-v.getStartTime(),h);r?(f=a-r.getReceivedPackets(),u=s-8*r.getReceivedBytes(),c=o-r.getLostPackets(),d=Math.max(t-i,h)):(m.Registry.getCredentials().getAdaptiveInterval(),h=m.Registry.getCredentials().getStatsSubmissionInterval(),p=Math.max(t-v.getStartTime(),h),f=a,u=s,c=o,d=Math.max(p,h)),g.csioIntPktRcv=f,g.csioIntPR=f/(d/1e3),g.csioAvgBRKbps=s/p,g.csioIntBRKbps=u/d,g.csioAvgPacketSize=e.getReceivedBytes()/a,g.csioIntMs=l,g.csioTimeElapseMs=d,g.csiores=n,g.csioPktLostPercentage=c/u*100},null,null)),v.attach(new f.SWBTreePercentile(95,function(e,t){var n=e.getFractionLost(),r=t.getFractionLost();return n==r?0:n<r?-1:1},function(e){return e.getFractionLost()},function(e){g.csioPercentileFl=e},function(e,t){return t?t.getFractionLost():e?e.getFractionLost():void 0},function(e){var t=e.getFractionLost();return null!=t},function(e,t){return e}))}},{key:"setupOutboundMonitor",value:function(v){var g=v.metrics;v.addPreProcess(function(e){var t=e.getLostPackets(),n=e.getSentPackets(),r=v.getRequestedMeasurement(),i=0,o=0;r?(i=t-r.getLostPackets(),o=n-r.getSentPackets()):(i=t,o=n);var s=0;(0<i||0<o)&&(s=i/(o+i)),g.csioIntPktLoss=i,g.csioIntFL=s,e.setFractionLost(s)}),v.attach(new h.SWFunctor(function(e){var t=y.getCurrent(),n=e.getResolution(),r=v.getRequestedMeasurement(),i=v.getRequestTime(),o=e.getLostPackets(),s=8*e.getSentBytes(),a=e.getSentPackets(),l=t-v.getStartTime(),u=0,c=0,d=0,f=0,h=1e3,p=Math.max(t-v.getStartTime(),h);r?(f=a-r.getSentPackets(),u=s-8*r.getSentBytes(),c=o-r.getLostPackets(),d=Math.max(t-i,h)):(m.Registry.getCredentials().getAdaptiveInterval(),h=m.Registry.getCredentials().getStatsSubmissionInterval(),p=Math.max(t-v.getStartTime(),h),f=a,u=s,c=o,d=Math.max(p,h)),g.csioIntPktRcv=f,g.csioAvgBRKbps=s/p,g.csioIntBRKbps=u/d,g.csioIntPR=f/(d/1e3),g.csioAvgPacketSize=e.getSentBytes()/a,g.csioIntMs=l,g.csioTimeElapseMs=d,g.csiores=n,g.csioPktLostPercentage=c/u*100},null,null)),v.attach(new f.SWBTreePercentile(95,function(e,t){var n=e.getFractionLost(),r=t.getFractionLost();return n==r?0:n<r?-1:1},function(e){return e.getFractionLost()},function(e){g.csioPercentileFl=e},function(e,t){return t?t.getFractionLost():e?e.getFractionLost():void 0},function(e){var t=e.getFractionLost();return null!=t},function(e,t){return e}))}},{key:"setupAudioMonitor",value:function(e){var t=e.metrics;e.attach(new h.SWFunctor(function(e){t.csioMediaType=p.mediaType.audio},null,null))}},{key:"setupVideoMonitor",value:function(t){var n=t.metrics;t.attach(new d.SWAvg(function(e){return e.getFrameRateReceived()},function(e){t.prevFrameRateMean=n.csioFrameRateMean,n.csioFrameRateMean=e},function(e){var t=e.getFrameRateReceived();return null!=t})),t.attach(new d.SWAvg(function(e){return e.getFrameHeight()},function(e){n.csioFrameHeightMean=e},function(e){var t=e.getFrameHeight();return null!=t})),t.attach(new d.SWAvg(function(e){return e.getFrameWidth()},function(e){n.csioFrameWidthMean=e},function(e){var t=e.getFrameWidth();return null!=t})),t.attach(new f.SWBTreePercentile(95,function(e,t){var n=e.getFrameRateReceived(),r=t.getFrameRateReceived();return n==r?0:n<r?-1:1},function(e){return e.getFrameRateReceived()},function(e){n.csioFrameRate95Percentile=e},function(e,t){return t?t.getFrameRateReceived():e?e.getFrameRateReceived():void 0},function(e){var t=e.getFrameRateReceived();return null!=t},function(e,t){return e})),t.attach(new f.SWBTreePercentile(50,function(e,t){var n=e.getFrameRateReceived(),r=t.getFrameRateReceived();return n==r?0:n<r?-1:1},function(e){return e.getFrameRateReceived()},function(e){n.csioFrameRate50Percentile=e},function(e,t){return t?t.getFrameRateReceived():e?e.getFrameRateReceived():void 0},function(e){var t=e.getFrameRateReceived();return null!=t},function(e,t){return e})),t.attach(new f.SWBTreePercentile(95,function(e,t){var n=e.getFrameHeight(),r=t.getFrameHeight();return n==r?0:n<r?-1:1},function(e){return e.getFrameHeight()},function(e){n.csioFrameHeight95Percentile=e},function(e,t){return t?t.getFrameHeight():e?e.getFrameHeight():void 0},function(e){var t=e.getFrameHeight();return null!=t},function(e,t){return e})),t.attach(new f.SWBTreePercentile(50,function(e,t){var n=e.getFrameHeight(),r=t.getFrameHeight();return n==r?0:n<r?-1:1},function(e){return e.getFrameHeight()},function(e){n.csioFrameHeight50Percentile=e},function(e,t){return t?t.getFrameHeight():e?e.getFrameHeight():void 0},function(e){var t=e.getFrameHeight();return null!=t},function(e,t){return e})),t.attach(new f.SWBTreePercentile(95,function(e,t){var n=e.getFrameWidth(),r=t.getFrameWidth();return n==r?0:n<r?-1:1},function(e){return e.getFrameWidth()},function(e){n.csioFrameWidth95Percentile=e},function(e,t){return t?t.getFrameWidth():e?e.getFrameWidth():void 0},function(e){var t=e.getFrameWidth();return null!=t},function(e,t){return e})),t.attach(new f.SWBTreePercentile(50,function(e,t){var n=e.getFrameWidth(),r=t.getFrameWidth();return n==r?0:n<r?-1:1},function(e){return e.getFrameWidth()},function(e){n.csioFrameWidth50Percentile=e},function(e,t){return t?t.getFrameWidth():e?e.getFrameWidth():void 0},function(e){var t=e.getFrameWidth();return null!=t},function(e,t){return e})),t.attach(new h.SWFunctor(function(e){n.csioMediaType=p.mediaType.video},null,null))}},{key:"setupSCSValidator",value:function(c){var d=c.metrics;c.attach(new h.SWFunctor(function(e){var t=m.Registry.getConfigServiceWrapper().getSenderConfig();if(!t||!t.rtc_rtp_parameters||!t.rtc_rtp_parameters.encodings)return d.csioSCSValidationSampleCount=null,d.csioAvgMaxBitrateDiff=null,d.csioAvgDeltaThroughput=null,d.csioMaxBitrateAboveRatio=null,void(d.csioCCDrivenRatio=null);var n=0;t.rtc_rtp_parameters.encodings.forEach(function(e){e&&(n=Math.max(n,e.maxBitrate))});var r=0,i=m.Registry.getConfigServiceWrapper().getDefaultSenderConfig();if(i&&i.encodings){i.encodings.forEach(function(e){r=Math.max(r,e.maxBitrate)});var o,s,a=0,l=null,u=c.getSCSHelper();0<r&&.9*r<1e3*d.csioAvgBRKbps?(a=n-r,l=!1):(a=n-1e3*d.csioAvgBRKbps,l=!0),s=0<a,o=d.csioAvgBRKbps-d.prevCsioAvgBRKbps,u.prevCsioAvgBRKbps=d.csioAvgBRKbps,d.csioSCSValidationSampleCount=++u.total,u.sumMaxBitrateDiff+=a,d.csioAvgMaxBitrateDiff=u.sumMaxBitrateDiff/u.total,u.sumThroughputDiff+=o,d.csioAvgDeltaThroughput=u.sumThroughputDiff/u.total,s&&(u.above+=1),d.csioMaxBitrateAboveRatio=u.above/u.total,l&&(u.ccDriven+=1),d.csioCCDrivenRatio=u.ccDriven/u.total}},null,null))}}]),u(s,[{key:"makeTrack",value:function(){var e={csioMediaType:void 0,csioMark:void 0,csioIntBRKbps:void 0,csioAvgBRKbps:void 0,csioIntFL:void 0,csioIntMs:void 0,csioIntPR:void 0,csioPercentileFl:void 0,csioAvgJitter:void 0,csioAvgRtt:void 0,csioPercentileJitter:void 0,csioSig2Latency:void 0,csioTimeElapseMs:void 0,csioeM:void 0,csiores:void 0,csioFrameWidth95Percentile:void 0,csioFrameWidth50Percentile:void 0,csioFrameHeight95Percentile:void 0,csioFrameHeight50Percentile:void 0,csioFrameRate95Percentile:void 0,csioFrameRate50Percentile:void 0,csioFrameWidthMean:void 0,csioFrameHeightMean:void 0,csioFrameRateMean:void 0,csioIntPktRcv:void 0,csioSCSValidationSampleCount:null,csioAvgMaxBitrateDiff:null,csioAvgDeltaThroughput:null,csioMaxBitrateAboveRatio:null,csioCCDrivenRatio:null};return e}},{key:"getSSRC",value:function(){return this.ssrc}},{key:"add",value:function(e){this.ssrc=e.getSSRC(),this.lastTrack=e.extractTrack(),this.lastTrack.pcHash=e.getPcHash(),0===this.started&&(this.started=y.getCurrent()),l(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"add",this).call(this,e)}},{key:"hasTraffic",value:function(){return 0<this.metrics.csioIntBRKbps}},{key:"getTrack",value:function(){var e=this.lastTrack;return Object.assign(e.data,this.metrics),e}},{key:"extractTrack",value:function(){var e=this.lastTrack;return Object.assign(e.data,this.metrics),this.requestTime=y.getCurrent(),this.requestedMeasurement=this.peek(),e}},{key:"getMediaType",value:function(){return this.mediaType}},{key:"getStreamType",value:function(){return this.streamType}},{key:"getStartTime",value:function(){return this.started}},{key:"getCreationTime",value:function(){return this.created}},{key:"getRequestTime",value:function(){return Math.max(this.started,this.requestTime)}},{key:"getRequestedMeasurement",value:function(){return this.requestedMeasurement}},{key:"getSCSHelper",value:function(){return this.scsHelper}},{key:"addQualityEvaluator",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;this.qualityHelper.addEvaluator(e,t)}},{key:"getQuality",value:function(e){return this.qualityHelper.getQuality(e)}},{key:"addPreProcess",value:function(e){l(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"addPreProcess",this).call(this,e)}},{key:"addPostProcess",value:function(e){l(s.prototype.__proto__||Object.getPrototypeOf(s.prototype),"addPostProcess",this).call(this,e)}}]),s}();n.TrackMonitor=s},{"../collections/slidingwindow":27,"../config/constants":32,"../statspipeline/swplugins/swavg":75,"../statspipeline/swplugins/swbtreepercentile":76,"../statspipeline/swplugins/swfunctor":77,"../utility/csiologger":87,"../utility/registry":94,"../utility/timestamps":98}],80:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TracksMonitor=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=e("./trackmonitor"),o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../config/constants")),s=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.inbMonitors=new Map,this.outbMonitors=new Map}return r(e,[{key:"getMonitor",value:function(e){var t=e.getStreamType(),n=e.getMediaType(),r=e.getSSRC(),i=null;return t===o.streamType.inbound?n===o.mediaType.audio?i=this.getInbAudioMonitor(r):n===o.mediaType.video&&(i=this.getInbVideoMonitor(r)):t===o.streamType.outbound&&(n===o.mediaType.audio?i=this.getOutbAudioMonitor(r):n===o.mediaType.video&&(i=this.getOutbVideoMonitor(r))),i}},{key:"extractTracks",value:function(){var n=[];return this.outbMonitors.forEach(function(e,t){n.push(e.extractTrack())}),this.inbMonitors.forEach(function(e,t){n.push(e.extractTrack())}),n}},{key:"getTracks",value:function(){var n=[];return this.outbMonitors.forEach(function(e,t){n.push(e.getTrack())}),this.inbMonitors.forEach(function(e,t){n.push(e.getTrack())}),n}},{key:"getMonitors",value:function(){var n=[];return this.outbMonitors.forEach(function(e,t){n.push(e)}),this.inbMonitors.forEach(function(e,t){n.push(e)}),n}},{key:"getInbAudioMonitor",value:function(e){var t=this.inbMonitors.get(e);return t||(t=i.TrackMonitor.make(1e3,3e4,o.streamType.inbound,o.mediaType.audio),this.inbMonitors.set(e,t)),t}},{key:"getInbVideoMonitor",value:function(e){var t=this.inbMonitors.get(e);return t||(t=i.TrackMonitor.make(1e3,3e4,o.streamType.inbound,o.mediaType.video),this.inbMonitors.set(e,t)),t}},{key:"getOutbAudioMonitor",value:function(e){var t=this.outbMonitors.get(e);return t||(t=i.TrackMonitor.make(1e3,3e4,o.streamType.outbound,o.mediaType.audio),this.outbMonitors.set(e,t)),t}},{key:"getOutbVideoMonitor",value:function(e){var t=this.outbMonitors.get(e);return t||(t=i.TrackMonitor.make(1e3,3e4,o.streamType.outbound,o.mediaType.video),this.outbMonitors.set(e,t)),t}}]),e}();n.TracksMonitor=s},{"../config/constants":32,"./trackmonitor":79}],81:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0}),n.TransportsMonitor=void 0;var o=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),u=r(e("../config/constants")),s=r(e("../utility/timestamps")),c=e("../utility/rttregistry"),a=function(){function t(e){i(this,t),this.previous=e,this.actual=e,this.outdated=s.getCurrent()}return o(t,[{key:"setActual",value:function(e){this.actual=e}},{key:"outdate",value:function(){this.previous=this.actual,this.outdated=s.getCurrent()}},{key:"getActual",value:function(){return this.actual}},{key:"getPrevious",value:function(){return this.previous}},{key:"getElapsedTime",value:function(){return s.getCurrent()-this.outdated}}]),t}(),l=function(){function t(e){i(this,t),this.stats=new Map,this.codeBase=e}return o(t,[{key:"set",value:function(e,t){var n=this.stats.get(e);n?n.setActual(t):this.stats.set(e,new a(t))}},{key:"getIntervalStats",value:function(){var n=this,r=new Map;return this.stats.forEach(function(e,t){r.set(t,n.getIntervalStat(e)),e.outdate()}),r}},{key:"getIntervalStat",value:function(e){var t=null;switch(this.codeBase){case u.codeBaseType.chrome:t=this.getIntervalStatForChrome(e);break;default:t=e.getActual()}return t}},{key:"getIntervalStatForChrome",value:function(e){var t=e.getActual(),n=e.getPrevious(),r=e.getElapsedTime();if(!n)return actual;for(var i=0;i<t.length;++i){var o=t[i],s=n[i];if(!s||!o)return t;var a=parseInt(s.bytesReceived,10),l=parseInt(s.bytesSent,10);o.csioReceivedBwKbps=8*(parseInt(o.bytesReceived,10)-a)/r,o.csioSentBwKbps=8*(parseInt(o.bytesSent,10)-l)/r,o.csioIntBytesReceived=parseInt(o.bytesReceived,10)-a,o.csioIntBytesSent=parseInt(o.bytesSent,10)-l,void 0!==s.packetsSent&&void 0!==o.packetsSent&&(o.csioSentPacketRate=(parseInt(o.packetsSent,10)-parseInt(s.packetsSent,10))/(r/1e3),o.csioIntPacketsSent=parseInt(o.packetsSent,10)-parseInt(s.packetsSent,10)),void 0!==s.packetsReceived&&void 0!==o.packetsReceived&&(o.csioReceivedPacketRate=(parseInt(o.packetsReceived,10)-parseInt(s.packetsReceived,10))/(r/1e3),o.csioIntPacketsReceived=parseInt(o.packetsReceived,10)-parseInt(s.packetsReceived,10)),this.codeBase==u.codeBaseType.chrome&&(o.currentRoundTripTime=(0,c.getRTTRegistry)().getTransportRTT())}return t}}]),t}();n.TransportsMonitor=l},{"../config/constants":32,"../utility/rttregistry":95,"../utility/timestamps":98}],82:[function(e,t,n){function r(e){return isNaN(e)?null:e}Object.defineProperty(n,"__esModule",{value:!0}),n.checkForNan=r,n.checkForNegativeValue=function(e){return null!==r(e)&&0<e?e:null}},{}],83:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.getWifiStatsMethod=null,this.wifiStats=null,this.interval=1e4}return r(e,[{key:"setGetWifiStatsMethod",value:function(e){this.getWifiStatsMethod=e,this.wifiStatsHandler()}},{key:"getWifiStats",value:function(){return this.wifiStats}},{key:"wifiStatsHandler",value:function(){var t=this;t.getWifiStatsMethod&&t.getWifiStatsMethod().then(function(e){t.wifiStats=JSON.parse(e),setTimeout(function(){t.wifiStatsHandler()},t.interval)}).catch(function(){setTimeout(function(){t.wifiStatsHandler()},t.interval)})}}]),e}();n.WifiStatsExecutor=i},{}],84:[function(e,t,n){function r(e){return window.btoa(e)}function o(e){return window.atob(e)}Object.defineProperty(n,"__esModule",{value:!0}),n.encode=r,n.decode=o,n.urlencode=function(e){return r(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"")},n.urlencodeUnicode=function(e){return(t=e,r(encodeURIComponent(t).replace(/%([0-9A-F]{2})/g,function(e,t){return String.fromCharCode("0x"+t)}))).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=+$/,"");var t},n.strtohex=function(e){for(var t=o(e.replace(/[ \r\n]+$/,"")),n=[],r=0;r<t.length;++r){var i=t.charCodeAt(r).toString(16);1===i.length&&(i="0"+i),n.push(i)}return n.join("")}},{}],85:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.Callbacks=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=r(e("../config/constants")),s=e("./registry"),a=r(e("./csiologger")),l=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.callbacks={}}return i(e,[{key:"set",value:function(e,t){if("function"==typeof t)return o.callbackFunctions.hasOwnProperty(e)?(this.callbacks[e]=t,void(e===o.callbackFunctions.stats&&s.Registry.getStatsCallbackBuilder().setCallback(t))):void a.error("Couldn't set callback: "+e)}},{key:"get",value:function(e){return this.callbacks.hasOwnProperty(e)?this.callbacks[e]:null}}]),e}();n.Callbacks=l},{"../config/constants":32,"./csiologger":87,"./registry":94}],86:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.Credentials=void 0;var i="function"==typeof Symbol&&"symbol"==_typeof(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof(e)},o=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),s=r(e("../config/constants")),a=r(e("./csiologger")),l=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.appId=null,this.userId=null,this.userIdObject=null,this.deviceId=null,this.statsSubmissionInterval=15e3,this.collectSDP=!1,this.transportType=s.transportType.rest,this.adaptiveInterval=!1}return o(e,[{key:"getAppId",value:function(){return this.appId}},{key:"setAppId",value:function(e){this.appId="string"==typeof e?parseInt(e,10):e}},{key:"getUserId",value:function(){return this.userId}},{key:"setUserId",value:function(e){"object"===(void 0===e?"undefined":i(e))?(this.userId=e.aliasName,this.setUserIdObject(e)):this.userId=e}},{key:"getUserIdObject",value:function(){return this.userIdObject}},{key:"setUserIdObject",value:function(e){this.userIdObject=e}},{key:"getStatsSubmissionInterval",value:function(){return this.statsSubmissionInterval}},{key:"setStatsSubmissionInterval",value:function(e){a.log("setStatsSubmissionInterval is ",e),this.statsSubmissionInterval=e}},{key:"getCollectSDP",value:function(){return this.collectSDP}},{key:"setCollectSDP",value:function(e){this.collectSDP=e}},{key:"getTransportType",value:function(){return this.transportType}},{key:"setTransportType",value:function(e){this.transportType=e}},{key:"getAdaptiveInterval",value:function(){return this.adaptiveInterval}},{key:"setAdaptiveInterval",value:function(e){this.adaptiveInterval=e}}]),e}();n.Credentials=l},{"../config/constants":32,"./csiologger":87}],87:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.info=function(){var e;"true"===r.csioDebug&&(e=console).info.apply(e,arguments)},n.log=function(){var e;"true"===r.csioDebug&&(e=console).log.apply(e,arguments)},n.warn=function(){var e;"true"===r.csioDebug&&(e=console).warn.apply(e,arguments)},n.error=function(){var e;(e=console).warn.apply(e,arguments)};var r=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../config/settings"))},{"../config/settings":33}],88:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.Endpoint=void 0;var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),o=r(e("../browserapi/localstorage")),s=r(e("../browserapi/detectbrowser")),a=r(e("../utility/timestamps")),l=r(e("../utility/hash")),u=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.id=null,this.appversion=null,this.magicKey=Math.floor(4294967296*Math.random()),this.browserName=null,this.browserVersion=null,this.osName=null,this.osVersion=null,this.codeBase=null,this.userAgent=null,this.retrieveId()}return i(e,[{key:"setup",value:function(){var e=s.detect();this.browserName=e.browserName,this.browserVersion=e.browserVersion,this.osName=e.os,this.osVersion=e.osVersion,this.codeBase=e.codeBase,this.userAgent=e.userAgent}},{key:"retrieveId",value:function(){var t=this,e=o.get("endpointID");if(null===e){var n=a.getCurrent(),r=Math.random()*n;l.generateSHA256(r.toString(),function(e){t.id=e,o.store("endpointID",e)})}else this.id=e}},{key:"getId",value:function(){return this.id}},{key:"getAppVersion",value:function(){return this.appversion}},{key:"setAppVersion",value:function(e){this.appversion=e}},{key:"getMagicKey",value:function(){return this.magicKey}},{key:"getBrowserName",value:function(){return this.browserName}},{key:"getBrowserVersion",value:function(){return this.browserVersion}},{key:"getOsName",value:function(){return this.osName}},{key:"getOsVersion",value:function(){return this.osVersion}},{key:"getCodeBase",value:function(){return this.codeBase}},{key:"getUserAgent",value:function(){return this.userAgent}},{key:"serialize",value:function(){return{type:"browser",buildName:this.browserName,buildVersion:this.browserVersion,appVersion:this.appversion,os:this.osName,osVersion:this.osVersion,userAgent:this.userAgent}}}]),e}();n.Endpoint=u},{"../browserapi/detectbrowser":17,"../browserapi/localstorage":19,"../utility/hash":91,"../utility/timestamps":98}],89:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.EventMessage=void 0;var o="function"==typeof Symbol&&"symbol"==_typeof(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof(e)},s=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),a=r(e("../config/constants")),l=r(e("../config/settings")),u=e("./registry"),c=r(e("./csiologger")),i=function(){function i(e,t,n,r){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,i),this.eventType=e,this.customEntries=n,this.pcHandler=r,this.auth=u.Registry.getAuthenticator(),this.clocksync=u.Registry.getClockSync(),this.timestamp=this.clocksync.getSynchronizedTimestamp(),this.conferenceId=t,this.clockUnSynced=!this.clocksync.isCompleted()}return s(i,[{key:"updateConferenceId",value:function(e){c.log("updating conferenceId to ",this.eventType,this.conferenceId,e),this.conferenceId=e}},{key:"toJson",value:function(){if(!this.canBeSent())return null;var e=this.getCommonHeader();return Object.assign(e,this.customEntries),this.eventType===a.internalFabricEvent.userJoined&&delete e.connectionID,e}},{key:"getCallback",value:function(){return this.pcHandler?this.pcHandler.getCallback():null}},{key:"canBeSent",value:function(){var e=void 0,t=a.tmpConferenceId;if(this.conferenceId===t)return!1;if(this.pcHandler&&!this.pcHandler.getRemoteId())return!1;if(this.eventType!==a.precalltestEvents.results){var n=u.Registry.getConferenceManager().get(this.conferenceId);if(!n)return!1;e=n.getUcId()}return!(!this.auth.getToken()||(this.auth.isTokenValid()?!(this.isPriority()||this.clocksync.isCompleted()&&e)||this.eventType===a.internalFabricEvent.userAlive&&!e:(this.auth.reAuthenticate(),1)))}},{key:"isCachable",value:function(){return-1===[a.internalFabricEvent.userAlive].indexOf(this.eventType)}},{key:"isPriority",value:function(){var e=!1;return this.eventType!==a.internalFabricEvent.userJoined&&this.eventType!==a.precalltestEvents.results&&this.eventType!==a.internalFabricEvent.userAlive||(e=!0),e}},{key:"getConferenceId",value:function(){return this.conferenceId}},{key:"getCommonHeader",value:function(){var e={version:l.version,callstatsVersion:l.version,channel:this.decideChannel(),timestamp:this.timestamp,action:this.eventType,eventType:this.eventType,localID:encodeURIComponent(u.Registry.getCredentials().getUserId()),timeShift:0,appID:u.Registry.getCredentials().getAppId(),deviceID:u.Registry.getEndpoint().getId(),token:this.auth.getToken(),confID:encodeURIComponent(this.conferenceId)};this.clockUnSynced&&(e.timestamp+=this.clocksync.getOffset());var t=u.Registry.getConferenceManager().get(this.conferenceId);return e.ucID=t?t.getUcId():null,this.eventType!==a.callstatsChannels.userFeedback&&this.eventType!==a.precalltestEvents.results&&(this.pcHandler?(e.remoteID=encodeURIComponent(this.pcHandler.getRemoteId()),e.connectionID=this.pcHandler.getPcHash()):(e.remoteID=encodeURIComponent(u.Registry.getCredentials().getUserId()),e.connectionID=encodeURIComponent(u.Registry.getCredentials().getUserId()))),e}},{key:"decideChannel",value:function(){if(this.eventType==a.callstatsChannels.sdpSubmission)return a.callstatsChannels.sdpSubmission;if(this.eventType==a.callstatsChannels.userFeedback)return a.callstatsChannels.userFeedback;if(this.eventType==a.callstatsChannels.processedStats)return a.callstatsChannels.processedStats;for(var e in a.precalltestEvents)if(this.eventType==a.precalltestEvents[e])return a.callstatsChannels.preCallTest;return a.callstatsChannels.callstatsEvent}}],[{key:"checkCustomEntries",value:function(e,t){if(!d[e])return c.error("eventType not recognized:",e),!1;var n=d[e];for(var r in n)if(!t.hasOwnProperty(r)||o(t[r])!==n[r])return c.error("customEntries for",e,"should have",r,"of type",n[r]),!1;return!0}}]),i}(),d={};d[a.internalFabricEvent.userJoined]={endpointInfo:"object"},d[a.internalFabricEvent.userLeft]={},d[a.internalFabricEvent.userAlive]={},d[a.internalFabricEvent.userDetails]={userName:"string"},d[a.internalFabricEvent.connectedDeviceList]={mediaDeviceList:"object"},d[a.fabricEvent.activeDeviceList]={mediaDeviceList:"object"},d[a.fabricEvent.audioMute]={},d[a.fabricEvent.audioUnmute]={},d[a.fabricEvent.videoPause]={},d[a.fabricEvent.videoResume]={},d[a.fabricEvent.screenShareStart]={},d[a.fabricEvent.screenShareStop]={},d[a.internalFabricEvent.mediaPlaybackStart]={ssrc:"string"},d[a.internalFabricEvent.mediaPlaybackSuspended]={ssrc:"string"},d[a.internalFabricEvent.mediaPlaybackStalled]={ssrc:"string"},d[a.internalFabricEvent.oneWayMedia]={mediaType:"string",ssrc:"string"},d[a.internalFabricEvent.fabricSetup]={localIceCandidates:"object",remoteIceCandidates:"object",iceCandidatePairs:"object"},d[a.fabricEvent.fabricSetupFailed]={failureDelay:"number",reason:"string",function:"string",endpoint:"object"},d[a.internalFabricEvent.fabricStateChange]={changedState:"string",prevState:"string",newState:"string"},d[a.internalFabricEvent.fabricDropped]={prevIceConnectionState:"string",currIceConnectionState:"string",currIceCandidatePair:"object",failureDelay:"number"},d[a.internalFabricEvent.iceConnectionDisruptionStart]={prevIceConnectionState:"string",currIceConnectionState:"string",prevIceConnectionStateTs:"number",currIceCandidatePair:"object"},d[a.internalFabricEvent.iceConnectionDisruptionEnd]={prevIceConnectionState:"string",currIceConnectionState:"string",disruptionDelay:"number"},d[a.internalFabricEvent.iceDisruptionStart]={prevIceConnectionState:"string",currIceConnectionState:"string",prevIceConnectionStateTs:"number",currIceCandidatePair:"object"},d[a.internalFabricEvent.iceDisruptionEnd]={prevIceConnectionState:"string",currIceConnectionState:"string",prevIceCandidatePair:"object"},d[a.internalFabricEvent.iceFailed]={localIceCandidates:"object",prevIceConnectionState:"string",currIceConnectionState:"string",currIceCandidatePair:"object",failureDelay:"number"},d[a.internalFabricEvent.iceAborted]={prevIceConnectionState:"string",currIceConnectionState:"string"},d[a.internalFabricEvent.iceRestarted]={prevIceConnectionState:"string",currIceConnectionState:"string",prevIceCandidatePair:"object"},d[a.internalFabricEvent.fabricTransportSwitch]={prevIceCandidatePair:"object",currIceCandidatePair:"object"},d[a.internalFabricEvent.iceTerminated]={prevIceConnectionState:"string",currIceConnectionState:"string"},d[a.fabricEvent.fabricTerminated]={},d[a.fabricEvent.fabricHold]={},d[a.fabricEvent.fabricResume]={},d[a.callstatsChannels.sdpSubmission]={localSDP:"string",remoteSDP:"string"},d[a.internalFabricEvent.ssrcMap]={ssrcData:"object"},d[a.callstatsChannels.userFeedback]={feedback:"object"},d[a.internalFabricEvent.sendingThroughputObservations]={ssrc:"string",maxsendingKBitrate:"number",timeToMaxSendingKBitrate:"number",stablesendingKBitrate:"number",timeToStableSendingKBitrate:"number"},d[a.fabricEvent.dominantSpeaker]={},d[a.fabricEvent.applicationErrorLog]={message:"string",messageType:"string"},d[a.callstatsChannels.processedStats]={stats:"object"},d[a.callstatsChannels.senderConfiguration]={rtc_rtp_parameters:"object"},d[a.internalFabricEvent.limitationObservations]={reason:"string"},d[a.qualityDisruptionTypes.qpchange]={reason:"string"},d[a.precalltestEvents.results]={results:"object"},d[a.precalltestEvents.associate]={ids:"object"},n.EventMessage=i},{"../config/constants":32,"../config/settings":33,"./csiologger":87,"./registry":94}],90:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.EventMessageBuilder=void 0;var a="function"==typeof Symbol&&"symbol"==_typeof(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof(e)},i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),l=e("./eventmessage"),u=r(e("../config/constants")),c=e("./registry"),d=r(e("./csiologger")),o=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.transmissionmanager=c.Registry.getTransmissionManager()}return i(e,[{key:"make",value:function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{};if("string"!=typeof e||null===r||"object"!==(void 0===r?"undefined":a(r)))return d.error("failed typeof checks:",e,void 0===e?"undefined":a(e),void 0===r?"undefined":a(r),r),c.Registry.getGenericEventHandler().sendEvent(u.logEvents.error,{msg:"failed typeof checks:"+e+":"+(void 0===r?"undefined":a(r))}),!1;if(null===t&&e!==u.precalltestEvents.results)return d.error("failed conferenceId checks:",e,t),c.Registry.getGenericEventHandler().sendEvent(u.logEvents.error,{msg:"failed conferenceId checks:"+e}),!1;if(!n&&e!==u.callstatsChannels.userFeedback&&e!==u.fabricEvent.applicationErrorLog&&e!==u.fabricEvent.fabricSetupFailed&&e!==u.precalltestEvents.results)return d.error("peerconnection cannot be null",e),c.Registry.getGenericEventHandler().sendEvent(u.logEvents.error,{msg:"peerconnection cannot be null"+e}),!1;if(!l.EventMessage.checkCustomEntries(e,r))return d.error("failed checks:",e,r),c.Registry.getGenericEventHandler().sendEvent(u.logEvents.error,{msg:"failed customEntries checks:"+e}),!1;var i=void 0;if(t){var o=c.Registry.getConferenceManager().get(t);o&&n&&(i=o.getPeerConnectionManager().getPcHandler(n))}var s=new l.EventMessage(e,t,r,i);return this.transmissionmanager.send(s),!0}}]),e}();n.EventMessageBuilder=o},{"../config/constants":32,"./csiologger":87,"./eventmessage":89,"./registry":94}],91:[function(e,t,n){function o(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:null,n=0;if(!e)return n;for(var r=0,i=e.length;r<i;r++)n=(n<<5)-n+e.charCodeAt(r),n|=0;return t&&t(n+""),n+""}function s(e){for(var t=[],n=0;n<e.length;++n){var r=e.charCodeAt(n);r<128?t[t.length]=r:(127<r&&r<2048?t[t.length]=r>>6|192:(t[t.length]=r>>12|224,t[t.length]=r>>6&63|128),t[t.length]=63&r|128)}return new Uint8Array(t).buffer}function a(e){for(var t=new DataView(e),n="",r=void 0,i=0;i<t.byteLength;i++)(r=t.getUint8(i).toString(16)).length<2&&(r="0"+r),n+=r;return n}Object.defineProperty(n,"__esModule",{value:!0}),n.generateSHA256=function(e,t){var n={name:"SHA-256"};if(window.crypto){var r=window.crypto.subtle||window.crypto.webkitSubtle;if(!r)return void o(e,t);r.digest(n,s(e)).then(function(e){t(a(e))}).catch(function(){o(e,t)})}else if(window.msCrypto){if(!window.msCrypto.subtle)return void o(e,t);var i=window.msCrypto.subtle.digest(n,s(e));i.oncomplete=function(e){e.target&&t(a(e.target.result))},i.onerror=function(){o(e,t)}}else o(e,t)},n.generateHash=o},{}],92:[function(e,t,n){function r(e){return!!/^[\],:{}\s]*$/.test(e.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))}Object.defineProperty(n,"__esModule",{value:!0}),n.isValid=r,n.parse=function(e){var t=null;return null===e||r(e)&&(t=JSON.parse(e)),t}},{}],93:[function(e,t,n){function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}Object.defineProperty(n,"__esModule",{value:!0}),n.setErrorEventListener=function(){window&&window.addEventListener&&window.addEventListener("error",function(e){var t=s.Registry.getGenericEventHandler();if(e&&e.filename&&-1<e.filename.indexOf("callstats")){for(var n=!1,r={fileName:e.filename,line:e.lineno,col:e.colno,jsVersion:a.version,eventType:"error",message:e.message,pageURL:window.location.href},i=s.Registry.getConferenceManager().getConferenceIds(),o=0;o<i.length;o++)r.conferenceID=i[o],t.sendEvent(l.logEvents.error,r),n=!0;n||t.sendEvent(l.logEvents.error,r)}})};var s=e("./registry"),a=r(e("../config/settings")),l=r(e("../config/constants"))},{"../config/constants":32,"../config/settings":33,"./registry":94}],94:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.Registry=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=e("../services/clocksync"),o=e("../services/configservice/configservicewrapper"),s=e("../services/authenticator"),a=e("../services/backendlog"),l=e("../services/transmissionmanager"),u=e("./eventmessagebuilder"),c=e("../conference/conferencemanager"),d=e("../utility/credentials"),f=e("../statspipeline/statsadapter"),h=e("../statspipeline/statsparser"),p=e("../statspipeline/statsmonitor"),v=e("../statspipeline/statstransmitter"),g=e("../statspipeline/statsassembler"),m=e("../utility/endpoint"),y=e("../browserapi/battery"),_=e("precalltest"),b=e("../statspipeline/wifistatsexecutor"),S=e("./callbacks"),C=e("../statspipeline/statscallbackbuilder"),T=e("../services/connectionmanager"),w=null,E=null,k=null,R=null,I=null,P=null,A=null,O=null,M=null,D=null,x=null,N=null,F=null,U=null,j=null,L=null,H=null,B=null,q=null,G=null,W=function(){function n(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n)}return r(n,null,[{key:"getConferenceManager",value:function(){return L||(L=new c.ConferenceManager),L}},{key:"getStatsCallbackBuilder",value:function(){return q||(q=new C.StatsCallbackBuilder),q}},{key:"getClockSync",value:function(){return E||(E=new i.ClockSync),E}},{key:"getWifiStatsExecutor",value:function(){return H||(H=new b.WifiStatsExecutor),H}},{key:"getAuthenticator",value:function(){return k||(k=new s.Authenticator),k}},{key:"getConfigServiceWrapper",value:function(){return R||(R=new o.ConfigServiceWrapper),R}},{key:"getGenericEventHandler",value:function(){return I||(I=new a.GenericEventHandler).enable(),I}},{key:"getConnectionManager",value:function(){return G||(G=new T.ConnectionManager),G}},{key:"getTransmissionManager",value:function(){return P||(P=new l.TransmissionManager),P}},{key:"getEventMessageBuilder",value:function(){return A||(A=new u.EventMessageBuilder),A}},{key:"getCredentials",value:function(){return O||(O=new d.Credentials),O}},{key:"getEndpoint",value:function(){return M||(M=new m.Endpoint),M}},{key:"getStatsAdapter",value:function(){if(!D){var e=n.getEndpoint().getCodeBase(),t=n.getEndpoint().getBrowserName();D=new f.StatsAdapter(e,t)}return D}},{key:"getPreCallTest",value:function(){return w||(w=new _.PreCallTest),w}},{key:"getStatsParser",value:function(){return x||(x=new h.StatsParser),x}},{key:"getStatsMonitor",value:function(){if(!N){var e=n.getEndpoint().getCodeBase();N=new p.StatsMonitor(e)}return N}},{key:"getStatsTransmitter",value:function(){return F||(F=new v.StatsTransmitter),F}},{key:"getStatsAssembler",value:function(){return U||(U=new g.StatsAssembler),U}},{key:"getBattery",value:function(){return j||(j=new y.Battery),j}},{key:"getCallbacks",value:function(){return B||(B=new S.Callbacks),B}}]),n}();n.Registry=W},{"../browserapi/battery":16,"../conference/conferencemanager":30,"../services/authenticator":43,"../services/backendlog":44,"../services/clocksync":45,"../services/configservice/configservicewrapper":49,"../services/connectionmanager":50,"../services/transmissionmanager":55,"../statspipeline/statsadapter":68,"../statspipeline/statsassembler":69,"../statspipeline/statscallbackbuilder":70,"../statspipeline/statsmonitor":71,"../statspipeline/statsparser":72,"../statspipeline/statstransmitter":73,"../statspipeline/wifistatsexecutor":83,"../utility/credentials":86,"../utility/endpoint":88,"./callbacks":85,"./eventmessagebuilder":90,precalltest:2}],95:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}();n.getRTTRegistry=function(){return null===i&&(i=new o),i};var u=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("../statspipeline/validator")),i=null,o=function(){function e(){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,e),this.rtts=new Map,this.transportRTT=null}return r(e,[{key:"update",value:function(e){var l=this;e.getStats(function(e){for(var t=[],n=e.result(),r=0;r<n.length;++r){var i=n[r];if("googCandidatePair"!==i.type){if("ssrc"===i.type){var o=i.stat("googRtt"),s=i.stat("ssrc");o&&l.rtts.set(u.checkForNan(parseInt(s,10)),u.checkForNan(parseInt(o,10)))}}else{var a=i.stat("googRtt");t.push(a)}}l.transportRTT=Math.max.apply(Math,t)})}},{key:"getTransportRTT",value:function(){return this.transportRTT}},{key:"getRTT",value:function(e){var t=u.checkForNan(parseInt(e,10));return this.rtts.has(t)?this.rtts.get(t):null}}]),e}()},{"../statspipeline/validator":82}],96:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var i=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),r=function(){function r(e,t,n){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,r),this.max=e,this.midpoint=t,this.stepness=n,this.actualStep=0,this.reset()}return i(r,[{key:"reset",value:function(){this.actualStep=0}},{key:"setMidpoint",value:function(e){this.midpoint=e}},{key:"setMax",value:function(e){this.max=e}},{key:"setStepness",value:function(e){this.stepness=e}},{key:"increaseActualStep",value:function(e){this.actualStep+=e}},{key:"getActual",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:1;return this.actualStep+=e,this.max/(1+Math.exp(-1*this.stepness*(this.actualStep-this.midpoint)))}}]),r}();n.Sigmoid=r},{}],97:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.TimeoutProcess=void 0;var r=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(e("./csiologger")),o=function(){function t(e){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,t),this.interval=e,this.timerId=null,this.callback=function(){i.warn("no callback function set",this)}}return r(t,[{key:"setCallback",value:function(e){this.callback=e}},{key:"start",value:function(){var e=this;this.timerId=setInterval(function(){e.callback()},this.interval)}},{key:"stop",value:function(){clearInterval(this.timerId),this.timerId=null}},{key:"isStarted",value:function(){return null!==this.timerId}}]),t}();n.TimeoutProcess=o},{"./csiologger":87}],98:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.getCurrent=function(){return window&&window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now()},n.getSinceOrigin=function(){return window&&window.performance&&window.performance.now?window.performance.now():null}},{}],99:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0});var r="function"==typeof Symbol&&"symbol"==_typeof(Symbol.iterator)?function(e){return void 0===e?"undefined":_typeof(e)}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":void 0===e?"undefined":_typeof(e)},o=function(){function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}}(),i=function(){function i(e){(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")})(this,i),this.base=e;for(var t=arguments.length,n=Array(1<t?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];this.appendixes=n}return o(i,null,[{key:"concat",value:function(e,t){if(!t)return e;if(!e)return t;var n="/"===e.substr(e.length-1),r="/"===t.substring(0,1);return n||r?n&&r?e+t.substring(1):e+t:e+"/"+t}}]),o(i,[{key:"append",value:function(e){this.appendixes.push(e)}},{key:"toString",value:function(){var n=this.getString(this.base),r=this;return this.appendixes.forEach(function(e){if(null!=e){var t=r.getString(e);n=i.concat(n,t)}}),n}},{key:"getString",value:function(e){switch(void 0===e?"undefined":r(e)){case"function":return this.getString(e());case"number":return e+"";case"string":default:return e}}}]),i}();n.Url=i},{}],100:[function(e,t,n){Object.defineProperty(n,"__esModule",{value:!0}),n.normalizeMediaDeviceList=function(e){var t=[];if(!e)return t;for(var n=0;n<e.length;n++){var r={};r.mediaDeviceID=e[n].deviceId,r.groupID=e[n].groupId,r.kind=e[n].kind,r.label=e[n].label,t.push(r)}return t},n.isIntegerPollyfill=function(){Number.isInteger||(Number.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e})},n.assignPollyfill=function(){"function"!=typeof Object.assign&&Object.defineProperty(Object,"assign",{value:function(e,t){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var n=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(n[o]=i[o])}return n},writable:!0,configurable:!0})}},{}]},{},[21]);
/***
Copyright (c) 2013-2018, callstats.io
All rights reserved.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE
LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
POSSIBILITY OF SUCH DAMAGE.
***/

/*! callstats  version = 3.50.3 2018-05-30 01-17-11 */

!function() {
    function a(b, c, d) {
        function e(g, h) {
            if (!c[g]) {
                if (!b[g]) {
                    var i = "function" == typeof require && require;
                    if (!h && i) return i(g, !0);
                    if (f) return f(g, !0);
                    var j = new Error("Cannot find module '" + g + "'");
                    throw j.code = "MODULE_NOT_FOUND", j;
                }
                var k = c[g] = {
                    exports: {}
                };
                b[g][0].call(k.exports, function(a) {
                    return e(b[g][1][a] || a);
                }, k, k.exports, a, b, c, d);
            }
            return c[g].exports;
        }
        for (var f = "function" == typeof require && require, g = 0; g < d.length; g++) e(d[g]);
        return e;
    }
    return a;
}()({
    1: [ function(a, b, c) {
        (function(a, d) {
            !function(a) {
                if ("object" == typeof c && void 0 !== b) b.exports = a(); else if ("function" == typeof define && define.amd) define([], a); else {
                    var e;
                    "undefined" != typeof window ? e = window : void 0 !== d ? e = d : "undefined" != typeof self && (e = self), 
                    e.Promise = a();
                }
            }(function() {
                var b, c, e;
                return function a(b, c, d) {
                    function e(g, h) {
                        if (!c[g]) {
                            if (!b[g]) {
                                var i = "function" == typeof _dereq_ && _dereq_;
                                if (!h && i) return i(g, !0);
                                if (f) return f(g, !0);
                                var j = new Error("Cannot find module '" + g + "'");
                                throw j.code = "MODULE_NOT_FOUND", j;
                            }
                            var k = c[g] = {
                                exports: {}
                            };
                            b[g][0].call(k.exports, function(a) {
                                var c = b[g][1][a];
                                return e(c || a);
                            }, k, k.exports, a, b, c, d);
                        }
                        return c[g].exports;
                    }
                    for (var f = "function" == typeof _dereq_ && _dereq_, g = 0; g < d.length; g++) e(d[g]);
                    return e;
                }({
                    1: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(a) {
                            function b(a) {
                                var b = new c(a), d = b.promise();
                                return b.setHowMany(1), b.setUnwrap(), b.init(), d;
                            }
                            var c = a._SomePromiseArray;
                            a.any = function(a) {
                                return b(a);
                            }, a.prototype.any = function() {
                                return b(this);
                            };
                        };
                    }, {} ],
                    2: [ function(b, c, d) {
                        "use strict";
                        function e() {
                            this._customScheduler = !1, this._isTickUsed = !1, this._lateQueue = new k(16), 
                            this._normalQueue = new k(16), this._haveDrainedQueues = !1, this._trampolineEnabled = !0;
                            var a = this;
                            this.drainQueues = function() {
                                a._drainQueues();
                            }, this._schedule = j;
                        }
                        function f(a, b, c) {
                            this._lateQueue.push(a, b, c), this._queueTick();
                        }
                        function g(a, b, c) {
                            this._normalQueue.push(a, b, c), this._queueTick();
                        }
                        function h(a) {
                            this._normalQueue._pushOne(a), this._queueTick();
                        }
                        var i;
                        try {
                            throw new Error();
                        } catch (a) {
                            i = a;
                        }
                        var j = b("./schedule"), k = b("./queue"), l = b("./util");
                        e.prototype.setScheduler = function(a) {
                            var b = this._schedule;
                            return this._schedule = a, this._customScheduler = !0, b;
                        }, e.prototype.hasCustomScheduler = function() {
                            return this._customScheduler;
                        }, e.prototype.enableTrampoline = function() {
                            this._trampolineEnabled = !0;
                        }, e.prototype.disableTrampolineIfNecessary = function() {
                            l.hasDevTools && (this._trampolineEnabled = !1);
                        }, e.prototype.haveItemsQueued = function() {
                            return this._isTickUsed || this._haveDrainedQueues;
                        }, e.prototype.fatalError = function(b, c) {
                            c ? (a.stderr.write("Fatal " + (b instanceof Error ? b.stack : b) + "\n"), a.exit(2)) : this.throwLater(b);
                        }, e.prototype.throwLater = function(a, b) {
                            if (1 === arguments.length && (b = a, a = function() {
                                throw b;
                            }), "undefined" != typeof setTimeout) setTimeout(function() {
                                a(b);
                            }, 0); else try {
                                this._schedule(function() {
                                    a(b);
                                });
                            } catch (a) {
                                throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n");
                            }
                        }, l.hasDevTools ? (e.prototype.invokeLater = function(a, b, c) {
                            this._trampolineEnabled ? f.call(this, a, b, c) : this._schedule(function() {
                                setTimeout(function() {
                                    a.call(b, c);
                                }, 100);
                            });
                        }, e.prototype.invoke = function(a, b, c) {
                            this._trampolineEnabled ? g.call(this, a, b, c) : this._schedule(function() {
                                a.call(b, c);
                            });
                        }, e.prototype.settlePromises = function(a) {
                            this._trampolineEnabled ? h.call(this, a) : this._schedule(function() {
                                a._settlePromises();
                            });
                        }) : (e.prototype.invokeLater = f, e.prototype.invoke = g, e.prototype.settlePromises = h), 
                        e.prototype._drainQueue = function(a) {
                            for (;a.length() > 0; ) {
                                var b = a.shift();
                                if ("function" == typeof b) {
                                    var c = a.shift(), d = a.shift();
                                    b.call(c, d);
                                } else b._settlePromises();
                            }
                        }, e.prototype._drainQueues = function() {
                            this._drainQueue(this._normalQueue), this._reset(), this._haveDrainedQueues = !0, 
                            this._drainQueue(this._lateQueue);
                        }, e.prototype._queueTick = function() {
                            this._isTickUsed || (this._isTickUsed = !0, this._schedule(this.drainQueues));
                        }, e.prototype._reset = function() {
                            this._isTickUsed = !1;
                        }, c.exports = e, c.exports.firstLineError = i;
                    }, {
                        "./queue": 26,
                        "./schedule": 29,
                        "./util": 36
                    } ],
                    3: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(a, b, c, d) {
                            var e = !1, f = function(a, b) {
                                this._reject(b);
                            }, g = function(a, b) {
                                b.promiseRejectionQueued = !0, b.bindingPromise._then(f, f, null, this, a);
                            }, h = function(a, b) {
                                0 == (50397184 & this._bitField) && this._resolveCallback(b.target);
                            }, i = function(a, b) {
                                b.promiseRejectionQueued || this._reject(a);
                            };
                            a.prototype.bind = function(f) {
                                e || (e = !0, a.prototype._propagateFrom = d.propagateFromFunction(), a.prototype._boundValue = d.boundValueFunction());
                                var j = c(f), k = new a(b);
                                k._propagateFrom(this, 1);
                                var l = this._target();
                                if (k._setBoundTo(j), j instanceof a) {
                                    var m = {
                                        promiseRejectionQueued: !1,
                                        promise: k,
                                        target: l,
                                        bindingPromise: j
                                    };
                                    l._then(b, g, void 0, k, m), j._then(h, i, void 0, k, m), k._setOnCancel(j);
                                } else k._resolveCallback(l);
                                return k;
                            }, a.prototype._setBoundTo = function(a) {
                                void 0 !== a ? (this._bitField = 2097152 | this._bitField, this._boundTo = a) : this._bitField = -2097153 & this._bitField;
                            }, a.prototype._isBound = function() {
                                return 2097152 == (2097152 & this._bitField);
                            }, a.bind = function(b, c) {
                                return a.resolve(c).bind(b);
                            };
                        };
                    }, {} ],
                    4: [ function(a, b, c) {
                        "use strict";
                        function d() {
                            try {
                                Promise === f && (Promise = e);
                            } catch (a) {}
                            return f;
                        }
                        var e;
                        "undefined" != typeof Promise && (e = Promise);
                        var f = a("./promise")();
                        f.noConflict = d, b.exports = f;
                    }, {
                        "./promise": 22
                    } ],
                    5: [ function(a, b, c) {
                        "use strict";
                        var d = Object.create;
                        if (d) {
                            var e = d(null), f = d(null);
                            e[" size"] = f[" size"] = 0;
                        }
                        b.exports = function(b) {
                            function c(a, c) {
                                var d;
                                if (null != a && (d = a[c]), "function" != typeof d) {
                                    var e = "Object " + h.classString(a) + " has no method '" + h.toString(c) + "'";
                                    throw new b.TypeError(e);
                                }
                                return d;
                            }
                            function d(a) {
                                return c(a, this.pop()).apply(a, this);
                            }
                            function e(a) {
                                return a[this];
                            }
                            function f(a) {
                                var b = +this;
                                return b < 0 && (b = Math.max(0, b + a.length)), a[b];
                            }
                            var g, h = a("./util"), i = h.canEvaluate;
                            h.isIdentifier;
                            b.prototype.call = function(a) {
                                var b = [].slice.call(arguments, 1);
                                return b.push(a), this._then(d, void 0, void 0, b, void 0);
                            }, b.prototype.get = function(a) {
                                var b, c = "number" == typeof a;
                                if (c) b = f; else if (i) {
                                    var d = g(a);
                                    b = null !== d ? d : e;
                                } else b = e;
                                return this._then(b, void 0, void 0, a, void 0);
                            };
                        };
                    }, {
                        "./util": 36
                    } ],
                    6: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d, e) {
                            var f = a("./util"), g = f.tryCatch, h = f.errorObj, i = b._async;
                            b.prototype.break = b.prototype.cancel = function() {
                                if (!e.cancellation()) return this._warn("cancellation is disabled");
                                for (var a = this, b = a; a._isCancellable(); ) {
                                    if (!a._cancelBy(b)) {
                                        b._isFollowing() ? b._followee().cancel() : b._cancelBranched();
                                        break;
                                    }
                                    var c = a._cancellationParent;
                                    if (null == c || !c._isCancellable()) {
                                        a._isFollowing() ? a._followee().cancel() : a._cancelBranched();
                                        break;
                                    }
                                    a._isFollowing() && a._followee().cancel(), a._setWillBeCancelled(), b = a, a = c;
                                }
                            }, b.prototype._branchHasCancelled = function() {
                                this._branchesRemainingToCancel--;
                            }, b.prototype._enoughBranchesHaveCancelled = function() {
                                return void 0 === this._branchesRemainingToCancel || this._branchesRemainingToCancel <= 0;
                            }, b.prototype._cancelBy = function(a) {
                                return a === this ? (this._branchesRemainingToCancel = 0, this._invokeOnCancel(), 
                                !0) : (this._branchHasCancelled(), !!this._enoughBranchesHaveCancelled() && (this._invokeOnCancel(), 
                                !0));
                            }, b.prototype._cancelBranched = function() {
                                this._enoughBranchesHaveCancelled() && this._cancel();
                            }, b.prototype._cancel = function() {
                                this._isCancellable() && (this._setCancelled(), i.invoke(this._cancelPromises, this, void 0));
                            }, b.prototype._cancelPromises = function() {
                                this._length() > 0 && this._settlePromises();
                            }, b.prototype._unsetOnCancel = function() {
                                this._onCancelField = void 0;
                            }, b.prototype._isCancellable = function() {
                                return this.isPending() && !this._isCancelled();
                            }, b.prototype.isCancellable = function() {
                                return this.isPending() && !this.isCancelled();
                            }, b.prototype._doInvokeOnCancel = function(a, b) {
                                if (f.isArray(a)) for (var c = 0; c < a.length; ++c) this._doInvokeOnCancel(a[c], b); else if (void 0 !== a) if ("function" == typeof a) {
                                    if (!b) {
                                        var d = g(a).call(this._boundValue());
                                        d === h && (this._attachExtraTrace(d.e), i.throwLater(d.e));
                                    }
                                } else a._resultCancelled(this);
                            }, b.prototype._invokeOnCancel = function() {
                                var a = this._onCancel();
                                this._unsetOnCancel(), i.invoke(this._doInvokeOnCancel, this, a);
                            }, b.prototype._invokeInternalOnCancel = function() {
                                this._isCancellable() && (this._doInvokeOnCancel(this._onCancel(), !0), this._unsetOnCancel());
                            }, b.prototype._resultCancelled = function() {
                                this.cancel();
                            };
                        };
                    }, {
                        "./util": 36
                    } ],
                    7: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b) {
                            function c(a, c, h) {
                                return function(i) {
                                    var j = h._boundValue();
                                    a: for (var k = 0; k < a.length; ++k) {
                                        var l = a[k];
                                        if (l === Error || null != l && l.prototype instanceof Error) {
                                            if (i instanceof l) return f(c).call(j, i);
                                        } else if ("function" == typeof l) {
                                            var m = f(l).call(j, i);
                                            if (m === g) return m;
                                            if (m) return f(c).call(j, i);
                                        } else if (d.isObject(i)) {
                                            for (var n = e(l), o = 0; o < n.length; ++o) {
                                                var p = n[o];
                                                if (l[p] != i[p]) continue a;
                                            }
                                            return f(c).call(j, i);
                                        }
                                    }
                                    return b;
                                };
                            }
                            var d = a("./util"), e = a("./es5").keys, f = d.tryCatch, g = d.errorObj;
                            return c;
                        };
                    }, {
                        "./es5": 13,
                        "./util": 36
                    } ],
                    8: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(a) {
                            function b() {
                                this._trace = new b.CapturedTrace(d());
                            }
                            function c() {
                                if (e) return new b();
                            }
                            function d() {
                                var a = f.length - 1;
                                if (a >= 0) return f[a];
                            }
                            var e = !1, f = [];
                            return a.prototype._promiseCreated = function() {}, a.prototype._pushContext = function() {}, 
                            a.prototype._popContext = function() {
                                return null;
                            }, a._peekContext = a.prototype._peekContext = function() {}, b.prototype._pushContext = function() {
                                void 0 !== this._trace && (this._trace._promiseCreated = null, f.push(this._trace));
                            }, b.prototype._popContext = function() {
                                if (void 0 !== this._trace) {
                                    var a = f.pop(), b = a._promiseCreated;
                                    return a._promiseCreated = null, b;
                                }
                                return null;
                            }, b.CapturedTrace = null, b.create = c, b.deactivateLongStackTraces = function() {}, 
                            b.activateLongStackTraces = function() {
                                var c = a.prototype._pushContext, f = a.prototype._popContext, g = a._peekContext, h = a.prototype._peekContext, i = a.prototype._promiseCreated;
                                b.deactivateLongStackTraces = function() {
                                    a.prototype._pushContext = c, a.prototype._popContext = f, a._peekContext = g, a.prototype._peekContext = h, 
                                    a.prototype._promiseCreated = i, e = !1;
                                }, e = !0, a.prototype._pushContext = b.prototype._pushContext, a.prototype._popContext = b.prototype._popContext, 
                                a._peekContext = a.prototype._peekContext = d, a.prototype._promiseCreated = function() {
                                    var a = this._peekContext();
                                    a && null == a._promiseCreated && (a._promiseCreated = this);
                                };
                            }, b;
                        };
                    }, {} ],
                    9: [ function(b, c, d) {
                        "use strict";
                        c.exports = function(c, d) {
                            function e(a, b) {
                                return {
                                    promise: b
                                };
                            }
                            function f() {
                                return !1;
                            }
                            function g(a, b, c) {
                                var d = this;
                                try {
                                    a(b, c, function(a) {
                                        if ("function" != typeof a) throw new TypeError("onCancel must be a function, got: " + N.toString(a));
                                        d._attachCancellationCallback(a);
                                    });
                                } catch (a) {
                                    return a;
                                }
                            }
                            function h(a) {
                                if (!this._isCancellable()) return this;
                                var b = this._onCancel();
                                void 0 !== b ? N.isArray(b) ? b.push(a) : this._setOnCancel([ b, a ]) : this._setOnCancel(a);
                            }
                            function i() {
                                return this._onCancelField;
                            }
                            function j(a) {
                                this._onCancelField = a;
                            }
                            function k() {
                                this._cancellationParent = void 0, this._onCancelField = void 0;
                            }
                            function l(a, b) {
                                if (0 != (1 & b)) {
                                    this._cancellationParent = a;
                                    var c = a._branchesRemainingToCancel;
                                    void 0 === c && (c = 0), a._branchesRemainingToCancel = c + 1;
                                }
                                0 != (2 & b) && a._isBound() && this._setBoundTo(a._boundTo);
                            }
                            function m(a, b) {
                                0 != (2 & b) && a._isBound() && this._setBoundTo(a._boundTo);
                            }
                            function n() {
                                var a = this._boundTo;
                                return void 0 !== a && a instanceof c ? a.isFulfilled() ? a.value() : void 0 : a;
                            }
                            function o() {
                                this._trace = new G(this._peekContext());
                            }
                            function p(a, b) {
                                if (O(a)) {
                                    var c = this._trace;
                                    if (void 0 !== c && b && (c = c._parent), void 0 !== c) c.attachExtraTrace(a); else if (!a.__stackCleaned__) {
                                        var d = y(a);
                                        N.notEnumerableProp(a, "stack", d.message + "\n" + d.stack.join("\n")), N.notEnumerableProp(a, "__stackCleaned__", !0);
                                    }
                                }
                            }
                            function q(a, b, c, d, e) {
                                if (void 0 === a && null !== b && Y) {
                                    if (void 0 !== e && e._returnedNonUndefined()) return;
                                    if (0 == (65535 & d._bitField)) return;
                                    c && (c += " ");
                                    var f = "", g = "";
                                    if (b._trace) {
                                        for (var h = b._trace.stack.split("\n"), i = w(h), j = i.length - 1; j >= 0; --j) {
                                            var k = i[j];
                                            if (!Q.test(k)) {
                                                var l = k.match(R);
                                                l && (f = "at " + l[1] + ":" + l[2] + ":" + l[3] + " ");
                                                break;
                                            }
                                        }
                                        if (i.length > 0) for (var m = i[0], j = 0; j < h.length; ++j) if (h[j] === m) {
                                            j > 0 && (g = "\n" + h[j - 1]);
                                            break;
                                        }
                                    }
                                    var n = "a promise was created in a " + c + "handler " + f + "but was not returned from it, see http://goo.gl/rRqMUw" + g;
                                    d._warn(n, !0, b);
                                }
                            }
                            function r(a, b) {
                                var c = a + " is deprecated and will be removed in a future version.";
                                return b && (c += " Use " + b + " instead."), s(c);
                            }
                            function s(a, b, d) {
                                if (ga.warnings) {
                                    var e, f = new M(a);
                                    if (b) d._attachExtraTrace(f); else if (ga.longStackTraces && (e = c._peekContext())) e.attachExtraTrace(f); else {
                                        var g = y(f);
                                        f.stack = g.message + "\n" + g.stack.join("\n");
                                    }
                                    ba("warning", f) || z(f, "", !0);
                                }
                            }
                            function t(a, b) {
                                for (var c = 0; c < b.length - 1; ++c) b[c].push("From previous event:"), b[c] = b[c].join("\n");
                                return c < b.length && (b[c] = b[c].join("\n")), a + "\n" + b.join("\n");
                            }
                            function u(a) {
                                for (var b = 0; b < a.length; ++b) (0 === a[b].length || b + 1 < a.length && a[b][0] === a[b + 1][0]) && (a.splice(b, 1), 
                                b--);
                            }
                            function v(a) {
                                for (var b = a[0], c = 1; c < a.length; ++c) {
                                    for (var d = a[c], e = b.length - 1, f = b[e], g = -1, h = d.length - 1; h >= 0; --h) if (d[h] === f) {
                                        g = h;
                                        break;
                                    }
                                    for (var h = g; h >= 0; --h) {
                                        var i = d[h];
                                        if (b[e] !== i) break;
                                        b.pop(), e--;
                                    }
                                    b = d;
                                }
                            }
                            function w(a) {
                                for (var b = [], c = 0; c < a.length; ++c) {
                                    var d = a[c], e = "    (No stack trace)" === d || S.test(d), f = e && da(d);
                                    e && !f && (U && " " !== d.charAt(0) && (d = "    " + d), b.push(d));
                                }
                                return b;
                            }
                            function x(a) {
                                for (var b = a.stack.replace(/\s+$/g, "").split("\n"), c = 0; c < b.length; ++c) {
                                    var d = b[c];
                                    if ("    (No stack trace)" === d || S.test(d)) break;
                                }
                                return c > 0 && "SyntaxError" != a.name && (b = b.slice(c)), b;
                            }
                            function y(a) {
                                var b = a.stack, c = a.toString();
                                return b = "string" == typeof b && b.length > 0 ? x(a) : [ "    (No stack trace)" ], 
                                {
                                    message: c,
                                    stack: "SyntaxError" == a.name ? b : w(b)
                                };
                            }
                            function z(a, b, c) {
                                if ("undefined" != typeof console) {
                                    var d;
                                    if (N.isObject(a)) {
                                        var e = a.stack;
                                        d = b + T(e, a);
                                    } else d = b + String(a);
                                    "function" == typeof J ? J(d, c) : "function" != typeof console.log && "object" != typeof console.log || console.log(d);
                                }
                            }
                            function A(a, b, c, d) {
                                var e = !1;
                                try {
                                    "function" == typeof b && (e = !0, "rejectionHandled" === a ? b(d) : b(c, d));
                                } catch (a) {
                                    L.throwLater(a);
                                }
                                "unhandledRejection" === a ? ba(a, c, d) || e || z(c, "Unhandled rejection ") : ba(a, d);
                            }
                            function B(a) {
                                var b;
                                if ("function" == typeof a) b = "[function " + (a.name || "anonymous") + "]"; else {
                                    b = a && "function" == typeof a.toString ? a.toString() : N.toString(a);
                                    if (/\[object [a-zA-Z0-9$_]+\]/.test(b)) try {
                                        b = JSON.stringify(a);
                                    } catch (a) {}
                                    0 === b.length && (b = "(empty array)");
                                }
                                return "(<" + C(b) + ">, no stack trace)";
                            }
                            function C(a) {
                                return a.length < 41 ? a : a.substr(0, 38) + "...";
                            }
                            function D() {
                                return "function" == typeof fa;
                            }
                            function E(a) {
                                var b = a.match(ea);
                                if (b) return {
                                    fileName: b[1],
                                    line: parseInt(b[2], 10)
                                };
                            }
                            function F(a, b) {
                                if (D()) {
                                    for (var c, d, e = a.stack.split("\n"), f = b.stack.split("\n"), g = -1, h = -1, i = 0; i < e.length; ++i) {
                                        var j = E(e[i]);
                                        if (j) {
                                            c = j.fileName, g = j.line;
                                            break;
                                        }
                                    }
                                    for (var i = 0; i < f.length; ++i) {
                                        var j = E(f[i]);
                                        if (j) {
                                            d = j.fileName, h = j.line;
                                            break;
                                        }
                                    }
                                    g < 0 || h < 0 || !c || !d || c !== d || g >= h || (da = function(a) {
                                        if (P.test(a)) return !0;
                                        var b = E(a);
                                        return !!(b && b.fileName === c && g <= b.line && b.line <= h);
                                    });
                                }
                            }
                            function G(a) {
                                this._parent = a, this._promisesCreated = 0;
                                var b = this._length = 1 + (void 0 === a ? 0 : a._length);
                                fa(this, G), b > 32 && this.uncycle();
                            }
                            var H, I, J, K = c._getDomain, L = c._async, M = b("./errors").Warning, N = b("./util"), O = N.canAttachTrace, P = /[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/, Q = /\((?:timers\.js):\d+:\d+\)/, R = /[\/<\(](.+?):(\d+):(\d+)\)?\s*$/, S = null, T = null, U = !1, V = !(0 == N.env("BLUEBIRD_DEBUG")), W = !(0 == N.env("BLUEBIRD_WARNINGS") || !V && !N.env("BLUEBIRD_WARNINGS")), X = !(0 == N.env("BLUEBIRD_LONG_STACK_TRACES") || !V && !N.env("BLUEBIRD_LONG_STACK_TRACES")), Y = 0 != N.env("BLUEBIRD_W_FORGOTTEN_RETURN") && (W || !!N.env("BLUEBIRD_W_FORGOTTEN_RETURN"));
                            c.prototype.suppressUnhandledRejections = function() {
                                var a = this._target();
                                a._bitField = -1048577 & a._bitField | 524288;
                            }, c.prototype._ensurePossibleRejectionHandled = function() {
                                if (0 == (524288 & this._bitField)) {
                                    this._setRejectionIsUnhandled();
                                    var a = this;
                                    setTimeout(function() {
                                        a._notifyUnhandledRejection();
                                    }, 1);
                                }
                            }, c.prototype._notifyUnhandledRejectionIsHandled = function() {
                                A("rejectionHandled", H, void 0, this);
                            }, c.prototype._setReturnedNonUndefined = function() {
                                this._bitField = 268435456 | this._bitField;
                            }, c.prototype._returnedNonUndefined = function() {
                                return 0 != (268435456 & this._bitField);
                            }, c.prototype._notifyUnhandledRejection = function() {
                                if (this._isRejectionUnhandled()) {
                                    var a = this._settledValue();
                                    this._setUnhandledRejectionIsNotified(), A("unhandledRejection", I, a, this);
                                }
                            }, c.prototype._setUnhandledRejectionIsNotified = function() {
                                this._bitField = 262144 | this._bitField;
                            }, c.prototype._unsetUnhandledRejectionIsNotified = function() {
                                this._bitField = -262145 & this._bitField;
                            }, c.prototype._isUnhandledRejectionNotified = function() {
                                return (262144 & this._bitField) > 0;
                            }, c.prototype._setRejectionIsUnhandled = function() {
                                this._bitField = 1048576 | this._bitField;
                            }, c.prototype._unsetRejectionIsUnhandled = function() {
                                this._bitField = -1048577 & this._bitField, this._isUnhandledRejectionNotified() && (this._unsetUnhandledRejectionIsNotified(), 
                                this._notifyUnhandledRejectionIsHandled());
                            }, c.prototype._isRejectionUnhandled = function() {
                                return (1048576 & this._bitField) > 0;
                            }, c.prototype._warn = function(a, b, c) {
                                return s(a, b, c || this);
                            }, c.onPossiblyUnhandledRejection = function(a) {
                                var b = K();
                                I = "function" == typeof a ? null === b ? a : N.domainBind(b, a) : void 0;
                            }, c.onUnhandledRejectionHandled = function(a) {
                                var b = K();
                                H = "function" == typeof a ? null === b ? a : N.domainBind(b, a) : void 0;
                            };
                            var Z = function() {};
                            c.longStackTraces = function() {
                                if (L.haveItemsQueued() && !ga.longStackTraces) throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");
                                if (!ga.longStackTraces && D()) {
                                    var a = c.prototype._captureStackTrace, b = c.prototype._attachExtraTrace;
                                    ga.longStackTraces = !0, Z = function() {
                                        if (L.haveItemsQueued() && !ga.longStackTraces) throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");
                                        c.prototype._captureStackTrace = a, c.prototype._attachExtraTrace = b, d.deactivateLongStackTraces(), 
                                        L.enableTrampoline(), ga.longStackTraces = !1;
                                    }, c.prototype._captureStackTrace = o, c.prototype._attachExtraTrace = p, d.activateLongStackTraces(), 
                                    L.disableTrampolineIfNecessary();
                                }
                            }, c.hasLongStackTraces = function() {
                                return ga.longStackTraces && D();
                            };
                            var $ = function() {
                                try {
                                    if ("function" == typeof CustomEvent) {
                                        var a = new CustomEvent("CustomEvent");
                                        return N.global.dispatchEvent(a), function(a, b) {
                                            var c = new CustomEvent(a.toLowerCase(), {
                                                detail: b,
                                                cancelable: !0
                                            });
                                            return !N.global.dispatchEvent(c);
                                        };
                                    }
                                    if ("function" == typeof Event) {
                                        var a = new Event("CustomEvent");
                                        return N.global.dispatchEvent(a), function(a, b) {
                                            var c = new Event(a.toLowerCase(), {
                                                cancelable: !0
                                            });
                                            return c.detail = b, !N.global.dispatchEvent(c);
                                        };
                                    }
                                    var a = document.createEvent("CustomEvent");
                                    return a.initCustomEvent("testingtheevent", !1, !0, {}), N.global.dispatchEvent(a), 
                                    function(a, b) {
                                        var c = document.createEvent("CustomEvent");
                                        return c.initCustomEvent(a.toLowerCase(), !1, !0, b), !N.global.dispatchEvent(c);
                                    };
                                } catch (a) {}
                                return function() {
                                    return !1;
                                };
                            }(), _ = function() {
                                return N.isNode ? function() {
                                    return a.emit.apply(a, arguments);
                                } : N.global ? function(a) {
                                    var b = "on" + a.toLowerCase(), c = N.global[b];
                                    return !!c && (c.apply(N.global, [].slice.call(arguments, 1)), !0);
                                } : function() {
                                    return !1;
                                };
                            }(), aa = {
                                promiseCreated: e,
                                promiseFulfilled: e,
                                promiseRejected: e,
                                promiseResolved: e,
                                promiseCancelled: e,
                                promiseChained: function(a, b, c) {
                                    return {
                                        promise: b,
                                        child: c
                                    };
                                },
                                warning: function(a, b) {
                                    return {
                                        warning: b
                                    };
                                },
                                unhandledRejection: function(a, b, c) {
                                    return {
                                        reason: b,
                                        promise: c
                                    };
                                },
                                rejectionHandled: e
                            }, ba = function(a) {
                                var b = !1;
                                try {
                                    b = _.apply(null, arguments);
                                } catch (a) {
                                    L.throwLater(a), b = !0;
                                }
                                var c = !1;
                                try {
                                    c = $(a, aa[a].apply(null, arguments));
                                } catch (a) {
                                    L.throwLater(a), c = !0;
                                }
                                return c || b;
                            };
                            c.config = function(a) {
                                if (a = Object(a), "longStackTraces" in a && (a.longStackTraces ? c.longStackTraces() : !a.longStackTraces && c.hasLongStackTraces() && Z()), 
                                "warnings" in a) {
                                    var b = a.warnings;
                                    ga.warnings = !!b, Y = ga.warnings, N.isObject(b) && "wForgottenReturn" in b && (Y = !!b.wForgottenReturn);
                                }
                                if ("cancellation" in a && a.cancellation && !ga.cancellation) {
                                    if (L.haveItemsQueued()) throw new Error("cannot enable cancellation after promises are in use");
                                    c.prototype._clearCancellationData = k, c.prototype._propagateFrom = l, c.prototype._onCancel = i, 
                                    c.prototype._setOnCancel = j, c.prototype._attachCancellationCallback = h, c.prototype._execute = g, 
                                    ca = l, ga.cancellation = !0;
                                }
                                return "monitoring" in a && (a.monitoring && !ga.monitoring ? (ga.monitoring = !0, 
                                c.prototype._fireEvent = ba) : !a.monitoring && ga.monitoring && (ga.monitoring = !1, 
                                c.prototype._fireEvent = f)), c;
                            }, c.prototype._fireEvent = f, c.prototype._execute = function(a, b, c) {
                                try {
                                    a(b, c);
                                } catch (a) {
                                    return a;
                                }
                            }, c.prototype._onCancel = function() {}, c.prototype._setOnCancel = function(a) {}, 
                            c.prototype._attachCancellationCallback = function(a) {}, c.prototype._captureStackTrace = function() {}, 
                            c.prototype._attachExtraTrace = function() {}, c.prototype._clearCancellationData = function() {}, 
                            c.prototype._propagateFrom = function(a, b) {};
                            var ca = m, da = function() {
                                return !1;
                            }, ea = /[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;
                            N.inherits(G, Error), d.CapturedTrace = G, G.prototype.uncycle = function() {
                                var a = this._length;
                                if (!(a < 2)) {
                                    for (var b = [], c = {}, d = 0, e = this; void 0 !== e; ++d) b.push(e), e = e._parent;
                                    a = this._length = d;
                                    for (var d = a - 1; d >= 0; --d) {
                                        var f = b[d].stack;
                                        void 0 === c[f] && (c[f] = d);
                                    }
                                    for (var d = 0; d < a; ++d) {
                                        var g = b[d].stack, h = c[g];
                                        if (void 0 !== h && h !== d) {
                                            h > 0 && (b[h - 1]._parent = void 0, b[h - 1]._length = 1), b[d]._parent = void 0, 
                                            b[d]._length = 1;
                                            var i = d > 0 ? b[d - 1] : this;
                                            h < a - 1 ? (i._parent = b[h + 1], i._parent.uncycle(), i._length = i._parent._length + 1) : (i._parent = void 0, 
                                            i._length = 1);
                                            for (var j = i._length + 1, k = d - 2; k >= 0; --k) b[k]._length = j, j++;
                                            return;
                                        }
                                    }
                                }
                            }, G.prototype.attachExtraTrace = function(a) {
                                if (!a.__stackCleaned__) {
                                    this.uncycle();
                                    for (var b = y(a), c = b.message, d = [ b.stack ], e = this; void 0 !== e; ) d.push(w(e.stack.split("\n"))), 
                                    e = e._parent;
                                    v(d), u(d), N.notEnumerableProp(a, "stack", t(c, d)), N.notEnumerableProp(a, "__stackCleaned__", !0);
                                }
                            };
                            var fa = function() {
                                var a = /^\s*at\s*/, b = function(a, b) {
                                    return "string" == typeof a ? a : void 0 !== b.name && void 0 !== b.message ? b.toString() : B(b);
                                };
                                if ("number" == typeof Error.stackTraceLimit && "function" == typeof Error.captureStackTrace) {
                                    Error.stackTraceLimit += 6, S = a, T = b;
                                    var c = Error.captureStackTrace;
                                    return da = function(a) {
                                        return P.test(a);
                                    }, function(a, b) {
                                        Error.stackTraceLimit += 6, c(a, b), Error.stackTraceLimit -= 6;
                                    };
                                }
                                var d = new Error();
                                if ("string" == typeof d.stack && d.stack.split("\n")[0].indexOf("stackDetection@") >= 0) return S = /@/, 
                                T = b, U = !0, function(a) {
                                    a.stack = new Error().stack;
                                };
                                var e;
                                try {
                                    throw new Error();
                                } catch (a) {
                                    e = "stack" in a;
                                }
                                return "stack" in d || !e || "number" != typeof Error.stackTraceLimit ? (T = function(a, b) {
                                    return "string" == typeof a ? a : "object" != typeof b && "function" != typeof b || void 0 === b.name || void 0 === b.message ? B(b) : b.toString();
                                }, null) : (S = a, T = b, function(a) {
                                    Error.stackTraceLimit += 6;
                                    try {
                                        throw new Error();
                                    } catch (b) {
                                        a.stack = b.stack;
                                    }
                                    Error.stackTraceLimit -= 6;
                                });
                            }();
                            "undefined" != typeof console && void 0 !== console.warn && (J = function(a) {
                                console.warn(a);
                            }, N.isNode && a.stderr.isTTY ? J = function(a, b) {
                                var c = b ? "[33m" : "[31m";
                                console.warn(c + a + "[0m\n");
                            } : N.isNode || "string" != typeof new Error().stack || (J = function(a, b) {
                                console.warn("%c" + a, b ? "color: darkorange" : "color: red");
                            }));
                            var ga = {
                                warnings: W,
                                longStackTraces: !1,
                                cancellation: !1,
                                monitoring: !1
                            };
                            return X && c.longStackTraces(), {
                                longStackTraces: function() {
                                    return ga.longStackTraces;
                                },
                                warnings: function() {
                                    return ga.warnings;
                                },
                                cancellation: function() {
                                    return ga.cancellation;
                                },
                                monitoring: function() {
                                    return ga.monitoring;
                                },
                                propagateFromFunction: function() {
                                    return ca;
                                },
                                boundValueFunction: function() {
                                    return n;
                                },
                                checkForgottenReturns: q,
                                setBounds: F,
                                warn: s,
                                deprecated: r,
                                CapturedTrace: G,
                                fireDomEvent: $,
                                fireGlobalEvent: _
                            };
                        };
                    }, {
                        "./errors": 12,
                        "./util": 36
                    } ],
                    10: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(a) {
                            function b() {
                                return this.value;
                            }
                            function c() {
                                throw this.reason;
                            }
                            a.prototype.return = a.prototype.thenReturn = function(c) {
                                return c instanceof a && c.suppressUnhandledRejections(), this._then(b, void 0, void 0, {
                                    value: c
                                }, void 0);
                            }, a.prototype.throw = a.prototype.thenThrow = function(a) {
                                return this._then(c, void 0, void 0, {
                                    reason: a
                                }, void 0);
                            }, a.prototype.catchThrow = function(a) {
                                if (arguments.length <= 1) return this._then(void 0, c, void 0, {
                                    reason: a
                                }, void 0);
                                var b = arguments[1], d = function() {
                                    throw b;
                                };
                                return this.caught(a, d);
                            }, a.prototype.catchReturn = function(c) {
                                if (arguments.length <= 1) return c instanceof a && c.suppressUnhandledRejections(), 
                                this._then(void 0, b, void 0, {
                                    value: c
                                }, void 0);
                                var d = arguments[1];
                                d instanceof a && d.suppressUnhandledRejections();
                                var e = function() {
                                    return d;
                                };
                                return this.caught(c, e);
                            };
                        };
                    }, {} ],
                    11: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(a, b) {
                            function c() {
                                return f(this);
                            }
                            function d(a, c) {
                                return e(a, c, b, b);
                            }
                            var e = a.reduce, f = a.all;
                            a.prototype.each = function(a) {
                                return e(this, a, b, 0)._then(c, void 0, void 0, this, void 0);
                            }, a.prototype.mapSeries = function(a) {
                                return e(this, a, b, b);
                            }, a.each = function(a, d) {
                                return e(a, d, b, 0)._then(c, void 0, void 0, a, void 0);
                            }, a.mapSeries = d;
                        };
                    }, {} ],
                    12: [ function(a, b, c) {
                        "use strict";
                        function d(a, b) {
                            function c(d) {
                                if (!(this instanceof c)) return new c(d);
                                l(this, "message", "string" == typeof d ? d : b), l(this, "name", a), Error.captureStackTrace ? Error.captureStackTrace(this, this.constructor) : Error.call(this);
                            }
                            return k(c, Error), c;
                        }
                        function e(a) {
                            if (!(this instanceof e)) return new e(a);
                            l(this, "name", "OperationalError"), l(this, "message", a), this.cause = a, this.isOperational = !0, 
                            a instanceof Error ? (l(this, "message", a.message), l(this, "stack", a.stack)) : Error.captureStackTrace && Error.captureStackTrace(this, this.constructor);
                        }
                        var f, g, h = a("./es5"), i = h.freeze, j = a("./util"), k = j.inherits, l = j.notEnumerableProp, m = d("Warning", "warning"), n = d("CancellationError", "cancellation error"), o = d("TimeoutError", "timeout error"), p = d("AggregateError", "aggregate error");
                        try {
                            f = TypeError, g = RangeError;
                        } catch (a) {
                            f = d("TypeError", "type error"), g = d("RangeError", "range error");
                        }
                        for (var q = "join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "), r = 0; r < q.length; ++r) "function" == typeof Array.prototype[q[r]] && (p.prototype[q[r]] = Array.prototype[q[r]]);
                        h.defineProperty(p.prototype, "length", {
                            value: 0,
                            configurable: !1,
                            writable: !0,
                            enumerable: !0
                        }), p.prototype.isOperational = !0;
                        var s = 0;
                        p.prototype.toString = function() {
                            var a = Array(4 * s + 1).join(" "), b = "\n" + a + "AggregateError of:\n";
                            s++, a = Array(4 * s + 1).join(" ");
                            for (var c = 0; c < this.length; ++c) {
                                for (var d = this[c] === this ? "[Circular AggregateError]" : this[c] + "", e = d.split("\n"), f = 0; f < e.length; ++f) e[f] = a + e[f];
                                d = e.join("\n"), b += d + "\n";
                            }
                            return s--, b;
                        }, k(e, Error);
                        var t = Error.__BluebirdErrorTypes__;
                        t || (t = i({
                            CancellationError: n,
                            TimeoutError: o,
                            OperationalError: e,
                            RejectionError: e,
                            AggregateError: p
                        }), h.defineProperty(Error, "__BluebirdErrorTypes__", {
                            value: t,
                            writable: !1,
                            enumerable: !1,
                            configurable: !1
                        })), b.exports = {
                            Error: Error,
                            TypeError: f,
                            RangeError: g,
                            CancellationError: t.CancellationError,
                            OperationalError: t.OperationalError,
                            TimeoutError: t.TimeoutError,
                            AggregateError: t.AggregateError,
                            Warning: m
                        };
                    }, {
                        "./es5": 13,
                        "./util": 36
                    } ],
                    13: [ function(a, b, c) {
                        var d = function() {
                            "use strict";
                            return void 0 === this;
                        }();
                        if (d) b.exports = {
                            freeze: Object.freeze,
                            defineProperty: Object.defineProperty,
                            getDescriptor: Object.getOwnPropertyDescriptor,
                            keys: Object.keys,
                            names: Object.getOwnPropertyNames,
                            getPrototypeOf: Object.getPrototypeOf,
                            isArray: Array.isArray,
                            isES5: d,
                            propertyIsWritable: function(a, b) {
                                var c = Object.getOwnPropertyDescriptor(a, b);
                                return !(c && !c.writable && !c.set);
                            }
                        }; else {
                            var e = {}.hasOwnProperty, f = {}.toString, g = {}.constructor.prototype, h = function(a) {
                                var b = [];
                                for (var c in a) e.call(a, c) && b.push(c);
                                return b;
                            }, i = function(a, b) {
                                return {
                                    value: a[b]
                                };
                            }, j = function(a, b, c) {
                                return a[b] = c.value, a;
                            }, k = function(a) {
                                return a;
                            }, l = function(a) {
                                try {
                                    return Object(a).constructor.prototype;
                                } catch (a) {
                                    return g;
                                }
                            }, m = function(a) {
                                try {
                                    return "[object Array]" === f.call(a);
                                } catch (a) {
                                    return !1;
                                }
                            };
                            b.exports = {
                                isArray: m,
                                keys: h,
                                names: h,
                                defineProperty: j,
                                getDescriptor: i,
                                freeze: k,
                                getPrototypeOf: l,
                                isES5: d,
                                propertyIsWritable: function() {
                                    return !0;
                                }
                            };
                        }
                    }, {} ],
                    14: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(a, b) {
                            var c = a.map;
                            a.prototype.filter = function(a, d) {
                                return c(this, a, d, b);
                            }, a.filter = function(a, d, e) {
                                return c(a, d, e, b);
                            };
                        };
                    }, {} ],
                    15: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d) {
                            function e(a, b, c) {
                                this.promise = a, this.type = b, this.handler = c, this.called = !1, this.cancelPromise = null;
                            }
                            function f(a) {
                                this.finallyHandler = a;
                            }
                            function g(a, b) {
                                return null != a.cancelPromise && (arguments.length > 1 ? a.cancelPromise._reject(b) : a.cancelPromise._cancel(), 
                                a.cancelPromise = null, !0);
                            }
                            function h() {
                                return j.call(this, this.promise._target()._settledValue());
                            }
                            function i(a) {
                                if (!g(this, a)) return m.e = a, m;
                            }
                            function j(a) {
                                var e = this.promise, j = this.handler;
                                if (!this.called) {
                                    this.called = !0;
                                    var k = this.isFinallyHandler() ? j.call(e._boundValue()) : j.call(e._boundValue(), a);
                                    if (k === d) return k;
                                    if (void 0 !== k) {
                                        e._setReturnedNonUndefined();
                                        var n = c(k, e);
                                        if (n instanceof b) {
                                            if (null != this.cancelPromise) {
                                                if (n._isCancelled()) {
                                                    var o = new l("late cancellation observer");
                                                    return e._attachExtraTrace(o), m.e = o, m;
                                                }
                                                n.isPending() && n._attachCancellationCallback(new f(this));
                                            }
                                            return n._then(h, i, void 0, this, void 0);
                                        }
                                    }
                                }
                                return e.isRejected() ? (g(this), m.e = a, m) : (g(this), a);
                            }
                            var k = a("./util"), l = b.CancellationError, m = k.errorObj, n = a("./catch_filter")(d);
                            return e.prototype.isFinallyHandler = function() {
                                return 0 === this.type;
                            }, f.prototype._resultCancelled = function() {
                                g(this.finallyHandler);
                            }, b.prototype._passThrough = function(a, b, c, d) {
                                return "function" != typeof a ? this.then() : this._then(c, d, void 0, new e(this, b, a), void 0);
                            }, b.prototype.lastly = b.prototype.finally = function(a) {
                                return this._passThrough(a, 0, j, j);
                            }, b.prototype.tap = function(a) {
                                return this._passThrough(a, 1, j);
                            }, b.prototype.tapCatch = function(a) {
                                var c = arguments.length;
                                if (1 === c) return this._passThrough(a, 1, void 0, j);
                                var d, e = new Array(c - 1), f = 0;
                                for (d = 0; d < c - 1; ++d) {
                                    var g = arguments[d];
                                    if (!k.isObject(g)) return b.reject(new TypeError("tapCatch statement predicate: expecting an object but got " + k.classString(g)));
                                    e[f++] = g;
                                }
                                e.length = f;
                                var h = arguments[d];
                                return this._passThrough(n(e, h, this), 1, void 0, j);
                            }, e;
                        };
                    }, {
                        "./catch_filter": 7,
                        "./util": 36
                    } ],
                    16: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d, e, f, g) {
                            function h(a, c, d) {
                                for (var f = 0; f < c.length; ++f) {
                                    d._pushContext();
                                    var g = n(c[f])(a);
                                    if (d._popContext(), g === m) {
                                        d._pushContext();
                                        var h = b.reject(m.e);
                                        return d._popContext(), h;
                                    }
                                    var i = e(g, d);
                                    if (i instanceof b) return i;
                                }
                                return null;
                            }
                            function i(a, c, e, f) {
                                if (g.cancellation()) {
                                    var h = new b(d), i = this._finallyPromise = new b(d);
                                    this._promise = h.lastly(function() {
                                        return i;
                                    }), h._captureStackTrace(), h._setOnCancel(this);
                                } else {
                                    (this._promise = new b(d))._captureStackTrace();
                                }
                                this._stack = f, this._generatorFunction = a, this._receiver = c, this._generator = void 0, 
                                this._yieldHandlers = "function" == typeof e ? [ e ].concat(o) : o, this._yieldedPromise = null, 
                                this._cancellationPhase = !1;
                            }
                            var j = a("./errors"), k = j.TypeError, l = a("./util"), m = l.errorObj, n = l.tryCatch, o = [];
                            l.inherits(i, f), i.prototype._isResolved = function() {
                                return null === this._promise;
                            }, i.prototype._cleanup = function() {
                                this._promise = this._generator = null, g.cancellation() && null !== this._finallyPromise && (this._finallyPromise._fulfill(), 
                                this._finallyPromise = null);
                            }, i.prototype._promiseCancelled = function() {
                                if (!this._isResolved()) {
                                    var a, c = void 0 !== this._generator.return;
                                    if (c) this._promise._pushContext(), a = n(this._generator.return).call(this._generator, void 0), 
                                    this._promise._popContext(); else {
                                        var d = new b.CancellationError("generator .return() sentinel");
                                        b.coroutine.returnSentinel = d, this._promise._attachExtraTrace(d), this._promise._pushContext(), 
                                        a = n(this._generator.throw).call(this._generator, d), this._promise._popContext();
                                    }
                                    this._cancellationPhase = !0, this._yieldedPromise = null, this._continue(a);
                                }
                            }, i.prototype._promiseFulfilled = function(a) {
                                this._yieldedPromise = null, this._promise._pushContext();
                                var b = n(this._generator.next).call(this._generator, a);
                                this._promise._popContext(), this._continue(b);
                            }, i.prototype._promiseRejected = function(a) {
                                this._yieldedPromise = null, this._promise._attachExtraTrace(a), this._promise._pushContext();
                                var b = n(this._generator.throw).call(this._generator, a);
                                this._promise._popContext(), this._continue(b);
                            }, i.prototype._resultCancelled = function() {
                                if (this._yieldedPromise instanceof b) {
                                    var a = this._yieldedPromise;
                                    this._yieldedPromise = null, a.cancel();
                                }
                            }, i.prototype.promise = function() {
                                return this._promise;
                            }, i.prototype._run = function() {
                                this._generator = this._generatorFunction.call(this._receiver), this._receiver = this._generatorFunction = void 0, 
                                this._promiseFulfilled(void 0);
                            }, i.prototype._continue = function(a) {
                                var c = this._promise;
                                if (a === m) return this._cleanup(), this._cancellationPhase ? c.cancel() : c._rejectCallback(a.e, !1);
                                var d = a.value;
                                if (!0 === a.done) return this._cleanup(), this._cancellationPhase ? c.cancel() : c._resolveCallback(d);
                                var f = e(d, this._promise);
                                if (!(f instanceof b) && null === (f = h(f, this._yieldHandlers, this._promise))) return void this._promiseRejected(new k("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s", String(d)) + "From coroutine:\n" + this._stack.split("\n").slice(1, -7).join("\n")));
                                f = f._target();
                                var g = f._bitField;
                                0 == (50397184 & g) ? (this._yieldedPromise = f, f._proxy(this, null)) : 0 != (33554432 & g) ? b._async.invoke(this._promiseFulfilled, this, f._value()) : 0 != (16777216 & g) ? b._async.invoke(this._promiseRejected, this, f._reason()) : this._promiseCancelled();
                            }, b.coroutine = function(a, b) {
                                if ("function" != typeof a) throw new k("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");
                                var c = Object(b).yieldHandler, d = i, e = new Error().stack;
                                return function() {
                                    var b = a.apply(this, arguments), f = new d(void 0, void 0, c, e), g = f.promise();
                                    return f._generator = b, f._promiseFulfilled(void 0), g;
                                };
                            }, b.coroutine.addYieldHandler = function(a) {
                                if ("function" != typeof a) throw new k("expecting a function but got " + l.classString(a));
                                o.push(a);
                            }, b.spawn = function(a) {
                                if (g.deprecated("Promise.spawn()", "Promise.coroutine()"), "function" != typeof a) return c("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");
                                var d = new i(a, this), e = d.promise();
                                return d._run(b.spawn), e;
                            };
                        };
                    }, {
                        "./errors": 12,
                        "./util": 36
                    } ],
                    17: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d, e, f, g) {
                            var h = a("./util");
                            h.canEvaluate, h.tryCatch, h.errorObj;
                            b.join = function() {
                                var a, b = arguments.length - 1;
                                if (b > 0 && "function" == typeof arguments[b]) {
                                    a = arguments[b];
                                    var d;
                                }
                                var e = [].slice.call(arguments);
                                a && e.pop();
                                var d = new c(e).promise();
                                return void 0 !== a ? d.spread(a) : d;
                            };
                        };
                    }, {
                        "./util": 36
                    } ],
                    18: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d, e, f, g) {
                            function h(a, b, c, d) {
                                this.constructor$(a), this._promise._captureStackTrace();
                                var e = j();
                                this._callback = null === e ? b : k.domainBind(e, b), this._preservedValues = d === f ? new Array(this.length()) : null, 
                                this._limit = c, this._inFlight = 0, this._queue = [], n.invoke(this._asyncInit, this, void 0);
                            }
                            function i(a, c, e, f) {
                                if ("function" != typeof c) return d("expecting a function but got " + k.classString(c));
                                var g = 0;
                                if (void 0 !== e) {
                                    if ("object" != typeof e || null === e) return b.reject(new TypeError("options argument must be an object but it is " + k.classString(e)));
                                    if ("number" != typeof e.concurrency) return b.reject(new TypeError("'concurrency' must be a number but it is " + k.classString(e.concurrency)));
                                    g = e.concurrency;
                                }
                                return g = "number" == typeof g && isFinite(g) && g >= 1 ? g : 0, new h(a, c, g, f).promise();
                            }
                            var j = b._getDomain, k = a("./util"), l = k.tryCatch, m = k.errorObj, n = b._async;
                            k.inherits(h, c), h.prototype._asyncInit = function() {
                                this._init$(void 0, -2);
                            }, h.prototype._init = function() {}, h.prototype._promiseFulfilled = function(a, c) {
                                var d = this._values, f = this.length(), h = this._preservedValues, i = this._limit;
                                if (c < 0) {
                                    if (c = -1 * c - 1, d[c] = a, i >= 1 && (this._inFlight--, this._drainQueue(), this._isResolved())) return !0;
                                } else {
                                    if (i >= 1 && this._inFlight >= i) return d[c] = a, this._queue.push(c), !1;
                                    null !== h && (h[c] = a);
                                    var j = this._promise, k = this._callback, n = j._boundValue();
                                    j._pushContext();
                                    var o = l(k).call(n, a, c, f), p = j._popContext();
                                    if (g.checkForgottenReturns(o, p, null !== h ? "Promise.filter" : "Promise.map", j), 
                                    o === m) return this._reject(o.e), !0;
                                    var q = e(o, this._promise);
                                    if (q instanceof b) {
                                        q = q._target();
                                        var r = q._bitField;
                                        if (0 == (50397184 & r)) return i >= 1 && this._inFlight++, d[c] = q, q._proxy(this, -1 * (c + 1)), 
                                        !1;
                                        if (0 == (33554432 & r)) return 0 != (16777216 & r) ? (this._reject(q._reason()), 
                                        !0) : (this._cancel(), !0);
                                        o = q._value();
                                    }
                                    d[c] = o;
                                }
                                return ++this._totalResolved >= f && (null !== h ? this._filter(d, h) : this._resolve(d), 
                                !0);
                            }, h.prototype._drainQueue = function() {
                                for (var a = this._queue, b = this._limit, c = this._values; a.length > 0 && this._inFlight < b; ) {
                                    if (this._isResolved()) return;
                                    var d = a.pop();
                                    this._promiseFulfilled(c[d], d);
                                }
                            }, h.prototype._filter = function(a, b) {
                                for (var c = b.length, d = new Array(c), e = 0, f = 0; f < c; ++f) a[f] && (d[e++] = b[f]);
                                d.length = e, this._resolve(d);
                            }, h.prototype.preservedValues = function() {
                                return this._preservedValues;
                            }, b.prototype.map = function(a, b) {
                                return i(this, a, b, null);
                            }, b.map = function(a, b, c, d) {
                                return i(a, b, c, d);
                            };
                        };
                    }, {
                        "./util": 36
                    } ],
                    19: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d, e, f) {
                            var g = a("./util"), h = g.tryCatch;
                            b.method = function(a) {
                                if ("function" != typeof a) throw new b.TypeError("expecting a function but got " + g.classString(a));
                                return function() {
                                    var d = new b(c);
                                    d._captureStackTrace(), d._pushContext();
                                    var e = h(a).apply(this, arguments), g = d._popContext();
                                    return f.checkForgottenReturns(e, g, "Promise.method", d), d._resolveFromSyncValue(e), 
                                    d;
                                };
                            }, b.attempt = b.try = function(a) {
                                if ("function" != typeof a) return e("expecting a function but got " + g.classString(a));
                                var d = new b(c);
                                d._captureStackTrace(), d._pushContext();
                                var i;
                                if (arguments.length > 1) {
                                    f.deprecated("calling Promise.try with more than 1 argument");
                                    var j = arguments[1], k = arguments[2];
                                    i = g.isArray(j) ? h(a).apply(k, j) : h(a).call(k, j);
                                } else i = h(a)();
                                var l = d._popContext();
                                return f.checkForgottenReturns(i, l, "Promise.try", d), d._resolveFromSyncValue(i), 
                                d;
                            }, b.prototype._resolveFromSyncValue = function(a) {
                                a === g.errorObj ? this._rejectCallback(a.e, !1) : this._resolveCallback(a, !0);
                            };
                        };
                    }, {
                        "./util": 36
                    } ],
                    20: [ function(a, b, c) {
                        "use strict";
                        function d(a) {
                            return a instanceof Error && k.getPrototypeOf(a) === Error.prototype;
                        }
                        function e(a) {
                            var b;
                            if (d(a)) {
                                b = new j(a), b.name = a.name, b.message = a.message, b.stack = a.stack;
                                for (var c = k.keys(a), e = 0; e < c.length; ++e) {
                                    var f = c[e];
                                    l.test(f) || (b[f] = a[f]);
                                }
                                return b;
                            }
                            return g.markAsOriginatingFromRejection(a), a;
                        }
                        function f(a, b) {
                            return function(c, d) {
                                if (null !== a) {
                                    if (c) {
                                        var f = e(h(c));
                                        a._attachExtraTrace(f), a._reject(f);
                                    } else if (b) {
                                        var g = [].slice.call(arguments, 1);
                                        a._fulfill(g);
                                    } else a._fulfill(d);
                                    a = null;
                                }
                            };
                        }
                        var g = a("./util"), h = g.maybeWrapAsError, i = a("./errors"), j = i.OperationalError, k = a("./es5"), l = /^(?:name|message|stack|cause)$/;
                        b.exports = f;
                    }, {
                        "./errors": 12,
                        "./es5": 13,
                        "./util": 36
                    } ],
                    21: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b) {
                            function c(a, b) {
                                var c = this;
                                if (!f.isArray(a)) return d.call(c, a, b);
                                var e = h(b).apply(c._boundValue(), [ null ].concat(a));
                                e === i && g.throwLater(e.e);
                            }
                            function d(a, b) {
                                var c = this, d = c._boundValue(), e = void 0 === a ? h(b).call(d, null) : h(b).call(d, null, a);
                                e === i && g.throwLater(e.e);
                            }
                            function e(a, b) {
                                var c = this;
                                if (!a) {
                                    var d = new Error(a + "");
                                    d.cause = a, a = d;
                                }
                                var e = h(b).call(c._boundValue(), a);
                                e === i && g.throwLater(e.e);
                            }
                            var f = a("./util"), g = b._async, h = f.tryCatch, i = f.errorObj;
                            b.prototype.asCallback = b.prototype.nodeify = function(a, b) {
                                if ("function" == typeof a) {
                                    var f = d;
                                    void 0 !== b && Object(b).spread && (f = c), this._then(f, e, void 0, this, a);
                                }
                                return this;
                            };
                        };
                    }, {
                        "./util": 36
                    } ],
                    22: [ function(b, c, d) {
                        "use strict";
                        c.exports = function() {
                            function d() {}
                            function e(a, b) {
                                if (null == a || a.constructor !== f) throw new t("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");
                                if ("function" != typeof b) throw new t("expecting a function but got " + o.classString(b));
                            }
                            function f(a) {
                                a !== v && e(this, a), this._bitField = 0, this._fulfillmentHandler0 = void 0, this._rejectionHandler0 = void 0, 
                                this._promise0 = void 0, this._receiver0 = void 0, this._resolveFromExecutor(a), 
                                this._promiseCreated(), this._fireEvent("promiseCreated", this);
                            }
                            function g(a) {
                                this.promise._resolveCallback(a);
                            }
                            function h(a) {
                                this.promise._rejectCallback(a, !1);
                            }
                            function i(a) {
                                var b = new f(v);
                                b._fulfillmentHandler0 = a, b._rejectionHandler0 = a, b._promise0 = a, b._receiver0 = a;
                            }
                            var j, k = function() {
                                return new t("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n");
                            }, l = function() {
                                return new f.PromiseInspection(this._target());
                            }, m = function(a) {
                                return f.reject(new t(a));
                            }, n = {}, o = b("./util");
                            j = o.isNode ? function() {
                                var b = a.domain;
                                return void 0 === b && (b = null), b;
                            } : function() {
                                return null;
                            }, o.notEnumerableProp(f, "_getDomain", j);
                            var p = b("./es5"), q = b("./async"), r = new q();
                            p.defineProperty(f, "_async", {
                                value: r
                            });
                            var s = b("./errors"), t = f.TypeError = s.TypeError;
                            f.RangeError = s.RangeError;
                            var u = f.CancellationError = s.CancellationError;
                            f.TimeoutError = s.TimeoutError, f.OperationalError = s.OperationalError, f.RejectionError = s.OperationalError, 
                            f.AggregateError = s.AggregateError;
                            var v = function() {}, w = {}, x = {}, y = b("./thenables")(f, v), z = b("./promise_array")(f, v, y, m, d), A = b("./context")(f), B = A.create, C = b("./debuggability")(f, A), D = (C.CapturedTrace, 
                            b("./finally")(f, y, x)), E = b("./catch_filter")(x), F = b("./nodeback"), G = o.errorObj, H = o.tryCatch;
                            return f.prototype.toString = function() {
                                return "[object Promise]";
                            }, f.prototype.caught = f.prototype.catch = function(a) {
                                var b = arguments.length;
                                if (b > 1) {
                                    var c, d = new Array(b - 1), e = 0;
                                    for (c = 0; c < b - 1; ++c) {
                                        var f = arguments[c];
                                        if (!o.isObject(f)) return m("Catch statement predicate: expecting an object but got " + o.classString(f));
                                        d[e++] = f;
                                    }
                                    return d.length = e, a = arguments[c], this.then(void 0, E(d, a, this));
                                }
                                return this.then(void 0, a);
                            }, f.prototype.reflect = function() {
                                return this._then(l, l, void 0, this, void 0);
                            }, f.prototype.then = function(a, b) {
                                if (C.warnings() && arguments.length > 0 && "function" != typeof a && "function" != typeof b) {
                                    var c = ".then() only accepts functions but was passed: " + o.classString(a);
                                    arguments.length > 1 && (c += ", " + o.classString(b)), this._warn(c);
                                }
                                return this._then(a, b, void 0, void 0, void 0);
                            }, f.prototype.done = function(a, b) {
                                this._then(a, b, void 0, void 0, void 0)._setIsFinal();
                            }, f.prototype.spread = function(a) {
                                return "function" != typeof a ? m("expecting a function but got " + o.classString(a)) : this.all()._then(a, void 0, void 0, w, void 0);
                            }, f.prototype.toJSON = function() {
                                var a = {
                                    isFulfilled: !1,
                                    isRejected: !1,
                                    fulfillmentValue: void 0,
                                    rejectionReason: void 0
                                };
                                return this.isFulfilled() ? (a.fulfillmentValue = this.value(), a.isFulfilled = !0) : this.isRejected() && (a.rejectionReason = this.reason(), 
                                a.isRejected = !0), a;
                            }, f.prototype.all = function() {
                                return arguments.length > 0 && this._warn(".all() was passed arguments but it does not take any"), 
                                new z(this).promise();
                            }, f.prototype.error = function(a) {
                                return this.caught(o.originatesFromRejection, a);
                            }, f.getNewLibraryCopy = c.exports, f.is = function(a) {
                                return a instanceof f;
                            }, f.fromNode = f.fromCallback = function(a) {
                                var b = new f(v);
                                b._captureStackTrace();
                                var c = arguments.length > 1 && !!Object(arguments[1]).multiArgs, d = H(a)(F(b, c));
                                return d === G && b._rejectCallback(d.e, !0), b._isFateSealed() || b._setAsyncGuaranteed(), 
                                b;
                            }, f.all = function(a) {
                                return new z(a).promise();
                            }, f.cast = function(a) {
                                var b = y(a);
                                return b instanceof f || (b = new f(v), b._captureStackTrace(), b._setFulfilled(), 
                                b._rejectionHandler0 = a), b;
                            }, f.resolve = f.fulfilled = f.cast, f.reject = f.rejected = function(a) {
                                var b = new f(v);
                                return b._captureStackTrace(), b._rejectCallback(a, !0), b;
                            }, f.setScheduler = function(a) {
                                if ("function" != typeof a) throw new t("expecting a function but got " + o.classString(a));
                                return r.setScheduler(a);
                            }, f.prototype._then = function(a, b, c, d, e) {
                                var g = void 0 !== e, h = g ? e : new f(v), i = this._target(), k = i._bitField;
                                g || (h._propagateFrom(this, 3), h._captureStackTrace(), void 0 === d && 0 != (2097152 & this._bitField) && (d = 0 != (50397184 & k) ? this._boundValue() : i === this ? void 0 : this._boundTo), 
                                this._fireEvent("promiseChained", this, h));
                                var l = j();
                                if (0 != (50397184 & k)) {
                                    var m, n, p = i._settlePromiseCtx;
                                    0 != (33554432 & k) ? (n = i._rejectionHandler0, m = a) : 0 != (16777216 & k) ? (n = i._fulfillmentHandler0, 
                                    m = b, i._unsetRejectionIsUnhandled()) : (p = i._settlePromiseLateCancellationObserver, 
                                    n = new u("late cancellation observer"), i._attachExtraTrace(n), m = b), r.invoke(p, i, {
                                        handler: null === l ? m : "function" == typeof m && o.domainBind(l, m),
                                        promise: h,
                                        receiver: d,
                                        value: n
                                    });
                                } else i._addCallbacks(a, b, h, d, l);
                                return h;
                            }, f.prototype._length = function() {
                                return 65535 & this._bitField;
                            }, f.prototype._isFateSealed = function() {
                                return 0 != (117506048 & this._bitField);
                            }, f.prototype._isFollowing = function() {
                                return 67108864 == (67108864 & this._bitField);
                            }, f.prototype._setLength = function(a) {
                                this._bitField = -65536 & this._bitField | 65535 & a;
                            }, f.prototype._setFulfilled = function() {
                                this._bitField = 33554432 | this._bitField, this._fireEvent("promiseFulfilled", this);
                            }, f.prototype._setRejected = function() {
                                this._bitField = 16777216 | this._bitField, this._fireEvent("promiseRejected", this);
                            }, f.prototype._setFollowing = function() {
                                this._bitField = 67108864 | this._bitField, this._fireEvent("promiseResolved", this);
                            }, f.prototype._setIsFinal = function() {
                                this._bitField = 4194304 | this._bitField;
                            }, f.prototype._isFinal = function() {
                                return (4194304 & this._bitField) > 0;
                            }, f.prototype._unsetCancelled = function() {
                                this._bitField = -65537 & this._bitField;
                            }, f.prototype._setCancelled = function() {
                                this._bitField = 65536 | this._bitField, this._fireEvent("promiseCancelled", this);
                            }, f.prototype._setWillBeCancelled = function() {
                                this._bitField = 8388608 | this._bitField;
                            }, f.prototype._setAsyncGuaranteed = function() {
                                r.hasCustomScheduler() || (this._bitField = 134217728 | this._bitField);
                            }, f.prototype._receiverAt = function(a) {
                                var b = 0 === a ? this._receiver0 : this[4 * a - 4 + 3];
                                if (b !== n) return void 0 === b && this._isBound() ? this._boundValue() : b;
                            }, f.prototype._promiseAt = function(a) {
                                return this[4 * a - 4 + 2];
                            }, f.prototype._fulfillmentHandlerAt = function(a) {
                                return this[4 * a - 4 + 0];
                            }, f.prototype._rejectionHandlerAt = function(a) {
                                return this[4 * a - 4 + 1];
                            }, f.prototype._boundValue = function() {}, f.prototype._migrateCallback0 = function(a) {
                                var b = (a._bitField, a._fulfillmentHandler0), c = a._rejectionHandler0, d = a._promise0, e = a._receiverAt(0);
                                void 0 === e && (e = n), this._addCallbacks(b, c, d, e, null);
                            }, f.prototype._migrateCallbackAt = function(a, b) {
                                var c = a._fulfillmentHandlerAt(b), d = a._rejectionHandlerAt(b), e = a._promiseAt(b), f = a._receiverAt(b);
                                void 0 === f && (f = n), this._addCallbacks(c, d, e, f, null);
                            }, f.prototype._addCallbacks = function(a, b, c, d, e) {
                                var f = this._length();
                                if (f >= 65531 && (f = 0, this._setLength(0)), 0 === f) this._promise0 = c, this._receiver0 = d, 
                                "function" == typeof a && (this._fulfillmentHandler0 = null === e ? a : o.domainBind(e, a)), 
                                "function" == typeof b && (this._rejectionHandler0 = null === e ? b : o.domainBind(e, b)); else {
                                    var g = 4 * f - 4;
                                    this[g + 2] = c, this[g + 3] = d, "function" == typeof a && (this[g + 0] = null === e ? a : o.domainBind(e, a)), 
                                    "function" == typeof b && (this[g + 1] = null === e ? b : o.domainBind(e, b));
                                }
                                return this._setLength(f + 1), f;
                            }, f.prototype._proxy = function(a, b) {
                                this._addCallbacks(void 0, void 0, b, a, null);
                            }, f.prototype._resolveCallback = function(a, b) {
                                if (0 == (117506048 & this._bitField)) {
                                    if (a === this) return this._rejectCallback(k(), !1);
                                    var c = y(a, this);
                                    if (!(c instanceof f)) return this._fulfill(a);
                                    b && this._propagateFrom(c, 2);
                                    var d = c._target();
                                    if (d === this) return void this._reject(k());
                                    var e = d._bitField;
                                    if (0 == (50397184 & e)) {
                                        var g = this._length();
                                        g > 0 && d._migrateCallback0(this);
                                        for (var h = 1; h < g; ++h) d._migrateCallbackAt(this, h);
                                        this._setFollowing(), this._setLength(0), this._setFollowee(d);
                                    } else if (0 != (33554432 & e)) this._fulfill(d._value()); else if (0 != (16777216 & e)) this._reject(d._reason()); else {
                                        var i = new u("late cancellation observer");
                                        d._attachExtraTrace(i), this._reject(i);
                                    }
                                }
                            }, f.prototype._rejectCallback = function(a, b, c) {
                                var d = o.ensureErrorObject(a), e = d === a;
                                if (!e && !c && C.warnings()) {
                                    var f = "a promise was rejected with a non-error: " + o.classString(a);
                                    this._warn(f, !0);
                                }
                                this._attachExtraTrace(d, !!b && e), this._reject(a);
                            }, f.prototype._resolveFromExecutor = function(a) {
                                if (a !== v) {
                                    var b = this;
                                    this._captureStackTrace(), this._pushContext();
                                    var c = !0, d = this._execute(a, function(a) {
                                        b._resolveCallback(a);
                                    }, function(a) {
                                        b._rejectCallback(a, c);
                                    });
                                    c = !1, this._popContext(), void 0 !== d && b._rejectCallback(d, !0);
                                }
                            }, f.prototype._settlePromiseFromHandler = function(a, b, c, d) {
                                var e = d._bitField;
                                if (0 == (65536 & e)) {
                                    d._pushContext();
                                    var f;
                                    b === w ? c && "number" == typeof c.length ? f = H(a).apply(this._boundValue(), c) : (f = G, 
                                    f.e = new t("cannot .spread() a non-array: " + o.classString(c))) : f = H(a).call(b, c);
                                    var g = d._popContext();
                                    e = d._bitField, 0 == (65536 & e) && (f === x ? d._reject(c) : f === G ? d._rejectCallback(f.e, !1) : (C.checkForgottenReturns(f, g, "", d, this), 
                                    d._resolveCallback(f)));
                                }
                            }, f.prototype._target = function() {
                                for (var a = this; a._isFollowing(); ) a = a._followee();
                                return a;
                            }, f.prototype._followee = function() {
                                return this._rejectionHandler0;
                            }, f.prototype._setFollowee = function(a) {
                                this._rejectionHandler0 = a;
                            }, f.prototype._settlePromise = function(a, b, c, e) {
                                var g = a instanceof f, h = this._bitField, i = 0 != (134217728 & h);
                                0 != (65536 & h) ? (g && a._invokeInternalOnCancel(), c instanceof D && c.isFinallyHandler() ? (c.cancelPromise = a, 
                                H(b).call(c, e) === G && a._reject(G.e)) : b === l ? a._fulfill(l.call(c)) : c instanceof d ? c._promiseCancelled(a) : g || a instanceof z ? a._cancel() : c.cancel()) : "function" == typeof b ? g ? (i && a._setAsyncGuaranteed(), 
                                this._settlePromiseFromHandler(b, c, e, a)) : b.call(c, e, a) : c instanceof d ? c._isResolved() || (0 != (33554432 & h) ? c._promiseFulfilled(e, a) : c._promiseRejected(e, a)) : g && (i && a._setAsyncGuaranteed(), 
                                0 != (33554432 & h) ? a._fulfill(e) : a._reject(e));
                            }, f.prototype._settlePromiseLateCancellationObserver = function(a) {
                                var b = a.handler, c = a.promise, d = a.receiver, e = a.value;
                                "function" == typeof b ? c instanceof f ? this._settlePromiseFromHandler(b, d, e, c) : b.call(d, e, c) : c instanceof f && c._reject(e);
                            }, f.prototype._settlePromiseCtx = function(a) {
                                this._settlePromise(a.promise, a.handler, a.receiver, a.value);
                            }, f.prototype._settlePromise0 = function(a, b, c) {
                                var d = this._promise0, e = this._receiverAt(0);
                                this._promise0 = void 0, this._receiver0 = void 0, this._settlePromise(d, a, e, b);
                            }, f.prototype._clearCallbackDataAtIndex = function(a) {
                                var b = 4 * a - 4;
                                this[b + 2] = this[b + 3] = this[b + 0] = this[b + 1] = void 0;
                            }, f.prototype._fulfill = function(a) {
                                var b = this._bitField;
                                if (!((117506048 & b) >>> 16)) {
                                    if (a === this) {
                                        var c = k();
                                        return this._attachExtraTrace(c), this._reject(c);
                                    }
                                    this._setFulfilled(), this._rejectionHandler0 = a, (65535 & b) > 0 && (0 != (134217728 & b) ? this._settlePromises() : r.settlePromises(this));
                                }
                            }, f.prototype._reject = function(a) {
                                var b = this._bitField;
                                if (!((117506048 & b) >>> 16)) {
                                    if (this._setRejected(), this._fulfillmentHandler0 = a, this._isFinal()) return r.fatalError(a, o.isNode);
                                    (65535 & b) > 0 ? r.settlePromises(this) : this._ensurePossibleRejectionHandled();
                                }
                            }, f.prototype._fulfillPromises = function(a, b) {
                                for (var c = 1; c < a; c++) {
                                    var d = this._fulfillmentHandlerAt(c), e = this._promiseAt(c), f = this._receiverAt(c);
                                    this._clearCallbackDataAtIndex(c), this._settlePromise(e, d, f, b);
                                }
                            }, f.prototype._rejectPromises = function(a, b) {
                                for (var c = 1; c < a; c++) {
                                    var d = this._rejectionHandlerAt(c), e = this._promiseAt(c), f = this._receiverAt(c);
                                    this._clearCallbackDataAtIndex(c), this._settlePromise(e, d, f, b);
                                }
                            }, f.prototype._settlePromises = function() {
                                var a = this._bitField, b = 65535 & a;
                                if (b > 0) {
                                    if (0 != (16842752 & a)) {
                                        var c = this._fulfillmentHandler0;
                                        this._settlePromise0(this._rejectionHandler0, c, a), this._rejectPromises(b, c);
                                    } else {
                                        var d = this._rejectionHandler0;
                                        this._settlePromise0(this._fulfillmentHandler0, d, a), this._fulfillPromises(b, d);
                                    }
                                    this._setLength(0);
                                }
                                this._clearCancellationData();
                            }, f.prototype._settledValue = function() {
                                var a = this._bitField;
                                return 0 != (33554432 & a) ? this._rejectionHandler0 : 0 != (16777216 & a) ? this._fulfillmentHandler0 : void 0;
                            }, f.defer = f.pending = function() {
                                return C.deprecated("Promise.defer", "new Promise"), {
                                    promise: new f(v),
                                    resolve: g,
                                    reject: h
                                };
                            }, o.notEnumerableProp(f, "_makeSelfResolutionError", k), b("./method")(f, v, y, m, C), 
                            b("./bind")(f, v, y, C), b("./cancel")(f, z, m, C), b("./direct_resolve")(f), b("./synchronous_inspection")(f), 
                            b("./join")(f, z, y, v, r, j), f.Promise = f, f.version = "3.5.1", b("./map.js")(f, z, m, y, v, C), 
                            b("./call_get.js")(f), b("./using.js")(f, m, y, B, v, C), b("./timers.js")(f, v, C), 
                            b("./generators.js")(f, m, v, y, d, C), b("./nodeify.js")(f), b("./promisify.js")(f, v), 
                            b("./props.js")(f, z, y, m), b("./race.js")(f, v, y, m), b("./reduce.js")(f, z, m, y, v, C), 
                            b("./settle.js")(f, z, C), b("./some.js")(f, z, m), b("./filter.js")(f, v), b("./each.js")(f, v), 
                            b("./any.js")(f), o.toFastProperties(f), o.toFastProperties(f.prototype), i({
                                a: 1
                            }), i({
                                b: 2
                            }), i({
                                c: 3
                            }), i(1), i(function() {}), i(void 0), i(!1), i(new f(v)), C.setBounds(q.firstLineError, o.lastLineError), 
                            f;
                        };
                    }, {
                        "./any.js": 1,
                        "./async": 2,
                        "./bind": 3,
                        "./call_get.js": 5,
                        "./cancel": 6,
                        "./catch_filter": 7,
                        "./context": 8,
                        "./debuggability": 9,
                        "./direct_resolve": 10,
                        "./each.js": 11,
                        "./errors": 12,
                        "./es5": 13,
                        "./filter.js": 14,
                        "./finally": 15,
                        "./generators.js": 16,
                        "./join": 17,
                        "./map.js": 18,
                        "./method": 19,
                        "./nodeback": 20,
                        "./nodeify.js": 21,
                        "./promise_array": 23,
                        "./promisify.js": 24,
                        "./props.js": 25,
                        "./race.js": 27,
                        "./reduce.js": 28,
                        "./settle.js": 30,
                        "./some.js": 31,
                        "./synchronous_inspection": 32,
                        "./thenables": 33,
                        "./timers.js": 34,
                        "./using.js": 35,
                        "./util": 36
                    } ],
                    23: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d, e, f) {
                            function g(a) {
                                switch (a) {
                                  case -2:
                                    return [];

                                  case -3:
                                    return {};

                                  case -6:
                                    return new Map();
                                }
                            }
                            function h(a) {
                                var d = this._promise = new b(c);
                                a instanceof b && d._propagateFrom(a, 3), d._setOnCancel(this), this._values = a, 
                                this._length = 0, this._totalResolved = 0, this._init(void 0, -2);
                            }
                            var i = a("./util");
                            i.isArray;
                            return i.inherits(h, f), h.prototype.length = function() {
                                return this._length;
                            }, h.prototype.promise = function() {
                                return this._promise;
                            }, h.prototype._init = function a(c, f) {
                                var h = d(this._values, this._promise);
                                if (h instanceof b) {
                                    h = h._target();
                                    var j = h._bitField;
                                    if (this._values = h, 0 == (50397184 & j)) return this._promise._setAsyncGuaranteed(), 
                                    h._then(a, this._reject, void 0, this, f);
                                    if (0 == (33554432 & j)) return 0 != (16777216 & j) ? this._reject(h._reason()) : this._cancel();
                                    h = h._value();
                                }
                                if (null === (h = i.asArray(h))) {
                                    var k = e("expecting an array or an iterable object but got " + i.classString(h)).reason();
                                    return void this._promise._rejectCallback(k, !1);
                                }
                                if (0 === h.length) return void (-5 === f ? this._resolveEmptyArray() : this._resolve(g(f)));
                                this._iterate(h);
                            }, h.prototype._iterate = function(a) {
                                var c = this.getActualLength(a.length);
                                this._length = c, this._values = this.shouldCopyValues() ? new Array(c) : this._values;
                                for (var e = this._promise, f = !1, g = null, h = 0; h < c; ++h) {
                                    var i = d(a[h], e);
                                    i instanceof b ? (i = i._target(), g = i._bitField) : g = null, f ? null !== g && i.suppressUnhandledRejections() : null !== g ? 0 == (50397184 & g) ? (i._proxy(this, h), 
                                    this._values[h] = i) : f = 0 != (33554432 & g) ? this._promiseFulfilled(i._value(), h) : 0 != (16777216 & g) ? this._promiseRejected(i._reason(), h) : this._promiseCancelled(h) : f = this._promiseFulfilled(i, h);
                                }
                                f || e._setAsyncGuaranteed();
                            }, h.prototype._isResolved = function() {
                                return null === this._values;
                            }, h.prototype._resolve = function(a) {
                                this._values = null, this._promise._fulfill(a);
                            }, h.prototype._cancel = function() {
                                !this._isResolved() && this._promise._isCancellable() && (this._values = null, this._promise._cancel());
                            }, h.prototype._reject = function(a) {
                                this._values = null, this._promise._rejectCallback(a, !1);
                            }, h.prototype._promiseFulfilled = function(a, b) {
                                return this._values[b] = a, ++this._totalResolved >= this._length && (this._resolve(this._values), 
                                !0);
                            }, h.prototype._promiseCancelled = function() {
                                return this._cancel(), !0;
                            }, h.prototype._promiseRejected = function(a) {
                                return this._totalResolved++, this._reject(a), !0;
                            }, h.prototype._resultCancelled = function() {
                                if (!this._isResolved()) {
                                    var a = this._values;
                                    if (this._cancel(), a instanceof b) a.cancel(); else for (var c = 0; c < a.length; ++c) a[c] instanceof b && a[c].cancel();
                                }
                            }, h.prototype.shouldCopyValues = function() {
                                return !0;
                            }, h.prototype.getActualLength = function(a) {
                                return a;
                            }, h;
                        };
                    }, {
                        "./util": 36
                    } ],
                    24: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c) {
                            function d(a) {
                                return !v.test(a);
                            }
                            function e(a) {
                                try {
                                    return !0 === a.__isPromisified__;
                                } catch (a) {
                                    return !1;
                                }
                            }
                            function f(a, b, c) {
                                var d = n.getDataPropertyOrDefault(a, b + c, t);
                                return !!d && e(d);
                            }
                            function g(a, b, c) {
                                for (var d = 0; d < a.length; d += 2) {
                                    var e = a[d];
                                    if (c.test(e)) for (var f = e.replace(c, ""), g = 0; g < a.length; g += 2) if (a[g] === f) throw new s("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s", b));
                                }
                            }
                            function h(a, b, c, d) {
                                for (var h = n.inheritedDataKeys(a), i = [], j = 0; j < h.length; ++j) {
                                    var k = h[j], l = a[k], m = d === w || w(k, l, a);
                                    "function" != typeof l || e(l) || f(a, k, b) || !d(k, l, a, m) || i.push(k, l);
                                }
                                return g(i, b, c), i;
                            }
                            function i(a, d, e, f, g, h) {
                                function i() {
                                    var e = d;
                                    d === m && (e = this);
                                    var f = new b(c);
                                    f._captureStackTrace();
                                    var g = "string" == typeof k && this !== j ? this[k] : a, i = o(f, h);
                                    try {
                                        g.apply(e, p(arguments, i));
                                    } catch (a) {
                                        f._rejectCallback(q(a), !0, !0);
                                    }
                                    return f._isFateSealed() || f._setAsyncGuaranteed(), f;
                                }
                                var j = function() {
                                    return this;
                                }(), k = a;
                                return "string" == typeof k && (a = f), n.notEnumerableProp(i, "__isPromisified__", !0), 
                                i;
                            }
                            function j(a, b, c, d, e) {
                                for (var f = new RegExp(x(b) + "$"), g = h(a, b, f, c), i = 0, j = g.length; i < j; i += 2) {
                                    var k = g[i], l = g[i + 1], o = k + b;
                                    if (d === y) a[o] = y(k, m, k, l, b, e); else {
                                        var p = d(l, function() {
                                            return y(k, m, k, l, b, e);
                                        });
                                        n.notEnumerableProp(p, "__isPromisified__", !0), a[o] = p;
                                    }
                                }
                                return n.toFastProperties(a), a;
                            }
                            function k(a, b, c) {
                                return y(a, b, void 0, a, null, c);
                            }
                            var l, m = {}, n = a("./util"), o = a("./nodeback"), p = n.withAppended, q = n.maybeWrapAsError, r = n.canEvaluate, s = a("./errors").TypeError, t = {
                                __isPromisified__: !0
                            }, u = [ "arity", "length", "name", "arguments", "caller", "callee", "prototype", "__isPromisified__" ], v = new RegExp("^(?:" + u.join("|") + ")$"), w = function(a) {
                                return n.isIdentifier(a) && "_" !== a.charAt(0) && "constructor" !== a;
                            }, x = function(a) {
                                return a.replace(/([$])/, "\\$");
                            }, y = r ? l : i;
                            b.promisify = function(a, b) {
                                if ("function" != typeof a) throw new s("expecting a function but got " + n.classString(a));
                                if (e(a)) return a;
                                b = Object(b);
                                var c = void 0 === b.context ? m : b.context, f = !!b.multiArgs, g = k(a, c, f);
                                return n.copyDescriptors(a, g, d), g;
                            }, b.promisifyAll = function(a, b) {
                                if ("function" != typeof a && "object" != typeof a) throw new s("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");
                                b = Object(b);
                                var c = !!b.multiArgs, d = b.suffix;
                                "string" != typeof d && (d = "Async");
                                var e = b.filter;
                                "function" != typeof e && (e = w);
                                var f = b.promisifier;
                                if ("function" != typeof f && (f = y), !n.isIdentifier(d)) throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");
                                for (var g = n.inheritedDataKeys(a), h = 0; h < g.length; ++h) {
                                    var i = a[g[h]];
                                    "constructor" !== g[h] && n.isClass(i) && (j(i.prototype, d, e, f, c), j(i, d, e, f, c));
                                }
                                return j(a, d, e, f, c);
                            };
                        };
                    }, {
                        "./errors": 12,
                        "./nodeback": 20,
                        "./util": 36
                    } ],
                    25: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d, e) {
                            function f(a) {
                                var b, c = !1;
                                if (void 0 !== h && a instanceof h) b = l(a), c = !0; else {
                                    var d = k.keys(a), e = d.length;
                                    b = new Array(2 * e);
                                    for (var f = 0; f < e; ++f) {
                                        var g = d[f];
                                        b[f] = a[g], b[f + e] = g;
                                    }
                                }
                                this.constructor$(b), this._isMap = c, this._init$(void 0, c ? -6 : -3);
                            }
                            function g(a) {
                                var c, g = d(a);
                                return j(g) ? (c = g instanceof b ? g._then(b.props, void 0, void 0, void 0, void 0) : new f(g).promise(), 
                                g instanceof b && c._propagateFrom(g, 2), c) : e("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n");
                            }
                            var h, i = a("./util"), j = i.isObject, k = a("./es5");
                            "function" == typeof Map && (h = Map);
                            var l = function() {
                                function a(a, d) {
                                    this[b] = a, this[b + c] = d, b++;
                                }
                                var b = 0, c = 0;
                                return function(d) {
                                    c = d.size, b = 0;
                                    var e = new Array(2 * d.size);
                                    return d.forEach(a, e), e;
                                };
                            }(), m = function(a) {
                                for (var b = new h(), c = a.length / 2 | 0, d = 0; d < c; ++d) {
                                    var e = a[c + d], f = a[d];
                                    b.set(e, f);
                                }
                                return b;
                            };
                            i.inherits(f, c), f.prototype._init = function() {}, f.prototype._promiseFulfilled = function(a, b) {
                                if (this._values[b] = a, ++this._totalResolved >= this._length) {
                                    var c;
                                    if (this._isMap) c = m(this._values); else {
                                        c = {};
                                        for (var d = this.length(), e = 0, f = this.length(); e < f; ++e) c[this._values[e + d]] = this._values[e];
                                    }
                                    return this._resolve(c), !0;
                                }
                                return !1;
                            }, f.prototype.shouldCopyValues = function() {
                                return !1;
                            }, f.prototype.getActualLength = function(a) {
                                return a >> 1;
                            }, b.prototype.props = function() {
                                return g(this);
                            }, b.props = function(a) {
                                return g(a);
                            };
                        };
                    }, {
                        "./es5": 13,
                        "./util": 36
                    } ],
                    26: [ function(a, b, c) {
                        "use strict";
                        function d(a, b, c, d, e) {
                            for (var f = 0; f < e; ++f) c[f + d] = a[f + b], a[f + b] = void 0;
                        }
                        function e(a) {
                            this._capacity = a, this._length = 0, this._front = 0;
                        }
                        e.prototype._willBeOverCapacity = function(a) {
                            return this._capacity < a;
                        }, e.prototype._pushOne = function(a) {
                            var b = this.length();
                            this._checkCapacity(b + 1), this[this._front + b & this._capacity - 1] = a, this._length = b + 1;
                        }, e.prototype.push = function(a, b, c) {
                            var d = this.length() + 3;
                            if (this._willBeOverCapacity(d)) return this._pushOne(a), this._pushOne(b), void this._pushOne(c);
                            var e = this._front + d - 3;
                            this._checkCapacity(d);
                            var f = this._capacity - 1;
                            this[e + 0 & f] = a, this[e + 1 & f] = b, this[e + 2 & f] = c, this._length = d;
                        }, e.prototype.shift = function() {
                            var a = this._front, b = this[a];
                            return this[a] = void 0, this._front = a + 1 & this._capacity - 1, this._length--, 
                            b;
                        }, e.prototype.length = function() {
                            return this._length;
                        }, e.prototype._checkCapacity = function(a) {
                            this._capacity < a && this._resizeTo(this._capacity << 1);
                        }, e.prototype._resizeTo = function(a) {
                            var b = this._capacity;
                            this._capacity = a, d(this, 0, this, b, this._front + this._length & b - 1);
                        }, b.exports = e;
                    }, {} ],
                    27: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d, e) {
                            function f(a, f) {
                                var i = d(a);
                                if (i instanceof b) return h(i);
                                if (null === (a = g.asArray(a))) return e("expecting an array or an iterable object but got " + g.classString(a));
                                var j = new b(c);
                                void 0 !== f && j._propagateFrom(f, 3);
                                for (var k = j._fulfill, l = j._reject, m = 0, n = a.length; m < n; ++m) {
                                    var o = a[m];
                                    (void 0 !== o || m in a) && b.cast(o)._then(k, l, void 0, j, null);
                                }
                                return j;
                            }
                            var g = a("./util"), h = function(a) {
                                return a.then(function(b) {
                                    return f(b, a);
                                });
                            };
                            b.race = function(a) {
                                return f(a, void 0);
                            }, b.prototype.race = function() {
                                return f(this, void 0);
                            };
                        };
                    }, {
                        "./util": 36
                    } ],
                    28: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d, e, f, g) {
                            function h(a, c, d, e) {
                                this.constructor$(a);
                                var g = m();
                                this._fn = null === g ? c : n.domainBind(g, c), void 0 !== d && (d = b.resolve(d), 
                                d._attachCancellationCallback(this)), this._initialValue = d, this._currentCancellable = null, 
                                this._eachValues = e === f ? Array(this._length) : 0 === e ? null : void 0, this._promise._captureStackTrace(), 
                                this._init$(void 0, -5);
                            }
                            function i(a, b) {
                                this.isFulfilled() ? b._resolve(a) : b._reject(a);
                            }
                            function j(a, b, c, e) {
                                return "function" != typeof b ? d("expecting a function but got " + n.classString(b)) : new h(a, b, c, e).promise();
                            }
                            function k(a) {
                                this.accum = a, this.array._gotAccum(a);
                                var c = e(this.value, this.array._promise);
                                return c instanceof b ? (this.array._currentCancellable = c, c._then(l, void 0, void 0, this, void 0)) : l.call(this, c);
                            }
                            function l(a) {
                                var c = this.array, d = c._promise, e = o(c._fn);
                                d._pushContext();
                                var f;
                                (f = void 0 !== c._eachValues ? e.call(d._boundValue(), a, this.index, this.length) : e.call(d._boundValue(), this.accum, a, this.index, this.length)) instanceof b && (c._currentCancellable = f);
                                var h = d._popContext();
                                return g.checkForgottenReturns(f, h, void 0 !== c._eachValues ? "Promise.each" : "Promise.reduce", d), 
                                f;
                            }
                            var m = b._getDomain, n = a("./util"), o = n.tryCatch;
                            n.inherits(h, c), h.prototype._gotAccum = function(a) {
                                void 0 !== this._eachValues && null !== this._eachValues && a !== f && this._eachValues.push(a);
                            }, h.prototype._eachComplete = function(a) {
                                return null !== this._eachValues && this._eachValues.push(a), this._eachValues;
                            }, h.prototype._init = function() {}, h.prototype._resolveEmptyArray = function() {
                                this._resolve(void 0 !== this._eachValues ? this._eachValues : this._initialValue);
                            }, h.prototype.shouldCopyValues = function() {
                                return !1;
                            }, h.prototype._resolve = function(a) {
                                this._promise._resolveCallback(a), this._values = null;
                            }, h.prototype._resultCancelled = function(a) {
                                if (a === this._initialValue) return this._cancel();
                                this._isResolved() || (this._resultCancelled$(), this._currentCancellable instanceof b && this._currentCancellable.cancel(), 
                                this._initialValue instanceof b && this._initialValue.cancel());
                            }, h.prototype._iterate = function(a) {
                                this._values = a;
                                var c, d, e = a.length;
                                if (void 0 !== this._initialValue ? (c = this._initialValue, d = 0) : (c = b.resolve(a[0]), 
                                d = 1), this._currentCancellable = c, !c.isRejected()) for (;d < e; ++d) {
                                    var f = {
                                        accum: null,
                                        value: a[d],
                                        index: d,
                                        length: e,
                                        array: this
                                    };
                                    c = c._then(k, void 0, void 0, f, void 0);
                                }
                                void 0 !== this._eachValues && (c = c._then(this._eachComplete, void 0, void 0, this, void 0)), 
                                c._then(i, i, void 0, c, this);
                            }, b.prototype.reduce = function(a, b) {
                                return j(this, a, b, null);
                            }, b.reduce = function(a, b, c, d) {
                                return j(a, b, c, d);
                            };
                        };
                    }, {
                        "./util": 36
                    } ],
                    29: [ function(b, c, e) {
                        "use strict";
                        var f, g = b("./util"), h = function() {
                            throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n");
                        }, i = g.getNativePromise();
                        if (g.isNode && "undefined" == typeof MutationObserver) {
                            var j = d.setImmediate, k = a.nextTick;
                            f = g.isRecentNode ? function(a) {
                                j.call(d, a);
                            } : function(b) {
                                k.call(a, b);
                            };
                        } else if ("function" == typeof i && "function" == typeof i.resolve) {
                            var l = i.resolve();
                            f = function(a) {
                                l.then(a);
                            };
                        } else f = "undefined" == typeof MutationObserver || "undefined" != typeof window && window.navigator && (window.navigator.standalone || window.cordova) ? "undefined" != typeof setImmediate ? function(a) {
                            setImmediate(a);
                        } : "undefined" != typeof setTimeout ? function(a) {
                            setTimeout(a, 0);
                        } : h : function() {
                            var a = document.createElement("div"), b = {
                                attributes: !0
                            }, c = !1, d = document.createElement("div");
                            new MutationObserver(function() {
                                a.classList.toggle("foo"), c = !1;
                            }).observe(d, b);
                            var e = function() {
                                c || (c = !0, d.classList.toggle("foo"));
                            };
                            return function(c) {
                                var d = new MutationObserver(function() {
                                    d.disconnect(), c();
                                });
                                d.observe(a, b), e();
                            };
                        }();
                        c.exports = f;
                    }, {
                        "./util": 36
                    } ],
                    30: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d) {
                            function e(a) {
                                this.constructor$(a);
                            }
                            var f = b.PromiseInspection;
                            a("./util").inherits(e, c), e.prototype._promiseResolved = function(a, b) {
                                return this._values[a] = b, ++this._totalResolved >= this._length && (this._resolve(this._values), 
                                !0);
                            }, e.prototype._promiseFulfilled = function(a, b) {
                                var c = new f();
                                return c._bitField = 33554432, c._settledValueField = a, this._promiseResolved(b, c);
                            }, e.prototype._promiseRejected = function(a, b) {
                                var c = new f();
                                return c._bitField = 16777216, c._settledValueField = a, this._promiseResolved(b, c);
                            }, b.settle = function(a) {
                                return d.deprecated(".settle()", ".reflect()"), new e(a).promise();
                            }, b.prototype.settle = function() {
                                return b.settle(this);
                            };
                        };
                    }, {
                        "./util": 36
                    } ],
                    31: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d) {
                            function e(a) {
                                this.constructor$(a), this._howMany = 0, this._unwrap = !1, this._initialized = !1;
                            }
                            function f(a, b) {
                                if ((0 | b) !== b || b < 0) return d("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");
                                var c = new e(a), f = c.promise();
                                return c.setHowMany(b), c.init(), f;
                            }
                            var g = a("./util"), h = a("./errors").RangeError, i = a("./errors").AggregateError, j = g.isArray, k = {};
                            g.inherits(e, c), e.prototype._init = function() {
                                if (this._initialized) {
                                    if (0 === this._howMany) return void this._resolve([]);
                                    this._init$(void 0, -5);
                                    var a = j(this._values);
                                    !this._isResolved() && a && this._howMany > this._canPossiblyFulfill() && this._reject(this._getRangeError(this.length()));
                                }
                            }, e.prototype.init = function() {
                                this._initialized = !0, this._init();
                            }, e.prototype.setUnwrap = function() {
                                this._unwrap = !0;
                            }, e.prototype.howMany = function() {
                                return this._howMany;
                            }, e.prototype.setHowMany = function(a) {
                                this._howMany = a;
                            }, e.prototype._promiseFulfilled = function(a) {
                                return this._addFulfilled(a), this._fulfilled() === this.howMany() && (this._values.length = this.howMany(), 
                                1 === this.howMany() && this._unwrap ? this._resolve(this._values[0]) : this._resolve(this._values), 
                                !0);
                            }, e.prototype._promiseRejected = function(a) {
                                return this._addRejected(a), this._checkOutcome();
                            }, e.prototype._promiseCancelled = function() {
                                return this._values instanceof b || null == this._values ? this._cancel() : (this._addRejected(k), 
                                this._checkOutcome());
                            }, e.prototype._checkOutcome = function() {
                                if (this.howMany() > this._canPossiblyFulfill()) {
                                    for (var a = new i(), b = this.length(); b < this._values.length; ++b) this._values[b] !== k && a.push(this._values[b]);
                                    return a.length > 0 ? this._reject(a) : this._cancel(), !0;
                                }
                                return !1;
                            }, e.prototype._fulfilled = function() {
                                return this._totalResolved;
                            }, e.prototype._rejected = function() {
                                return this._values.length - this.length();
                            }, e.prototype._addRejected = function(a) {
                                this._values.push(a);
                            }, e.prototype._addFulfilled = function(a) {
                                this._values[this._totalResolved++] = a;
                            }, e.prototype._canPossiblyFulfill = function() {
                                return this.length() - this._rejected();
                            }, e.prototype._getRangeError = function(a) {
                                var b = "Input array must contain at least " + this._howMany + " items but contains only " + a + " items";
                                return new h(b);
                            }, e.prototype._resolveEmptyArray = function() {
                                this._reject(this._getRangeError(0));
                            }, b.some = function(a, b) {
                                return f(a, b);
                            }, b.prototype.some = function(a) {
                                return f(this, a);
                            }, b._SomePromiseArray = e;
                        };
                    }, {
                        "./errors": 12,
                        "./util": 36
                    } ],
                    32: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(a) {
                            function b(a) {
                                void 0 !== a ? (a = a._target(), this._bitField = a._bitField, this._settledValueField = a._isFateSealed() ? a._settledValue() : void 0) : (this._bitField = 0, 
                                this._settledValueField = void 0);
                            }
                            b.prototype._settledValue = function() {
                                return this._settledValueField;
                            };
                            var c = b.prototype.value = function() {
                                if (!this.isFulfilled()) throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");
                                return this._settledValue();
                            }, d = b.prototype.error = b.prototype.reason = function() {
                                if (!this.isRejected()) throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");
                                return this._settledValue();
                            }, e = b.prototype.isFulfilled = function() {
                                return 0 != (33554432 & this._bitField);
                            }, f = b.prototype.isRejected = function() {
                                return 0 != (16777216 & this._bitField);
                            }, g = b.prototype.isPending = function() {
                                return 0 == (50397184 & this._bitField);
                            }, h = b.prototype.isResolved = function() {
                                return 0 != (50331648 & this._bitField);
                            };
                            b.prototype.isCancelled = function() {
                                return 0 != (8454144 & this._bitField);
                            }, a.prototype.__isCancelled = function() {
                                return 65536 == (65536 & this._bitField);
                            }, a.prototype._isCancelled = function() {
                                return this._target().__isCancelled();
                            }, a.prototype.isCancelled = function() {
                                return 0 != (8454144 & this._target()._bitField);
                            }, a.prototype.isPending = function() {
                                return g.call(this._target());
                            }, a.prototype.isRejected = function() {
                                return f.call(this._target());
                            }, a.prototype.isFulfilled = function() {
                                return e.call(this._target());
                            }, a.prototype.isResolved = function() {
                                return h.call(this._target());
                            }, a.prototype.value = function() {
                                return c.call(this._target());
                            }, a.prototype.reason = function() {
                                var a = this._target();
                                return a._unsetRejectionIsUnhandled(), d.call(a);
                            }, a.prototype._value = function() {
                                return this._settledValue();
                            }, a.prototype._reason = function() {
                                return this._unsetRejectionIsUnhandled(), this._settledValue();
                            }, a.PromiseInspection = b;
                        };
                    }, {} ],
                    33: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c) {
                            function d(a, d) {
                                if (k(a)) {
                                    if (a instanceof b) return a;
                                    var e = f(a);
                                    if (e === j) {
                                        d && d._pushContext();
                                        var i = b.reject(e.e);
                                        return d && d._popContext(), i;
                                    }
                                    if ("function" == typeof e) {
                                        if (g(a)) {
                                            var i = new b(c);
                                            return a._then(i._fulfill, i._reject, void 0, i, null), i;
                                        }
                                        return h(a, e, d);
                                    }
                                }
                                return a;
                            }
                            function e(a) {
                                return a.then;
                            }
                            function f(a) {
                                try {
                                    return e(a);
                                } catch (a) {
                                    return j.e = a, j;
                                }
                            }
                            function g(a) {
                                try {
                                    return l.call(a, "_promise0");
                                } catch (a) {
                                    return !1;
                                }
                            }
                            function h(a, d, e) {
                                function f(a) {
                                    h && (h._resolveCallback(a), h = null);
                                }
                                function g(a) {
                                    h && (h._rejectCallback(a, l, !0), h = null);
                                }
                                var h = new b(c), k = h;
                                e && e._pushContext(), h._captureStackTrace(), e && e._popContext();
                                var l = !0, m = i.tryCatch(d).call(a, f, g);
                                return l = !1, h && m === j && (h._rejectCallback(m.e, !0, !0), h = null), k;
                            }
                            var i = a("./util"), j = i.errorObj, k = i.isObject, l = {}.hasOwnProperty;
                            return d;
                        };
                    }, {
                        "./util": 36
                    } ],
                    34: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d) {
                            function e(a) {
                                this.handle = a;
                            }
                            function f(a) {
                                return clearTimeout(this.handle), a;
                            }
                            function g(a) {
                                throw clearTimeout(this.handle), a;
                            }
                            var h = a("./util"), i = b.TimeoutError;
                            e.prototype._resultCancelled = function() {
                                clearTimeout(this.handle);
                            };
                            var j = function(a) {
                                return k(+this).thenReturn(a);
                            }, k = b.delay = function(a, f) {
                                var g, h;
                                return void 0 !== f ? (g = b.resolve(f)._then(j, null, null, a, void 0), d.cancellation() && f instanceof b && g._setOnCancel(f)) : (g = new b(c), 
                                h = setTimeout(function() {
                                    g._fulfill();
                                }, +a), d.cancellation() && g._setOnCancel(new e(h)), g._captureStackTrace()), g._setAsyncGuaranteed(), 
                                g;
                            };
                            b.prototype.delay = function(a) {
                                return k(a, this);
                            };
                            var l = function(a, b, c) {
                                var d;
                                d = "string" != typeof b ? b instanceof Error ? b : new i("operation timed out") : new i(b), 
                                h.markAsOriginatingFromRejection(d), a._attachExtraTrace(d), a._reject(d), null != c && c.cancel();
                            };
                            b.prototype.timeout = function(a, b) {
                                a = +a;
                                var c, h, i = new e(setTimeout(function() {
                                    c.isPending() && l(c, b, h);
                                }, a));
                                return d.cancellation() ? (h = this.then(), c = h._then(f, g, void 0, i, void 0), 
                                c._setOnCancel(i)) : c = this._then(f, g, void 0, i, void 0), c;
                            };
                        };
                    }, {
                        "./util": 36
                    } ],
                    35: [ function(a, b, c) {
                        "use strict";
                        b.exports = function(b, c, d, e, f, g) {
                            function h(a) {
                                setTimeout(function() {
                                    throw a;
                                }, 0);
                            }
                            function i(a) {
                                var b = d(a);
                                return b !== a && "function" == typeof a._isDisposable && "function" == typeof a._getDisposer && a._isDisposable() && b._setDisposable(a._getDisposer()), 
                                b;
                            }
                            function j(a, c) {
                                function e() {
                                    if (g >= j) return k._fulfill();
                                    var f = i(a[g++]);
                                    if (f instanceof b && f._isDisposable()) {
                                        try {
                                            f = d(f._getDisposer().tryDispose(c), a.promise);
                                        } catch (a) {
                                            return h(a);
                                        }
                                        if (f instanceof b) return f._then(e, h, null, null, null);
                                    }
                                    e();
                                }
                                var g = 0, j = a.length, k = new b(f);
                                return e(), k;
                            }
                            function k(a, b, c) {
                                this._data = a, this._promise = b, this._context = c;
                            }
                            function l(a, b, c) {
                                this.constructor$(a, b, c);
                            }
                            function m(a) {
                                return k.isDisposer(a) ? (this.resources[this.index]._setDisposable(a), a.promise()) : a;
                            }
                            function n(a) {
                                this.length = a, this.promise = null, this[a - 1] = null;
                            }
                            var o = a("./util"), p = a("./errors").TypeError, q = a("./util").inherits, r = o.errorObj, s = o.tryCatch, t = {};
                            k.prototype.data = function() {
                                return this._data;
                            }, k.prototype.promise = function() {
                                return this._promise;
                            }, k.prototype.resource = function() {
                                return this.promise().isFulfilled() ? this.promise().value() : t;
                            }, k.prototype.tryDispose = function(a) {
                                var b = this.resource(), c = this._context;
                                void 0 !== c && c._pushContext();
                                var d = b !== t ? this.doDispose(b, a) : null;
                                return void 0 !== c && c._popContext(), this._promise._unsetDisposable(), this._data = null, 
                                d;
                            }, k.isDisposer = function(a) {
                                return null != a && "function" == typeof a.resource && "function" == typeof a.tryDispose;
                            }, q(l, k), l.prototype.doDispose = function(a, b) {
                                return this.data().call(a, a, b);
                            }, n.prototype._resultCancelled = function() {
                                for (var a = this.length, c = 0; c < a; ++c) {
                                    var d = this[c];
                                    d instanceof b && d.cancel();
                                }
                            }, b.using = function() {
                                var a = arguments.length;
                                if (a < 2) return c("you must pass at least 2 arguments to Promise.using");
                                var e = arguments[a - 1];
                                if ("function" != typeof e) return c("expecting a function but got " + o.classString(e));
                                var f, h = !0;
                                2 === a && Array.isArray(arguments[0]) ? (f = arguments[0], a = f.length, h = !1) : (f = arguments, 
                                a--);
                                for (var i = new n(a), l = 0; l < a; ++l) {
                                    var p = f[l];
                                    if (k.isDisposer(p)) {
                                        var q = p;
                                        p = p.promise(), p._setDisposable(q);
                                    } else {
                                        var t = d(p);
                                        t instanceof b && (p = t._then(m, null, null, {
                                            resources: i,
                                            index: l
                                        }, void 0));
                                    }
                                    i[l] = p;
                                }
                                for (var u = new Array(i.length), l = 0; l < u.length; ++l) u[l] = b.resolve(i[l]).reflect();
                                var v = b.all(u).then(function(a) {
                                    for (var b = 0; b < a.length; ++b) {
                                        var c = a[b];
                                        if (c.isRejected()) return r.e = c.error(), r;
                                        if (!c.isFulfilled()) return void v.cancel();
                                        a[b] = c.value();
                                    }
                                    w._pushContext(), e = s(e);
                                    var d = h ? e.apply(void 0, a) : e(a), f = w._popContext();
                                    return g.checkForgottenReturns(d, f, "Promise.using", w), d;
                                }), w = v.lastly(function() {
                                    var a = new b.PromiseInspection(v);
                                    return j(i, a);
                                });
                                return i.promise = w, w._setOnCancel(i), w;
                            }, b.prototype._setDisposable = function(a) {
                                this._bitField = 131072 | this._bitField, this._disposer = a;
                            }, b.prototype._isDisposable = function() {
                                return (131072 & this._bitField) > 0;
                            }, b.prototype._getDisposer = function() {
                                return this._disposer;
                            }, b.prototype._unsetDisposable = function() {
                                this._bitField = -131073 & this._bitField, this._disposer = void 0;
                            }, b.prototype.disposer = function(a) {
                                if ("function" == typeof a) return new l(a, this, e());
                                throw new p();
                            };
                        };
                    }, {
                        "./errors": 12,
                        "./util": 36
                    } ],
                    36: [ function(b, c, e) {
                        "use strict";
                        function f() {
                            try {
                                var a = F;
                                return F = null, a.apply(this, arguments);
                            } catch (a) {
                                return E.e = a, E;
                            }
                        }
                        function g(a) {
                            return F = a, f;
                        }
                        function h(a) {
                            return null == a || !0 === a || !1 === a || "string" == typeof a || "number" == typeof a;
                        }
                        function i(a) {
                            return "function" == typeof a || "object" == typeof a && null !== a;
                        }
                        function j(a) {
                            return h(a) ? new Error(s(a)) : a;
                        }
                        function k(a, b) {
                            var c, d = a.length, e = new Array(d + 1);
                            for (c = 0; c < d; ++c) e[c] = a[c];
                            return e[c] = b, e;
                        }
                        function l(a, b, c) {
                            if (!C.isES5) return {}.hasOwnProperty.call(a, b) ? a[b] : void 0;
                            var d = Object.getOwnPropertyDescriptor(a, b);
                            return null != d ? null == d.get && null == d.set ? d.value : c : void 0;
                        }
                        function m(a, b, c) {
                            if (h(a)) return a;
                            var d = {
                                value: c,
                                configurable: !0,
                                enumerable: !1,
                                writable: !0
                            };
                            return C.defineProperty(a, b, d), a;
                        }
                        function n(a) {
                            throw a;
                        }
                        function o(a) {
                            try {
                                if ("function" == typeof a) {
                                    var b = C.names(a.prototype), c = C.isES5 && b.length > 1, d = b.length > 0 && !(1 === b.length && "constructor" === b[0]), e = J.test(a + "") && C.names(a).length > 0;
                                    if (c || d || e) return !0;
                                }
                                return !1;
                            } catch (a) {
                                return !1;
                            }
                        }
                        function p(a) {
                            function b() {}
                            b.prototype = a;
                            for (var c = 8; c--; ) new b();
                            return a;
                        }
                        function q(a) {
                            return K.test(a);
                        }
                        function r(a, b, c) {
                            for (var d = new Array(a), e = 0; e < a; ++e) d[e] = b + e + c;
                            return d;
                        }
                        function s(a) {
                            try {
                                return a + "";
                            } catch (a) {
                                return "[no string representation]";
                            }
                        }
                        function t(a) {
                            return a instanceof Error || null !== a && "object" == typeof a && "string" == typeof a.message && "string" == typeof a.name;
                        }
                        function u(a) {
                            try {
                                m(a, "isOperational", !0);
                            } catch (a) {}
                        }
                        function v(a) {
                            return null != a && (a instanceof Error.__BluebirdErrorTypes__.OperationalError || !0 === a.isOperational);
                        }
                        function w(a) {
                            return t(a) && C.propertyIsWritable(a, "stack");
                        }
                        function x(a) {
                            return {}.toString.call(a);
                        }
                        function y(a, b, c) {
                            for (var d = C.names(a), e = 0; e < d.length; ++e) {
                                var f = d[e];
                                if (c(f)) try {
                                    C.defineProperty(b, f, C.getDescriptor(a, f));
                                } catch (a) {}
                            }
                        }
                        function z(b) {
                            return P ? a.env[b] : void 0;
                        }
                        function A() {
                            if ("function" == typeof Promise) try {
                                var a = new Promise(function() {});
                                if ("[object Promise]" === {}.toString.call(a)) return Promise;
                            } catch (a) {}
                        }
                        function B(a, b) {
                            return a.bind(b);
                        }
                        var C = b("./es5"), D = "undefined" == typeof navigator, E = {
                            e: {}
                        }, F, G = "undefined" != typeof self ? self : "undefined" != typeof window ? window : void 0 !== d ? d : void 0 !== this ? this : null, H = function(a, b) {
                            function c() {
                                this.constructor = a, this.constructor$ = b;
                                for (var c in b.prototype) d.call(b.prototype, c) && "$" !== c.charAt(c.length - 1) && (this[c + "$"] = b.prototype[c]);
                            }
                            var d = {}.hasOwnProperty;
                            return c.prototype = b.prototype, a.prototype = new c(), a.prototype;
                        }, I = function() {
                            var a = [ Array.prototype, Object.prototype, Function.prototype ], b = function(b) {
                                for (var c = 0; c < a.length; ++c) if (a[c] === b) return !0;
                                return !1;
                            };
                            if (C.isES5) {
                                var c = Object.getOwnPropertyNames;
                                return function(a) {
                                    for (var d = [], e = Object.create(null); null != a && !b(a); ) {
                                        var f;
                                        try {
                                            f = c(a);
                                        } catch (a) {
                                            return d;
                                        }
                                        for (var g = 0; g < f.length; ++g) {
                                            var h = f[g];
                                            if (!e[h]) {
                                                e[h] = !0;
                                                var i = Object.getOwnPropertyDescriptor(a, h);
                                                null != i && null == i.get && null == i.set && d.push(h);
                                            }
                                        }
                                        a = C.getPrototypeOf(a);
                                    }
                                    return d;
                                };
                            }
                            var d = {}.hasOwnProperty;
                            return function(c) {
                                if (b(c)) return [];
                                var e = [];
                                a: for (var f in c) if (d.call(c, f)) e.push(f); else {
                                    for (var g = 0; g < a.length; ++g) if (d.call(a[g], f)) continue a;
                                    e.push(f);
                                }
                                return e;
                            };
                        }(), J = /this\s*\.\s*\S+\s*=/, K = /^[a-z$_][a-z$_0-9]*$/i, L = function() {
                            return "stack" in new Error() ? function(a) {
                                return w(a) ? a : new Error(s(a));
                            } : function(a) {
                                if (w(a)) return a;
                                try {
                                    throw new Error(s(a));
                                } catch (a) {
                                    return a;
                                }
                            };
                        }(), M = function(a) {
                            return C.isArray(a) ? a : null;
                        };
                        if ("undefined" != typeof Symbol && Symbol.iterator) {
                            var N = "function" == typeof Array.from ? function(a) {
                                return Array.from(a);
                            } : function(a) {
                                for (var b, c = [], d = a[Symbol.iterator](); !(b = d.next()).done; ) c.push(b.value);
                                return c;
                            };
                            M = function(a) {
                                return C.isArray(a) ? a : null != a && "function" == typeof a[Symbol.iterator] ? N(a) : null;
                            };
                        }
                        var O = void 0 !== a && "[object process]" === x(a).toLowerCase(), P = void 0 !== a && void 0 !== a.env, Q = {
                            isClass: o,
                            isIdentifier: q,
                            inheritedDataKeys: I,
                            getDataPropertyOrDefault: l,
                            thrower: n,
                            isArray: C.isArray,
                            asArray: M,
                            notEnumerableProp: m,
                            isPrimitive: h,
                            isObject: i,
                            isError: t,
                            canEvaluate: D,
                            errorObj: E,
                            tryCatch: g,
                            inherits: H,
                            withAppended: k,
                            maybeWrapAsError: j,
                            toFastProperties: p,
                            filledRange: r,
                            toString: s,
                            canAttachTrace: w,
                            ensureErrorObject: L,
                            originatesFromRejection: v,
                            markAsOriginatingFromRejection: u,
                            classString: x,
                            copyDescriptors: y,
                            hasDevTools: "undefined" != typeof chrome && chrome && "function" == typeof chrome.loadTimes,
                            isNode: O,
                            hasEnvVariables: P,
                            env: z,
                            global: G,
                            getNativePromise: A,
                            domainBind: B
                        };
                        Q.isRecentNode = Q.isNode && function() {
                            var b = a.versions.node.split(".").map(Number);
                            return 0 === b[0] && b[1] > 10 || b[0] > 0;
                        }(), Q.isNode && Q.toFastProperties(a);
                        try {
                            throw new Error();
                        } catch (a) {
                            Q.lastLineError = a;
                        }
                        c.exports = Q;
                    }, {
                        "./es5": 13
                    } ]
                }, {}, [ 4 ])(4);
            }), "undefined" != typeof window && null !== window ? window.P = window.Promise : "undefined" != typeof self && null !== self && (self.P = self.Promise);
        }).call(this, a("_process"), "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {});
    }, {
        _process: 15
    } ],
    2: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.PreCallTest = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./turnConnection"), g = a("./tests/rttTest"), h = a("./tests/throughputTest"), i = a("./utility/resultsHandler"), j = a("./utility/onlineCheck"), k = a("./utility/stats/detectbrowser"), l = a("bluebird"), m = {
            RTT: "rtt",
            THROUGHPUT: "throughput"
        }, n = function() {
            function a() {
                d(this, a), this.browserInfo = (0, k.detect)(), this.turnConnection = new f.TurnConnection(this.browserInfo), 
                this.onlineCheck = new j.OnlineCheck(), this.callsInProgress = 0, this.turnTests = [ m.RTT, m.THROUGHPUT ], 
                this.active = !1, this.rtt = null, this.resultsHandler = null;
            }
            return e(a, [ {
                key: "start",
                value: function(a, b) {
                    if (this.browserInfo.browserName !== k.Constants.browserName.msie) if (this.iceServers = a, 
                    this.callback = b, this.active) this.callback && this.callback(null, "Not started: already in progress"); else if (this.callsInProgress > 0) this.callback && this.callback(null, "Not started: call in progress"); else if (a) {
                        this.turnTestCounter = 0, this.resultsHandler = new i.ResultsHandler();
                        var c = {
                            type: "browser",
                            os: this.browserInfo.os,
                            osVersion: this.browserInfo.osVersion,
                            buildName: this.browserInfo.browserName,
                            buildVersion: this.browserInfo.browserVersion
                        };
                        this.resultsHandler.add("endpointInfo", c), this.onlineCheck.start(), this.active = !0, 
                        this._start();
                    } else this.callback && this.callback(null, "Not started: no ICE servers given"); else this.callback && this.callback(null, "Not started: disabled for IE");
                }
            }, {
                key: "_start",
                value: function() {
                    var a = this;
                    this.active && this.turnConnection.connect(this.iceServers).then(function() {
                        a.active ? a.startTurnTests().then(function() {
                            a.stop();
                        }, function(b) {
                            a.stop();
                        }) : a.stop();
                    }, function(b) {
                        var c = b.continueFlag;
                        if (a.resultsHandler.failure(b), !c) {
                            a.turnConnection.disconnect(), a.active = !1;
                            var d = "";
                            try {
                                d = b.stack;
                            } catch (a) {
                                d = b.toString();
                            }
                            return d && "" !== d || (d = b.toString()), void a.callback(null, d);
                        }
                        a.resultsHandler.getFailureNumber() >= 10 ? a.stop() : (a.turnConnection.disconnect(), 
                        setTimeout(function() {
                            a._start();
                        }, 0));
                    });
                }
            }, {
                key: "stop",
                value: function() {
                    var a = this;
                    if (this.browserInfo.browserName !== k.Constants.browserName.msie && this.active) {
                        this.active = !1, this.activeTurnTest && this.activeTurnTest.forceStop();
                        var b = this.onlineCheck.stop();
                        this.resultsHandler && this.resultsHandler.add("onlineStatus", b), this.turnConnection.getIceResults().then(function(b) {
                            a.resultsHandler && a.resultsHandler.add("ice", b), a.turnConnection.disconnect(), 
                            a.sendResults();
                        }, function(b) {
                            a.resultsHandler && a.resultsHandler.failure(b), a.turnConnection.disconnect(), 
                            a.sendResults();
                        });
                    }
                }
            }, {
                key: "sendResults",
                value: function() {
                    this.resultsHandler || this.callback && this.callback(null, "No results present");
                    var a = this.resultsHandler.getResults();
                    this.callback && this.callback(a, null), this.resultsHandler = null;
                }
            }, {
                key: "callStarts",
                value: function() {
                    this.callsInProgress += 1, this.stop();
                }
            }, {
                key: "callFinished",
                value: function() {
                    this.callsInProgress -= 1;
                }
            }, {
                key: "getId",
                value: function() {
                    return this.resultsHandler ? this.resultsHandler.getId() : null;
                }
            }, {
                key: "crashDisconnect",
                value: function() {
                    try {
                        this.turnConnection.disconnect();
                    } catch (a) {}
                }
            }, {
                key: "startTurnTests",
                value: function() {
                    var a = this;
                    if (this.turnTestCounter >= this.turnTests.length) return new l(function(a, b) {
                        a();
                    });
                    var b = this.turnTests[this.turnTestCounter], c = null;
                    switch (b) {
                      case m.RTT:
                        c = new g.RttTest(this.turnConnection);
                        break;

                      case m.THROUGHPUT:
                        c = new h.ThroughputTest(this.turnConnection, this.rtt);
                        break;

                      default:
                        return new l(function(a, c) {
                            c(new Error("Unknown test: " + b));
                        });
                    }
                    return this.activeTurnTest = c, this.active ? c.start().then(function() {
                        return a.handleTestResults(b, c.getResults()), a.turnTestCounter += 1, a.activeTurnTest = null, 
                        a.startTurnTests();
                    }, function(d) {
                        return a.handleTestResults(b, c.getResults(), d), a.turnTestCounter += 1, a.activeTurnTest = null, 
                        a.startTurnTests();
                    }) : new l(function(a, b) {
                        b(new Error("Test trying to start while testing is not active"));
                    });
                }
            }, {
                key: "handleTestResults",
                value: function(a, b) {
                    null == (arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null) && a == m.RTT && (this.rtt = b.median), 
                    this.resultsHandler && this.resultsHandler.add(a, b);
                }
            } ]), a;
        }();
        c.PreCallTest = n;
    }, {
        "./tests/rttTest": 3,
        "./tests/throughputTest": 4,
        "./turnConnection": 6,
        "./utility/onlineCheck": 8,
        "./utility/resultsHandler": 10,
        "./utility/stats/detectbrowser": 11,
        bluebird: 1
    } ],
    3: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function e(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function f(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.RttTest = void 0;
        var g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = function a(b, c, d) {
            null === b && (b = Function.prototype);
            var e = Object.getOwnPropertyDescriptor(b, c);
            if (void 0 === e) {
                var f = Object.getPrototypeOf(b);
                return null === f ? void 0 : a(f, c, d);
            }
            if ("value" in e) return e.value;
            var g = e.get;
            return void 0 !== g ? g.call(d) : void 0;
        }, i = a("../utility/timestamps"), j = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(i), k = a("./turnTest"), l = function(a) {
            function b(a) {
                d(this, b);
                var c = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, a));
                return c.sendTimer = null, c.countSent = 0, c.rtts = [], c;
            }
            return f(b, k.TurnTest), g(b, [ {
                key: "initiate",
                value: function() {
                    this.results.startTimestamp = j.getCurrent(), this.sendPing();
                }
            }, {
                key: "handleMessage",
                value: function(a) {
                    if (this.isActive()) {
                        var b = parseInt(a, 10), c = this.calculateRtt(b);
                        this.rtts.push(c), this.countSent < 10 ? this.sendPing() : this.calculateMetrics();
                    }
                }
            }, {
                key: "handleError",
                value: function(a) {
                    this.fillResults(), this.failed(a);
                }
            }, {
                key: "sendPing",
                value: function() {
                    if (this.isActive()) {
                        var a = j.getCurrent();
                        this.send(a.toString()), this.countSent += 1, this.sendTimer && (clearTimeout(this.sendTimer), 
                        this.sendTimer = null), this.countSent < 10 ? this.sendTimer = setTimeout(this.sendPing.bind(this), 100) : this.sendTimer = setTimeout(this.calculateMetrics.bind(this), 500);
                    }
                }
            }, {
                key: "calculateRtt",
                value: function(a) {
                    return j.getCurrent() - a;
                }
            }, {
                key: "calculateMetrics",
                value: function() {
                    this.sendTimer && (clearTimeout(this.sendTimer), this.sendTimer = null), this.fillResults(), 
                    this.finished();
                }
            }, {
                key: "fillResults",
                value: function() {
                    this.results.sentMessages = this.countSent, this.results.unAckedMessages = this.countSent - this.rtts.length, 
                    this.results.maxMessages = 10, this.results.forceStopped = this.forceStopped, this.results.median = this.median(), 
                    this.results.variance = this.variance(), this.results.endTimestamp = j.getCurrent();
                }
            }, {
                key: "median",
                value: function() {
                    if (0 == this.rtts.length) return null;
                    this.rtts.sort();
                    var a = Math.floor(this.rtts.length / 2);
                    return this.rtts[a];
                }
            }, {
                key: "variance",
                value: function() {
                    if (0 == this.rtts.length) return null;
                    for (var a = 0, b = this.median(), c = 0; c < this.rtts.length; c++) {
                        var d = this.rtts[c];
                        a += Math.abs(d - b);
                    }
                    return a /= this.rtts.length;
                }
            }, {
                key: "stop",
                value: function() {
                    this.isActive() && (h(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "stop", this).call(this), 
                    this.fillResults());
                }
            } ]), b;
        }();
        c.RttTest = l;
    }, {
        "../utility/timestamps": 14,
        "./turnTest": 5
    } ],
    4: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function e(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function f(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.ThroughputTest = void 0;
        var g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = function a(b, c, d) {
            null === b && (b = Function.prototype);
            var e = Object.getOwnPropertyDescriptor(b, c);
            if (void 0 === e) {
                var f = Object.getPrototypeOf(b);
                return null === f ? void 0 : a(f, c, d);
            }
            if ("value" in e) return e.value;
            var g = e.get;
            return void 0 !== g ? g.call(d) : void 0;
        }, i = a("../utility/timestamps"), j = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(i), k = a("../utility/messageMaker"), l = a("./turnTest"), m = function(a) {
            function b(a, c) {
                d(this, b);
                var f = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, a));
                if (f.sentBytes = 0, f.receivedBytes = 0, f.secondHalfBytes = 0, f.secondHalfStart = null, 
                f.bufferEmpty = 0, f.chunkSize = 1200, f.messageMaker = new k.MessageMaker(f.chunkSize), 
                f.duration = 5e3, null != c) {
                    var g = 50 * c;
                    f.duration = Math.max(Math.min(g, 1e4), 1e3);
                }
                return f.sendTimer = null, f.lastMessage = null, f.intervals = [], f.intervalStart = 0, 
                f.intervalLength = 100, f.intervalBytes = 0, f;
            }
            return f(b, l.TurnTest), g(b, [ {
                key: "initiate",
                value: function() {
                    if (window && window.csioReactNative) {
                        this.handleError(new Error("Not running throughput test for react-native"));
                    } else this.startSend();
                }
            }, {
                key: "handleMessage",
                value: function(a) {
                    var b = this;
                    if (this.isActive()) {
                        this.lastMessage = a, this.receivedBytes += a.length;
                        var c = j.getCurrent();
                        if (this.sendTimer || (this.results.startTimestamp = c, this.sendTimer = setTimeout(function() {
                            b.stop(), b.finished();
                        }, this.duration)), 0 == this.intervalStart && (this.intervalStart = c), this.intervalBytes += a.length, 
                        c - this.intervalStart >= this.intervalLength) {
                            var d = c - this.intervalStart, e = this.averageThroughput(this.intervalBytes, d), f = null;
                            try {
                                f = c - JSON.parse(this.lastMessage).timestamp;
                            } catch (a) {}
                            this.intervals.push({
                                startTimestamp: this.intervalStart,
                                endTimestamp: c,
                                bytesReceived: this.intervalBytes,
                                average: e,
                                rtt: f
                            }), this.intervalStart = c, this.intervalBytes = 0;
                        }
                        this.results.startTimestamp && c - this.results.startTimestamp > this.duration / 2 && (this.secondHalfStart || (this.secondHalfStart = c), 
                        this.secondHalfBytes += a.length);
                    }
                }
            }, {
                key: "handleError",
                value: function(a) {
                    this.stop(), this.failed(a);
                }
            }, {
                key: "averageThroughput",
                value: function(a, b) {
                    return a / (b / 1e3) * 8 / 1024;
                }
            }, {
                key: "bufferListener",
                value: function() {
                    this.sendChannel.removeEventListener("bufferedamountlow", this.bufferListener.bind(this)), 
                    this.fillBuffer();
                }
            }, {
                key: "fillBuffer",
                value: function() {
                    for (0 == this.sendChannel.bufferedAmount && (this.bufferEmpty += 1); this.isActive(); ) {
                        if (this.sendChannel.bufferedAmount > this.bufferFullThreshold) return void (this.usePolling ? setTimeout(this.fillBuffer.bind(this), 250) : this.sendChannel.addEventListener("bufferedamountlow", this.bufferListener.bind(this)));
                        var a = this.messageMaker.make(this.sentBytes);
                        this.sentBytes += a.length, this.send(a);
                    }
                    this.sendChannel.removeEventListener("bufferedamountlow", this.bufferListener.bind(this));
                }
            }, {
                key: "startSend",
                value: function() {
                    this.isActive() && (this.bufferFullThreshold = 1e3 * this.chunkSize, this.sendChannel = this.connection.sendChannel, 
                    this.usePolling = !0, "number" == typeof this.sendChannel.bufferedAmountLowThreshold && (this.usePolling = !1, 
                    this.sendChannel.bufferedAmountLowThreshold = this.bufferFullThreshold / 10), setTimeout(this.fillBuffer.bind(this), 0));
                }
            }, {
                key: "fillResults",
                value: function() {
                    this.results.endTimestamp = j.getCurrent(), this.results.maxDuration = this.duration, 
                    this.results.forceStopped = this.forceStopped, this.results.bufferEmpty = this.bufferEmpty, 
                    this.results.intervals = this.intervals, this.results.bytesPrepared = this.sentBytes, 
                    this.results.bytesReceived = this.receivedBytes;
                    var a = 0, b = 0;
                    this.secondHalfStart && (a = this.results.endTimestamp - this.secondHalfStart, b = this.averageThroughput(this.secondHalfBytes, a));
                    var c = this.results.endTimestamp - this.results.startTimestamp, d = this.averageThroughput(this.receivedBytes, c);
                    d > b && (b = d), this.results.average = b;
                    var e = null;
                    try {
                        e = JSON.parse(this.lastMessage);
                    } catch (a) {
                        return;
                    }
                    if (e) {
                        var f = e.sentBytes + this.lastMessage.length;
                        this.results.bytesSent = f, this.results.fractionLostBytes = 1 - this.receivedBytes / f;
                    } else this.results.bytesSent = -1, this.results.fractionLostBytes = -1;
                }
            }, {
                key: "stop",
                value: function() {
                    this.isActive() && (clearTimeout(this.sendTimer), this.sendTimer = null, h(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "stop", this).call(this), 
                    this.fillResults());
                }
            } ]), b;
        }();
        c.ThroughputTest = m;
    }, {
        "../utility/messageMaker": 7,
        "../utility/timestamps": 14,
        "./turnTest": 5
    } ],
    5: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("bluebird"), g = function() {
            function a(b) {
                d(this, a), this.connection = b, this.active = !1, this.results = {};
            }
            return e(a, [ {
                key: "getResults",
                value: function() {
                    return this.results;
                }
            }, {
                key: "start",
                value: function() {
                    var a = this, b = new f(function(b, c) {
                        a.resolveCb = b, a.rejectCb = c;
                    });
                    return this.connection.setMessageCallback(this.handleMessage.bind(this)), this.connection.setErrorCallback(this.handleError.bind(this)), 
                    this.active = !0, this.forceStopped = !1, this.initiate(), b;
                }
            }, {
                key: "stop",
                value: function() {
                    this.active = !1;
                }
            }, {
                key: "forceStop",
                value: function() {
                    this.forceStopped = !0, this.stop(), this.finished();
                }
            }, {
                key: "isActive",
                value: function() {
                    return this.active;
                }
            }, {
                key: "initiate",
                value: function() {}
            }, {
                key: "handleMessage",
                value: function(a) {}
            }, {
                key: "handleError",
                value: function(a) {}
            }, {
                key: "send",
                value: function(a) {
                    this.connection.send(a);
                }
            }, {
                key: "finished",
                value: function() {
                    this.active = !1, this.resolveCb && (this.resolveCb(), this.resolveCb = null);
                }
            }, {
                key: "failed",
                value: function(a) {
                    this.active = !1, this.rejectCb && (this.rejectCb(a), this.rejectCb = null);
                }
            } ]), a;
        }();
        c.TurnTest = g;
    }, {
        bluebird: 1
    } ],
    6: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.TurnConnection = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./utility/parsedIceCandidate"), g = a("./utility/stats/getstatshandler"), h = a("./utility/stats/detectbrowser"), i = a("bluebird"), j = function() {
            function a(b) {
                d(this, a), this.reset(), this.statshandler = new g.GetStatsHandler(b);
            }
            return e(a, [ {
                key: "reset",
                value: function() {
                    this.disconnect(), this.iceServers = null, this.pctpc1 = null, this.pctpc2 = null, 
                    this.sendChannel = null, this.messageCallback = null, this.errorCallback = null, 
                    this.parsedIceResults = {}, this.resolveCb = null, this.rejectCb = null;
                }
            }, {
                key: "setMessageCallback",
                value: function(a) {
                    this.messageCallback = a;
                }
            }, {
                key: "setErrorCallback",
                value: function(a) {
                    this.errorCallback = a;
                }
            }, {
                key: "send",
                value: function(a) {
                    if (this.sendChannel) try {
                        this.sendChannel.send(a);
                    } catch (a) {
                        this.raiseSendError(a);
                    } else this.raiseSendError(new Error("No send channel"));
                }
            }, {
                key: "raiseSendError",
                value: function(a) {
                    this.errorCallback && this.errorCallback(a);
                }
            }, {
                key: "assignEvent",
                value: function(a, b, c) {
                    a.addEventListener ? a.addEventListener(b, c.bind(this), !1) : a.attachEvent && (b = "on" + b, 
                    a.attachEvent(b, c.bind(this)));
                }
            }, {
                key: "connect",
                value: function(a) {
                    var b = this;
                    this.reset();
                    var c = new i(function(a, c) {
                        b.resolveCb = a, b.rejectCb = c;
                    });
                    this.iceServers = a;
                    var d = null;
                    try {
                        if (RTCPeerConnection ? d = RTCPeerConnection : webkitRTCPeerConnection ? d = webkitRTCPeerConnection : mozRTCPeerConnection ? d = mozRTCPeerConnection : window && window.RTCPeerConnection && (d = window.RTCPeerConnection), 
                        !d) {
                            var e = new Error("RTCPeerConnection not found");
                            return e.continueFlag = !1, this.rejectCb(e), c;
                        }
                    } catch (e) {
                        return e.continueFlag = !1, this.rejectCb(e), c;
                    }
                    var f = {
                        ordered: !1,
                        maxRetransmits: 0
                    }, g = {
                        iceTransportPolicy: "all",
                        iceServers: this.iceServers
                    };
                    try {
                        this.pctpc1 = new d(g), this.pctpc2 = new d(g);
                    } catch (e) {
                        return this.rejectDisconnect(!1, e), c;
                    }
                    this.connectionTimer = setTimeout(function() {
                        delete b.connectionTimer, b.rejectDisconnect(!1, new Error("Connection timeout"));
                    }, 3e4);
                    try {
                        this.sendChannel = this.pctpc1.createDataChannel("precalltest", f), this.sendChannel.binaryType = "arraybuffer", 
                        this.assignEvent(this.sendChannel, "error", function(a) {
                            b.raiseSendError(a), b.rejectDisconnect(!0, a);
                        }), this.assignEvent(this.pctpc2, "datachannel", function(a) {
                            var c = a.channel;
                            b.assignEvent(c, "open", function(a) {
                                b.resolveCb && (b.resolveCb(), b.resolveCb = null);
                            }), b.assignEvent(c, "close", function(a) {
                                b && b.disconnect && b.disconnect();
                            }), b.assignEvent(c, "message", function(a) {
                                b.messageCallback && b.messageCallback(a.data);
                            }), b.assignEvent(c, "error", function(a) {
                                b.errorCallback && b.errorCallback(a), b.rejectDisconnect(!0, a);
                            });
                        });
                    } catch (e) {
                        return this.rejectDisconnect(!1, e), c;
                    }
                    try {
                        this.assignEvent(this.pctpc1, "icecandidate", function(a) {
                            b.onIceCandidate(b.pctpc1, a);
                        }), this.assignEvent(this.pctpc1, "iceconnectionstatechange", function(a) {
                            b.onIceStateChange(b.pctpc1, a);
                        }), this.assignEvent(this.pctpc2, "icecandidate", function(a) {
                            b.onIceCandidate(b.pctpc2, a);
                        }), this.assignEvent(this.pctpc2, "iceconnectionstatechange", function(a) {
                            b.onIceStateChange(b.pctpc2, a);
                        }), this.pctpc1.createOffer().then(function(a, c) {
                            b.onCreateOfferSuccess(a);
                        }, function(a) {
                            b.onCreateOfferError(b.pctpc1, a);
                        });
                    } catch (e) {
                        return this.rejectDisconnect(!1, e), c;
                    }
                    return c;
                }
            }, {
                key: "rejectDisconnect",
                value: function(a, b) {
                    this.disconnect(), this.rejectCb && (b.continueFlag = a, this.rejectCb(b)), this.resolveCb = null, 
                    this.rejectCb = null;
                }
            }, {
                key: "disconnect",
                value: function() {
                    if (clearTimeout(this.connectionTimer), clearTimeout(this.iceTimer), this.pctpc1) try {
                        this.pctpc1.close();
                    } catch (a) {}
                    if (this.pctpc1 = null, this.pctpc2) try {
                        this.pctpc2.close();
                    } catch (a) {}
                    this.pctpc2 = null;
                }
            }, {
                key: "getName",
                value: function(a) {
                    return a === this.pctpc1 ? "pctpc1" : "pctpc2";
                }
            }, {
                key: "getOtherPc",
                value: function(a) {
                    return a === this.pctpc1 ? this.pctpc2 : this.pctpc1;
                }
            }, {
                key: "onCreateOfferError",
                value: function(a, b) {
                    this.rejectDisconnect(!1, b);
                }
            }, {
                key: "onCreateAnswerError",
                value: function(a, b) {
                    this.rejectDisconnect(!1, b);
                }
            }, {
                key: "onCreateOfferSuccess",
                value: function(a) {
                    var b = this;
                    try {
                        this.pctpc1.setLocalDescription(a).then(function() {
                            b.onSetLocalSuccess(b.pctpc1);
                        }, function(a) {
                            b.onSetSessionDescriptionError(b.pctpc1, a);
                        }), this.pctpc2.setRemoteDescription(a).then(function() {
                            b.onSetRemoteSuccess(b.pctpc2);
                        }, function(a) {
                            b.onSetRemoteSessionDescriptionError(b.pctpc2, a);
                        }), this.pctpc2.createAnswer().then(function(a) {
                            b.onCreateAnswerSuccess(a);
                        }, function(a) {
                            b.onCreateAnswerError(b.pctpc2, a);
                        });
                    } catch (a) {
                        this.rejectDisconnect(!1, a);
                    }
                }
            }, {
                key: "onSetLocalSuccess",
                value: function(a) {}
            }, {
                key: "onSetRemoteSuccess",
                value: function(a) {}
            }, {
                key: "onSetSessionDescriptionError",
                value: function(a, b) {
                    this.rejectDisconnect(!1, b);
                }
            }, {
                key: "onSetRemoteSessionDescriptionError",
                value: function(a, b) {
                    this.rejectDisconnect(!1, b);
                }
            }, {
                key: "onCreateAnswerSuccess",
                value: function(a) {
                    var b = this;
                    try {
                        this.pctpc2.setLocalDescription(a).then(function() {
                            b.onSetLocalSuccess(b.pctpc2);
                        }, function(a) {
                            b.onSetSessionDescriptionError(b.pctpc2, a);
                        }), this.pctpc1.setRemoteDescription(a).then(function() {
                            b.onSetRemoteSuccess(b.pctpc1);
                        }, function(a) {
                            b.onSetRemoteSessionDescriptionError(b.pctpc1, a);
                        });
                    } catch (a) {
                        this.rejectDisconnect(!1, a);
                    }
                }
            }, {
                key: "onIceCandidate",
                value: function(a, b) {
                    var c = this;
                    try {
                        if (!b.candidate) return;
                        var d = new f.ParsedIceCandidate(b.candidate);
                        if (a == this.pctpc1 && this.statshandler.codeBase == h.Constants.codeBaseType.chrome && (d.isRelay() && (d.isTypeTransportUdp() && (this.parsedIceResults.relayUdpGathered = !0), 
                        d.isTypeTransportTcp() && (this.parsedIceResults.relayTcpGathered = !0), d.isTypeTransportTls() && (this.parsedIceResults.relayTlsGathered = !0)), 
                        d.isServerReflexive() && (this.parsedIceResults.srflxGathered = !0)), !d.isRelay()) return;
                        this.getOtherPc(a).addIceCandidate(b.candidate).then(function() {
                            c.onAddIceCandidateSuccess(a);
                        }, function(b) {
                            c.onAddIceCandidateError(a, b, d.isRelay());
                        });
                    } catch (a) {
                        this.rejectDisconnect(!1, a);
                    }
                }
            }, {
                key: "onAddIceCandidateSuccess",
                value: function(a) {}
            }, {
                key: "onAddIceCandidateError",
                value: function(a, b, c) {
                    c && this.rejectDisconnect(!1, b);
                }
            }, {
                key: "onIceStateChange",
                value: function(a, b) {
                    var c = this;
                    try {
                        var d = "(?)";
                        a && (d = a.iceConnectionState), "failed" === d && this.rejectDisconnect(!0, new Error("ICE failure")), 
                        "checking" !== d || this.iceTimer || (this.iceTimer = setTimeout(function() {
                            delete c.iceTimer, c.rejectDisconnect(!0, new Error("ICE timeout"));
                        }, 1e4)), "completed" !== d && "connected" !== d || (clearTimeout(this.iceTimer), 
                        delete this.iceTimer);
                    } catch (a) {
                        this.rejectDisconnect(!1, a);
                    }
                }
            }, {
                key: "getIceResults",
                value: function() {
                    var a = this;
                    return new i(function(b, c) {
                        for (var d = JSON.parse(JSON.stringify(a.iceServers)), e = 0; e < d.length; e++) {
                            var f = d[e];
                            d.hasOwnProperty(f) || delete f.credential;
                        }
                        var g = {
                            turnIpAddress: "",
                            turnIpVersion: "",
                            turnTransport: "",
                            iceServers: d,
                            ipv6Supported: !1,
                            ipv4Supported: !1,
                            relayTlsGathered: !1,
                            relayTcpGathered: !1,
                            relayUdpGathered: !1,
                            srflxGathered: !1,
                            relayTlsSuccess: !1,
                            relayTcpSuccess: !1,
                            relayUdpSuccess: !1,
                            srflxSuccess: !1
                        };
                        for (var h in a.parsedIceResults) a.parsedIceResults.hasOwnProperty(h) && (g[h] = a.parsedIceResults[h]);
                        a.pctpc1 ? a.statshandler.getIceCandidates(a.pctpc1).then(function(a) {
                            for (var c = 0; c < a.iceCandidatePairs.length; c++) {
                                var d = a.iceCandidatePairs[c];
                                if (d.googActiveConnection || d.selected) for (var e = 0; e < a.localCandidates.length; e++) {
                                    var f = a.localCandidates[e], h = null;
                                    if (h = f.ip ? f.ip : f.ipAddress, f.id == d.localCandidateId) {
                                        g.turnIpAddress = h;
                                        var i = -1 !== h.indexOf(":");
                                        g.turnIpVersion = i ? "ipv6" : "ipv4", g.turnTransport = f.mozLocalTransport;
                                    }
                                    "relay" !== f.candidateType && "relayed" !== f.candidateType || ("udp" === f.mozLocalTransport && (g.relayUdpSuccess = !0), 
                                    "tcp" === f.mozLocalTransport && (g.relayTcpSuccess = !0), "tls" === f.mozLocalTransport && (g.relayTlsSuccess = !0)), 
                                    -1 !== h.indexOf(":") ? g.ipv6Supported = !0 : g.ipv4Supported = !0;
                                }
                            }
                            for (var j = 0; j < a.localCandidates.length; j++) {
                                var k = a.localCandidates[j];
                                "relay" !== k.candidateType && "relayed" !== k.candidateType || ("udp" === k.mozLocalTransport && (g.relayUdpGathered = !0), 
                                "tcp" === k.mozLocalTransport && (g.relayTcpGathered = !0), "tls" === k.mozLocalTransport && (g.relayTlsGathered = !0)), 
                                "srflx" !== k.candidateType && "serverreflexive" !== k.candidateType || (g.srflxGathered = !0);
                            }
                            for (var l = 0; l < a.iceCandidatePairs.length; l++) {
                                var m = a.iceCandidatePairs[l];
                                if ("succeeded" === m.state) for (var n = 0; n < a.localCandidates.length; n++) {
                                    var o = a.localCandidates[n];
                                    o.id == m.localCandidateId && ("relay" !== o.candidateType && "relayed" !== o.candidateType || ("udp" === o.mozLocalTransport && (g.relayUdpSuccess = !0), 
                                    "tcp" === o.mozLocalTransport && (g.relayTcpSuccess = !0), "tls" === o.mozLocalTransport && (g.relayTlsSuccess = !0)), 
                                    "srflx" !== o.candidateType && "serverreflexive" !== o.candidateType || (g.srflxSuccess = !0));
                                }
                            }
                            b(g);
                        }, function(a) {
                            c(a);
                        }) : c(new Error("PC not available for stats"));
                    }, function(a) {
                        reject(a);
                    });
                }
            } ]), a;
        }();
        c.TurnConnection = j;
    }, {
        "./utility/parsedIceCandidate": 9,
        "./utility/stats/detectbrowser": 11,
        "./utility/stats/getstatshandler": 12,
        bluebird: 1
    } ],
    7: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function e(a) {
            for (var b = "", c = 0; c < a; c++) b += String.fromCharCode(35 + 58 * Math.random());
            return b;
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.randomAsciiString = c.MessageMaker = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../utility/timestamps"), h = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(g), i = function() {
            function a() {
                var b = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 1200;
                d(this, a), this.message = {
                    timestamp: "",
                    sentBytes: 1e4,
                    padding: ""
                };
                var c = e(b - h.getCurrent().toString().length - JSON.stringify(this.message).length);
                this.message.padding = c;
            }
            return f(a, [ {
                key: "make",
                value: function(a) {
                    return this.message.timestamp = h.getCurrent(), this.message.sentBytes = a, JSON.stringify(this.message);
                }
            } ]), a;
        }();
        c.MessageMaker = i, c.randomAsciiString = e;
    }, {
        "../utility/timestamps": 14
    } ],
    8: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.OnlineCheck = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./timestamps"), g = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(f), h = function() {
            function a() {
                d(this, a), this.active = !1;
            }
            return e(a, [ {
                key: "start",
                value: function() {
                    var a = this;
                    this.active = !0, this.onlineCheck = [], window && window.addEventListener && "function" == typeof window.addEventListener && (window.addEventListener("offline", function() {
                        a.addEntry();
                    }), window.addEventListener("online", function() {
                        a.addEntry();
                    }), this.addEntry());
                }
            }, {
                key: "addEntry",
                value: function() {
                    if (this.active) {
                        var a = g.getCurrent();
                        if (navigator && navigator.onLine) {
                            var b = navigator.onLine;
                            this.onlineCheck.push({
                                timestamp: a,
                                online: b
                            });
                        }
                    }
                }
            }, {
                key: "stop",
                value: function() {
                    var a = this;
                    return this.active = !1, window && window.removeEventListener && "function" == typeof window.removeEventListener && (window.removeEventListener("offline", function() {
                        a.addEntry();
                    }), window.removeEventListener("online", function() {
                        a.addEntry();
                    })), this.onlineCheck;
                }
            } ]), a;
        }();
        c.OnlineCheck = h;
    }, {
        "./timestamps": 14
    } ],
    9: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a(b) {
                d(this, a), this.iceCandidateStr = b.candidate, this.parse();
            }
            return e(a, [ {
                key: "parse",
                value: function() {
                    var a = this.iceCandidateStr.split(" ");
                    a.length < 8 || (this.protocol = "1" === a[1] ? "rtp" : "rtcp", this.transport = a[2], 
                    this.typeTransport = this.extractTypeTransport(a[3]), this.ipv6 = -1 !== a[4].indexOf(":"), 
                    this.ipAddress = a[4], this.port = a[5], this.type = a[7]);
                }
            }, {
                key: "extractTypeTransport",
                value: function(a) {
                    var b = "None", c = a >> 24;
                    if ("rtp" === this.protocol && c >= 0 && c <= 2) switch (c) {
                      case 0:
                        b = "TLS";
                        break;

                      case 1:
                        b = "TCP";
                        break;

                      case 2:
                        b = "UDP";
                    }
                    return b;
                }
            }, {
                key: "getString",
                value: function() {
                    return this.iceCandidateStr;
                }
            }, {
                key: "getType",
                value: function() {
                    return this.type;
                }
            }, {
                key: "isHost",
                value: function() {
                    return "host" === this.type.toLowerCase();
                }
            }, {
                key: "isServerReflexive",
                value: function() {
                    return "srflx" === this.type.toLowerCase();
                }
            }, {
                key: "isPeerReflexive",
                value: function() {
                    return "prflx" === this.type.toLowerCase();
                }
            }, {
                key: "isRelay",
                value: function() {
                    return "relay" === this.type.toLowerCase() || "relayed" === this.type.toLowerCase();
                }
            }, {
                key: "getTypeTransport",
                value: function() {
                    return this.typeTransport;
                }
            }, {
                key: "isTypeTransportUdp",
                value: function() {
                    return "UDP" === this.typeTransport;
                }
            }, {
                key: "isTypeTransportTcp",
                value: function() {
                    return "TCP" === this.typeTransport;
                }
            }, {
                key: "isTypeTransportTls",
                value: function() {
                    return "TLS" === this.typeTransport;
                }
            }, {
                key: "getTransport",
                value: function() {
                    return this.transport;
                }
            }, {
                key: "isUdp",
                value: function() {
                    return "udp" === this.transport.toLowerCase();
                }
            }, {
                key: "isTcp",
                value: function() {
                    return "tcp" === this.transport.toLowerCase();
                }
            }, {
                key: "getProtocol",
                value: function() {
                    return this.protocol;
                }
            }, {
                key: "isRtp",
                value: function() {
                    return "rtp" === this.protocol;
                }
            }, {
                key: "isRtcp",
                value: function() {
                    return "rtcp" === this.protocol;
                }
            }, {
                key: "isIpv6",
                value: function() {
                    return this.ipv6;
                }
            }, {
                key: "getIpAddress",
                value: function() {
                    return this.ipAddress;
                }
            }, {
                key: "getPort",
                value: function() {
                    return this.port;
                }
            } ]), a;
        }();
        c.ParsedIceCandidate = f;
    }, {} ],
    10: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.ResultsHandler = void 0;
        var e = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {
            return typeof a;
        } : function(a) {
            return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;
        }, f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("./timestamps"), h = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(g), i = a("./messageMaker"), j = function() {
            function a() {
                d(this, a), this.start = h.getCurrent(), this.id = Math.trunc(this.start) + "-" + (0, 
                i.randomAsciiString)(20), this.version = "1.2.0", this.failures = [], this.results = {}, 
                this.forceStopped = !1;
            }
            return f(a, [ {
                key: "getResults",
                value: function() {
                    return {
                        id: this.id,
                        version: this.version,
                        forceStopped: this.forceStopped,
                        startTimestamp: this.start,
                        endTimestamp: h.getCurrent(),
                        failures: this.failures,
                        tests: this.results
                    };
                }
            }, {
                key: "getFailureNumber",
                value: function() {
                    return this.failures.length;
                }
            }, {
                key: "getId",
                value: function() {
                    return this.id;
                }
            }, {
                key: "add",
                value: function(a, b) {
                    this.results[a] = b, b.forceStopped && !0 === b.forceStopped && (this.forceStopped = !0);
                }
            }, {
                key: "failure",
                value: function(a) {
                    "object" === (void 0 === a ? "undefined" : e(a)) && (a = a.toString());
                    var b = {
                        timestamp: h.getCurrent(),
                        reason: a
                    };
                    this.failures.push(b);
                }
            } ]), a;
        }();
        c.ResultsHandler = j;
    }, {
        "./messageMaker": 7,
        "./timestamps": 14
    } ],
    11: [ function(a, b, c) {
        "use strict";
        function d() {
            var a = e.browserName.chrome, b = null, c = null, d = null, f = e.codeBaseType.chrome;
            if (window && (!window.navigator || !window.navigator.userAgent || window.csioReactNative)) return window && window.csioGetOsName && (b = window.csioGetOsName()), 
            window && window.csioGetOsVer && (c = window.csioGetOsVer()), window && window.csioReactNative && (d = "react-native"), 
            {
                browserName: a,
                codeBase: f,
                os: b,
                osVersion: c,
                userAgent: d
            };
            var g = (d = navigator.userAgent).toLowerCase(), h = navigator.appVersion, i = "" + parseFloat(navigator.appVersion), j = void 0;
            -1 !== (j = g.indexOf("opera")) ? (a = e.browserName.opera, i = g.substring(j + 6), 
            -1 !== (j = g.indexOf("Version")) && (i = g.substring(j + 8)), f = e.codeBaseType.chrome) : -1 !== (j = g.indexOf("opr")) ? (a = e.browserName.opera, 
            i = g.substring(j + 4), -1 !== (j = g.indexOf("Version")) && (i = g.substring(j + 8)), 
            f = e.codeBaseType.chrome) : -1 !== (j = g.indexOf("msie")) ? (a = e.browserName.msie, 
            i = g.substring(j + 5), f = e.codeBaseType.chrome) : -1 !== (j = g.indexOf("edge")) ? (a = e.browserName.edge, 
            i = g.substring(j + 5), f = e.codeBaseType.edge) : -1 !== (j = g.indexOf("chrome")) ? (a = e.browserName.chrome, 
            i = g.substring(j + 7), f = e.codeBaseType.chrome) : -1 !== (j = g.indexOf("safari")) ? (a = e.browserName.safari, 
            i = g.substring(j + 7), -1 !== (j = g.indexOf("Version")) && (i = g.substring(j + 8)), 
            f = e.codeBaseType.chrome) : -1 !== (j = g.indexOf("firefox")) ? (a = e.browserName.firefox, 
            i = g.substring(j + 8), f = e.codeBaseType.firefox) : -1 !== (j = g.indexOf("trident")) && (a = e.browserName.msie, 
            j = g.indexOf("rv"), i = g.substring(j + 3, j + 7), f = e.codeBaseType.chrome);
            var k = [ {
                s: "Windows 3.11",
                r: /win16/
            }, {
                s: "Windows 95",
                r: /(windows 95|win95|windows_95)/
            }, {
                s: "Windows ME",
                r: /(win 9x 4.90|windows me)/
            }, {
                s: "Windows 98",
                r: /(windows 98|win98)/
            }, {
                s: "Windows CE",
                r: /windows ce/
            }, {
                s: "Windows 2000",
                r: /(windows nt 5.0|windows 2000)/
            }, {
                s: "Windows XP",
                r: /(windows nt 5.1|windows xp)/
            }, {
                s: "Windows Server 2003",
                r: /windows nt 5.2/
            }, {
                s: "Windows Vista",
                r: /windows nt 6.0/
            }, {
                s: "Windows 7",
                r: /(windows 7|windows nt 6.1)/
            }, {
                s: "Windows 8.1",
                r: /(windows 8.1|windows nt 6.3)/
            }, {
                s: "Windows 8",
                r: /(windows 8|windows nt 6.2)/
            }, {
                s: "Windows 10",
                r: /(windows 10|windows nt 10.0)/
            }, {
                s: "Windows NT 4.0",
                r: /(windows nt 4.0|winnt4.0|winnt|windows nt)/
            }, {
                s: "Windows ME",
                r: /windows me/
            }, {
                s: "Android",
                r: /android/
            }, {
                s: "Open BSD",
                r: /openbsd/
            }, {
                s: "Sun OS",
                r: /sunos/
            }, {
                s: "Linux",
                r: /(linux|x11)/
            }, {
                s: "iOS",
                r: /(iphone|ipad|ipod)/
            }, {
                s: "Mac OS X",
                r: /mac os x/
            }, {
                s: "Mac OS",
                r: /(macppc|macintel|mac_powerpc|macintosh)/
            }, {
                s: "QNX",
                r: /qnx/
            }, {
                s: "UNIX",
                r: /unix/
            }, {
                s: "BeOS",
                r: /beos/
            }, {
                s: "OS/2",
                r: /os\/2/
            }, {
                s: "Search Bot",
                r: /(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\/teoma|ia_archiver)/
            } ], l = void 0, m = void 0;
            for (l in k) if (k.hasOwnProperty(l) && (m = k[l]).r.test(g)) {
                b = m.s;
                break;
            }
            switch (b && /Windows/.test(b) && (c = /Windows (.*)/.exec(b)[1], b = e.osName.windows), 
            b) {
              case e.osName.mac:
                c = /mac os x (10[\.\_\d]+)/.exec(g)[1];
                break;

              case e.osName.android:
                c = /android ([\.\_\d]+)/.exec(g)[1];
                break;

              case e.osName.ios:
                c = (c = /os (\d+)_(\d+)_?(\d+)?/.exec(h))[1] + "." + c[2] + "." + (0 | c[3]);
            }
            return {
                browserName: a,
                browserVersion: i.toString(),
                os: b,
                osVersion: c,
                codeBase: f,
                userAgent: d
            };
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.detect = d;
        var e = c.Constants = {
            codeBaseType: {
                chrome: "Chrome",
                firefox: "Firefox",
                edge: "Edge",
                plugin: "Plugin"
            },
            browserName: {
                chrome: "Chrome",
                firefox: "Firefox",
                edge: "Edge",
                msie: "Microsoft Internet Explorer",
                safari: "Safari"
            },
            osName: {
                windows: "Windows",
                mac: "Mac OS X",
                android: "Android",
                ios: "iOS"
            }
        };
    }, {} ],
    12: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.GetStatsHandler = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./detectbrowser"), g = a("./statsadapter"), h = a("bluebird"), i = function() {
            function a(b) {
                d(this, a), this.codeBase = b.codeBase, this.browserName = b.browserName, this.adapter = new g.StatsAdapter(this.codeBase, this.browserName), 
                this.isPromiseBased = !0;
            }
            return e(a, [ {
                key: "getIceCandidates",
                value: function(a) {
                    var b = this;
                    return new h(function(c, d) {
                        b.csioGetStats(b.iceCandidatesHandler.bind(b), a, function(a) {
                            c(a);
                        });
                    });
                }
            }, {
                key: "iceCandidatesHandler",
                value: function(a, b) {
                    b(this.adapter.getIceCandidates(a));
                }
            }, {
                key: "csioGetStats",
                value: function(a, b, c) {
                    var d = f.Constants.codeBaseType.firefox, e = f.Constants.codeBaseType.chrome, g = f.Constants.codeBaseType.edge, h = f.Constants.browserName.safari;
                    b && (this.codeBase === d ? this.getStatsFirefox(a, b, c) : this.browserName === h ? this.getStatsSafari(a, b, c) : this.codeBase === e ? this.getStatsChrome(a, b, c) : this.codeBase === g && this.getStatsEdge(a, b, c));
                }
            }, {
                key: "getStatsFirefox",
                value: function(a, b, c) {
                    var d = this;
                    if (d.isPromiseBased) try {
                        b.getStats().then(function(b) {
                            a(b, c);
                        }).catch(function(e) {
                            d.isPromiseBased = !1, b.getStats(null, function(b) {
                                a(b, c);
                            }, function() {});
                        });
                    } catch (e) {
                        d.isPromiseBased = !1, b.getStats(null, function(b) {
                            a(b, c);
                        }, function() {});
                    } else b.getStats(null, function(b) {
                        a(b, c);
                    }, function() {});
                }
            }, {
                key: "getStatsChrome",
                value: function(a, b, c) {
                    var d = this;
                    if (window && window.csioReactNative) b.getStats(null, function(b) {
                        a(b, c);
                    }, function(a) {}); else if (d.isPromiseBased) try {
                        b.getStats().then(function(b) {
                            a(b, c);
                        }).catch(function(e) {
                            d.isPromiseBased = !1, b.getStats(function(b) {
                                a(b, c);
                            });
                        });
                    } catch (d) {
                        isPromiseBased = !1, b.getStats(function(b) {
                            a(b, c);
                        });
                    } else b.getStats(function(b) {
                        a(b, c);
                    });
                }
            }, {
                key: "getStatsEdge",
                value: function(a, b, c) {
                    b.getStats().then(function(b) {
                        a(b, c);
                    }).catch(function(a) {});
                }
            }, {
                key: "getStatsSafari",
                value: function(a, b, c) {
                    b.getStats().then(function(b) {
                        a(b, c);
                    }).catch(function(a) {});
                }
            } ]), a;
        }();
        c.GetStatsHandler = i;
    }, {
        "./detectbrowser": 11,
        "./statsadapter": 13,
        bluebird: 1
    } ],
    13: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.StatsAdapter = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./detectbrowser"), g = function() {
            function a(b, c) {
                d(this, a), this.codeBase = b, this.browser = c;
            }
            return e(a, [ {
                key: "getIceCandidates",
                value: function(a) {
                    if (!a) return null;
                    var b = this.extractRawStats(a);
                    return this.processRawStatsForIceInfo(b);
                }
            }, {
                key: "extractRawStats",
                value: function(a) {
                    var b = [], c = void 0, d = f.Constants.codeBaseType.firefox, e = f.Constants.codeBaseType.chrome, g = f.Constants.browserName.safari;
                    if (this.codeBase === d && this.browser !== g) a.forEach(function(a) {
                        b.push(a);
                    }); else if (this.codeBase === e && this.browser !== g) a && a.result ? b = a.result() : a && a.forEach && (b = [], 
                    a.forEach(function(a) {
                        b.push(a);
                    })); else for (c in a) a.hasOwnProperty(c) && b.push(a[c]);
                    return b;
                }
            }, {
                key: "processRawStatsForIceInfo",
                value: function(a) {
                    var b = [], c = [], d = [], e = void 0;
                    if (!a) return null;
                    for (var f = 0; f < a.length; ++f) {
                        var g = this.getParsedStats(a[f]), h = this.statsClassifier(g);
                        if (h.candidatePair) d.push(h.candidatePair); else if (h.transportStats) {
                            if ("transport" === h.transportStats.type) {
                                e = h.transportStats.selectedCandidatePairId;
                                continue;
                            }
                            d.push(h.transportStats);
                        } else if (h.localCandidate) {
                            var i = h.localCandidate;
                            if ("relay" == i.candidateType || "relayed" == i.candidateType) {
                                if (!i.mozLocalTransport) {
                                    var j = i.priority >> 24;
                                    i.mozLocalTransport = this.formatRelayType(j);
                                }
                                i.mozLocalTransport = i.mozLocalTransport.toLowerCase();
                            }
                            b.push(i);
                        } else h.remoteCandidate && c.push(h.remoteCandidate);
                    }
                    if (e) for (var k = 0; k < d.length; ++k) d[k].id === e && (d[k].googActiveConnection = "true");
                    return {
                        localCandidates: b,
                        remoteCandidates: c,
                        iceCandidatePairs: d
                    };
                }
            }, {
                key: "getParsedStats",
                value: function(a) {
                    var b = {};
                    if (a.timestamp instanceof Date && (b.timestamp = a.timestamp.getTime().toString()), 
                    a.type && (b.type = a.type), a.names) for (var c = a.names(), d = 0; d < c.length; ++d) b[c[d]] = a.stat(c[d]); else Object.assign(b, a);
                    if (b.values) {
                        for (var e = 0; e < b.values.length; e++) {
                            var f = b.values[e];
                            Object.assign(b, f);
                        }
                        delete b.values;
                    }
                    return b;
                }
            }, {
                key: "statsClassifier",
                value: function(a) {
                    var b = {}, c = function() {
                        for (var b = arguments.length, c = Array(b), d = 0; d < b; d++) c[d] = arguments[d];
                        for (var e = 0; e < c.length; e++) {
                            var f = c[e];
                            if (a.type === f) return !0;
                        }
                        return !1;
                    }, d = c("inbound-rtp", "inboundrtp"), e = "true" === a.isRemote || !0 === a.isRemote;
                    return d || c("outbound-rtp", "outboundrtp") ? (b.tracks = {}, b.tracks.data = a, 
                    b.tracks.ssrc = a.ssrc, b.tracks.streamType = d ? "inbound" : "outbound", b.tracks.reportType = "local", 
                    void 0 !== a.isRemote && (b.tracks.reportType = e ? "remote" : "local")) : c("candidatepair") && a.selected ? b.transportStats = a : c("localcandidate", "local-candidate") ? b.localCandidate = a : c("remotecandidate", "remote-candidate") ? b.remoteCandidate = a : c("transport", "googCandidatePair") ? b.transportStats = a : c("VideoBwe") ? b.bwe = a : c("track") ? b.trackStats = a : c("candidate-pair") ? b.candidatePair = a : c("codec") ? b.codec = a : c("ssrc") && (b.tracks = {}, 
                    b.tracks.data = a, b.tracks.ssrc = a.ssrc, b.tracks.reportType = "local", b.tracks.streamType = a.bytesSent ? "outbound" : "inbound"), 
                    b;
                }
            }, {
                key: "formatRelayType",
                value: function(a) {
                    var b = "none";
                    switch (a) {
                      case 0:
                        b = "tls";
                        break;

                      case 1:
                        b = "tcp";
                        break;

                      case 2:
                        b = "udp";
                    }
                    return b;
                }
            } ]), a;
        }();
        c.StatsAdapter = g;
    }, {
        "./detectbrowser": 11
    } ],
    14: [ function(a, b, c) {
        "use strict";
        function d() {
            return window && window.performance && window.performance.now && window.performance.timing && window.performance.timing.navigationStart ? window.performance.now() + window.performance.timing.navigationStart : Date.now();
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.getCurrent = d;
    }, {} ],
    15: [ function(a, b, c) {
        function d() {
            throw new Error("setTimeout has not been defined");
        }
        function e() {
            throw new Error("clearTimeout has not been defined");
        }
        function f(a) {
            if (l === setTimeout) return setTimeout(a, 0);
            if ((l === d || !l) && setTimeout) return l = setTimeout, setTimeout(a, 0);
            try {
                return l(a, 0);
            } catch (b) {
                try {
                    return l.call(null, a, 0);
                } catch (b) {
                    return l.call(this, a, 0);
                }
            }
        }
        function g(a) {
            if (m === clearTimeout) return clearTimeout(a);
            if ((m === e || !m) && clearTimeout) return m = clearTimeout, clearTimeout(a);
            try {
                return m(a);
            } catch (b) {
                try {
                    return m.call(null, a);
                } catch (b) {
                    return m.call(this, a);
                }
            }
        }
        function h() {
            q && o && (q = !1, o.length ? p = o.concat(p) : r = -1, p.length && i());
        }
        function i() {
            if (!q) {
                var a = f(h);
                q = !0;
                for (var b = p.length; b; ) {
                    for (o = p, p = []; ++r < b; ) o && o[r].run();
                    r = -1, b = p.length;
                }
                o = null, q = !1, g(a);
            }
        }
        function j(a, b) {
            this.fun = a, this.array = b;
        }
        function k() {}
        var l, m, n = b.exports = {};
        !function() {
            try {
                l = "function" == typeof setTimeout ? setTimeout : d;
            } catch (a) {
                l = d;
            }
            try {
                m = "function" == typeof clearTimeout ? clearTimeout : e;
            } catch (a) {
                m = e;
            }
        }();
        var o, p = [], q = !1, r = -1;
        n.nextTick = function(a) {
            var b = new Array(arguments.length - 1);
            if (arguments.length > 1) for (var c = 1; c < arguments.length; c++) b[c - 1] = arguments[c];
            p.push(new j(a, b)), 1 !== p.length || q || f(i);
        }, j.prototype.run = function() {
            this.fun.apply(null, this.array);
        }, n.title = "browser", n.browser = !0, n.env = {}, n.argv = [], n.version = "", 
        n.versions = {}, n.on = k, n.addListener = k, n.once = k, n.off = k, n.removeListener = k, 
        n.removeAllListeners = k, n.emit = k, n.prependListener = k, n.prependOnceListener = k, 
        n.listeners = function(a) {
            return [];
        }, n.binding = function(a) {
            throw new Error("process.binding is not supported");
        }, n.cwd = function() {
            return "/";
        }, n.chdir = function(a) {
            throw new Error("process.chdir is not supported");
        }, n.umask = function() {
            return 0;
        };
    }, {} ],
    16: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a() {
                var b = this;
                d(this, a), this.batteryManager = null, "function" == typeof navigator.getBattery && navigator.getBattery().then(function(a) {
                    b.batteryManager = a;
                });
            }
            return e(a, [ {
                key: "getLevel",
                value: function() {
                    return this.batteryManager ? this.batteryManager.level : -1;
                }
            }, {
                key: "getCharging",
                value: function() {
                    return this.batteryManager ? this.batteryManager.charging : null;
                }
            } ]), a;
        }();
        c.Battery = f;
    }, {} ],
    17: [ function(a, b, c) {
        "use strict";
        function d() {
            var a = f.browserName.chrome, b = null, c = null, d = null, e = null, g = f.codeBaseType.chrome;
            if (!window.navigator.userAgent || window.csioReactNative) return window && window.csioGetOsName && (b = window.csioGetOsName()), 
            window && window.csioGetOsVer && (c = window.csioGetOsVer()), window && window.csioReactNative && (d = "react-native"), 
            {
                browserName: a,
                codeBase: g,
                os: b,
                osVersion: c,
                userAgent: d,
                browserVersion: null
            };
            d = navigator.userAgent;
            var h = d.toLowerCase();
            e = navigator.appVersion;
            var i = e.toLowerCase(), j = "" + parseFloat(i), k = void 0;
            -1 !== (k = h.indexOf("opera")) ? (a = f.browserName.opera, j = h.substring(k + 6), 
            -1 !== (k = h.indexOf("Version")) && (j = h.substring(k + 8)), g = f.codeBaseType.chrome) : -1 !== (k = h.indexOf("opr")) ? (a = f.browserName.opera, 
            j = h.substring(k + 4), -1 !== (k = h.indexOf("Version")) && (j = h.substring(k + 8)), 
            g = f.codeBaseType.chrome) : -1 !== (k = h.indexOf("msie")) ? (a = f.browserName.msie, 
            j = h.substring(k + 5), g = f.codeBaseType.chrome) : -1 !== (k = h.indexOf("edge")) ? (a = f.browserName.edge, 
            j = h.substring(k + 5), g = f.codeBaseType.edge) : -1 !== (k = h.indexOf("chrome")) ? (a = f.browserName.chrome, 
            j = h.substring(k + 7), g = f.codeBaseType.chrome) : -1 !== (k = h.indexOf("safari")) ? (a = f.browserName.safari, 
            j = h.substring(k + 7), -1 !== (k = h.indexOf("Version")) && (j = h.substring(k + 8)), 
            g = f.codeBaseType.chrome) : -1 !== (k = h.indexOf("firefox")) ? (a = f.browserName.firefox, 
            j = h.substring(k + 8), g = f.codeBaseType.firefox) : -1 !== (k = h.indexOf("trident")) && (a = f.browserName.msie, 
            k = h.indexOf("rv"), j = h.substring(k + 3, k + 7), g = f.codeBaseType.chrome);
            var l = [ {
                s: "Windows 3.11",
                r: /win16/
            }, {
                s: "Windows 95",
                r: /(windows 95|win95|windows_95)/
            }, {
                s: "Windows ME",
                r: /(win 9x 4.90|windows me)/
            }, {
                s: "Windows 98",
                r: /(windows 98|win98)/
            }, {
                s: "Windows CE",
                r: /windows ce/
            }, {
                s: "Windows 2000",
                r: /(windows nt 5.0|windows 2000)/
            }, {
                s: "Windows XP",
                r: /(windows nt 5.1|windows xp)/
            }, {
                s: "Windows Server 2003",
                r: /windows nt 5.2/
            }, {
                s: "Windows Vista",
                r: /windows nt 6.0/
            }, {
                s: "Windows 7",
                r: /(windows 7|windows nt 6.1)/
            }, {
                s: "Windows 8.1",
                r: /(windows 8.1|windows nt 6.3)/
            }, {
                s: "Windows 8",
                r: /(windows 8|windows nt 6.2)/
            }, {
                s: "Windows 10",
                r: /(windows 10|windows nt 10.0)/
            }, {
                s: "Windows NT 4.0",
                r: /(windows nt 4.0|winnt4.0|winnt|windows nt)/
            }, {
                s: "Windows ME",
                r: /windows me/
            }, {
                s: "Android",
                r: /android/
            }, {
                s: "Open BSD",
                r: /openbsd/
            }, {
                s: "Sun OS",
                r: /sunos/
            }, {
                s: "Linux",
                r: /(linux|x11)/
            }, {
                s: "iOS",
                r: /(iphone|ipad|ipod)/
            }, {
                s: "Mac OS X",
                r: /mac os x/
            }, {
                s: "Mac OS",
                r: /(macppc|macintel|mac_powerpc|macintosh)/
            }, {
                s: "QNX",
                r: /qnx/
            }, {
                s: "UNIX",
                r: /unix/
            }, {
                s: "BeOS",
                r: /beos/
            }, {
                s: "OS/2",
                r: /os\/2/
            }, {
                s: "Search Bot",
                r: /(nuhk|googlebot|yammybot|openbot|slurp|msnbot|ask jeeves\/teoma|ia_archiver)/
            } ], m = void 0, n = void 0;
            for (m in l) if (l.hasOwnProperty(m) && (n = l[m], n.r.test(h))) {
                b = n.s;
                break;
            }
            switch (b && /Windows/.test(b) && (c = /Windows (.*)/.exec(b)[1], b = f.osName.windows), 
            b) {
              case f.osName.mac:
                c = /mac os x (10[\.\_\d]+)/.exec(h)[1];
                break;

              case f.osName.android:
                c = /android ([\.\_\d]+)/.exec(h)[1];
                break;

              case f.osName.ios:
                if (!(c = /os (\d+)_(\d+)_?(\d+)?/.exec(i))) break;
                c = c[1] + "." + c[2] + "." + (0 | c[3]);
            }
            return {
                browserName: a,
                browserVersion: j.toString(),
                os: b,
                osVersion: c,
                codeBase: g,
                userAgent: d
            };
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.detect = d;
        var e = a("../config/constants"), f = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(e);
    }, {
        "../config/constants": 32
    } ],
    18: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.Devices = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../config/constants"), h = d(g), i = a("../utility/registry"), j = a("../utility/csiologger"), k = d(j), l = a("../utility/utils"), m = d(l), n = function() {
            function a(b, c) {
                e(this, a), this.conferenceId = b, this.pc = c, this.devices = null, this.emb = i.Registry.getEventMessageBuilder();
            }
            return f(a, [ {
                key: "collectConnected",
                value: function() {
                    var a = this;
                    if (navigator.mediaDevices && navigator.mediaDevices.enumerateDevices) {
                        var b = this;
                        navigator.mediaDevices.enumerateDevices().then(function(c) {
                            var d = m.normalizeMediaDeviceList(c);
                            b.sendConnected(d), setTimeout(a.collectConnected.bind(b), 1e4);
                        }).catch(function(c) {
                            setTimeout(a.collectConnected.bind(b), 1e4);
                        });
                    }
                }
            }, {
                key: "sendConnected",
                value: function(a) {
                    this.devices ? this.compare(a) || (this.devices = a, this.send()) : (this.devices = a, 
                    this.send());
                }
            }, {
                key: "compare",
                value: function(a) {
                    return self.devices.sort().toString() === a.sort().toString();
                }
            }, {
                key: "send",
                value: function() {
                    var a = {
                        mediaDeviceList: this.devices
                    };
                    k.log("sending connectedDevice", h.internalFabricEvent.connectedDeviceList, a), 
                    this.emb.make(h.internalFabricEvent.connectedDeviceList, this.conferenceId, this.pc, a);
                }
            } ]), a;
        }();
        c.Devices = n;
    }, {
        "../config/constants": 32,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "../utility/utils": 100
    } ],
    19: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (b) try {
                window && window.localStorage && window.localStorage.setItem(a, b);
            } catch (a) {
                return;
            }
        }
        function e(a) {
            try {
                if (window && window.localStorage) return window.localStorage.getItem(a);
            } catch (a) {
                return null;
            }
            return null;
        }
        function f(a) {
            try {
                window && window.localStorage && window.localStorage.removeItem(a);
            } catch (a) {
                return;
            }
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.store = d, c.get = e, c.remove = f;
    }, {} ],
    20: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (b) try {
                window && window.sessionStorage && window.sessionStorage.setItem(a, b);
            } catch (a) {
                return;
            }
        }
        function e(a) {
            try {
                if (window && window.sessionStorage) return window.sessionStorage.getItem(a);
            } catch (a) {
                return null;
            }
            return null;
        }
        function f(a) {
            try {
                window && window.sessionStorage && window.sessionStorage.removeItem(a);
            } catch (a) {
                return;
            }
        }
        function g(a, b) {
            if (a) {
                var c = JSON.parse(e("csio_ucid_data"));
                c || (c = {}), c[a] || (c[a] = {}), c[a].ucID = b, d("csio_ucid_data", JSON.stringify(c));
            }
        }
        function h(a) {
            if (!a) return null;
            var b = JSON.parse(e("csio_ucid_data"));
            return b && b[a] ? b[a].ucID : null;
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.store = d, c.get = e, c.remove = f, c.storeUcId = g, c.getUcId = h;
    }, {} ],
    21: [ function(a, b, c) {
        (function(c) {
            "use strict";
            function d(a) {
                if (a && a.__esModule) return a;
                var b = {};
                if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
                return b.default = a, b;
            }
            function e(a, b) {
                if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
            }
            function f(a, b) {
                var c = {};
                return c.status = a, b && (c.message = b), c;
            }
            function g(a, b) {
                return a + ": " + b + " " + (arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : "");
            }
            function h() {
                var a = null, b = r.Registry.getEndpoint().getBrowserName();
                return "Firefox" === b ? a = mozRTCPeerConnection : "Chrome" === b || "Opera" === b ? a = webkitRTCPeerConnection : "Safari" === b ? t.log("Browser type Safari") : "Edge" === b && (a = window.RTCPeerConnection), 
                a;
            }
            function i(a) {
                if (null === a) return !1;
                var b = r.Registry.getEndpoint().getCodeBase();
                if (b === m.codeBaseType.firefox) return "undefined" != typeof mozRTCPeerConnection && a instanceof mozRTCPeerConnection || "undefined" != typeof RTCPeerConnection && a instanceof RTCPeerConnection;
                if (b === m.codeBaseType.edge || "function" == typeof a) return !0;
                var c = h();
                return null !== c && a instanceof c || void 0 !== a.createOffer;
            }
            var j = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {
                return typeof a;
            } : function(a) {
                return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;
            }, k = function() {
                function a(a, b) {
                    for (var c = 0; c < b.length; c++) {
                        var d = b[c];
                        d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                        Object.defineProperty(a, d.key, d);
                    }
                }
                return function(b, c, d) {
                    return c && a(b.prototype, c), d && a(b, d), b;
                };
            }(), l = a("./config/constants"), m = d(l), n = a("./config/settings"), o = d(n), p = a("./config/callstatserrors"), q = a("./fsm/mainfsm"), r = a("./utility/registry"), s = a("./utility/csiologger"), t = d(s), u = a("./utility/onerroreventlistner"), v = d(u), w = a("./utility/utils"), x = d(w);
            v.setErrorEventListener(), x.assignPollyfill(), x.isIntegerPollyfill();
            var y = null, z = function() {
                function a() {
                    e(this, a), y = new q.MainFSM();
                }
                return k(a, [ {
                    key: "initialize",
                    value: function(a, b, c, d, e, h) {
                        if (!a || !c || !b) {
                            var i = g("initialize", p.csErrorStrings.argumentError);
                            return t.error(i), f(m.callstatsAPIReturnStatus.failure, i);
                        }
                        if (d && "function" != typeof d) {
                            var j = g("initialize", p.csErrorStrings.argumentError);
                            t.warn(j), d = null;
                        }
                        if (e && "function" != typeof e) {
                            var k = g("initialize", p.csErrorStrings.argumentError);
                            t.warn(k), e = null;
                        }
                        if ("function" != typeof b && !(window.crypto && (window.crypto.subtle || window.crypto.webkitSubtle) || window.msCrypto && window.msCrypto.subtle || window.csioReactNative)) {
                            var l = g("initialize", p.csErrorStrings.cryptoError);
                            return t.error(l), d && d(p.csError.tokenGenerationError, p.csErrorStrings.cryptoError), 
                            f(m.callstatsAPIReturnStatus.failure, l);
                        }
                        try {
                            y.fire(q.MainEvents.onInitialize, a, c, b, d, e, h), y.run();
                        } catch (a) {
                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {
                                msg: "initialize: Error",
                                error: a.message + ":" + a.stack
                            }), t.error("initialize: Error", a);
                        }
                        return f(m.callstatsAPIReturnStatus.success);
                    }
                }, {
                    key: "addNewFabric",
                    value: function(a, b, c, d, e, h) {
                        var j = null, k = m.endpointType.peer, l = m.transmissionDirection.sendrecv;
                        if (d || (d = m.tmpConferenceId), !a || !c) {
                            var n = g("addNewFabric", p.csErrorStrings.argumentError);
                            return t.error(n), f(m.callstatsAPIReturnStatus.failure, n);
                        }
                        if (h && "function" == typeof h && (j = h), e && "function" == typeof e && (j = e), 
                        e && "function" != typeof e) {
                            if (e.remoteEndpointType) {
                                if (!m.endpointType.hasOwnProperty(e.remoteEndpointType)) {
                                    var o = g("addNewFabric", p.csErrorStrings.invalidEndPointType, e.remoteEndpointType);
                                    return t.error(o), f(m.callstatsAPIReturnStatus.failure, o);
                                }
                                k = e.remoteEndpointType;
                            }
                            if (e.fabricTransmissionDirection) {
                                if (!m.transmissionDirection.hasOwnProperty(e.fabricTransmissionDirection)) {
                                    var s = g("addNewFabric", p.csErrorStrings.invalidTransmissionDirection, e.fabricTransmissionDirection);
                                    return t.error(s), f(m.callstatsAPIReturnStatus.failure, s);
                                }
                                l = e.fabricTransmissionDirection;
                            }
                        }
                        if (!m.fabricUsage.hasOwnProperty(c) || c instanceof Function) {
                            var u = g("addNewFabric", p.csErrorStrings.fabricUsageInvalid, c);
                            return t.error(u), f(m.callstatsAPIReturnStatus.failure, u);
                        }
                        if (!i(a)) {
                            var v = g("addNewFabric", p.csErrorStrings.pcInvalid);
                            return t.error(v), f(m.callstatsAPIReturnStatus.failure, v);
                        }
                        var w = r.Registry.getConferenceManager().get(d);
                        if (w) {
                            if (w.getPeerConnectionManager().getPcHandler(a)) return f(m.callstatsAPIReturnStatus.success);
                        }
                        if (!r.Registry.getCredentials().getAppId() || !r.Registry.getCredentials().getUserId()) {
                            var x = g("addNewFabric", p.csErrorStrings.notInitialized);
                            return t.error(x), f(m.callstatsAPIReturnStatus.failure, x);
                        }
                        try {
                            y.fire(q.MainEvents.onAddNewFabric, a, b, c, d, k, l, j), y.run();
                        } catch (a) {
                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {
                                msg: "addNewFabric: Error",
                                error: a.message + ":" + a.stack
                            }), t.error("addNewFabric: Error", a);
                        }
                        return f(m.callstatsAPIReturnStatus.success);
                    }
                }, {
                    key: "sendFabricEvent",
                    value: function(a, b, c, d) {
                        if (t.log("sendFabricEvent ", b), c || (c = m.tmpConferenceId), !a || !b) {
                            var e = g("sendFabricEvent", p.csErrorStrings.argumentError);
                            return t.error(e), f(m.callstatsAPIReturnStatus.failure, e);
                        }
                        if (b === m.fabricEvent.fabricSetupFailed) {
                            var h = g("sendFabricEvent", p.csErrorStrings.fabricEventUnsupported, b);
                            return t.error(h), f(m.callstatsAPIReturnStatus.failure, h);
                        }
                        if (!m.fabricEvent.hasOwnProperty(b) && !m.internalFabricEvent.hasOwnProperty(b)) {
                            var i = g("sendFabricEvent", p.csErrorStrings.fabricEventInvalid, b);
                            return t.error(i), f(m.callstatsAPIReturnStatus.failure, i);
                        }
                        if (!(b !== m.fabricEvent.activeDeviceList || d && d.deviceList)) {
                            var j = g("sendFabricEvent ", p.csErrorStrings.argumentError);
                            return t.error(j), f(m.callstatsAPIReturnStatus.failure, j);
                        }
                        var k = r.Registry.getConferenceManager().get(c);
                        if (!r.Registry.getCredentials().getAppId() || !r.Registry.getCredentials().getUserId() || !k) {
                            var l = g("sendFabricEvent ", p.csErrorStrings.notInitialized);
                            return t.error(l), f(m.callstatsAPIReturnStatus.failure, l);
                        }
                        if (!k.getPeerConnectionManager().getPcHandler(a)) {
                            var n = g("sendFabricEvent ", p.csErrorStrings.pcInvalid);
                            return t.error(n), f(m.callstatsAPIReturnStatus.failure, n);
                        }
                        try {
                            y.fire(q.MainEvents.onSendFabricEvent, a, b, c, d), y.run();
                        } catch (a) {
                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {
                                msg: "sendFabricEvent: Error",
                                error: a.message + ":" + a.stack
                            }), t.error("sendFabricEvent: Error", a);
                        }
                        return f(m.callstatsAPIReturnStatus.success);
                    }
                }, {
                    key: "sendUserFeedback",
                    value: function(a, b, c) {
                        if (!b || !a) {
                            var d = g("sendUserFeedback", p.csErrorStrings.argumentError);
                            return t.error(d), f(m.callstatsAPIReturnStatus.failure, d);
                        }
                        if ("object" !== (void 0 === b ? "undefined" : j(b))) {
                            var e = g("sendUserFeedback", p.csErrorStrings.argumentError);
                            return t.error(e), f(m.callstatsAPIReturnStatus.failure, e);
                        }
                        if (0 === Object.keys(b).length) {
                            var h = g("sendUserFeedback", p.csErrorStrings.argumentError);
                            return t.error(h), f(m.callstatsAPIReturnStatus.failure, h);
                        }
                        try {
                            y.fire(q.MainEvents.onSendUserFeedback, a, b, c), y.run();
                        } catch (a) {
                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {
                                msg: "sendUserFeedback: Error",
                                error: a.message + ":" + a.stack
                            }), t.error("sendUserFeedback: Error", a);
                        }
                        return f(m.callstatsAPIReturnStatus.success);
                    }
                }, {
                    key: "associateMstWithUserID",
                    value: function(a, b, c, d, e, h) {
                        if (c || (c = m.tmpConferenceId), !a || !d || !e) {
                            var j = g("associateMstWithUserID", p.csErrorStrings.argumentError);
                            return t.error(j), f(m.callstatsAPIReturnStatus.failure, j);
                        }
                        if (!i(a)) {
                            var k = g("associateMstWithUserID", p.csErrorStrings.pcInvalid);
                            return t.error(k), f(m.callstatsAPIReturnStatus.failure, k);
                        }
                        var l = r.Registry.getConferenceManager().get(c);
                        if (!l) {
                            var n = g("associateMstWithUserID", p.csErrorStrings.confereneDoesNotExist);
                            return t.error(n), f(m.callstatsAPIReturnStatus.failure, n);
                        }
                        if (!l.getPeerConnectionManager().getPcHandler(a)) {
                            var o = g("associateMstWithUserID", p.csErrorStrings.pcInvalid);
                            return t.error(o), f(m.callstatsAPIReturnStatus.failure, o);
                        }
                        h && "string" != typeof h && (t.error("associateMstWithUserID: Invalid videoTag"), 
                        h = null);
                        try {
                            y.fire(q.MainEvents.onAssociateMstWithUserID, a, b, c, d, e, h), y.run();
                        } catch (a) {
                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {
                                msg: "associateMstWithUserID: Error",
                                error: a.message + ":" + a.stack
                            }), t.error("associateMstWithUserID: Error", a);
                        }
                        return f(m.callstatsAPIReturnStatus.success);
                    }
                }, {
                    key: "reportError",
                    value: function(a, b, c, d, e, h) {
                        if (b || (b = m.tmpConferenceId), void 0 === a || !c) {
                            var i = g("reportError", p.csErrorStrings.argumentError);
                            return t.error(i), f(m.callstatsAPIReturnStatus.failure, i);
                        }
                        if (!m.webRTCFunctions.hasOwnProperty(c)) {
                            var j = g("reportError", p.csErrorStrings.webRTCFunctionsInvalid, c);
                            return t.error(j), f(m.callstatsAPIReturnStatus.failure, j);
                        }
                        if (void 0 === d && t.warn("reportError: Missing DOM error parameter"), !r.Registry.getCredentials().getAppId() || !r.Registry.getCredentials().getUserId()) {
                            var k = g("reportError", p.csErrorStrings.notInitialized);
                            return t.error(k), f(m.callstatsAPIReturnStatus.failure, k);
                        }
                        try {
                            y.fire(q.MainEvents.onReportError, a, b, c, d, e, h), y.run();
                        } catch (a) {
                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {
                                msg: "reportError: Error",
                                error: a.message + ":" + a.stack
                            }), t.error("reportError: Error", a);
                        }
                        return f(m.callstatsAPIReturnStatus.success);
                    }
                }, {
                    key: "setProxyConfig",
                    value: function(a) {
                        if (window && !window.csioproxy) {
                            var b = g("setProxyConfig", p.csErrorStrings.setProxyConfigInvokeError);
                            return t.error(b), f(m.callstatsAPIReturnStatus.failure, b);
                        }
                        if (!a) {
                            var c = g("setProxyConfig", p.csErrorStrings.argumentError);
                            return t.error(c), f(m.callstatsAPIReturnStatus.failure, c);
                        }
                        try {
                            y.fire(q.MainEvents.onSetProxyConfig, a), y.run();
                        } catch (a) {
                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {
                                msg: "setProxyConfig: Error",
                                error: a.message + ":" + a.stack
                            }), t.error("setProxyConfig: Error", a);
                        }
                        return f(m.callstatsAPIReturnStatus.success);
                    }
                }, {
                    key: "attachWifiStatsHandler",
                    value: function(a) {
                        if (!a) {
                            var b = g("attachWifiStatsHandler", p.csErrorStrings.argumentError);
                            return t.error(b), f(m.callstatsAPIReturnStatus.failure, b);
                        }
                        if ("function" != typeof a) {
                            var c = g("attachWifiStatsHandler", p.csErrorStrings.argumentError);
                            return t.error(c), f(m.callstatsAPIReturnStatus.failure, c);
                        }
                        try {
                            y.fire(q.MainEvents.onAttachWifiStatsHandler, a), y.run();
                        } catch (a) {
                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {
                                msg: "attachWifiStatsHandler: Error",
                                error: a.message + ":" + a.stack
                            }), t.error("attachWifiStatsHandler: Error", a);
                        }
                        return f(m.callstatsAPIReturnStatus.success);
                    }
                }, {
                    key: "setIdentifiers",
                    value: function(a, b) {
                        if (!a) {
                            var c = g("setIdentifiers", p.csErrorStrings.argumentError);
                            return t.error(c), f(m.callstatsAPIReturnStatus.failure, c);
                        }
                        try {
                            y.fire(q.MainEvents.onSetIdentifiers, a, b), y.run();
                        } catch (a) {
                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {
                                msg: "setIdentifiers: Error",
                                error: a.message + ":" + a.stack
                            }), t.error("setIdentifiers: Error", a);
                        }
                        return f(m.callstatsAPIReturnStatus.success);
                    }
                }, {
                    key: "makePrecallTest",
                    value: function() {
                        if (!r.Registry.getAuthenticator().getToken() || !r.Registry.getCredentials().getAppId()) {
                            var a = g("makePrecallTest", p.csErrorStrings.notInitialized);
                            return t.error(a), f(m.callstatsAPIReturnStatus.failure, a);
                        }
                        if (!r.Registry.getAuthenticator().getIceServers()) {
                            var b = g("makePrecallTest", p.csErrorStrings.notInitialized);
                            return t.error(b), f(m.callstatsAPIReturnStatus.failure, b);
                        }
                        if (!r.Registry.getCredentials().getCollectSDP()) {
                            var c = g("makePrecallTest", p.csErrorStrings.apiaccesserror);
                            return t.error(c), f(m.callstatsAPIReturnStatus.failure, c);
                        }
                        try {
                            y.fire(q.MainEvents.onMakePrecallTest), y.run();
                        } catch (a) {
                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {
                                msg: "on: Error",
                                error: a.message + ":" + a.stack
                            }), t.error("makePrecallTest: Error", a);
                        }
                        return f(m.callstatsAPIReturnStatus.success);
                    }
                }, {
                    key: "on",
                    value: function(a, b) {
                        if (!b || "function" != typeof b) {
                            var c = g("on", p.csErrorStrings.argumentError);
                            return t.error(c), f(m.callstatsAPIReturnStatus.failure, c);
                        }
                        if (!a || !m.callbackFunctions.hasOwnProperty(a)) {
                            var d = g("on", p.csErrorStrings.argumentError);
                            return t.error(d), f(m.callstatsAPIReturnStatus.failure, d);
                        }
                        try {
                            y.fire(q.MainEvents.onOn, a, b), y.run();
                        } catch (a) {
                            r.Registry.getGenericEventHandler().sendEvent(m.logEvents.error, {
                                msg: "on: Error",
                                error: a.message + ":" + a.stack
                            }), t.error("on: Error", a);
                        }
                        return f(m.callstatsAPIReturnStatus.success);
                    }
                }, {
                    key: "fabricUsage",
                    get: function() {
                        return this.constructor.fabricUsage;
                    }
                }, {
                    key: "fabricEvent",
                    get: function() {
                        return this.constructor.fabricEvent;
                    }
                }, {
                    key: "webRTCFunctions",
                    get: function() {
                        return this.constructor.webRTCFunctions;
                    }
                }, {
                    key: "csError",
                    get: function() {
                        return this.constructor.csError;
                    }
                }, {
                    key: "qualityRating",
                    get: function() {
                        return this.constructor.qualityRating;
                    }
                }, {
                    key: "callStatsAPIReturnStatus",
                    get: function() {
                        return this.constructor.callStatsAPIReturnStatus;
                    }
                }, {
                    key: "version",
                    get: function() {
                        return this.constructor.version;
                    }
                }, {
                    key: "userIDType",
                    get: function() {
                        return this.constructor.userIDType;
                    }
                }, {
                    key: "transmissionDirection",
                    get: function() {
                        return this.constructor.transmissionDirection;
                    }
                }, {
                    key: "endpointType",
                    get: function() {
                        return this.constructor.endpointType;
                    }
                } ]), a;
            }();
            z.fabricUsage = m.fabricUsage, z.fabricEvent = m.fabricEvent, z.webRTCFunctions = m.webRTCFunctions, 
            z.csError = p.csError, z.qualityRating = m.qualityRating, z.callStatsAPIReturnStatus = m.callstatsAPIReturnStatus, 
            z.version = o.version, z.userIDType = m.userIdType, z.endpointType = m.endpointType, 
            z.transmissionDirection = m.transmissionDirection, function() {
                function a() {
                    return new z();
                }
                "function" == typeof define && define.amd ? define("callstats", [], a) : c.callstats = a, 
                b.exports = a;
            }("undefined" != typeof window && window);
        }).call(this, "undefined" != typeof global ? global : "undefined" != typeof self ? self : "undefined" != typeof window ? window : {});
    }, {
        "./config/callstatserrors": 31,
        "./config/constants": 32,
        "./config/settings": 33,
        "./fsm/mainfsm": 34,
        "./utility/csiologger": 87,
        "./utility/onerroreventlistner": 93,
        "./utility/registry": 94,
        "./utility/utils": 100
    } ],
    22: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (Array.isArray(a)) {
                for (var b = 0, c = Array(a.length); b < a.length; b++) c[b] = a[b];
                return c;
            }
            return Array.from(a);
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.BinaryTree = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("./binarytreenode.js"), h = a("../utility/csiologger"), i = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(h), j = function() {
            function a(b) {
                e(this, a), this.root = null, this.top = null, this.bottom = null, this.comparator = b, 
                this.node_counter = 0, this.duplicate_counter = 0;
            }
            return f(a, [ {
                key: "getTopNode",
                value: function() {
                    return this.top;
                }
            }, {
                key: "getTopValue",
                value: function() {
                    return null === this.top ? null : this.top.peek();
                }
            }, {
                key: "getBottomValue",
                value: function() {
                    return null === this.bottom ? null : this.bottom.peek();
                }
            }, {
                key: "getBottomNode",
                value: function() {
                    return this.bottom;
                }
            }, {
                key: "getDuplicatedCounter",
                value: function() {
                    return this.duplicate_counter;
                }
            }, {
                key: "getNodeCounter",
                value: function() {
                    return this.node_counter;
                }
            }, {
                key: "getSize",
                value: function() {
                    return this.duplicate_counter + this.node_counter;
                }
            }, {
                key: "insertNodeAtTop",
                value: function(a) {
                    a && this.inserting(a.getValues(), this.top);
                }
            }, {
                key: "insertNodeAtBottom",
                value: function(a) {
                    a && this.inserting(a.getValues(), this.bottom);
                }
            }, {
                key: "insert",
                value: function(a) {
                    this.inserting([ a ], this.root);
                }
            }, {
                key: "createNode",
                value: function(a) {
                    var b = new (Function.prototype.bind.apply(g.BinaryTreeNode, [ null ].concat(d(a))))();
                    return null === this.top ? this.top = b : this.comparator(this.top.peek(), b.peek()) < 0 && (this.top = b), 
                    null === this.bottom ? this.bottom = b : this.comparator(b.peek(), this.bottom.peek()) < 0 && (this.bottom = b), 
                    b;
                }
            }, {
                key: "inserting",
                value: function(a, b) {
                    if (null === this.root) return this.root = this.createNode(a), this.node_counter = 1, 
                    void (this.duplicate_counter += a.length - 1);
                    for (var c = null, d = b, e = 0; null !== d; ) {
                        if (0 === (e = this.comparator(a[0], d.peek()))) return d.concat(a), this.duplicate_counter += a.length, 
                        void d.find(a[0]);
                        c = d, d = e < 0 ? d.getLeft() : d.getRight();
                    }
                    ++this.node_counter, this.duplicate_counter += a.length - 1, d = this.createNode(a), 
                    e < 0 ? c.setLeft(d) : c.setRight(d);
                }
            }, {
                key: "getRightist",
                value: function(a) {
                    for (var b = null; null !== a.right; ) b = a, a = a.right;
                    return [ a, b ];
                }
            }, {
                key: "getLeftist",
                value: function(a) {
                    for (var b = null; null !== a.getLeft(); ) b = a, a = a.getLeft();
                    return [ a, b ];
                }
            }, {
                key: "popBottomNode",
                value: function() {
                    if (null === this.bottom) return null;
                    var a = this.search(this.bottom.peek()), b = a[0], c = a[1];
                    return this.replaceNode(b, c, b.getRight()), this.disposeNode(b), --this.node_counter, 
                    this.duplicate_counter -= b.getLength() - 1, b.setRight(null), b;
                }
            }, {
                key: "popTopNode",
                value: function() {
                    if (null === this.top) return null;
                    var a = this.search(this.top.peek()), b = a[0], c = a[1];
                    return null === b ? null : (this.replaceNode(b, c, b.getLeft()), this.disposeNode(b), 
                    --this.node_counter, this.duplicate_counter -= b.getLength() - 1, b.setLeft(null), 
                    b);
                }
            }, {
                key: "search",
                value: function(a) {
                    for (var b = this.root, c = null, d = void 0; null !== b; ) {
                        if (0 === (d = this.comparator(a, b.peek()))) return b.find(a) ? [ b, c ] : [ null, null ];
                        c = b, b = d < 0 ? b.getLeft() : b.getRight();
                    }
                    return [ null, null ];
                }
            }, {
                key: "replaceNode",
                value: function(a, b, c) {
                    null !== b ? b.left === a ? b.left = c : b.right = c : this.root = c;
                }
            }, {
                key: "disposeNode",
                value: function(a) {
                    if (null === this.root) return void (this.bottom = this.top = null);
                    if (0 === this.comparator(this.top.peek(), a.peek())) {
                        var b = this.getRightist(this.root);
                        this.top = b[0];
                    }
                    if (0 === this.comparator(this.bottom.peek(), a.peek())) {
                        var c = this.getLeftist(this.root);
                        this.bottom = c[0];
                    }
                }
            }, {
                key: "delete",
                value: function(a) {
                    var b = this.search(a), c = b[0], d = b[1];
                    if (null === c) return !1;
                    if (1 < c.getLength()) return c.remove(a), --this.duplicate_counter, !0;
                    if (--this.node_counter, null === c.getLeft() && null === c.getRight()) this.replaceNode(c, d, null); else if (null === c.getLeft()) this.replaceNode(c, d, c.getRight()); else if (null === c.getRight()) this.replaceNode(c, d, c.getLeft()); else {
                        for (var e = c.getLeft(), f = c; null !== e.getRight(); f = e, e = e.getRight()) ;
                        var g = e.getLeft();
                        f === c ? f.setLeft(g) : f.setRight(g), c.setValues(e.getValues());
                    }
                    return this.disposeNode(c), !0;
                }
            }, {
                key: "logging",
                value: function() {
                    if (null === this.root) return void i.log("This tree is empty Duplicate Counter: " + this.duplicate_counter);
                    i.log("Size of the tree: " + this.getSize() + " Node: " + this.getNodeCounter() + " Duplicates: " + this.getDuplicatedCounter() + " Top: " + this.getTopNode().toString() + " Bottom: " + this.getBottomNode().toString()), 
                    function a(b, c, d) {
                        if (null !== b) {
                            for (var e = "-", f = 0; f < c; ++f) e += "--";
                            i.log(e + "> (" + d + ") [" + b.toString() + "]"), null !== b.getLeft() && a(b.getLeft(), c + 1, "Left"), 
                            null !== b.getRight() && a(b.getRight(), c + 1, "Right");
                        }
                    }(this.root, 0, "Root");
                }
            } ]), a;
        }();
        c.BinaryTree = j;
    }, {
        "../utility/csiologger": 87,
        "./binarytreenode.js": 23
    } ],
    23: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a() {
                d(this, a);
                for (var b = arguments.length, c = Array(b), e = 0; e < b; e++) c[e] = arguments[e];
                this.values = c, this.left = null, this.right = null;
            }
            return e(a, [ {
                key: "getRight",
                value: function() {
                    return this.right;
                }
            }, {
                key: "setRight",
                value: function(a) {
                    this.right = a;
                }
            }, {
                key: "getLeft",
                value: function() {
                    return this.left;
                }
            }, {
                key: "setLeft",
                value: function(a) {
                    this.left = a;
                }
            }, {
                key: "push",
                value: function(a) {
                    this.values.push(a);
                }
            }, {
                key: "concat",
                value: function(a) {
                    this.values = this.values.concat(a);
                }
            }, {
                key: "pop",
                value: function() {
                    return this.values.length < 1 ? null : this.values.shift();
                }
            }, {
                key: "remove",
                value: function(a) {
                    this.values.splice(this.values.indexOf(a), 1);
                }
            }, {
                key: "setValues",
                value: function(a) {
                    this.values = a;
                }
            }, {
                key: "getValues",
                value: function() {
                    return this.values;
                }
            }, {
                key: "hasValue",
                value: function() {
                    return 0 < this.values.length;
                }
            }, {
                key: "getLength",
                value: function() {
                    return this.values.length;
                }
            }, {
                key: "peek",
                value: function() {
                    return this.values.length < 1 ? null : this.values[0];
                }
            }, {
                key: "find",
                value: function(a) {
                    return this.values.find(function(b) {
                        return b === a;
                    });
                }
            }, {
                key: "toString",
                value: function() {
                    return this.values.toString();
                }
            } ]), a;
        }();
        c.BinaryTreeNode = f;
    }, {} ],
    24: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.Cache = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("../utility/csiologger"), g = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(f), h = function() {
            function a() {
                d(this, a), this.queue = [], this.priority = [];
            }
            return e(a, [ {
                key: "add",
                value: function(a) {
                    var b = arguments.length > 1 && void 0 !== arguments[1] && arguments[1];
                    if (this.length() > 1e6) return void g.error("Maximum cached items reached, dropping.");
                    b ? this.priority.push(a) : this.queue.push(a);
                }
            }, {
                key: "pop",
                value: function() {
                    return this.priority.length > 0 ? this.priority.shift() : this.queue.shift();
                }
            }, {
                key: "peak",
                value: function() {
                    return this.priority.length > 0 ? this.priority[0] : this.queue.length > 0 ? this.queue[0] : null;
                }
            }, {
                key: "length",
                value: function() {
                    return this.queue.length + this.priority.length;
                }
            }, {
                key: "updateConferenceId",
                value: function(a) {
                    for (var b = 0; b < this.queue.length; ++b) {
                        this.queue[b].updateConferenceId(a);
                    }
                    for (var c = 0; c < this.priority.length; ++c) {
                        this.priority[c].updateConferenceId(a);
                    }
                }
            } ]), a;
        }();
        c.Cache = h;
    }, {
        "../utility/csiologger": 87
    } ],
    25: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.Component = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./port"), g = a("../utility/csiologger"), h = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(g), i = function() {
            function a() {
                var b = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "Unknown";
                d(this, a), this.name = b, this.ports = new Map();
            }
            return e(a, [ {
                key: "bindPort",
                value: function(a, b) {
                    var c = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : this;
                    if (this.ports.has(a)) return void h.warn("Port (" + a + ") for " + this.name + " already exists.");
                    this.ports.set(a, new f.Port(b, c));
                }
            }, {
                key: "declarePort",
                value: function(a) {
                    if (this.ports.has(a)) return void h.warn("Port (" + a + ") for " + this.name + " already exists.");
                    this.ports.set(a, null);
                }
            }, {
                key: "getPort",
                value: function(a) {
                    return this.ports.get(a);
                }
            }, {
                key: "isConnected",
                value: function(a) {
                    return !!this.ports.has(a) && null !== this.ports.get(a);
                }
            }, {
                key: "connect",
                value: function(a, b) {
                    if (!this.ports.has(a)) return void h.warn("Port (" + a + ") for " + this.name + " does not exists.");
                    this.ports.set(a, b);
                }
            }, {
                key: "transmit",
                value: function(a) {
                    var b = this.ports.get(a);
                    if (void 0 === b) return void h.warn("Port (" + a + ") for " + this.name + " does not exists.");
                    if (null === b) return void h.warn("Port (" + a + ") for " + this.name + " is not connected.");
                    for (var c = arguments.length, d = Array(c > 1 ? c - 1 : 0), e = 1; e < c; e++) d[e - 1] = arguments[e];
                    b.transmit(d);
                }
            }, {
                key: "request",
                value: function(a) {
                    var b = this.ports.get(a);
                    if (void 0 === b) return h.warn("Port (" + a + ") for " + this.name + " does not exists."), 
                    null;
                    if (null === b) return h.warn("Port (" + a + ") for " + this.name + " is not connected."), 
                    null;
                    for (var c = arguments.length, d = Array(c > 1 ? c - 1 : 0), e = 1; e < c; e++) d[e - 1] = arguments[e];
                    return b.request(d);
                }
            } ]), a;
        }();
        c.Component = i;
    }, {
        "../utility/csiologger": 87,
        "./port": 26
    } ],
    26: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a(b) {
                var c = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null;
                d(this, a), this.target = b, this.object = c;
            }
            return e(a, [ {
                key: "transmit",
                value: function(a) {
                    this.target.apply(this.object, a);
                }
            }, {
                key: "request",
                value: function(a) {
                    return this.target.apply(this.object, a);
                }
            } ]), a;
        }();
        c.Port = f;
    }, {} ],
    27: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.SlidingWindow = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./switem"), g = a("../utility/timestamps"), h = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(g), i = function() {
            function a(b, c) {
                d(this, a), this.items = [], this.plugins = [], this.postProcesses = [], this.preProcesses = [], 
                this.timeoutInMs = c, this.maxItemsNum = b, this.minItemsNum = 0;
            }
            return e(a, [ {
                key: "setMaxItemsNum",
                value: function(a) {
                    this.maxItemsNum = a;
                }
            }, {
                key: "setTimeoutInMs",
                value: function(a) {
                    this.timeoutInMs = a;
                }
            }, {
                key: "setMinItemsNum",
                value: function(a) {
                    this.minItemsNum = a;
                }
            }, {
                key: "refresh",
                value: function() {
                    var a = h.getCurrent();
                    if (!(this.items.length <= this.minItemsNum)) {
                        for (;0 < this.maxItemsNum && this.maxItemsNum <= this.items.length; ) this.remove();
                        this.timeoutInMs && this.timeoutInMs < a - this.items[0].getCreated() && (this.remove(), 
                        this.refresh());
                    }
                }
            }, {
                key: "getLength",
                value: function() {
                    return this.items.length;
                }
            }, {
                key: "add",
                value: function(a) {
                    this.refresh(), this.items.push(new f.SWItem(a));
                    for (var b = 0; b < this.preProcesses.length; b++) {
                        (0, this.preProcesses[b])(a);
                    }
                    for (var c = 0; c < this.plugins.length; c++) {
                        this.plugins[c].add(a);
                    }
                    for (var d = 0; d < this.postProcesses.length; d++) {
                        (0, this.postProcesses[d])(a);
                    }
                }
            }, {
                key: "remove",
                value: function() {
                    for (var a = this.items.shift(), b = 0; b < this.plugins.length; b++) {
                        this.plugins[b].remove(a.value);
                    }
                }
            }, {
                key: "peek",
                value: function() {
                    var a = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 0;
                    return this.items.length <= a ? null : this.items[this.items.length - a - 1].getValue();
                }
            }, {
                key: "attach",
                value: function(a) {
                    this.plugins.push(a);
                }
            }, {
                key: "addPreProcess",
                value: function(a) {
                    this.preProcesses.push(a);
                }
            }, {
                key: "addPostProcess",
                value: function(a) {
                    this.postProcesses.push(a);
                }
            }, {
                key: "detach",
                value: function(a) {
                    this.plugins = this.plugins.filter(function(b) {
                        return b !== a;
                    });
                }
            } ]), a;
        }();
        c.SlidingWindow = i;
    }, {
        "../utility/timestamps": 98,
        "./switem": 28
    } ],
    28: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.SWItem = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("../utility/timestamps"), g = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(f), h = function() {
            function a(b) {
                d(this, a), this.value = b, this.created = g.getCurrent();
            }
            return e(a, [ {
                key: "getValue",
                value: function() {
                    return this.value;
                }
            }, {
                key: "getCreated",
                value: function() {
                    return this.created;
                }
            }, {
                key: "toString",
                value: function() {
                    return "";
                }
            } ]), a;
        }();
        c.SWItem = h;
    }, {
        "../utility/timestamps": 98
    } ],
    29: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.Conference = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../peerconnection/peerconnectionmanager"), h = a("../config/settings"), i = d(h), j = a("../utility/registry"), k = a("../browserapi/sessionstorage"), l = d(k), m = function() {
            function a(b, c) {
                e(this, a), this.conferenceId = b, this.startTime, this.peerConnectionManager = new g.PeerConnectionManager(), 
                this.credentials = c, this.ucId = null, this.url = null, this.userJoinedSent = !1;
            }
            return f(a, [ {
                key: "getCredentials",
                value: function() {
                    return this.credentials;
                }
            }, {
                key: "getUcId",
                value: function() {
                    return this.ucId;
                }
            }, {
                key: "setUcId",
                value: function(a) {
                    this.ucId = a, this.url = i.conferenceBaseUrl + j.Registry.getCredentials().getAppId() + "/conferences/" + encodeURIComponent(this.conferenceId) + "/" + a + "/general", 
                    l.storeUcId(this.conferenceId, a);
                }
            }, {
                key: "getPeerConnectionManager",
                value: function() {
                    return this.peerConnectionManager;
                }
            }, {
                key: "getUrl",
                value: function() {
                    return this.url;
                }
            }, {
                key: "updateConferenceId",
                value: function(a) {
                    this.conferenceId = a, this.peerConnectionManager.updateConferenceId(a);
                }
            }, {
                key: "close",
                value: function(a) {}
            } ]), a;
        }();
        c.Conference = m;
    }, {
        "../browserapi/sessionstorage": 20,
        "../config/settings": 33,
        "../peerconnection/peerconnectionmanager": 41,
        "../utility/registry": 94
    } ],
    30: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.ConferenceManager = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./conference"), g = a("../config/constants"), h = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(g), i = function() {
            function a() {
                d(this, a), this.conferenceMap = new Map();
            }
            return e(a, [ {
                key: "add",
                value: function(a, b) {
                    if (!this.get(a)) {
                        var c = new f.Conference(a, b);
                        this.conferenceMap.set(a, c);
                    }
                }
            }, {
                key: "get",
                value: function(a) {
                    return this.conferenceMap.get(a);
                }
            }, {
                key: "getConferenceForPc",
                value: function(a) {
                    var b = null;
                    return a ? (this.conferenceMap.forEach(function(c, d) {
                        var e = c.getPeerConnectionManager().getPcHandler(a);
                        e && e.getConferenceId() === d && (b = c);
                    }), b) : b;
                }
            }, {
                key: "getConferenceForPcHash",
                value: function(a) {
                    var b = null;
                    return a ? (this.conferenceMap.forEach(function(c, d) {
                        var e = c.getPeerConnectionManager().getPcHandlerByHash(a);
                        e && e.getConferenceId() === d && (b = c);
                    }), b) : b;
                }
            }, {
                key: "updateConferenceId",
                value: function(a) {
                    var b = h.tmpConferenceId, c = this.get(b);
                    c && (c.updateConferenceId(a), this.conferenceMap.set(a, c), this.conferenceMap.delete(b));
                }
            }, {
                key: "getConferenceIds",
                value: function() {
                    var a = [];
                    return this.conferenceMap.forEach(function(b, c) {
                        a.push(c);
                    }), a;
                }
            } ]), a;
        }();
        c.ConferenceManager = i;
    }, {
        "../config/constants": 32,
        "./conference": 29
    } ],
    31: [ function(a, b, c) {
        "use strict";
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        c.csError = {
            httpError: "httpError",
            authError: "authError",
            wsChannelFailure: "wsChannelFailure",
            success: "success",
            csProtoError: "csProtoError",
            appConnectivityError: "appConnectivityError",
            tokenGenerationError: "tokenGenerationError",
            ok: "OK",
            authOngoing: "authOngoing",
            invalidWebRTCFunctionName: "Invalid WebRTC function name",
            invalidEndPointType: "Invalid EndPoint Type",
            invalidTransmissionDirection: "Invalid fabric transmission direction"
        }, c.csErrorStrings = {
            argumentError: "Argument missing/invalid",
            cryptoError: "Browser does not support Web Cryptography API. App secret based authentication requires Web Cryptography API",
            fabricEventUnsupported: "Unsupported fabricEvent",
            fabricEventInvalid: "Invalid fabricEvents value",
            fabricUsageInvalid: "Invalid fabricUsage value",
            notInitialized: "SDK is not initialized or no Fabrics added",
            pcInvalid: "Invalid PeerConnection object passed",
            confereneDoesNotExist: "conferenceId does not exist",
            webRTCFunctionsInvalid: "Invalid webRTC functionName value",
            setProxyConfigInvokeError: "cannot be called if window.csioproxy is false",
            invalidWebRTCFunctionName: "Invalid WebRTC function name",
            invalidEndPointType: "Invalid EndPoint Type",
            invalidTransmissionDirection: "Invalid fabric transmission direction",
            apiaccesserror: "API access Error"
        }, c.csErrorReason = {
            csProtoError: "Protocol fields cannot be empty.",
            csNoAuthState: "Authentication state unavailable in server."
        }, c.internalErrors = {
            authOngoing: "authOngoing"
        }, c.authErrorActions = {
            RETRY: 0,
            GET_NEW_TOKEN: 1,
            REPORT_ERROR: 2
        };
    }, {} ],
    32: [ function(a, b, c) {
        "use strict";
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        c.logEvents = {
            stateMachine: "stateMachine",
            log: "log",
            timing: "timing",
            error: "error",
            getStatsError: "getStatsError",
            restResponseError: "restResponseError"
        }, c.fabricEvent = {
            fabricSetupFailed: "fabricSetupFailed",
            fabricHold: "fabricHold",
            fabricResume: "fabricResume",
            audioMute: "audioMute",
            audioUnmute: "audioUnmute",
            videoPause: "videoPause",
            videoResume: "videoResume",
            fabricUsageEvent: "fabricUsageEvent",
            fabricTerminated: "fabricTerminated",
            screenShareStart: "screenShareStart",
            screenShareStop: "screenShareStop",
            dominantSpeaker: "dominantSpeaker",
            activeDeviceList: "activeDeviceList",
            applicationErrorLog: "applicationErrorLog"
        }, c.internalFabricEvent = {
            fabricSetup: "fabricSetup",
            fabricSetupFailed: "fabricSetupFailed",
            userJoined: "userJoined",
            userLeft: "userLeft",
            userAlive: "userAlive",
            ssrcMap: "ssrcMap",
            mediaPlaybackStart: "mediaPlaybackStart",
            mediaPlaybackSuspended: "mediaPlaybackSuspended",
            mediaPlaybackStalled: "mediaPlaybackStalled",
            oneWayMedia: "oneWayMedia",
            fabricStateChange: "fabricStateChange",
            iceDisruptionStart: "iceDisruptionStart",
            iceDisruptionEnd: "iceDisruptionEnd",
            fabricTransportSwitch: "fabricTransportSwitch",
            iceConnectionDisruptionStart: "iceConnectionDisruptionStart",
            iceConnectionDisruptionEnd: "iceConnectionDisruptionEnd",
            iceAborted: "iceAborted",
            iceTerminated: "iceTerminated",
            iceFailed: "iceFailed",
            iceRestarted: "iceRestarted",
            fabricDropped: "fabricDropped",
            connectedDeviceList: "connectedDeviceList",
            sdpSubmission: "sdpSubmissionEvent",
            sendingThroughputObservations: "sendingThroughputObservations",
            limitationObservations: "limitationObservations",
            userDetails: "userDetails"
        }, c.callstatsChannels = {
            sdpSubmission: "sdpSubmissionEvent",
            processedStats: "processedStats",
            callstatsEvent: "callStatsEvent",
            userFeedback: "userFeedbackEvent",
            preCallTest: "preCallTest",
            senderConfiguration: "senderConfiguration"
        }, c.precalltestEvents = {
            results: "preCallTestResults",
            associate: "preCallTestAssociate"
        }, c.callstatsAPIReturnStatus = {
            success: "success",
            failure: "failure"
        }, c.fabricUsage = {
            audio: "audio",
            video: "video",
            data: "data",
            screen: "screen",
            multiplex: "multiplex",
            unbundled: "unbundled"
        }, c.userIdType = {
            local: "local",
            remote: "remote"
        }, c.qualityRating = {
            excellent: 5,
            good: 4,
            fair: 3,
            poor: 2,
            bad: 1
        }, c.reportType = {
            local: "local",
            remote: "remote",
            inbound: "inbound",
            outbound: "outbound"
        }, c.avQualityRatings = {
            excellent: "excellent",
            fair: "fair",
            bad: "bad",
            unknown: "unknown"
        }, c.fabricState = {
            established: "established",
            initializing: "initializing",
            failed: "failed",
            disrupted: "disrupted",
            hold: "hold",
            checkingDisrupted: "checkingDisrupted",
            terminated: "terminated"
        }, c.webRTCFunctions = {
            createOffer: "createOffer",
            createAnswer: "createAnswer",
            setLocalDescription: "setLocalDescription",
            setRemoteDescription: "setRemoteDescription",
            addIceCandidate: "addIceCandidate",
            getUserMedia: "getUserMedia",
            iceConnectionFailure: "iceConnectionFailure",
            signalingError: "signalingError",
            applicationError: "applicationError",
            applicationLog: "applicationLog"
        }, c.callFailureReasons = {
            mediaConfigError: "MediaConfigError",
            negotiationFailure: "NegotiationFailure",
            sdpError: "SDPGenerationError",
            iceFailure: "IceConnectionFailure",
            transportFailure: "TransportFailure",
            signalingError: "SignalingError",
            applicationError: "ApplicationError",
            applicationLog: "ApplicationLog",
            invalidWebRTCFunctionName: "Invalid WebRTC function name"
        }, c.throughputThreshold = {
            video: {
                green: 1024,
                red: 256
            },
            audio: {
                green: 30,
                red: 8
            }
        }, c.currOverPrevFrameRateThreshold = {
            video: {
                green: .8,
                red: .3
            }
        }, c.rttThreshold = {
            video: {
                green: 400,
                red: 1e3
            }
        }, c.fractionalLossThreshold = {
            video: {
                green: .1,
                red: .5
            },
            audio: {
                green: .15,
                red: .3
            }
        }, c.eModelThreshold = {
            audio: {
                green: 240,
                red: 400
            }
        }, c.codeBaseType = {
            chrome: "Chrome",
            firefox: "Firefox",
            edge: "Edge",
            plugin: "Plugin"
        }, c.browserName = {
            chrome: "Chrome",
            firefox: "Firefox",
            edge: "Edge",
            msie: "Microsoft Internet Explorer",
            safari: "Safari",
            opera: "Opera"
        }, c.osName = {
            windows: "Windows",
            mac: "Mac OS X",
            android: "Android",
            ios: "iOS"
        }, c.mediaType = {
            audio: "audio",
            video: "video"
        }, c.streamType = {
            inbound: "inbound",
            outbound: "outbound"
        }, c.fabricStateChangeType = {
            signalingState: "signalingState",
            iceConnectionState: "iceConnectionState",
            iceGatheringState: "iceGatheringState"
        }, c.transportType = {
            rest: "rest",
            ws: "ws"
        }, c.wsConnectionState = {
            initiated: "initiated",
            connected: "connected",
            closed: "closed"
        }, c.csCallBackMessages = {
            authSuccessful: "SDK authentication successful.",
            authFailed: "SDK authentication failed.",
            authProtocolInvalid: "Fatal authentication error. Invalid auth protocol message.",
            authOngoing: "Authentication on going.",
            wsConnected: "WebSocket establishment successful.",
            wsClosed: "WebSocket server closed.",
            wsFailed: "WebSocket establishment failed."
        }, c.oneWayMediaTypes = {
            audio: "audio",
            video: "video",
            screen: "screen"
        }, c.limitationType = {
            cpu: "cpu",
            network: "network"
        }, c.qualityDisruptionTypes = {
            qpchange: "qpchange"
        }, c.callbackFunctions = {
            stats: "stats",
            defaultConfig: "defaultConfig",
            recommendedConfig: "recommendedConfig",
            preCallTestResults: "preCallTestResults"
        }, c.endpointType = {
            peer: "peer",
            server: "server"
        }, c.transmissionDirection = {
            sendonly: "sendonly",
            receiveonly: "receiveonly",
            sendrecv: "sendrecv",
            inactive: "inactive"
        }, c.tmpConferenceId = "csio-conf-id-tmp";
    }, {} ],
    33: [ function(a, b, c) {
        "use strict";
        function d(a) {
            c.configServiceUrl = m = a;
        }
        function e(a) {
            c.authServiceUrl = n = a;
        }
        function f(a) {
            c.conferenceBaseUrl = o = a;
        }
        function g(a) {
            c.wsUrl = p = a;
        }
        function h(a) {
            c.restEventUrl = q = a;
        }
        function i(a) {
            c.restStatsUrl = r = a;
        }
        function j(a) {
            c.baseUrl = s = a;
        }
        function k(a) {
            c.qmodelThresholdsAPIUrl = t = a;
        }
        function l(a) {
            c.transportType = u = a;
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.setConfigServiceUrl = d, c.setAuthServiceUrl = e, c.setConferenceBaseUrl = f, 
        c.setWsUrl = g, c.setRestEventUrl = h, c.setRestStatsUrl = i, c.setBaseUrl = j, 
        c.setQmodelThresholdsAPIUrl = k, c.setTransportType = l;
        var m = (c.version = "3.50.3", c.configServiceUrl = "https://appsettings.callstats.io/v1/apps/"), n = c.authServiceUrl = "https://auth.callstats.io/", o = (c.authRetryTimeout = 5e3, 
        c.conferenceBaseUrl = "https://dashboard.callstats.io/apps/"), p = c.wsUrl = "wss://collector.callstats.io:443/csiows/collectCallStats", q = c.restEventUrl = "https://events.callstats.io/v1/apps/", r = c.restStatsUrl = "https://stats.callstats.io/v1/apps/", s = c.baseUrl = "https://collector.callstats.io:443/", t = c.qmodelThresholdsAPIUrl = "https://dashboard.callstats.io/api-internal/v1/qmodelthresholds", u = (c.csioDebug = "false", 
        c.transportType = "@@transportType");
    }, {} ],
    34: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a) {
            if (Array.isArray(a)) {
                for (var b = 0, c = Array(a.length); b < a.length; b++) c[b] = a[b];
                return c;
            }
            return Array.from(a);
        }
        function f(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function g(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function h(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        function i() {
            Array.prototype.find || Object.defineProperty(Array.prototype, "find", {
                value: function(a) {
                    if (null === this) throw new TypeError("Array.prototype.find called on null or undefined");
                    if ("function" != typeof a) throw new TypeError("predicate must be a function");
                    for (var b = Object(this), c = b.length >>> 0, d = arguments[1], e = void 0, f = 0; f < c; f++) if (e = b[f], 
                    a.call(d, e, f, b)) return e;
                }
            });
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.MainFSM = c.MainEvents = void 0;
        var j = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {
            return typeof a;
        } : function(a) {
            return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;
        }, k = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), l = a("./statemachine"), m = a("../utility/registry"), n = a("../utility/csiologger"), o = d(n), p = a("../utility/utils"), q = d(p), r = a("../utility/timestamps"), s = d(r), t = a("../config/constants"), u = d(t), v = a("../config/settings"), w = d(v), x = a("./utility"), y = d(x), z = a("../statspipeline/statsadapter"), A = a("../statspipeline/statsparser"), B = a("../statspipeline/statsmonitor"), C = a("../statspipeline/statstransmitter"), D = a("../statspipeline/statsassembler"), E = {
            Created: "Created",
            Initializing: "Initializing",
            Idle: "Idle",
            Run: "Run"
        }, F = c.MainEvents = {
            onStart: "onStart",
            onInitialize: "onInitialize",
            onAddNewFabric: "onAddNewFabric",
            onSendFabricEvent: "onSendFabricEvent",
            onReportError: "onReportError",
            onAssociateMstWithUserID: "onAssociateMstWithUserID",
            onSetProxyConfig: "onSetProxyConfig",
            onAttachWifiStatsHandler: "onAttachWifiStatsHandler",
            onSendUserFeedback: "onSendUserFeedback",
            onOn: "onOn",
            onSetIdentifiers: "onSetIdentifiers",
            onMakePrecallTest: "onMakePrecallTest"
        }, G = {
            onServicesFinished: "onServicesFinished"
        }, H = function(a) {
            function b() {
                f(this, b);
                var a = g(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, E.Created));
                return o.log("FSM:", a.getState()), a.fire(F.onStart), a.run(), i(), a;
            }
            return h(b, a), k(b, [ {
                key: "proceed",
                value: function(a, b) {
                    switch (this.getState()) {
                      case E.Created:
                        switch (a) {
                          case F.onStart:
                            this.onStart.apply(this, e(b));
                            break;

                          case F.onInitialize:
                            this.setState(E.Initializing), o.log("FSM:", this.getState()), this.onInitialize.apply(this, e(b));
                            break;

                          case F.onOn:
                            this.onOn.apply(this, e(b));
                        }
                        break;

                      case E.Initializing:
                        switch (a) {
                          case G.onServicesFinished:
                            this.onServicesFinished() && (this.setState(E.Idle), o.log("FSM:", this.getState()));
                            break;

                          case F.onAddNewFabric:
                            this.onAddNewFabric.apply(this, e(b));
                            break;

                          case F.onSendFabricEvent:
                            this.onSendFabricEvent.apply(this, e(b));
                            break;

                          case F.onReportError:
                            this.onReportError.apply(this, e(b));
                            break;

                          case F.onAssociateMstWithUserID:
                            this.onAssociateMstWithUserID.apply(this, e(b));
                            break;

                          case F.onSendUserFeedback:
                            this.onSendUserFeedback.apply(this, e(b));
                            break;

                          case F.onAttachWifiStatsHandler:
                            this.onAttachWifiStatsHandler.apply(this, e(b));
                            break;

                          case F.onOn:
                            this.onOn.apply(this, e(b));
                            break;

                          case F.onMakePrecallTest:
                            this.onMakePrecallTest();
                            break;

                          case F.onSetIdentifiers:
                            this.onSetIdentifiers.apply(this, e(b));
                        }
                        break;

                      case E.Idle:
                      case E.Run:
                        switch (a) {
                          case F.onAddNewFabric:
                            this.onAddNewFabric.apply(this, e(b));
                            break;

                          case F.onSendFabricEvent:
                            this.onSendFabricEvent.apply(this, e(b));
                            break;

                          case F.onReportError:
                            this.onReportError.apply(this, e(b));
                            break;

                          case F.onAssociateMstWithUserID:
                            this.onAssociateMstWithUserID.apply(this, e(b));
                            break;

                          case F.onSendUserFeedback:
                            this.onSendUserFeedback.apply(this, e(b));
                            break;

                          case F.onAttachWifiStatsHandler:
                            this.onAttachWifiStatsHandler.apply(this, e(b));
                            break;

                          case F.onOn:
                            this.onOn.apply(this, e(b));
                            break;

                          case F.onMakePrecallTest:
                            this.onMakePrecallTest();
                            break;

                          case F.onSetIdentifiers:
                            this.onSetIdentifiers.apply(this, e(b));
                        }
                    }
                }
            }, {
                key: "onStart",
                value: function() {
                    m.Registry.getEndpoint().setup(), this.authenticator = m.Registry.getAuthenticator(), 
                    this.configservicewrapper = m.Registry.getConfigServiceWrapper(), this.precalltest = m.Registry.getPreCallTest(), 
                    this.precalltestIds = [];
                    var a = m.Registry.getStatsAdapter(), b = m.Registry.getStatsParser(), c = m.Registry.getStatsMonitor(), d = m.Registry.getStatsTransmitter(), e = m.Registry.getStatsAssembler();
                    a.connect(z.StatsAdapterIO.RawStatsOut, b.getPort(A.StatsParserIO.RawStatsIn)), 
                    b.connect(A.StatsParserIO.PcStatsTupleOut, c.getPort(B.StatsMonitorIO.PcStatsTupleIn)), 
                    c.connect(B.StatsMonitorIO.StatsTupleOut, e.getPort(D.StatsAssemblerIO.StatsTupleIn)), 
                    e.connect(D.StatsAssemblerIO.CallstatsOut, d.getPort(C.StatsTransmitterIO.CallstatsIn)), 
                    a.connect(z.StatsAdapterIO.UnprocessedOut, d.getPort(C.StatsTransmitterIO.UnprocessedIn));
                }
            }, {
                key: "setupConnection",
                value: function() {
                    var a = this;
                    this.connectionManager = m.Registry.getConnectionManager(), this.connectionManager.setupCollectorConnection(m.Registry.getCredentials().getTransportType()), 
                    this.connectionManager.setup().then(function() {
                        o.log("Connected to connectionManager"), a.fire(G.onServicesFinished), a.run();
                    }).catch(function(a) {
                        return o.log("Could not connect to connectionManager", a);
                    });
                }
            }, {
                key: "setup",
                value: function() {
                    var a = this;
                    this.clocksync = m.Registry.getClockSync(), this.clocksync.initiate().then(function() {
                        o.log("Clocksync completed"), a.fire(G.onServicesFinished), a.run();
                    }).catch(function(a) {
                        return o.log("Could not finish ClockSync", a);
                    });
                }
            }, {
                key: "onInitialize",
                value: function(a, b, c, d, e, f) {
                    var g = this, h = m.Registry.getCredentials();
                    if (h.setAppId(a), h.setUserId(b), m.Registry.getCallbacks().set(u.callbackFunctions.stats, e), 
                    this.doPrecalltest = !0, m.Registry.getGenericEventHandler().sendEvent(u.logEvents.log, {
                        msg: "callstats initialize in progress"
                    }), f) {
                        if (!0 === f.disableBeforeUnloadHandler && this.setBeforeUnloadHandler(), f.applicationVersion) {
                            m.Registry.getEndpoint().setAppVersion(f.applicationVersion);
                        }
                        f.transportType && w.setTransportType(f.transportType), f.disablePrecalltest && (this.doPrecalltest = !1);
                    }
                    this.setup(), this.authenticator.initiate(c, d).then(function(a) {
                        o.log("Authentication complete"), g.setupConnection();
                        var b = m.Registry.getCredentials().getStatsSubmissionInterval();
                        m.Registry.getStatsMonitor().setIntervals(b, b), g.fire(G.onServicesFinished), g.run();
                        var c = g.authenticator.getIceServers();
                        c && g.doPrecalltest && g.precalltest.start(c, g.precalltestCallback.bind(g)), g.configservicewrapper.initiateInternalConfig().then(function() {
                            o.log("ConfigService internal config:", g.configservicewrapper.getInternalConfig()), 
                            g.fire(G.onServicesFinished), g.run();
                        }, function(a) {
                            return o.log(a);
                        }), g.configservicewrapper.initiateAppConfig().then(function() {
                            var a = m.Registry.getCallbacks().get(u.callbackFunctions.defaultConfig), b = g.configservicewrapper.getAppDefaultConfig();
                            a && b && a(b);
                            var c = m.Registry.getCallbacks().get(u.callbackFunctions.recommendedConfig), d = g.configservicewrapper.getAppRecommendedConfig();
                            c && d && c(d), g.fire(G.onServicesFinished), g.run();
                        }, function(a) {
                            return o.log(a);
                        });
                    }, function(a) {
                        o.log(a);
                    }), this.genericevent = m.Registry.getGenericEventHandler(), this.genericevent.sendEvent(u.logEvents.log, {
                        msg: "callstats initialize in progress"
                    });
                }
            }, {
                key: "precalltestCallback",
                value: function(a, b) {
                    var c = m.Registry.getCallbacks().get(u.callbackFunctions.preCallTestResults);
                    if (c) {
                        if (b) {
                            var d = {
                                msg: "precalltest error: " + b
                            };
                            return o.warn("backendlog", d), this.genericevent.sendEvent(u.logEvents.log, d), 
                            void c(u.callstatsAPIReturnStatus.failure, null);
                        }
                        var e = y.getPublicPrecalltestResults(a);
                        c(u.callstatsAPIReturnStatus.success, e);
                    }
                    a && (this.precalltestIds.push(a.id), a.tests && a.tests.ice && ("" === a.tests.ice.turnIpAddress && delete a.tests.ice.turnIpAddress, 
                    "" === a.tests.ice.turnIpVersion && delete a.tests.ice.turnIpVersion, "" === a.tests.ice.turnTransport && delete a.tests.ice.turnTransport), 
                    o.log("sending preCallTest results", a), m.Registry.getEventMessageBuilder().make(u.precalltestEvents.results, null, null, {
                        results: a
                    }));
                }
            }, {
                key: "setBeforeUnloadHandler",
                value: function() {
                    window && window.addEventListener && (o.log("setBeforeUnloadHandler"), window.addEventListener("beforeunload", function(a) {
                        return m.Registry.getConferenceManager().conferenceMap.forEach(function(a, b) {
                            a && a.getPeerConnectionManager().pcHandlers.forEach(function(a, b) {
                                m.Registry.getEventMessageBuilder().make(u.internalFabricEvent.userLeft, a.getConferenceId(), a.getPeerConnection());
                            });
                        }), "Are you sure you want to close the call?";
                    }));
                }
            }, {
                key: "onServicesFinished",
                value: function() {
                    return !!(this.connectionManager && this.connectionManager.isReady() && this.clocksync.isCompleted() && this.authenticator.isCompleted()) && (m.Registry.getTransmissionManager().trySend(), 
                    !0);
                }
            }, {
                key: "onAddNewFabric",
                value: function(a, b, c, d, e, f, g) {
                    o.warn("FSM onAddNewFabric"), m.Registry.getConferenceManager().add(d, m.Registry.getCredentials());
                    var h = m.Registry.getConferenceManager().get(d);
                    h.getPeerConnectionManager().addPcHandler(a, b, c, d, e, f, g);
                    var i = {
                        endpointInfo: m.Registry.getEndpoint().serialize()
                    };
                    m.Registry.getCredentials().getUserIdObject() && (i.localUserIDObject = m.Registry.getCredentials().getUserIdObject()), 
                    h.userJoinedSent || (m.Registry.getEventMessageBuilder().make(u.internalFabricEvent.userJoined, d, a, i), 
                    h.userJoinedSent = !0, m.Registry.getCredentials().getTransportType() === u.transportType.rest && i.localUserIDObject && i.localUserIDObject.userName && m.Registry.getEventMessageBuilder().make(u.internalFabricEvent.userDetails, d, a, {
                        userName: String(i.localUserIDObject.userName)
                    }));
                    var j = this.precalltestIds;
                    this.precalltestIds = [];
                    var k = this.precalltest.getId();
                    k && j.push(k), j.length > 0 && m.Registry.getEventMessageBuilder().make(u.precalltestEvents.associate, d, a, {
                        ids: j
                    });
                }
            }, {
                key: "onSendFabricEvent",
                value: function(a, b, c, d) {
                    o.warn("FSM onSendFabricEvent");
                    var e = {};
                    if (d && (e = d), b === u.fabricEvent.activeDeviceList) {
                        e = {
                            mediaDeviceList: q.normalizeMediaDeviceList(d.deviceList)
                        };
                    }
                    m.Registry.getEventMessageBuilder().make(b, c, a, e);
                    var f = m.Registry.getConferenceManager().get(c);
                    if (f) {
                        var g = f.getPeerConnectionManager().getPcHandler(a);
                        b !== u.fabricEvent.fabricTerminated && b !== u.internalFabricEvent.fabricSetupFailed || (g.stopUserAliveHandler(), 
                        g.setPcState(u.fabricState.terminated), g.stopStatsPolling()), b === u.fabricEvent.fabricHold && (g.setPcState(u.fabricState.hold), 
                        g.stopStatsPolling()), b === u.fabricEvent.fabricResume && (g.setPcState(u.fabricState.established), 
                        g.startStatsPolling());
                    }
                }
            }, {
                key: "onReportError",
                value: function(a, b, c, d, e, f) {
                    o.warn("FSM onReportError");
                    var g = {
                        failureDelay: 0,
                        reason: this.callFailureClassifier(c),
                        function: c,
                        magicKey: m.Registry.getEndpoint().getMagicKey(),
                        endpoint: m.Registry.getEndpoint().serialize(),
                        level: "debug"
                    };
                    if (d) {
                        var h = this.formatDomError(d);
                        g.message = h.message, g.messageType = h.messageType, g.name = d.name, g.stack = d.stack;
                    }
                    if (a) {
                        var i = m.Registry.getConferenceManager().get(b), j = void 0;
                        if (i && (j = i.getPeerConnectionManager().getPcHandler(a)), !j) return void o.error("onReportError: No handler found for given PeerConnection!");
                        if (g.failureDelay = s.getCurrent() - j.getStartTime(), g.fabricState = j.getPcState(), 
                        g.iceConnectionState = j.getIceConnectionState(), (e || f || a && "closed" !== a.signalingState) && m.Registry.getCredentials().getCollectSDP() && c === u.fabricEvent.fabricSetupFailed) {
                            var k = {};
                            k.localSDP = this.pickSDP(a, e, "localDescription"), k.remoteSDP = this.pickSDP(a, f, "remoteDescription"), 
                            m.Registry.getEventMessageBuilder().make(u.callstatsChannels.sdpSubmission, b, a, k);
                        }
                    }
                    c === u.webRTCFunctions.applicationLog || c === u.webRTCFunctions.applicationError ? m.Registry.getEventMessageBuilder().make(u.fabricEvent.applicationErrorLog, b, a, g) : m.Registry.getEventMessageBuilder().make(u.fabricEvent.fabricSetupFailed, b, a, g);
                }
            }, {
                key: "onAssociateMstWithUserID",
                value: function(a, b, c, d, e, f) {
                    var g = m.Registry.getConferenceManager().get(c);
                    if (g) {
                        var h = g.getPeerConnectionManager().getPcHandler(a);
                        "string" != typeof d && (d += ""), h.updateSSRCInfo(d, b, e, f);
                    }
                }
            }, {
                key: "onAttachWifiStatsHandler",
                value: function(a) {
                    m.Registry.getWifiStatsExecutor().setGetWifiStatsMethod(a);
                }
            }, {
                key: "onSetProxyConfig",
                value: function(a) {
                    a.collectorURL && w.setBaseUrl(a.collectorURL), a.authServiceURL && w.setAuthServiceUrl(a.authServiceURL), 
                    a.csioInternalAPIURL && w.setQmodelThresholdsAPIUrl(a.csioInternalAPIURL), a.wsURL && w.setWsUrl(a.wsURL), 
                    a.restEventUrl && w.setRestEventUrl(a.restEventURL), a.restStatsUrl && w.setRestStatsUrl(a.restStatsURL), 
                    this.setup();
                }
            }, {
                key: "onSendUserFeedback",
                value: function(a, b, c) {
                    var d = {
                        feedback: {
                            overallRating: b.overall
                        }
                    };
                    b.video && (d.feedback.videoQualityRating = b.video), b.audio && (d.feedback.audioQualityRating = b.audio), 
                    b.comment && (d.feedback.comments = b.comment), m.Registry.getEventMessageBuilder().make(u.callstatsChannels.userFeedback, a, null, d);
                }
            }, {
                key: "onOn",
                value: function(a, b) {
                    m.Registry.getCallbacks().set(a, b);
                }
            }, {
                key: "onSetIdentifiers",
                value: function(a, b) {
                    if (a.conferenceID && (m.Registry.getConferenceManager().updateConferenceId(a.conferenceID), 
                    m.Registry.getTransmissionManager().updateConferenceId(a.conferenceID), m.Registry.getTransmissionManager().trySend()), 
                    a.remoteUserID && b) {
                        var c = m.Registry.getConferenceManager().getConferenceForPc(b);
                        if (!c) return void o.log("onSetIdentifiers conference not found");
                        var d = c.getPeerConnectionManager().getPcHandler(b);
                        if (!d) return void o.log("pcHandler not found");
                        d.updateRemoteId(a.remoteUserID), m.Registry.getTransmissionManager().trySend();
                    }
                }
            }, {
                key: "onMakePrecallTest",
                value: function() {
                    var a = this, b = this.authenticator.getIceServers();
                    a.precalltest.start(b, a.precalltestCallback.bind(a));
                }
            }, {
                key: "callFailureClassifier",
                value: function(a) {
                    var b = void 0;
                    return u.webRTCFunctions.hasOwnProperty(a) ? a === u.webRTCFunctions.createOffer || a === u.webRTCFunctions.createAnswer || a === u.webRTCFunctions.setRemoteDescription ? b = u.callFailureReasons.negotiationFailure : a === u.webRTCFunctions.setLocalDescription ? b = u.callFailureReasons.sdpError : a === u.webRTCFunctions.addIceCandidate ? b = u.callFailureReasons.sdpError : a === u.webRTCFunctions.getUserMedia ? b = u.callFailureReasons.mediaConfigError : a === u.webRTCFunctions.iceConnectionFailure ? b = u.callFailureReasons.iceFailure : a === u.webRTCFunctions.signalingError ? b = u.callFailureReasons.signalingError : (a === u.webRTCFunctions.applicationLog || u.webRTCFunctions.applicationError) && (b = u.callFailureReasons.applicationLog) : b = u.callFailureReasons.invalidWebRTCFunctionName, 
                    b;
                }
            }, {
                key: "formatDomError",
                value: function(a) {
                    var b = {}, c = {};
                    a && (window.DOMException && a instanceof window.DOMException ? (c.message = a.message, 
                    c.name = a.name, b.messageType = "domError") : "object" === (void 0 === a ? "undefined" : j(a)) ? (a.message && (c.message = a.message), 
                    a.name && (c.name = a.name), a.constraintName && (c.name = a.constraintName), a.stack && (c.stack = a.stack), 
                    b.messageType = "json") : (c = a, b.messageType = "text"));
                    var d = this.truncateLog(c);
                    return "object" === (void 0 === d ? "undefined" : j(d)) ? b.message = JSON.stringify(d) : b.message = d, 
                    b;
                }
            }, {
                key: "pickSDP",
                value: function(a, b, c) {
                    return b || (a && a[c] ? a[c].sdp : "");
                }
            }, {
                key: "truncateString",
                value: function(a) {
                    return a.length > 2e4 && (o.log("Log exceeds 20kb, It will be truncated"), a = a.substring(0, 2e4)), 
                    a;
                }
            }, {
                key: "truncateLog",
                value: function(a) {
                    return a ? ("string" == typeof a ? a = this.truncateString(a) : "object" === (void 0 === a ? "undefined" : j(a)) && a.message && (a.message = this.truncateString(a.message)), 
                    a) : a;
                }
            } ]), b;
        }(l.StateMachine);
        c.MainFSM = H;
    }, {
        "../config/constants": 32,
        "../config/settings": 33,
        "../statspipeline/statsadapter": 68,
        "../statspipeline/statsassembler": 69,
        "../statspipeline/statsmonitor": 71,
        "../statspipeline/statsparser": 72,
        "../statspipeline/statstransmitter": 73,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "../utility/timestamps": 98,
        "../utility/utils": 100,
        "./statemachine": 36,
        "./utility": 37
    } ],
    35: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a(b, c) {
                d(this, a), this.type = b, this.args = void 0 !== c ? c : null;
            }
            return e(a, [ {
                key: "getType",
                value: function() {
                    return this.type;
                }
            }, {
                key: "getArgs",
                value: function() {
                    return this.args;
                }
            } ]), a;
        }();
        c.ProgramEvent = f;
    }, {} ],
    36: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.StateMachine = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./programevent"), g = a("../utility/csiologger"), h = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(g), i = function() {
            function a(b) {
                d(this, a), this.events = [], this.state = b;
            }
            return e(a, [ {
                key: "fire",
                value: function(a) {
                    for (var b = arguments.length, c = Array(b > 1 ? b - 1 : 0), d = 1; d < b; d++) c[d - 1] = arguments[d];
                    var e = new f.ProgramEvent(a, c);
                    this.events.push(e);
                }
            }, {
                key: "proceed",
                value: function(a, b) {
                    h.warn("You need to overwrite the proceed function inan extended StateMachine");
                }
            }, {
                key: "setState",
                value: function(a) {
                    this.state = a;
                }
            }, {
                key: "getState",
                value: function() {
                    return this.state;
                }
            }, {
                key: "run",
                value: function() {
                    if (!(this.events.length < 1)) {
                        var a = this.events.shift();
                        this.proceed(a.getType(), a.getArgs());
                    }
                }
            } ]), a;
        }();
        c.StateMachine = i;
    }, {
        "../utility/csiologger": 87,
        "./programevent": 35
    } ],
    37: [ function(a, b, c) {
        "use strict";
        function d(a) {
            var b = {
                mediaConnectivity: !1,
                throughput: null,
                fractionalLoss: null,
                rtt: null
            };
            return a && a.tests ? (a.tests.rtt && (b.rtt = a.tests.rtt.median, b.mediaConnectivity = !0), 
            a.tests.throughput && (b.throughput = a.tests.throughput.average, b.fractionalLoss = Math.max(a.tests.throughput.fractionLostBytes, 0), 
            b.mediaConnectivity = !0), a.tests.ice && (a.tests.ice.relayTcpSuccess || a.tests.ice.relayTlsSuccess || a.tests.ice.relayUdpSuccess) && (b.mediaConnectivity = !0), 
            b) : b;
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.getPublicPrecalltestResults = d;
    }, {} ],
    38: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.GetStatsHandler = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../config/constants"), h = d(g), i = a("../statspipeline/statsadapter"), j = a("../utility/registry"), k = a("../utility/rttregistry"), l = a("../utility/csiologger"), m = d(l), n = function() {
            function a(b, c, d, f, g) {
                e(this, a), this.pc = b, this.interval = d, this.codeBase = f, this.browserName = g, 
                this.getStatsTimer = null, this.isPromiseBased = !0, this.pcHash = c, this.genericevent = j.Registry.getGenericEventHandler();
            }
            return f(a, [ {
                key: "startStatsPolling",
                value: function() {
                    var a = this;
                    a.getStatsTimer || (m.log("startStatsPolling for ", a.pcHash), this.getStatsTimer = setInterval(function() {
                        a.csioGetStats(a.statsHandler, a.pcHash);
                    }, a.interval));
                }
            }, {
                key: "stopStatsPolling",
                value: function() {
                    this.getStatsTimer && (clearInterval(this.getStatsTimer), this.getStatsTimer = null);
                }
            }, {
                key: "csioGetStats",
                value: function(a, b) {
                    var c = h.codeBaseType.firefox, d = h.codeBaseType.chrome, e = h.codeBaseType.edge, f = h.browserName.safari;
                    if (this.pc) try {
                        this.isTemaSys() ? this.getStatsTemasys(a, b) : this.codeBase === c ? this.getStatsFirefox(a, b) : this.browserName === f ? this.getStatsSafari(a, b) : this.codeBase === d ? this.getStatsChrome(a, b) : this.codeBase === e && this.getStatsEdge(a, b);
                    } catch (a) {
                        m.log("csioGetStats: Error ", a);
                    }
                }
            }, {
                key: "getStatsTemasys",
                value: function(a, b) {
                    this.pc.getStats(null, function(c) {
                        a(c, b);
                    }, function(a) {
                        m("getStatsTemasys error", a);
                    });
                }
            }, {
                key: "getStatsFirefox",
                value: function(a, b) {
                    var c = this, d = this.pc;
                    if (!c.isPromiseBased) return void d.getStats(null, function(c) {
                        a(c, b);
                    });
                    try {
                        d.getStats().then(function(c) {
                            a(c, b);
                        }).catch(function(e) {
                            c.isPromiseBased = !1, d.getStats(null, function(c) {
                                a(c, b);
                            });
                        });
                    } catch (e) {
                        c.isPromiseBased = !1, c.genericevent.sendEvent(h.logEvents.getStatsError, {
                            msg: "Firefox getStats reports error ",
                            error: e.message + ":" + e.stack
                        }), d.getStats(null, function(c) {
                            a(c, b);
                        });
                    }
                }
            }, {
                key: "getStatsChrome",
                value: function(a, b) {
                    var c = this, d = c.pc;
                    if (window && window.csioReactNative) return void d.getStats(null, function(c) {
                        a(c, b);
                    }, function(a) {
                        c.genericevent.sendEvent(h.logEvents.getStatsError, {
                            msg: "react-native getStats reports error",
                            error: a.message + ":" + a.stack
                        });
                    });
                    if (!c.isPromiseBased) return void d.getStats(function(c) {
                        a(c, b);
                    });
                    try {
                        d.getStats().then(function(c) {
                            (0, k.getRTTRegistry)().update(d), a(c, b);
                        }).catch(function(e) {
                            m.log("Chrome getStats Error ", e), c.isPromiseBased = !1, c.genericevent.sendEvent(h.logEvents.getStatsError, {
                                msg: "Chrome getStats reports error",
                                error: e.message + ":" + e.stack
                            }), d.getStats(function(c) {
                                a(c, b);
                            });
                        });
                    } catch (e) {
                        c.isPromiseBased = !1, c.genericevent.sendEvent(h.logEvents.getStatsError, {
                            msg: "Chrome getStats reports error",
                            error: e.message + ":" + e.stack
                        }), d.getStats(function(c) {
                            a(c, b);
                        });
                    }
                }
            }, {
                key: "getStatsEdge",
                value: function(a, b) {
                    var c = this;
                    c.pc.getStats().then(function(c) {
                        a(c, b);
                    }).catch(function(d) {
                        a({}, b), d ? c.genericevent.sendEvent(h.logEvents.getStatsError, {
                            msg: "Edge getStats reports error",
                            error: d.message + ":" + d.stack
                        }) : c.genericevent.sendEvent(h.logEvents.getStatsError, {
                            msg: "Edge getStats reports error"
                        });
                    });
                }
            }, {
                key: "getStatsSafari",
                value: function(a, b) {
                    var c = this;
                    c.pc.getStats().then(function(c) {
                        a(c, b);
                    }).catch(function(a) {
                        c.genericevent.sendEvent(h.logEvents.getStatsError, {
                            msg: "Safari getStats reports error",
                            error: a.message + ":" + a.stack
                        });
                    });
                }
            }, {
                key: "statsHandler",
                value: function(a, b) {
                    var c = j.Registry.getStatsAdapter();
                    if (a && c) try {
                        c.transmit(i.StatsAdapterIO.RawStatsIn, a, b);
                    } catch (a) {
                        m.log("statsHandler 123: Error ", a), j.Registry.getGenericEventHandler().sendEvent(h.logEvents.error, {
                            msg: "statsHandler: Error",
                            error: a.message + ":" + a.stack
                        });
                    }
                }
            }, {
                key: "iceCandidatesHandler",
                value: function(a, b) {
                    var c = j.Registry.getStatsAdapter(), d = void 0;
                    d = c.getIceCandidates(a), b(d);
                }
            }, {
                key: "getIceCandidates",
                value: function() {
                    var a = this;
                    return new Promise(function(b, c) {
                        a.csioGetStats(a.iceCandidatesHandler, function(a) {
                            b(a);
                        });
                    });
                }
            }, {
                key: "isTemaSys",
                value: function() {
                    return !!(window && window.AdapterJS && window.AdapterJS.WebRTCPlugin && window.AdapterJS.WebRTCPlugin.plugin);
                }
            } ]), a;
        }();
        c.GetStatsHandler = n;
    }, {
        "../config/constants": 32,
        "../statspipeline/statsadapter": 68,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "../utility/rttregistry": 95
    } ],
    39: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.PcCallbackHandler = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../config/constants"), h = d(g), i = a("../utility/registry"), j = a("../utility/timestamps"), k = d(j), l = a("../config/callstatserrors"), m = d(l), n = a("../utility/csiologger"), o = d(n), p = function() {
            function a(b, c, d, f, g, j) {
                var l = this;
                e(this, a), c && (this.conferenceId = b, this.pc = c, this.getStatsHandler = d, 
                this.userAlive = f, this.callback = j, this.remoteId = g, this.clocksync = i.Registry.getClockSync(), 
                this.emb = i.Registry.getEventMessageBuilder(), this.precalltest = i.Registry.getPreCallTest(), 
                this.genericevent = i.Registry.getGenericEventHandler(), this.iceCandidates = [], 
                this.iceConnectionState = c.iceConnectionState, this.iceGatheringState = c.iceGatheringState, 
                this.signalingState = c.signalingState, this.oldIceConnectionState = "", this.oldIceGatheringState = "", 
                this.iceConnectionStateTS = "", this.negotiationNeeded = 0, this.pcState = h.fabricState.initializing, 
                this.disruptedTS = 0, this.startTime = k.getCurrent(), this.established = !1, this.activeIceCandidatePair = null, 
                this.prevActiveIceCandidatePair = null, this.localIceCandidates = [], this.remoteIceCandidates = [], 
                this.iceCandidatePairs = [], this.iceConnectivityDelay = 0, this.iceGatheringDelay = 0, 
                this.fabricSetupSent = !1, this.pc && this.pc.addEventListener ? (this.pc.addEventListener("icecandidate", this.iceCandidateCallback.bind(this), !1), 
                this.pc.addEventListener("iceconnectionstatechange", this.iceConnectionStateChangeCallback.bind(this), !1), 
                this.pc.addEventListener("signalingstatechange", this.pcSignalingStateChangeCallback.bind(this), !1), 
                this.pc.addEventListener("negotiationneeded", this.pcNegotiationNeededCallback.bind(this), !1)) : this.pc && this.pc.attachEvent ? (o.info("attachEvent"), 
                this.pc.attachEvent("onicecandidate", this.iceCandidateCallback.bind(this)), this.pc.attachEvent("oniceconnectionstatechange", this.iceConnectionStateChangeCallback.bind(this)), 
                this.pc.attachEvent("onsignalingstatechange", this.pcSignalingStateChangeCallback.bind(this)), 
                this.pc.attachEvent("onnegotiationneeded", this.pcNegotiationNeededCallback.bind(this))) : o.error("callstats cannot monitor or collect stats"), 
                !c || "connected" !== c.iceConnectionState && "completed" !== c.iceConnectionState || (this.pcState = h.fabricState.established, 
                this.getStatsHandler.getIceCandidates().then(function(a) {
                    l.localIceCandidates = a.localIceCandidates, l.remoteIceCandidates = a.remoteIceCandidates, 
                    l.iceCandidatePairs = a.iceCandidatePairs, l.prevActiveIceCandidatePair = l.activeIceCandidatePair, 
                    l.activeIceCandidatePair = l.getActiveIceCandidatePair(), l.sendfabricSetup(), l.startStatsPolling();
                })));
            }
            return f(a, [ {
                key: "iceCandidateCallback",
                value: function(a) {
                    if (a && a.candidate) {
                        var b = a.candidate.candidate.split(" ");
                        if ("0" !== b[4] && "0" !== b[5]) {
                            var c = -1 !== b[4].indexOf(":"), d = "1" === b[1] ? "rtp" : "rtcp", e = {
                                transport: b[2],
                                protocol: d,
                                typePreference: b[3],
                                address: c ? "[" + b[4] + "]:" + b[5] : b[4] + ":" + b[5],
                                type: b[7],
                                media: a.candidate.sdpMid
                            };
                            -1 === this.iceCandidates.indexOf(e) && (this.iceCandidates.push(e), o.warn("CALLBACK: ICE candidate", e));
                        }
                    }
                }
            }, {
                key: "iceConnectionStateChangeCallback",
                value: function(a) {
                    var b = this;
                    if (a) {
                        o.log("pc states ", this.pc.iceGatheringState, this.pc.iceConnectionState), this.iceConnectionStateTS = this.clocksync.getSynchronizedTimestamp(), 
                        this.handleIceGatheringState(), this.handleIceConnectionState(), o.log("states ", this.iceGatheringState, this.iceConnectionState), 
                        "complete" === this.iceGatheringState && "checking" === this.iceConnectionState && this.handleIceChecking();
                        var c = {
                            prevIceConnectionState: this.oldIceConnectionState,
                            currIceConnectionState: this.iceConnectionState
                        }, d = this.iceConnectionState;
                        this.getStatsHandler.getIceCandidates().then(function(a) {
                            b.localIceCandidates = a.localIceCandidates, b.remoteIceCandidates = a.remoteIceCandidates, 
                            b.iceCandidatePairs = a.iceCandidatePairs, b.prevActiveIceCandidatePair = b.activeIceCandidatePair, 
                            b.activeIceCandidatePair = b.getActiveIceCandidatePair(), "connected" === d || "completed" === d ? b.handleIceConnectedOrCompleted(c) : "failed" === d ? b.handleIceFailed(c) : "disconnected" === d ? b.handleIceDisconnected(c) : "closed" === d ? b.handleIceClosed(c) : "new" === d && b.handleIceRestart(c);
                        });
                    }
                }
            }, {
                key: "sendFabricStateChange",
                value: function(a) {
                    this.emb.make(h.internalFabricEvent.fabricStateChange, this.conferenceId, this.pc, a);
                }
            }, {
                key: "handleIceConnectionState",
                value: function() {
                    this.oldIceConnectionState = this.iceConnectionState, this.iceConnectionState = this.pc.iceConnectionState, 
                    o.warn("CALLBACK: ICE connection state change", this.oldIceConnectionState, "->", this.iceConnectionState);
                    var a = {
                        changedState: h.fabricStateChangeType.iceConnectionState,
                        prevState: this.oldIceConnectionState,
                        newState: this.iceConnectionState
                    };
                    this.sendFabricStateChange(a);
                }
            }, {
                key: "handleIceGatheringState",
                value: function() {
                    if (this.iceGatheringState !== this.pc.iceGatheringState) {
                        "complete" === this.pc.iceGatheringState && (this.iceGatheringDelay = k.getCurrent() - this.startTime), 
                        this.oldIceGatheringState = this.iceGatheringState, this.iceGatheringState = this.pc.iceGatheringState, 
                        o.warn("CALLBACK: ICE gathering state change", this.oldIceGatheringState, "->", this.iceGatheringState);
                        var a = {
                            changedState: h.fabricStateChangeType.iceGatheringState,
                            prevState: this.oldIceGatheringState,
                            newState: this.iceGatheringState
                        };
                        this.sendFabricStateChange(a);
                    }
                }
            }, {
                key: "handleIceChecking",
                value: function() {
                    if ("disconnected" === this.oldIceConnectionState && this.pcState === h.fabricState.checkingDisrupted) {
                        var a = {
                            prevIceConnectionState: this.oldIceConnectionState,
                            currIceConnectionState: this.iceConnectionState,
                            disruptionDelay: k.getCurrent() - this.disruptedTS
                        };
                        this.emb.make(h.internalFabricEvent.iceConnectionDisruptionEnd, this.conferenceId, this.pc, a);
                    }
                }
            }, {
                key: "handleIceConnectedOrCompleted",
                value: function(a) {
                    var b = k.getCurrent();
                    this.pcState === h.fabricState.disrupted && (a.prevIceCandidatePair = this.prevActiveIceCandidatePair, 
                    a.currIceCandidatePair = this.activeIceCandidatePair, a.disruptionDelay = b - this.disruptedTS, 
                    this.emb.make(h.internalFabricEvent.iceDisruptionEnd, this.conferenceId, this.pc, a)), 
                    this.iceConnectivityDelay = b - this.startTime, this.established = !0, this.pcState = h.fabricState.established, 
                    this.sendfabricSetup(), this.startStatsPolling();
                }
            }, {
                key: "sendfabricSetup",
                value: function() {
                    if (this.fabricSetupSent) return void o.log("fabricSetup has been sent already");
                    var a = {
                        delay: k.getCurrent() - this.startTime,
                        iceGatheringDelay: this.iceGatheringDelay,
                        iceConnectivityDelay: this.iceConnectivityDelay,
                        localIceCandidates: this.localIceCandidates,
                        remoteIceCandidates: this.remoteIceCandidates,
                        iceCandidatePairs: this.iceCandidatePairs
                    };
                    this.fabricSetupSent = !0;
                    var b = void 0;
                    if (this.conferenceId) {
                        b = i.Registry.getConferenceManager().get(this.conferenceId).getPeerConnectionManager().getPcHandler(this.pc), 
                        a.remoteEndpointType = b.getRemoteEndpointType(), a.fabricTransmissionDirection = b.getFabricTransmissionDirection();
                    }
                    this.pcState = h.fabricState.established, this.emb.make(h.internalFabricEvent.fabricSetup, this.conferenceId, this.pc, a);
                }
            }, {
                key: "isFabricSetupSent",
                value: function() {
                    return this.fabricSetupSent;
                }
            }, {
                key: "startStatsPolling",
                value: function() {
                    this.getStatsHandler.startStatsPolling();
                }
            }, {
                key: "stopStatsPolling",
                value: function() {
                    this.getStatsHandler.stopStatsPolling();
                }
            }, {
                key: "handleIceFailed",
                value: function(a) {
                    a.currIceCandidatePair = this.activeIceCandidatePair, a.failureDelay = k.getCurrent() - this.startTime, 
                    a.delay = k.getCurrent() - this.startTime, this.pcState = h.fabricState.failed, 
                    "checking" === this.oldIceConnectionState ? this.sendIceFailed(a) : "completed" === this.oldIceConnectionState || "connected" === this.oldIceConnectionState ? this.emb.make(h.internalFabricEvent.fabricDropped, this.conferenceId, this.pc, a) : "disconnected" === this.oldIceConnectionState && this.established ? this.emb.make(h.internalFabricEvent.fabricDropped, this.conferenceId, this.pc, a) : "disconnected" === this.oldIceConnectionState && this.sendIceFailed(a);
                }
            }, {
                key: "getActiveIceCandidatePair",
                value: function() {
                    var a = null, b = this.iceCandidatePairs;
                    if (b && b.length > 0) {
                        var c = b.filter(function(a) {
                            return "true" === a.selected || "true" === a.googActiveConnection || !0 === a.selected || !0 === a.googActiveConnection;
                        });
                        c.length > 0 && (a = c[0]);
                    }
                    return a;
                }
            }, {
                key: "sendIceFailed",
                value: function(a) {
                    a.localIceCandidates = this.localIceCandidates, a.remoteIceCandidates = this.remoteIceCandidates, 
                    a.iceCandidatePairs = this.iceCandidatePairs, o.log("sending icefailed ", a), this.emb.make(h.internalFabricEvent.iceFailed, this.conferenceId, this.pc, a);
                }
            }, {
                key: "sendFabricTransportSwitch",
                value: function(a) {
                    var b = this, c = {};
                    c.prevIceCandidatePair = b.activeIceCandidatePair, c.relayType = a, c.currIceConnectionState = b.iceConnectionState, 
                    c.prevIceConnectionState = b.oldIceConnectionState, c.switchDelay = null, b.getStatsHandler.getIceCandidates().then(function(a) {
                        b.localIceCandidates = a.localIceCandidates, b.remoteIceCandidates = a.remoteIceCandidates, 
                        b.iceCandidatePairs = a.iceCandidatePairs, b.activeIceCandidatePair = b.getActiveIceCandidatePair(), 
                        c.currIceCandidatePair = b.activeIceCandidatePair, c.localIceCandidates = b.localIceCandidates, 
                        c.remoteIceCandidates = b.remoteIceCandidates, o.log("sending fabric transport switch ", c), 
                        "completed" !== c.currIceConnectionState && "connected" !== c.currIceConnectionState || "completed" !== c.prevIceConnectionState && "connected" !== c.prevIceConnectionState || b.emb.make(h.internalFabricEvent.fabricTransportSwitch, b.conferenceId, b.pc, c);
                    });
                }
            }, {
                key: "handleIceDisconnected",
                value: function(a) {
                    var b = k.getCurrent();
                    this.startTime = b, a.prevIceConnectionStateTs = this.iceConnectionStateTS, a.currIceCandidatePair = this.activeIceCandidatePair, 
                    "connected" === this.oldIceConnectionState || "completed" === this.oldIceConnectionState ? (this.pcState = h.fabricState.disrupted, 
                    this.disruptedTS = b, this.emb.make(h.internalFabricEvent.iceDisruptionStart, this.conferenceId, this.pc, a), 
                    this.callback && this.callback(m.csError.appConnectivityError, "Connectivity check for PC object to " + this.remoteId + " failed.")) : "checking" === this.oldIceConnectionState && (this.pcState = h.fabricState.checkingDisrupted, 
                    this.disruptedTS = b, this.emb.make(h.internalFabricEvent.iceConnectionDisruptionStart, this.conferenceId, this.pc, a), 
                    this.callback && this.callback(m.csError.appConnectivityError, "Connectivity check for PC object to " + this.remoteId + " failed."));
                }
            }, {
                key: "handleIceClosed",
                value: function(a) {
                    "new" === this.oldIceConnectionState || "checking" === this.oldIceConnectionState ? (a.failureDelay = k.getCurrent() - this.startTime, 
                    a.localIceCandidates = this.localIceCandidates, a.remoteIceCandidates = this.remoteIceCandidates, 
                    a.iceCandidatePairs = this.iceCandidatePairs, this.emb.make(h.internalFabricEvent.iceAborted, this.conferenceId, this.pc, a)) : (a.currIceCandidatePair = this.activeIceCandidatePair, 
                    this.emb.make(h.internalFabricEvent.iceTerminated, this.conferenceId, this.pc, a), 
                    this.stopStatsPolling());
                }
            }, {
                key: "handleIceRestart",
                value: function(a) {
                    a.prevIceCandidatePair = this.prevActiveIceCandidatePair, "new" !== this.oldIceConnectionState && (o.log("iceRestarted sending"), 
                    this.established = !1, this.emb.make(h.internalFabricEvent.iceRestarted, this.conferenceId, this.pc, a));
                }
            }, {
                key: "pcSignalingStateChangeCallback",
                value: function(a) {
                    var b = this;
                    if (a) {
                        var c = this.signalingState;
                        this.signalingState = this.pc.signalingState, o.warn("CALLBACK: signaling state change", c, "->", this.signalingState);
                        var d = {
                            changedState: h.fabricStateChangeType.signalingState,
                            prevState: c,
                            newState: this.signalingState
                        };
                        this.sendFabricStateChange(d), "have-remote-offer" !== this.signalingState && "stable" !== this.signalingState || (this.precalltest.callStarts(), 
                        this.genericevent.sendEvent(h.logEvents.log, {
                            msg: "precalltest told to stop "
                        })), "closed" === this.signalingState && (this.emb.make(h.fabricEvent.fabricTerminated, this.conferenceId, this.pc), 
                        this.userAlive.stop(), this.precalltest.callFinished(), this.stopStatsPolling(), 
                        this.genericevent.sendEvent(h.logEvents.log, {
                            msg: "precalltest finished "
                        })), "have-local-offer" !== this.signalingState && "have-local-pranswer" !== this.signalingState && "stable" !== this.signalingState || (o.log(this.signalingState, ".. requesting sender config."), 
                        i.Registry.getConfigServiceWrapper().initiateSenderConfig(this.pc).then(function() {
                            var a = i.Registry.getConfigServiceWrapper().getSenderConfig();
                            o.log("Sender config:", a);
                            var c = h.callstatsChannels.senderConfiguration;
                            i.Registry.getEventMessageBuilder().make(c, b.conferenceId, b.pc, a);
                        }).catch(function(a) {
                            o.warn(a);
                        }));
                    }
                }
            }, {
                key: "pcNegotiationNeededCallback",
                value: function(a) {
                    a && (this.negotiationNeeded++, this.startTime = k.getCurrent(), o.warn("CALLBACK: negotiation needed", this.negotiationNeeded));
                }
            } ]), a;
        }();
        c.PcCallbackHandler = p;
    }, {
        "../config/callstatserrors": 31,
        "../config/constants": 32,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "../utility/timestamps": 98
    } ],
    40: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.PeerConnectionHandler = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../utility/registry"), h = a("../peerconnection/pccallbackhandler"), i = a("../browserapi/devices"), j = a("./useralivehandler"), k = a("./getstatshandler"), l = a("../config/constants"), m = d(l), n = a("../utility/timestamps"), o = d(n), p = a("../utility/csiologger"), q = d(p), r = function() {
            function a(b) {
                e(this, a), this.pc = b.pc, this.remoteId = b.remoteId, this.fabricUsage = b.fabricUsage, 
                this.callback = b.callback, this.conferenceId = b.conferenceId, this.remoteEndpointType = b.remoteEndpointType, 
                this.fabricTransmissionDirection = b.fabricTransmissionDirection, this.clocksync = g.Registry.getClockSync(), 
                this.startTime = this.clocksync.getSynchronizedTimestamp(), this.credentials = g.Registry.getCredentials(), 
                this.pcHash = this.generatePcHash(), this.ssrcMap = new Map(), this.localSdp = null, 
                this.remoteSdp = null, this.transportInfo = null, this.userAliveHandler = new j.UserAliveHandler(this.conferenceId, this.pc), 
                this.userAliveHandler.start(), this.emb = g.Registry.getEventMessageBuilder(), this.devices = new i.Devices(this.conferenceId, this.pc);
                var c = g.Registry.getEndpoint();
                this.getStatsHandler = new k.GetStatsHandler(this.pc, this.pcHash, 5e3, c.getCodeBase(), c.getBrowserName()), 
                this.pcCallbackHandler = new h.PcCallbackHandler(this.conferenceId, this.pc, this.getStatsHandler, this.userAliveHandler, this.remoteId, this.callback), 
                this.devices.collectConnected(), this.fabricTransmissionDirection || (this.fabricTransmissionDirection = "sendrecv"), 
                this.remoteEndpointType || (this.remoteEndpointType = "peer");
            }
            return f(a, [ {
                key: "getFabricTransmissionDirection",
                value: function() {
                    return this.fabricTransmissionDirection;
                }
            }, {
                key: "getRemoteEndpointType",
                value: function() {
                    return this.remoteEndpointType;
                }
            }, {
                key: "stopUserAliveHandler",
                value: function() {
                    this.userAliveHandler.stop();
                }
            }, {
                key: "getPcState",
                value: function() {
                    return this.pcCallbackHandler.pcState;
                }
            }, {
                key: "stopStatsPolling",
                value: function() {
                    this.getStatsHandler.stopStatsPolling();
                }
            }, {
                key: "startStatsPolling",
                value: function() {
                    this.getStatsHandler.startStatsPolling();
                }
            }, {
                key: "setPcState",
                value: function(a) {
                    a in m.fabricState ? this.pcCallbackHandler.pcState = a : q.error("setPcState: Invalid state");
                }
            }, {
                key: "getAppId",
                value: function() {
                    return this.credentials.getAppId();
                }
            }, {
                key: "getLocalId",
                value: function() {
                    return this.credentials.getUserId();
                }
            }, {
                key: "getConferenceId",
                value: function() {
                    return this.conferenceId;
                }
            }, {
                key: "getPeerConnection",
                value: function() {
                    return this.pc;
                }
            }, {
                key: "getRemoteId",
                value: function() {
                    return this.remoteId;
                }
            }, {
                key: "isFabricSetupSent",
                value: function() {
                    return this.pcCallbackHandler.isFabricSetupSent();
                }
            }, {
                key: "getStartTime",
                value: function() {
                    return this.startTime;
                }
            }, {
                key: "getCallback",
                value: function() {
                    return this.callback;
                }
            }, {
                key: "getPcHash",
                value: function() {
                    return this.pcHash;
                }
            }, {
                key: "getIceCandidates",
                value: function() {
                    return this.pcCallbackHandler ? this.pcCallbackHandler.iceCandidates : null;
                }
            }, {
                key: "getIceConnectionState",
                value: function() {
                    return this.pcCallbackHandler ? this.pcCallbackHandler.iceConnectionState : null;
                }
            }, {
                key: "getNegotiationsNumber",
                value: function() {
                    return this.pcCallbackHandler ? this.pcCallbackHandler.negotiationNeeded : 0;
                }
            }, {
                key: "sendFabricTransportSwitch",
                value: function(a) {
                    this.pcCallbackHandler && this.pcCallbackHandler.sendFabricTransportSwitch(a);
                }
            }, {
                key: "getSdp",
                value: function() {
                    return {
                        localSdp: this.localSdp,
                        remoteSdp: this.remoteSdp
                    };
                }
            }, {
                key: "setSdp",
                value: function(a, b) {
                    this.localSdp = a, this.remoteSdp = b;
                }
            }, {
                key: "generatePcHash",
                value: function() {
                    var a = (Math.random() + 1).toString(36);
                    return a.substring(2, a.length);
                }
            }, {
                key: "getTransportInfo",
                value: function() {
                    return this.transportInfo;
                }
            }, {
                key: "setTransportInfo",
                value: function(a) {
                    this.transportInfo = a;
                }
            }, {
                key: "updateSDP",
                value: function(a) {
                    var b = this, c = this.pc.localDescription.sdp, d = this.pc.remoteDescription.sdp;
                    if (c && d && (c !== this.localSdp || d !== this.remoteSdp)) {
                        this.parseSDP(c, m.streamType.outbound), this.parseSDP(d, m.streamType.inbound);
                        var e = {
                            localSDP: c !== this.localSdp ? c : "",
                            remoteSDP: d !== this.remoteSdp ? d : ""
                        };
                        "" === c && "" === remoteSDP || !g.Registry.getCredentials().getCollectSDP() || this.emb.make(m.internalFabricEvent.sdpSubmission, this.conferenceId, this.pc, e), 
                        a && a.forEach(function(a) {
                            var c = String(a.data.ssrc), d = b.ssrcMap.get(c);
                            d || (d = {}), d.mediaType = a.data.mediaType, d.reportType = a.data.isRemote ? "remote" : "local", 
                            d.ssrc = c, b.ssrcMap.set(c, d);
                        });
                        var f = [];
                        this.ssrcMap.forEach(function(a, b) {
                            f.push(a);
                        });
                        for (var h = {
                            ssrcData: f
                        }, i = 0; i < h.ssrcData.length; i += 1) {
                            h.ssrcData[i].userID = g.Registry.getCredentials().getUserId();
                        }
                        this.emb.make(m.internalFabricEvent.ssrcMap, this.conferenceId, this.pc, h), this.setSdp(c, d);
                    }
                }
            }, {
                key: "parseSDP",
                value: function(a, b) {
                    var c = this, d = RegExp.prototype.test.bind(/^([a-z])=(.*)/), e = /^ssrc:(\d*) ([\w_]*):(.*)/, f = /^ssrc-group:SIM (\d*)/;
                    a.split(/(\r\n|\r|\n)/).filter(d).forEach(function(a) {
                        var d = a[0], g = a.slice(2);
                        if ("a" === d && e.test(g)) {
                            var h = g.match(e), i = h[1], j = h[2], k = h[3], l = c.ssrcMap.get(i);
                            if (l || (l = {}), l.ssrc = i, l[j] = k, l.localStartTime = o.getCurrent(), l.syncedStartTime = c.clocksync.getSynchronizedTimestamp(), 
                            l.streamType = b, !f.test(g)) return void c.ssrcMap.set(i, l);
                            l.ssrcGroup = {}, l.ssrcGroup[b] = {}, l.ssrcGroup[b].simulcastGroup = g.match(/\d+/g), 
                            c.ssrcMap.set(i, l);
                        }
                    });
                }
            }, {
                key: "getSSRCInfo",
                value: function(a) {
                    return this.ssrcMap.get(a);
                }
            }, {
                key: "setupVideoTagMethods",
                value: function(a, b) {
                    var c = this, d = document.getElementById(a);
                    d && (d.oncanplay = function() {
                        var a = {
                            ssrc: String(b),
                            highResTs: o.getCurrent()
                        };
                        c.emb.make(m.internalFabricEvent.mediaPlaybackStart, c.conferenceId, c.pc, a);
                    }, d.onsuspend = function() {
                        var a = {
                            ssrc: String(b),
                            highResTs: o.getCurrent()
                        };
                        c.emb.make(m.internalFabricEvent.mediaPlaybackSuspended, c.conferenceId, c.pc, a);
                    });
                }
            }, {
                key: "updateSSRCInfo",
                value: function(a, b, c, d) {
                    var e = this.ssrcMap.get(a);
                    e || (e = {}), e.ssrc = a, e.remoteUserID = b, e.usageLabel = c, e.associatedVideoTag = d, 
                    this.ssrcMap.set(a, e), d && b !== this.credentials.getUserId() && this.setupVideoTagMethods(d, a);
                }
            }, {
                key: "updateConferenceId",
                value: function(a) {
                    this.conferenceId = a, this.userAliveHandler.updateConferenceId(a);
                }
            }, {
                key: "updateRemoteId",
                value: function(a) {
                    this.remoteId = a;
                }
            } ], [ {
                key: "Builder",
                get: function() {
                    return function() {
                        function b() {
                            e(this, b);
                        }
                        return f(b, [ {
                            key: "withPc",
                            value: function(a) {
                                return this.pc = a, this;
                            }
                        }, {
                            key: "withRemoteId",
                            value: function(a) {
                                return this.remoteId = a, this;
                            }
                        }, {
                            key: "withFabricUsage",
                            value: function(a) {
                                return this.fabricUsage = a, this;
                            }
                        }, {
                            key: "withConferenceId",
                            value: function(a) {
                                return this.conferenceId = a, this;
                            }
                        }, {
                            key: "withRemoteEndpointType",
                            value: function(a) {
                                return this.remoteEndpointType = a, this;
                            }
                        }, {
                            key: "withFabricTransmissionDirection",
                            value: function(a) {
                                return this.fabricTransmissionDirection = a, this;
                            }
                        }, {
                            key: "withCallback",
                            value: function(a) {
                                return this.callback = a, this;
                            }
                        }, {
                            key: "make",
                            value: function() {
                                return new a(this);
                            }
                        } ]), b;
                    }();
                }
            } ]), a;
        }();
        c.PeerConnectionHandler = r;
    }, {
        "../browserapi/devices": 18,
        "../config/constants": 32,
        "../peerconnection/pccallbackhandler": 39,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "../utility/timestamps": 98,
        "./getstatshandler": 38,
        "./useralivehandler": 42
    } ],
    41: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.PeerConnectionManager = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./peerconnectionhandler"), g = function() {
            function a() {
                d(this, a), this.pcHandlers = new Map();
            }
            return e(a, [ {
                key: "addPcHandler",
                value: function(a, b, c, d, e, g, h) {
                    if (!this.getPcHandler(a)) {
                        var i = new f.PeerConnectionHandler.Builder().withPc(a).withRemoteId(b).withFabricUsage(c).withConferenceId(d).withRemoteEndpointType(e).withFabricTransmissionDirection(g).withCallback(h).make();
                        this.pcHandlers.set(i.getPcHash(), i);
                    }
                }
            }, {
                key: "getPcHandler",
                value: function(a) {
                    var b = null;
                    return a ? (this.pcHandlers.forEach(function(c, d) {
                        c && c.getPeerConnection() === a && (b = c);
                    }), b) : b;
                }
            }, {
                key: "getPcHandlerByHash",
                value: function(a) {
                    return a && this.pcHandlers.has(a) ? this.pcHandlers.get(a) : null;
                }
            }, {
                key: "updateConferenceId",
                value: function(a) {
                    this.pcHandlers.forEach(function(b, c) {
                        b.updateConferenceId(a);
                    });
                }
            } ]), a;
        }();
        c.PeerConnectionManager = g;
    }, {
        "./peerconnectionhandler": 40
    } ],
    42: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function e(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function f(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.UserAliveHandler = void 0;
        var g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = a("../config/constants"), i = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(h), j = a("../utility/timeoutprocess"), k = a("../utility/registry"), l = 1e4, m = function(a) {
            function b(a, c) {
                d(this, b);
                var f = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, l));
                return f.emb = k.Registry.getEventMessageBuilder(), f.pc = c, f.conferenceId = a, 
                f.setCallback(f.send), f;
            }
            return f(b, a), g(b, [ {
                key: "send",
                value: function() {
                    this.conferenceId !== i.tmpConferenceId && this.pc && this.emb.make(i.internalFabricEvent.userAlive, this.conferenceId, this.pc);
                }
            }, {
                key: "updateConferenceId",
                value: function(a) {
                    this.conferenceId = a;
                }
            } ]), b;
        }(j.TimeoutProcess);
        c.UserAliveHandler = m;
    }, {
        "../config/constants": 32,
        "../utility/registry": 94,
        "../utility/timeoutprocess": 97
    } ],
    43: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function f(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function g(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.Authenticator = void 0;
        var h = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), i = function a(b, c, d) {
            null === b && (b = Function.prototype);
            var e = Object.getOwnPropertyDescriptor(b, c);
            if (void 0 === e) {
                var f = Object.getPrototypeOf(b);
                return null === f ? void 0 : a(f, c, d);
            }
            if ("value" in e) return e.value;
            var g = e.get;
            if (void 0 !== g) return g.call(d);
        }, j = a("./jwt/jwt"), k = a("./jwt/jwttoken"), l = a("../config/settings"), m = d(l), n = a("../utility/base64"), o = d(n), p = a("../config/callstatserrors"), q = d(p), r = a("../config/constants"), s = d(r), t = a("../browserapi/localstorage"), u = d(t), v = a("../utility/json"), w = d(v), x = a("./xmlhttp"), y = a("./xmlhttpservice"), z = a("../utility/registry"), A = a("../utility/csiologger"), B = d(A), C = m.authRetryTimeout, D = function(a) {
            function b() {
                e(this, b);
                var a = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "Authenticator"));
                return a.clockSync = z.Registry.getClockSync(), a.credentials = z.Registry.getCredentials(), 
                a.url = m.authServiceUrl, a;
            }
            return g(b, a), h(b, [ {
                key: "initiate",
                value: function(a, c) {
                    var d = this;
                    return this.inProgress ? (c && c(q.csError.authOngoing, null), new Promise(function(a, b) {
                        b(new Error(d.name + ": in progress"));
                    })) : this.credentials.getAppId() && this.credentials.getUserId() ? (this.initCallback = c, 
                    "function" == typeof a ? (this.setTokenGenerator(a), i(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "initiate", this).call(this)) : new Promise(function(c, e) {
                        d.createTokenGenerator(a).then(function(a) {
                            d.setTokenGenerator(a), i(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "initiate", d).call(d).then(function() {
                                c();
                            }, function(a) {
                                e(a);
                            });
                        }, function(a) {
                            e(new Error(d.name + ": tokenGenerator creation problem (" + a + ")"));
                        });
                    })) : new Promise(function(a, b) {
                        b(new Error(d.name + ": credentials not set"));
                    });
                }
            }, {
                key: "getToken",
                value: function() {
                    var a = null;
                    return this.token && (a = this.token.getToken()), a;
                }
            }, {
                key: "isTokenValid",
                value: function() {
                    return !!this.token && this.token.isValid(this.credentials);
                }
            }, {
                key: "getElapsed",
                value: function() {
                    return this.isCompleted() ? this.elapsed : null;
                }
            }, {
                key: "getIceServers",
                value: function() {
                    return this.iceServers;
                }
            }, {
                key: "reset",
                value: function() {
                    this.token = null, this.reauthTimer = null, this.renew = !1, this.credentials = null, 
                    this.jwt = new j.Jwt(), this.tokenGenerator = function(a, b) {
                        b("Token generator is not set");
                    }, this.elapsed = 0, this.iceServers = null, i(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "reset", this).call(this);
                }
            }, {
                key: "setupToken",
                value: function(a) {
                    u.store("csio_auth_data", JSON.stringify(a)), this.token = new k.JwtToken(a, this.clockSync);
                }
            }, {
                key: "clearReauthTimer",
                value: function() {
                    null !== this.reauthTimer && (clearTimeout(this.reauthTimer), this.reauthTimer = null);
                }
            }, {
                key: "setupReauthTimer",
                value: function(a) {
                    var b = this;
                    b.clearReauthTimer(), b.reauthTimer = setTimeout(function() {
                        b.reAuthenticate();
                    }, a);
                }
            }, {
                key: "reAuthenticate",
                value: function() {
                    this.inProgress || (this.inProgress = !0, this.token = null, this.sendRequest());
                }
            }, {
                key: "handleErrorActions",
                value: function(a) {
                    if (0 !== a.length) {
                        var b = a.shift();
                        if (b.action === q.authErrorActions.RETRY) {
                            var c = b.params.timeout ? b.params.timeout : m.authRetryTimeout;
                            this.setupReauthTimer(c), this.handleErrorActions(a);
                        }
                        b.action === q.authErrorActions.GET_NEW_TOKEN && (this.renew = !0, this.handleErrorActions(a)), 
                        b.action === q.authErrorActions.REPORT_ERROR && (B.error(this.name + ": " + b.params.errorReason), 
                        this.handleErrorActions(a));
                    }
                }
            }, {
                key: "setTokenGenerator",
                value: function(a) {
                    this.tokenGenerator = a;
                }
            }, {
                key: "handleResponse",
                value: function(a) {
                    var b = a.getXhr(), c = a.getElapsed(), d = w.parse(b.response);
                    if (!d) return B.error(this.name + ": invalid authentication response"), void this.sendNextRequest();
                    if (d["urn:x-callstats:auth:errorActions"] && d["urn:x-callstats:auth:errorActions"].length > 0) return void this.handleErrorActions(d["urn:x-callstats:auth:errorActions"]);
                    if (200 === b.status) {
                        if ("bearer" !== d.token_type) return B.error(this.name + ": successful, but token type was not bearer. Scheduling retry."), 
                        void this.sendNextRequest();
                        this.setupToken(d.access_token), d.iceServers && (this.iceServers = d.iceServers);
                        var e = parseInt(1e3 * parseInt(d.expires_in) * .9);
                        return this.setupReauthTimer(e), this.renew = !1, this.initCallback && this.initCallback(q.csError.success, s.csCallBackMessages.authSuccessful), 
                        this.elapsed = c, void this.completeProcess();
                    }
                    B.error("Authentication failed, but no error actions were defined in response."), 
                    this.sendNextRequest();
                }
            }, {
                key: "request",
                value: function() {
                    var a = this;
                    this.clearReauthTimer();
                    var b = new Promise(function(b, c) {
                        a.tempResolve = b, a.tempReject = c;
                    });
                    return this.tokenGenerator(this.renew, function(b, c) {
                        if (null !== b) return a.initCallback && a.initCallback(q.csError.tokenGenerationError, b.toString()), 
                        a.rejectCb(new Error(a.name + ": tokenGenerationError")), B.error("tokenGenerationError ", b), 
                        null;
                        var d = a.url + "authenticate", e = {
                            client_id: a.credentials.userId + "@" + a.credentials.getAppId(),
                            code: c,
                            grant_type: "authorization_code"
                        }, f = {
                            "Content-Type": "application/x-www-form-urlencoded"
                        };
                        (0, x.sendPostRequest)(d, f, C, e).then(function(b) {
                            a.tempResolve(b);
                        }, function(b) {
                            a.tempReject(b);
                        });
                    }), b;
                }
            }, {
                key: "tokenGeneratorCreator",
                value: function(a, b) {
                    var c = this;
                    return function(d, e) {
                        var f = null, g = {
                            alg: "HS256"
                        };
                        if (!d && null !== f) return e(null, f);
                        var h = c.credentials, i = {
                            userID: h.getUserId(),
                            appID: h.getAppId()
                        };
                        b && (i.keyId = b), c.jwt.sign(g, i, a).then(function(a) {
                            f = a, e(null, a);
                        }).catch(function(a) {
                            e(a);
                        });
                    };
                }
            }, {
                key: "createTokenGenerator",
                value: function(a) {
                    var b = this;
                    return new Promise(function(c, d) {
                        var e = null;
                        a.indexOf(":") > -1 && (e = o.strtohex(a.split(":")[0]), a = a.split(":")[1]), b.jwt.importKey(a).then(function(d) {
                            a = null;
                            var f = b.tokenGeneratorCreator(d, e);
                            c(f);
                        }).catch(function(a) {
                            B.error(b.name + ": could not import key (" + a + ")"), d(a);
                        });
                    });
                }
            } ]), b;
        }(y.XMLHttpService);
        c.Authenticator = D;
    }, {
        "../browserapi/localstorage": 19,
        "../config/callstatserrors": 31,
        "../config/constants": 32,
        "../config/settings": 33,
        "../utility/base64": 84,
        "../utility/csiologger": 87,
        "../utility/json": 92,
        "../utility/registry": 94,
        "./jwt/jwt": 51,
        "./jwt/jwttoken": 52,
        "./xmlhttp": 57,
        "./xmlhttpservice": 58
    } ],
    44: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.GenericEventHandler = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../config/settings"), h = d(g), i = a("./xmlhttp"), j = a("../utility/registry"), k = a("../utility/csiologger"), l = d(k), m = h.baseUrl + "generics", n = function() {
            function a() {
                e(this, a), this.credentials = j.Registry.getCredentials(), this.enabled = !1;
            }
            return f(a, [ {
                key: "enable",
                value: function() {
                    this.enabled = !0;
                }
            }, {
                key: "disable",
                value: function() {
                    this.enabled = !1;
                }
            }, {
                key: "sendEvent",
                value: function(a, b) {
                    this.send(a, b).then(function(a) {
                        l.log("Got generic response: %o", a);
                    }).catch(function(a) {
                        l.log("Got error for generic request", a);
                    });
                }
            }, {
                key: "send",
                value: function(a, b) {
                    if (!this.enabled) return new Promise(function(a, b) {
                        b(new Error("GenericEvent Error: not enabled"));
                    });
                    var c = this;
                    return new Promise(function(d, e) {
                        var f = {
                            "Content-Type": "application/json"
                        }, g = {
                            appID: c.credentials.appId,
                            userID: encodeURIComponent(c.credentials.userId),
                            version: h.version,
                            eventType: a,
                            data: b
                        };
                        (0, i.sendPostRequest)(m, f, 5e3, g).then(function(a) {
                            d(a.getXhr().response);
                        }, function(a) {
                            e(a);
                        });
                    });
                }
            } ]), a;
        }();
        c.GenericEventHandler = n;
    }, {
        "../config/settings": 33,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "./xmlhttp": 57
    } ],
    45: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function f(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function g(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.ClockSync = void 0;
        var h = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), i = function a(b, c, d) {
            null === b && (b = Function.prototype);
            var e = Object.getOwnPropertyDescriptor(b, c);
            if (void 0 === e) {
                var f = Object.getPrototypeOf(b);
                return null === f ? void 0 : a(f, c, d);
            }
            if ("value" in e) return e.value;
            var g = e.get;
            if (void 0 !== g) return g.call(d);
        }, j = a("../config/settings"), k = d(j), l = a("./xmlhttp"), m = a("../utility/timestamps"), n = d(m), o = a("./xmlhttpservice"), p = a("../utility/registry"), q = a("../config/constants"), r = d(q), s = k.baseUrl + "clockSync", t = function(a) {
            function b() {
                e(this, b);
                var a = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "ClockSync"));
                return a.currentOffset = 0, a.completed = !1, a;
            }
            return g(b, a), h(b, [ {
                key: "initiate",
                value: function() {
                    return this.startTime = n.getCurrent(), p.Registry.getGenericEventHandler().sendEvent(r.logEvents.log, {
                        msg: "Starting clocksync"
                    }), i(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "initiate", this).call(this);
                }
            }, {
                key: "getSynchronizedTimestamp",
                value: function() {
                    return n.getCurrent() + this.currentOffset;
                }
            }, {
                key: "getElapsed",
                value: function() {
                    return this.isCompleted() ? this.endTime - this.startTime : null;
                }
            }, {
                key: "getOffset",
                value: function() {
                    return this.currentOffset;
                }
            }, {
                key: "reset",
                value: function() {
                    this.currentOffset = 0, this.offsetResults = [], this.startTime = 0, this.endTime = 0, 
                    i(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "reset", this).call(this);
                }
            }, {
                key: "request",
                value: function() {
                    return (0, l.sendGetRequest)(s, null, 5e3);
                }
            }, {
                key: "handleResponse",
                value: function(a) {
                    var b = a.getXhr(), c = a.getElapsed(), d = JSON.parse(b.response), e = n.getCurrent();
                    this.handleMessage(d, c, e);
                }
            }, {
                key: "handleMessage",
                value: function(a, b, c) {
                    var d = b / 2;
                    d > 6e4 ? (this.offsetResults = [], p.Registry.getGenericEventHandler().sendEvent(r.logEvents.log, {
                        msg: "clockSync restarting"
                    })) : this.addOffset(a, d, c), this.offsetResults.length >= 5 ? (this.calculateOffset(), 
                    this.endTime = n.getCurrent(), this.completeProcess()) : this.sendRequest();
                }
            }, {
                key: "isCompleted",
                value: function() {
                    return this.completed;
                }
            }, {
                key: "addOffset",
                value: function(a, b, c) {
                    var d = a.now + b, e = d - c;
                    this.offsetResults.push(e), p.Registry.getGenericEventHandler().sendEvent(r.logEvents.log, {
                        msg: "clockSync Info: serverTime " + d + " responseRecvTs: " + c
                    });
                }
            }, {
                key: "calculateOffset",
                value: function() {
                    var a = this.offsetResults.reduce(function(a, b) {
                        return a + b;
                    });
                    this.currentOffset = a / this.offsetResults.length, this.currentOffset = isNaN(this.currentOffset) ? 0 : this.currentOffset, 
                    p.Registry.getGenericEventHandler().sendEvent(r.logEvents.log, {
                        msg: "clockSync Done, offset is: " + this.currentOffset + "results length" + this.offsetResults.length
                    }), this.offsetResults = [], this.completed = !0;
                }
            } ]), b;
        }(o.XMLHttpService);
        c.ClockSync = t;
    }, {
        "../config/constants": 32,
        "../config/settings": 33,
        "../utility/registry": 94,
        "../utility/timestamps": 98,
        "./xmlhttp": 57,
        "./xmlhttpservice": 58
    } ],
    46: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a() {
                d(this, a), this.connected = !1, this.reconnected = !1, this.conferenceUrl = {};
            }
            return e(a, [ {
                key: "setup",
                value: function() {
                    return new Promise(function(a, b) {
                        a();
                    });
                }
            }, {
                key: "isReady",
                value: function() {
                    return this.connected;
                }
            }, {
                key: "send",
                value: function(a) {}
            } ]), a;
        }();
        c.CollectorConnection = f;
    }, {} ],
    47: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function e(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function f(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.ConfigServiceGet = void 0;
        var g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = function a(b, c, d) {
            null === b && (b = Function.prototype);
            var e = Object.getOwnPropertyDescriptor(b, c);
            if (void 0 === e) {
                var f = Object.getPrototypeOf(b);
                return null === f ? void 0 : a(f, c, d);
            }
            if ("value" in e) return e.value;
            var g = e.get;
            if (void 0 !== g) return g.call(d);
        }, i = a("../xmlhttp"), j = a("../xmlhttpservice"), k = a("../../utility/registry"), l = function(a) {
            function b() {
                return d(this, b), e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "ConfigService"));
            }
            return f(b, a), g(b, [ {
                key: "initiate",
                value: function(a) {
                    var c = this;
                    return this.url = a, this.authToken = k.Registry.getAuthenticator().getToken(), 
                    this.authToken ? h(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "initiate", this).call(this) : new Promise(function(a, b) {
                        b(new Error(c.name + ": authToken has to be string"));
                    });
                }
            }, {
                key: "getConfig",
                value: function() {
                    return this.config;
                }
            }, {
                key: "getElapsed",
                value: function() {
                    return this.isCompleted() ? this.elapsed : null;
                }
            }, {
                key: "reset",
                value: function() {
                    this.authToken = null, this.url = null, this.config = null, this.elapsed = 0, h(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "reset", this).call(this);
                }
            }, {
                key: "request",
                value: function() {
                    var a = {
                        Authorization: "Bearer " + this.authToken
                    };
                    return (0, i.sendGetRequest)(this.url, a, 2e3);
                }
            }, {
                key: "handleResponse",
                value: function(a) {
                    var b = a.getXhr(), c = a.getElapsed();
                    this.config = JSON.parse(b.response), this.elapsed = c, this.completeProcess();
                }
            } ]), b;
        }(j.XMLHttpService);
        c.ConfigServiceGet = l;
    }, {
        "../../utility/registry": 94,
        "../xmlhttp": 57,
        "../xmlhttpservice": 58
    } ],
    48: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function e(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function f(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.ConfigServicePost = void 0;
        var g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = function a(b, c, d) {
            null === b && (b = Function.prototype);
            var e = Object.getOwnPropertyDescriptor(b, c);
            if (void 0 === e) {
                var f = Object.getPrototypeOf(b);
                return null === f ? void 0 : a(f, c, d);
            }
            if ("value" in e) return e.value;
            var g = e.get;
            if (void 0 !== g) return g.call(d);
        }, i = a("../xmlhttp"), j = a("./configserviceget"), k = function(a) {
            function b() {
                return d(this, b), e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this));
            }
            return f(b, a), g(b, [ {
                key: "initiate",
                value: function(a, c) {
                    return this.body = c, h(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "initiate", this).call(this, a);
                }
            }, {
                key: "request",
                value: function() {
                    var a = {
                        Authorization: "Bearer " + this.authToken
                    };
                    return a["Content-Type"] = "application/json", (0, i.sendPostRequest)(this.url, a, 2e3, this.body);
                }
            } ]), b;
        }(j.ConfigServiceGet);
        c.ConfigServicePost = k;
    }, {
        "../xmlhttp": 57,
        "./configserviceget": 47
    } ],
    49: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.ConfigServiceWrapper = void 0;
        var f = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {
            return typeof a;
        } : function(a) {
            return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;
        }, g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = a("./configserviceget"), i = a("./configservicepost"), j = a("../../config/settings"), k = d(j), l = a("../../utility/registry"), m = a("../../utility/csiologger"), n = d(m), o = k.configServiceUrl, p = function() {
            function a() {
                e(this, a), this.internalConfigService = new h.ConfigServiceGet(), this.appConfigService = new h.ConfigServiceGet(), 
                this.senderConfigService = new i.ConfigServicePost(), this.defaultSenderConfig = null;
            }
            return g(a, [ {
                key: "initiateInternalConfig",
                value: function() {
                    var a = this, b = l.Registry.getCredentials().getAppId();
                    if (!b) return new Promise(function(b, c) {
                        n.log("appId has to be string"), c(new Error(a.internalConfigService.name + ": appId has to be string"));
                    });
                    var c = o + b;
                    return this.internalConfigService.initiate(c + "/configurations/internal");
                }
            }, {
                key: "initiateAppConfig",
                value: function() {
                    var a = this, b = l.Registry.getCredentials().getAppId();
                    if (!b) return new Promise(function(b, c) {
                        n.log("appId has to be string"), c(new Error(a.appConfigService.name + ": appId has to be string"));
                    });
                    var c = o + b;
                    return this.appConfigService.initiate(c + "/configurations");
                }
            }, {
                key: "initiateSenderConfig",
                value: function(a) {
                    var b = this;
                    if (this.senderConfigService.getConfig()) return new Promise(function(a, c) {
                        n.log("sender config already present"), c(new Error(b.senderConfigService.name + ": sender config already present"));
                    });
                    var c = l.Registry.getCredentials().getAppId(), d = l.Registry.getCredentials().getUserId();
                    if (!c || !d) return new Promise(function(a, c) {
                        n.log("appId and userId have to be string"), c(new Error(b.senderConfigService.name + ": appId and userId have to be string"));
                    });
                    if (this.defaultSenderConfig = this.getCurrentVideoSenderConfig(a), !this.defaultSenderConfig) return new Promise(function(a, c) {
                        n.log("Could not obtain a sender config"), c(new Error(b.senderConfigService.name + ": Could not obtain a sender config"));
                    });
                    var e = o + c, f = {
                        app_id: c,
                        local_id: d,
                        rtc_rtp_parameters: this.defaultSenderConfig
                    };
                    return this.senderConfigService.initiate(e + "/configurations", f);
                }
            }, {
                key: "getInternalConfig",
                value: function() {
                    return this.internalConfigService.getConfig();
                }
            }, {
                key: "getAppDefaultConfig",
                value: function() {
                    var a = this.appConfigService.getConfig(), b = {
                        peerConnection: null,
                        media: null
                    };
                    return a.default ? (a.default.peerConnection && (b.peerConnection = a.default.peerConnection), 
                    a.default.media && (b.media = a.default.media), b) : b;
                }
            }, {
                key: "getAppRecommendedConfig",
                value: function() {
                    var a = this.appConfigService.getConfig(), b = {};
                    return a.recommended ? (a.recommended.peerConnection && (b.peerConnection = a.recommended.peerConnection), 
                    a.recommended.media && (b.media = a.recommended.media), b) : b;
                }
            }, {
                key: "getSenderConfig",
                value: function() {
                    var a = this.senderConfigService.getConfig();
                    return a && a.recommended && a.recommended.sender ? a.recommended.sender : null;
                }
            }, {
                key: "getDefaultSenderConfig",
                value: function() {
                    return this.defaultSenderConfig ? this.defaultSenderConfig : null;
                }
            }, {
                key: "getInternalElapsed",
                value: function() {
                    return this.internalConfigService.getElapsed();
                }
            }, {
                key: "getAppElapsed",
                value: function() {
                    return this.appConfigService.getElapsed();
                }
            }, {
                key: "getSenderElapsed",
                value: function() {
                    return this.senderConfigService.getElapsed();
                }
            }, {
                key: "getCurrentVideoSenderConfig",
                value: function(a) {
                    var b = {
                        encodings: [ {
                            maxBitrate: 0
                        } ]
                    }, c = l.Registry.getConferenceManager().getConferenceForPc(a);
                    if (!c) return n.warn("No conference found for PC, skipping"), null;
                    if (c.getPeerConnectionManager().pcHandlers.size > 1) return n.warn("Multiple PCs found, skipping"), 
                    null;
                    if (!a.getSenders || "function" != typeof a.getSenders) return n.warn("Get senders error"), 
                    b;
                    for (var d = a.getSenders(), e = void 0, g = 0; g < d.length; g += 1) {
                        var h = d[g];
                        if ("object" !== (void 0 === h ? "undefined" : f(h)) || !h.track || "object" !== f(h.track) || !h.track.kind) return n.warn("Access senders error"), 
                        null;
                        if ("video" === h.track.kind) {
                            if (e) return n.warn("Multiple video sender, skipping"), null;
                            e = h;
                        }
                    }
                    if (!e) return n.warn("No video sender found"), null;
                    if (!e.getParameters || "function" != typeof e.getParameters) return n.warn("Sender getParameters error"), 
                    b;
                    var i = e.getParameters();
                    return "object" !== (void 0 === i ? "undefined" : f(i)) ? null : ("encodings" in i || (i.encodings = []), 
                    0 === i.encodings.length && i.encodings.push({
                        maxBitrate: 0
                    }), i);
                }
            } ]), a;
        }();
        c.ConfigServiceWrapper = p;
    }, {
        "../../config/settings": 33,
        "../../utility/csiologger": 87,
        "../../utility/registry": 94,
        "./configserviceget": 47,
        "./configservicepost": 48
    } ],
    50: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.ConnectionManager = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("../config/constants"), g = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(f), h = a("./wscollectorconnection"), i = a("./restcollectorconnection"), j = a("../utility/registry"), k = function() {
            function a() {
                d(this, a), this.connection = null;
            }
            return e(a, [ {
                key: "setupCollectorConnection",
                value: function(a) {
                    a === g.transportType.rest ? this.connection = new i.RestCollectorConnection() : this.connection = new h.WsCollectorConnection();
                }
            }, {
                key: "setup",
                value: function() {
                    return this.connection ? this.connection.setup() : new Promise(function(a, b) {
                        b();
                    });
                }
            }, {
                key: "isReady",
                value: function() {
                    return !!this.connection && this.connection.isReady();
                }
            }, {
                key: "send",
                value: function(a) {
                    if (!this.connection) return void j.Registry.getGenericEventHandler().sendEvent(g.logEvents.error, {
                        msg: "Connection not available to the collector"
                    });
                    this.connection.send(a);
                }
            } ]), a;
        }();
        c.ConnectionManager = k;
    }, {
        "../config/constants": 32,
        "../utility/registry": 94,
        "./restcollectorconnection": 53,
        "./wscollectorconnection": 56
    } ],
    51: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.Jwt = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../../utility/base64"), h = d(g), i = a("../../utility/csiologger"), j = d(i), k = a("../../utility/registry"), l = a("../../config/constants"), m = d(l), n = function() {
            function a() {
                e(this, a), this.cryptotype = null, window.crypto && window.crypto.subtle ? (this.cryptotype = "standard", 
                this.subtlecrypto = window.crypto.subtle) : window.crypto && !window.crypto.subtle && window.crypto.webkitSubtle ? (this.cryptotype = "webkit", 
                this.subtlecrypto = window.crypto.webkitSubtle) : window.msCrypto && window.msCrypto.subtle ? (this.cryptotype = "ie", 
                this.subtlecrypto = window.msCrypto.subtle) : (this.subtlecrypto = null, j.info("WebCryptography API not supported in this browser.")), 
                this.browserName = k.Registry.getEndpoint().getBrowserName();
            }
            return f(a, [ {
                key: "sign",
                value: function(a, b, c) {
                    var d = this;
                    return new Promise(function(e, f) {
                        "HS256" !== a.alg && f("Use header.alg=HS256"), a = JSON.stringify(a), "string" != typeof b && (b = JSON.stringify(b));
                        var g = h.urlencodeUnicode(a) + "." + h.urlencodeUnicode(b);
                        window.csioReactNative && window.csiosign(g, c, function(a, b) {
                            if (a) return j.log("Token sign error", a), void f(error);
                            e(b);
                        });
                        var i = new ArrayBuffer(g.length), k = new Uint8Array(i), l = {
                            name: "HMAC"
                        };
                        "ie" !== d.cryptotype && "webkit" !== d.cryptotype && d.browserName !== m.browserName.edge || (l.hash = {
                            name: "sha-256"
                        });
                        for (var n = g.length - 1; n >= 0; n--) k[n] = g.charCodeAt(n);
                        var o = d.subtlecrypto.sign(l, c, k);
                        "ie" === d.cryptotype ? (o.onerror = f, o.oncomplete = function(a) {
                            g = d.buildToken(a.target.result, g), e(g);
                        }) : o.then(function(a) {
                            g = d.buildToken(a, g), e(g);
                        }).catch(function(a) {
                            f(a);
                        });
                    });
                }
            }, {
                key: "buildToken",
                value: function(a, b) {
                    for (var c = "", d = new Uint8Array(a), e = d.byteLength, f = 0; f < e; f++) c += String.fromCharCode(d[f]);
                    return b += "." + h.urlencode(c);
                }
            }, {
                key: "decode",
                value: function(a) {
                    try {
                        var b = a.split(".")[1], c = h.decode(b);
                        return JSON.parse(c);
                    } catch (a) {
                        return j.error("Could not decode token. "), null;
                    }
                }
            }, {
                key: "importKey",
                value: function(a) {
                    var b = this;
                    return new Promise(function(c, d) {
                        if (window.csioReactNative) return void c(a);
                        if ("webkit" === b.cryptotype) for (;a.length < 32; ) a += "\0";
                        var e = {
                            kty: "oct",
                            k: h.urlencode(a),
                            alg: "HS256"
                        }, f = {
                            name: "HMAC",
                            hash: {
                                name: "SHA-256"
                            }
                        };
                        if ("ie" === b.cryptotype ? e.extractable = !1 : e.ext = !1, "webkit" === b.cryptotype && (f = null, 
                        e.use = "sig"), "ie" === b.cryptotype || "webkit" === b.cryptotype) {
                            var g = JSON.stringify(e);
                            e = new Uint8Array(g.length);
                            for (var i = 0; i < g.length; i++) e[i] = g.charCodeAt(i);
                        }
                        var j = b.subtlecrypto.importKey("jwk", e, f, !1, [ "sign" ]);
                        "ie" === b.cryptotype ? (j.onerror = d, j.oncomplete = function(a) {
                            c(a.target.result);
                        }) : j.then(c).catch(d);
                    });
                }
            } ]), a;
        }();
        c.Jwt = n;
    }, {
        "../../config/constants": 32,
        "../../utility/base64": 84,
        "../../utility/csiologger": 87,
        "../../utility/registry": 94
    } ],
    52: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.JwtToken = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("./jwt"), h = a("../../utility/registry"), i = a("../../config/constants"), j = d(i), k = a("../../utility/csiologger"), l = d(k), m = function() {
            function a(b) {
                e(this, a), this.token = b, this.statsSubmissionInterval = 15e3, this.collectSDP = !1, 
                this.appId = null, this.userId = null, this.tokenPayload = null, this.jwt = new g.Jwt(), 
                this.expires = null, this.clockSync = h.Registry.getClockSync(), this.adaptiveInterval = !1, 
                this.transportType = j.transportType.rest, this.setupTokenPayload(), this.restApiTransport = !1;
            }
            return f(a, [ {
                key: "getToken",
                value: function() {
                    return this.token;
                }
            }, {
                key: "setupTokenPayload",
                value: function() {
                    var a = this.jwt.decode(this.token);
                    if (this.statsSubmissionInterval = parseInt(a.submissionInterval, 10), this.collectSDP = a.collectSDP, 
                    this.adaptiveInterval = a.adaptiveInterval, this.appId = a.appID, this.userId = a.userID, 
                    this.restApiTransport = a.restApiTransport, navigator.mozGetUserMedia) {
                        var b = a.expiry.split(" ").join("T");
                        this.expires = Date.parse(b);
                    } else this.expires = new Date(a.expiry);
                    this.restApiTransport ? this.transportType = j.transportType.rest : this.transportType = j.transportType.ws, 
                    l.info("transportType is ", this.transportType, this.restApiTransport), h.Registry.getCredentials().setStatsSubmissionInterval(this.statsSubmissionInterval), 
                    h.Registry.getCredentials().setCollectSDP(this.collectSDP), h.Registry.getCredentials().setTransportType(this.transportType), 
                    h.Registry.getCredentials().setAdaptiveInterval(this.adaptiveInterval);
                }
            }, {
                key: "isValid",
                value: function(a) {
                    var b = this, c = !1;
                    if (null !== b.token && b.appId === a.appId && b.userId === encodeURIComponent(a.userId)) {
                        new Date(this.clockSync.getSynchronizedTimestamp()) < b.expires && (c = !0);
                    }
                    return c;
                }
            } ]), a;
        }();
        c.JwtToken = m;
    }, {
        "../../config/constants": 32,
        "../../utility/csiologger": 87,
        "../../utility/registry": 94,
        "./jwt": 51
    } ],
    53: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function f(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function g(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.RestCollectorConnection = void 0;
        var h = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), i = a("../utility/registry"), j = a("./xmlhttp"), k = a("./collectorconnection"), l = a("./restrelays"), m = a("../config/constants"), n = d(m), o = a("../utility/csiologger"), p = d(o), q = function(a) {
            function b() {
                e(this, b);
                var a = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this));
                return a.relays = new l.RestRelays(), a;
            }
            return g(b, a), h(b, [ {
                key: "isReady",
                value: function() {
                    return !0;
                }
            }, {
                key: "send",
                value: function(a) {
                    var b = {
                        "Content-Type": "application/json",
                        Authorization: "Bearer " + i.Registry.getAuthenticator().getToken()
                    }, c = a.eventType, d = a.confID, e = a.ucID, f = this.relays, g = f.getRequestUrl(c, d, e);
                    if (!g) return void p.warn("No action for message type: " + c);
                    var h = this.getMessage(c, a);
                    p.log("sending ", g, a), (0, j.sendPostRequest)(g, b, 5e3, h).then(function(a) {
                        f.handleResponse(c, a, d);
                    }, function(a) {
                        p.error(a);
                    });
                }
            }, {
                key: "getMessage",
                value: function(a, b) {
                    delete b.confID, delete b.channel, delete b.token, delete b.appID, delete b.action, 
                    delete b.ucID, delete b.version;
                    var c = decodeURIComponent(b.localID);
                    b.localID = c;
                    var d = decodeURIComponent(b.remoteID);
                    return b.remoteID = d, a === n.callstatsChannels.processedStats && (b.eventType = "stats"), 
                    b;
                }
            } ]), b;
        }(k.CollectorConnection);
        c.RestCollectorConnection = q;
    }, {
        "../config/constants": 32,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "./collectorconnection": 46,
        "./restrelays": 54,
        "./xmlhttp": 57
    } ],
    54: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function f() {
            var a = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : null, b = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null;
            return function(c, d) {
                if (!c || !c.xhr) return void p.log("Response for request is null");
                var e = c.xhr.response, f = JSON.parse(e);
                f.conferenceId = d, "success" === f.status ? a && a(f) : b ? b(f) : (m.Registry.getGenericEventHandler().sendEvent(j.logEvents.restResponseError, {
                    msg: "response failure " + f.msg + ":" + f.status
                }), p.error("Response error:", f.msg, e));
            };
        }
        function g(a) {
            var b = f();
            return new Map([ [ j.fabricEvent.fabricTerminated, new r(l.restEventUrl, "/events/fabric/terminated", b) ], [ j.fabricEvent.audioMute, new r(l.restEventUrl, "/events/media/actions", b) ], [ j.fabricEvent.audioUnmute, new r(l.restEventUrl, "/events/media/actions", b) ], [ j.fabricEvent.videoPause, new r(l.restEventUrl, "/events/media/actions", b) ], [ j.fabricEvent.videoResume, new r(l.restEventUrl, "/events/media/actions", b) ], [ j.fabricEvent.screenShareStart, new r(l.restEventUrl, "/events/media/actions", b) ], [ j.fabricEvent.screenShareStop, new r(l.restEventUrl, "/events/media/actions", b) ], [ j.fabricEvent.activeDeviceList, new r(l.restEventUrl, "/events/devices/list", b) ], [ j.fabricEvent.applicationErrorLog, new r(l.restEventUrl, "/events/app/logs", b) ], [ j.fabricEvent.dominantSpeaker, new r(l.restEventUrl, "/events/dominantspeaker", b) ], [ j.fabricEvent.fabricHold, new r(l.restEventUrl, "/events/fabric/actions", b) ], [ j.fabricEvent.fabricResume, new r(l.restEventUrl, "/events/fabric/actions", b) ], [ j.internalFabricEvent.fabricSetup, new r(l.restEventUrl, "/events/fabric/setup", b) ], [ j.fabricEvent.fabricSetupFailed, new r(l.restEventUrl, "/events/fabric/setupfailed", b) ], [ j.internalFabricEvent.userJoined, new r(l.restEventUrl, "", f(function(a) {
                if ("success" !== a.status) return void m.Registry.getGenericEventHandler().sendEvent(j.logEvents.restResponseError, {
                    msg: "userJoined response failure" + a.msg + ":" + a.status
                });
                var b = decodeURIComponent(a.conferenceId), c = m.Registry.getConferenceManager().get(b);
                c && (p.log("UcId =", a.ucID, b), c.setUcId(a.ucID), m.Registry.getTransmissionManager().trySend());
            })) ], [ j.internalFabricEvent.userLeft, new r(l.restEventUrl, "/events/user/left", b) ], [ j.internalFabricEvent.userAlive, new r(l.restEventUrl, "/events/user/alive", b) ], [ j.internalFabricEvent.fabricTransportSwitch, new r(l.restEventUrl, "/events/fabric/transportchange", b) ], [ j.internalFabricEvent.mediaPlaybackStart, new r(l.restEventUrl, "/events/media/pipeline", b) ], [ j.internalFabricEvent.mediaPlaybackSuspended, new r(l.restEventUrl, "/events/media/pipeline", b) ], [ j.internalFabricEvent.mediaPlaybackStalled, new r(l.restEventUrl, "/events/media/pipeline", b) ], [ j.internalFabricEvent.ssrcMap, new r(l.restEventUrl, "/events/ssrcmap", b) ], [ j.internalFabricEvent.connectedDeviceList, new r(l.restEventUrl, "/events/devices/list", b) ], [ j.internalFabricEvent.sdpSubmission, new r(l.restEventUrl, "/events/sdp", b) ], [ j.internalFabricEvent.iceDisruptionStart, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.iceDisruptionEnd, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.iceConnectionDisruptionStart, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.iceConnectionDisruptionEnd, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.iceAborted, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.iceTerminated, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.iceFailed, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.iceRestarted, new r(l.restEventUrl, "/events/ice/status", b) ], [ j.internalFabricEvent.fabricDropped, new r(l.restEventUrl, "/events/fabric/status", b) ], [ j.callstatsChannels.processedStats, new r(l.restStatsUrl, "/stats", b) ], [ j.internalFabricEvent.fabricStateChange, new r(l.restEventUrl, "/events/fabric/statechange", b) ], [ j.callstatsChannels.userFeedback, new r(l.restEventUrl, "/events/feedback", b) ], [ j.precalltestEvents.results, new r(l.restEventUrl, "/events/precall", b) ], [ j.precalltestEvents.associate, new r(l.restEventUrl, "/events/precall", b) ], [ j.internalFabricEvent.userDetails, new r(l.restEventUrl, "/events/userdetails", b) ] ]);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.RestRelays = void 0;
        var h = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), i = a("../config/constants"), j = d(i), k = a("../config/settings"), l = d(k), m = a("../utility/registry"), n = a("../utility/url"), o = a("../utility/csiologger"), p = d(o), q = function() {
            function a() {
                e(this, a), this.items = g();
            }
            return h(a, [ {
                key: "getRequestUrl",
                value: function(a, b, c) {
                    return this.items.has(a) ? this.items.get(a).getRequestUrl(a, b, c) : (p.warn("EventType Unsupported ", a), 
                    null);
                }
            }, {
                key: "handleResponse",
                value: function(a, b, c) {
                    if (!this.items.has(a)) return void p.warn("No response handler for event type " + a);
                    this.items.get(a).handleResponse(b, c);
                }
            } ]), a;
        }(), r = function() {
            function a(b, c) {
                var d = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null;
                e(this, a), this.baseUrl = b, this.urlAppendix = c, this.responseHandler = d;
            }
            return h(a, [ {
                key: "getRequestUrl",
                value: function(a, b, c) {
                    return this.makeRequestUrl(a, b, c), this.requestUrl.toString();
                }
            }, {
                key: "makeRequestUrl",
                value: function(a, b, c) {
                    a === j.precalltestEvents.results ? this.requestUrl = new n.Url(this.baseUrl, m.Registry.getCredentials().getAppId(), this.urlAppendix) : (a === j.internalFabricEvent.userJoined && c && (c = ""), 
                    this.requestUrl = new n.Url(this.baseUrl, m.Registry.getCredentials().getAppId() + "/conferences/" + b, c, this.urlAppendix));
                }
            }, {
                key: "handleResponse",
                value: function(a, b) {
                    this.responseHandler(a, b);
                }
            } ]), a;
        }();
        c.RestRelays = q;
    }, {
        "../config/constants": 32,
        "../config/settings": 33,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "../utility/url": 99
    } ],
    55: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.TransmissionManager = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../utility/timestamps"), h = d(g), i = a("../collections/cache"), j = a("../utility/registry"), k = a("../config/constants"), l = d(k), m = a("../utility/csiologger"), n = d(m), o = function() {
            function a() {
                e(this, a), this.cache = [], this.connectionManager = j.Registry.getConnectionManager(), 
                this.lastTS = 0, this.timerStarted = !1;
            }
            return f(a, [ {
                key: "send",
                value: function(a) {
                    (a.isCachable() || a.canBeSent()) && (this.cache[a.getConferenceId()] || (this.cache[a.getConferenceId()] = new i.Cache()), 
                    this.cache[a.getConferenceId()].add(a, a.isPriority()), this.trySend());
                }
            }, {
                key: "trySend",
                value: function() {
                    if (!this.connectionManager.isReady()) return void this.setupConnection();
                    if (!this.timerStarted) return this.timeToSend() ? void (this.sendMessage() && this.startTimer()) : void (this.getCacheLength() > 0 && this.startTimer());
                }
            }, {
                key: "setupConnection",
                value: function() {
                    this.connectionManager.setup().then(function() {
                        n.log("Connected to connectionManager");
                    }).catch(function(a) {
                        return n.log("Could not connect to connectionManager", a);
                    });
                }
            }, {
                key: "sendMessage",
                value: function() {
                    var a = void 0, b = void 0;
                    if (0 === this.getCacheLength()) return !1;
                    for (var c in this.cache) if (this.cache.hasOwnProperty(c) && (b = c, (a = this.cache[b].peak()) && a.canBeSent())) break;
                    return !(!a || !a.canBeSent()) && (n.log("sending message type :", a.toJson().action, a.toJson()), 
                    a = this.cache[b].pop(), this.lastTS = h.getCurrent(), this.connectionManager.send(a.toJson()), 
                    !0);
                }
            }, {
                key: "startTimer",
                value: function() {
                    var a = this;
                    this.timerStarted || 0 != this.getCacheLength() && (this.timerStarted = !0, setTimeout(function() {
                        a.timerStarted = !1, a.trySend();
                    }, 200));
                }
            }, {
                key: "timeToSend",
                value: function() {
                    return h.getCurrent() >= this.lastTS + 200;
                }
            }, {
                key: "getCacheLength",
                value: function() {
                    var a = 0;
                    for (var b in this.cache) this.cache.hasOwnProperty(b) && (a += this.cache[b].length());
                    return a;
                }
            }, {
                key: "updateConferenceId",
                value: function(a) {
                    var b = l.tmpConferenceId;
                    this.cache[b] && this.cache[b].updateConferenceId(a);
                }
            } ]), a;
        }();
        c.TransmissionManager = o;
    }, {
        "../collections/cache": 24,
        "../config/constants": 32,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "../utility/timestamps": 98
    } ],
    56: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function f(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function g(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.WsCollectorConnection = void 0;
        var h = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), i = a("../config/callstatserrors"), j = d(i), k = a("../config/constants"), l = d(k), m = a("../config/settings"), n = d(m), o = a("../utility/registry"), p = a("../utility/csiologger"), q = d(p), r = a("./collectorconnection"), s = function(a) {
            function b() {
                e(this, b);
                var a = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this));
                return a.wsConnection = null, a.wsUrl = n.wsUrl, a.wsConnectionState = l.wsConnectionState.closed, 
                a.connected = !1, a.reconnected = !1, a;
            }
            return g(b, a), h(b, [ {
                key: "onOpenHandler",
                value: function() {
                    var a = this;
                    a.wsConnectionState = l.wsConnectionState.connected, a.connected ? a.reconnected = !0 : a.connected = !0, 
                    a.reconnected = !1;
                }
            }, {
                key: "onCloseHandler",
                value: function() {
                    var a = this;
                    a.wsConnectionState = l.wsConnectionState.closed, q.log("**** Connection to the backend closed."), 
                    a.wsConnection && (a.wsConnection = null);
                }
            }, {
                key: "onErrorHandler",
                value: function(a) {
                    var b = this;
                    b.wsConnectionState = l.wsConnectionState.closed, q.log("**** Connection establishment to the backend failed."), 
                    b.callback && b.callback(j.csError.wsChannelFailure, "WebSocket establishment failed.", a);
                }
            }, {
                key: "onMessageHandler",
                value: function(a) {
                    var b = a.data, c = JSON.parse(b);
                    if ("200 OK" === c.status) {
                        if ("feedback" === c.event) window.localStorage.removeItem("feedback"); else if (c.event === l.internalFabricEvent.userJoined) {
                            var d = o.Registry.getConferenceManager().get(decodeURIComponent(c.conferenceID));
                            d && d.setUcId(c.ucID), q.log("UcId =", c.ucID), o.Registry.getTransmissionManager().trySend();
                        }
                    } else q.error("Collector error:", c.reason);
                }
            }, {
                key: "setup",
                value: function() {
                    var a = this;
                    return new Promise(function(b, c) {
                        if (a.wsConnectionState === l.wsConnectionState.initiated || a.wsConnectionState === l.wsConnectionState.connected) return q.log("setupWebSocketConnection is called when already connected!"), 
                        a.callback && a.callback(j.csError.success, l.csCallBackMessages.wsConnected), void b();
                        a.wsConnectionState = l.wsConnectionState.initiated, q.log("creating new WebSocket", a.wsUrl), 
                        a.wsConnection = new WebSocket(a.wsUrl, "echo-protocol"), a.wsConnection.onopen = function() {
                            b(), a.onOpenHandler();
                        }, a.wsConnection.onclose = function() {
                            a.onCloseHandler();
                        }, a.wsConnection.onerror = function(b) {
                            c(b), a.onErrorHandler(b);
                        }, a.wsConnection.onmessage = function(b) {
                            a.onMessageHandler(b);
                        };
                    });
                }
            }, {
                key: "isReady",
                value: function() {
                    var a = this;
                    return !(!a.wsConnection || 1 !== a.wsConnection.readyState);
                }
            }, {
                key: "getState",
                value: function() {
                    var a = this;
                    return a.wsConnection ? a.wsConnection.readyState : -1;
                }
            }, {
                key: "send",
                value: function(a) {
                    this.wsConnection.send(JSON.stringify(a));
                }
            } ]), b;
        }(r.CollectorConnection);
        c.WsCollectorConnection = s;
    }, {
        "../config/callstatserrors": 31,
        "../config/constants": 32,
        "../config/settings": 33,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "./collectorconnection": 46
    } ],
    57: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function f(a, b, c, d, e) {
            return new Promise(function(f, g) {
                var h = null, i = null, j = null, l = new XMLHttpRequest(), p = n.Registry.getEndpoint().getBrowserName();
                if (!l) return void g(new Error("creating instance failed"));
                h = k.getCurrent(), l.open(a, b), p !== m.browserName.msie && (l.timeout = d);
                for (var q in c) c.hasOwnProperty(q) && l.setRequestHeader(q, c[q]);
                var r = null;
                if ("POST" === a) {
                    if ("application/x-www-form-urlencoded" === c["Content-Type"]) {
                        var s = [];
                        for (var t in e) e.hasOwnProperty(t) && s.push(encodeURIComponent(t) + "=" + encodeURIComponent(e[t]));
                        r = s.join("&");
                    }
                    "application/json" === c["Content-Type"] && (r = JSON.stringify(e));
                }
                l.onload = function() {
                    i = k.getCurrent(), j = i - h;
                    var a = new o(l, j);
                    f(a);
                }, l.ontimeout = function() {
                    g(new Error("connection timeout"));
                }, l.onreadystatechange = function() {
                    4 === l.readyState && 0 === l.status && g(new Error("no server response received"));
                }, l.send(r);
            });
        }
        function g(a, b, c) {
            return f("GET", a, b, c, null);
        }
        function h(a, b, c, d) {
            return f("POST", a, b, c, d);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var i = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }();
        c.sendGetRequest = g, c.sendPostRequest = h;
        var j = a("../utility/timestamps"), k = d(j), l = a("../config/constants"), m = d(l), n = a("../utility/registry"), o = function() {
            function a(b, c) {
                e(this, a), this.xhr = b, this.elapsed = c;
            }
            return i(a, [ {
                key: "getXhr",
                value: function() {
                    return this.xhr;
                }
            }, {
                key: "getElapsed",
                value: function() {
                    return this.elapsed;
                }
            } ]), a;
        }();
    }, {
        "../config/constants": 32,
        "../utility/registry": 94,
        "../utility/timestamps": 98
    } ],
    58: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.XMLHttpService = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("../utility/sigmoid"), g = a("../utility/csiologger"), h = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(g), i = 100, j = 1e4, k = function() {
            function a() {
                var b = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : "XMLHttpService", c = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : i, e = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : j;
                d(this, a), this.name = b, this.minRetryTimeout = c, this.sigmoid = new f.Sigmoid(e - c, 15, .5), 
                this.reset();
            }
            return e(a, [ {
                key: "reset",
                value: function() {
                    this.inProgress = !1, this.completed = !1, this.resolveCb && this.rejectCb(new Error(this.name + ": resetting")), 
                    this.resolveCb = null, this.rejectCb = null;
                }
            }, {
                key: "initiate",
                value: function() {
                    var a = this;
                    if (this.inProgress) return new Promise(function(b, c) {
                        c(new Error(a.name + ": in progress"));
                    });
                    var b = new Promise(function(b, c) {
                        a.resolveCb = b, a.rejectCb = c;
                    });
                    return this.inProgress = !0, this.sendRequest(), b;
                }
            }, {
                key: "isCompleted",
                value: function() {
                    return this.completed;
                }
            }, {
                key: "handleSendError",
                value: function(a) {
                    h.log(this.name + ": send next request (" + a + ")"), this.sendNextRequest();
                }
            }, {
                key: "handleResponseProxy",
                value: function(a) {
                    this.handleResponse(a), this.resetTimeout();
                }
            }, {
                key: "handleResponse",
                value: function(a) {
                    h.error(this.name + ": handleResponse() not implemented"), this.completeProcess();
                }
            }, {
                key: "completeProcess",
                value: function() {
                    this.inProgress = !1, this.completed = !0, this.resolveCb.apply(this, arguments);
                }
            }, {
                key: "request",
                value: function() {
                    return h.error(this.name + ": request() not implemented!"), new Promise(function(a, b) {
                        a();
                    });
                }
            }, {
                key: "sendRequest",
                value: function() {
                    if (this.inProgress) {
                        var a = this.request();
                        a && a.then(this.handleResponseProxy.bind(this), this.handleSendError.bind(this));
                    }
                }
            }, {
                key: "sendNextRequest",
                value: function() {
                    setTimeout(this.sendRequest.bind(this), this.getTimeout());
                }
            }, {
                key: "resetTimeout",
                value: function() {
                    this.sigmoid.reset();
                }
            }, {
                key: "getTimeout",
                value: function() {
                    return this.minRetryTimeout + this.sigmoid.getActual();
                }
            } ]), a;
        }();
        c.XMLHttpService = k;
    }, {
        "../utility/csiologger": 87,
        "../utility/sigmoid": 96
    } ],
    59: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.Measurement = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./resolution"), g = a("./validator"), h = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(g), i = function() {
            function a() {
                d(this, a), this.pcHash = null, this.ssrc = null, this.streamType = null, this.mediaType = null, 
                this.resolution = null, this.frameRateReceived = null, this.frameHeight = null, 
                this.frameWidth = null, this.droppedFramesNum = null, this.rtt = null, this.jitter = null, 
                this.lostPackets = -1, this.receivedPackets = -1, this.sentPackets = -1, this.discardedPackets = -1, 
                this.sentBytes = -1, this.receivedBytes = -1, this.track = null, this.fractionLost = 0;
            }
            return e(a, null, [ {
                key: "make",
                value: function(b, c, d, e, g, i, j, k, l, m, n, o, p, q, r, s, t) {
                    var u = new a(), v = function(a, b) {
                        -1 === [ void 0, null ].indexOf(b) && (u[a] = b);
                    };
                    return v("pcHash", b), v("ssrc", c), v("streamType", d), v("mediaType", e), v("frameRateReceived", g), 
                    v("frameHeight", h.checkForNan(parseInt(i, 10))), v("frameWidth", h.checkForNan(parseInt(j, 10))), 
                    v("droppedFramesNum", k), v("rtt", l), v("jitter", m), v("lostPackets", n), v("receivedPackets", o), 
                    v("sentPackets", p), v("discardedPackets", q), v("sentBytes", r), v("receivedBytes", s), 
                    v("track", t), u.resolution = void 0 !== g && void 0 !== j && void 0 !== i && j > 0 && i > 0 ? new f.Resolution(j, i, g) : null, 
                    u;
                }
            } ]), e(a, [ {
                key: "getPcHash",
                value: function() {
                    return this.pcHash;
                }
            }, {
                key: "getSSRC",
                value: function() {
                    return this.ssrc;
                }
            }, {
                key: "getStreamType",
                value: function() {
                    return this.streamType;
                }
            }, {
                key: "getMediaType",
                value: function() {
                    return this.mediaType;
                }
            }, {
                key: "getResolution",
                value: function() {
                    return this.resolution ? this.resolution.toString() : null;
                }
            }, {
                key: "getFrameRateReceived",
                value: function() {
                    return this.frameRateReceived;
                }
            }, {
                key: "getFrameHeight",
                value: function() {
                    return this.frameHeight;
                }
            }, {
                key: "getFrameWidth",
                value: function() {
                    return this.frameWidth;
                }
            }, {
                key: "getDroppedFramesNum",
                value: function() {
                    return this.droppedFramesNum;
                }
            }, {
                key: "getJitter",
                value: function() {
                    return this.jitter;
                }
            }, {
                key: "getRTT",
                value: function() {
                    return this.rtt;
                }
            }, {
                key: "getLostPackets",
                value: function() {
                    return this.lostPackets;
                }
            }, {
                key: "getDiscardedPackets",
                value: function() {
                    return this.discardedPackets;
                }
            }, {
                key: "getReceivedPackets",
                value: function() {
                    return this.receivedPackets;
                }
            }, {
                key: "getSentPackets",
                value: function() {
                    return this.sentPackets;
                }
            }, {
                key: "getSentBytes",
                value: function() {
                    return this.sentBytes;
                }
            }, {
                key: "getReceivedBytes",
                value: function() {
                    return this.receivedBytes;
                }
            }, {
                key: "setFractionLost",
                value: function(a) {
                    this.fractionLost = void 0 === a ? null : a;
                }
            }, {
                key: "getFractionLost",
                value: function() {
                    return this.fractionLost;
                }
            }, {
                key: "extractTrack",
                value: function() {
                    var a = this.track;
                    return this.track = null, a;
                }
            }, {
                key: "toString",
                value: function() {
                    return "pcHash: " + this.pcHash + ", ssrc: " + this.ssrc + ", streamType: " + this.streamType + ", mediaType: " + this.mediaType + ", frameRateReceived: " + this.frameRateReceived + ", frameHeight: " + this.frameHeight + ", frameWidth: " + this.frameWidth + ", droppedFramesNum: " + this.droppedFramesNum + ", rtt: " + this.rtt + ", jitter: " + this.jitter + ", lostPackets: " + this.lostPackets + ", receivedPackets: " + this.receivedPackets + ", sentPackets: " + this.sentPackets + ", discardedPackets: " + this.discardedPackets + ", sentBytes: " + this.sentBytes + ", receivedBytes: " + this.receivedBytes;
                }
            } ]), a;
        }();
        c.Measurement = i;
    }, {
        "./resolution": 67,
        "./validator": 82
    } ],
    60: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.CPULimitationObserver = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../../config/constants"), h = d(g), i = a("../../utility/timestamps"), j = d(i), k = function() {
            function a() {
                e(this, a), this.ewmaDiscardedPackets = 0, this.ewmaLostPackets = 0, this.ewmaDroppedFrames = 0, 
                this.last = 0, this.noticed = 0;
            }
            return f(a, [ {
                key: "test",
                value: function(a) {
                    var b = a.discardedPackets, c = a.lostPackets;
                    if (!c || c < 1 || !b || b < 1) return !1;
                    if (0 === this.last) return this.last = j.getCurrent(), this.ewmaLostPackets = c, 
                    this.ewmaDiscardedPackets = b, !1;
                    var d = j.getCurrent(), e = Math.max(d - this.last, 1), f = Math.min((5e3 - e) / 5e3, .9), g = a.droppedFrames;
                    return this.ewmaLostPackets = this.ewmaLostPackets * f + c, this.ewmaDroppedFrames = this.ewmaDroppedFrames * f + g, 
                    this.ewmaDiscardedPackets = this.ewmaDiscardedPackets * f + b, !(!g || g < 1) && (!(1 < this.ewmaLostPackets || 1 < this.ewmaDiscardedPackets) && (!(d - this.noticed < 1e4) && (!(this.ewmaDroppedFrames < 1) && (this.noticed = d, 
                    !0))));
                }
            } ]), a;
        }(), l = function() {
            function a(b) {
                e(this, a), this.notifyCallback = b, this.inbVideoTesters = new Map();
            }
            return f(a, [ {
                key: "accept",
                value: function(a) {
                    for (var b = a.filter(function(a) {
                        return a.getMediaType() === h.mediaType.video && a.getStreamType() === h.streamType.inbound;
                    }), c = 0; c < b.length; ++c) {
                        var d = b[c];
                        this.checkInboundVideo(d);
                    }
                }
            }, {
                key: "checkInboundVideo",
                value: function(a) {
                    var b = a.peek(), c = a.getSSRC();
                    if (this.inbVideoTesters.has(c) || this.inbVideoTesters.set(c, new k()), this.inbVideoTesters.get(c).test(b)) {
                        var d = {
                            reason: h.limitationType.cpu,
                            ssrc: c
                        };
                        this.notifyCallback(d);
                    }
                }
            }, {
                key: "toString",
                value: function() {
                    return "CPULimitationObserver";
                }
            } ]), a;
        }();
        c.CPULimitationObserver = l;
    }, {
        "../../config/constants": 32,
        "../../utility/timestamps": 98
    } ],
    61: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.OneWayMediaObserver = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../../config/constants"), h = d(g), i = a("../onewaymediadisruption"), j = a("../../utility/timestamps"), k = d(j), l = function() {
            function a(b) {
                e(this, a), this.notifierCallback = b, this.inbOneWayAudioDisruption = {
                    sent: !1,
                    started: 0,
                    hasTrafficTs: 0
                }, this.outbOneWayAudioDisruption = {
                    sent: !1,
                    started: 0,
                    hasTrafficTs: 0
                };
            }
            return f(a, [ {
                key: "accept",
                value: function(a) {
                    var b = a.filter(function(a) {
                        return a.getMediaType() == h.mediaType.audio && a.getStreamType() === h.streamType.inbound;
                    }), c = a.filter(function(a) {
                        return a.getMediaType() == h.mediaType.audio && a.getStreamType() === h.streamType.outbound;
                    }), d = [ this.getInbOneWayAudioDisruption(b, c), this.getOutbOneWayAudioDisruption(b, c) ], e = d.filter(function(a) {
                        return null !== a;
                    });
                    0 < e.length && this.notifierCallback(e);
                }
            }, {
                key: "toString",
                value: function() {
                    return "DisruptionObserver";
                }
            }, {
                key: "getInbOneWayAudioDisruption",
                value: function(a, b) {
                    var c = this.inbOneWayAudioDisruption;
                    if (c.sent) return null;
                    var d = b.filter(function(a) {
                        return 0 === a.getStartTime();
                    }).length < 1, e = b.filter(function(a) {
                        return !a.hasTraffic();
                    }).length < 1;
                    if (!d || e) return null;
                    var f = a.filter(function(a) {
                        return !a.hasTraffic();
                    }).length < 1;
                    return 0 < a.length && f ? (c.started = 0, null) : 0 === c.started ? (c.started = k.getCurrent(), 
                    null) : k.getCurrent() - 5e3 < c.started ? null : (c.sent = !0, new i.OneWayMediaDisruption(h.oneWayMediaTypes.audio));
                }
            }, {
                key: "getOutbOneWayAudioDisruption",
                value: function(a, b) {
                    var c = this.outbOneWayAudioDisruption;
                    if (c.sent) return null;
                    var d = a.filter(function(a) {
                        return 0 === a.getStartTime();
                    }).length < 1, e = a.filter(function(a) {
                        return !a.hasTraffic();
                    }).length < 1;
                    if (!d || !e) return null;
                    var f = b.filter(function(a) {
                        return !a.hasTraffic();
                    }).length < 1;
                    return 0 < b.length && f ? (c.started = 0, null) : 0 === c.started ? (c.started = k.getCurrent(), 
                    null) : k.getCurrent() - 5e3 < c.started ? null : (c.sent = !0, new i.OneWayMediaDisruption(h.oneWayMediaTypes.audio));
                }
            } ]), a;
        }();
        c.OneWayMediaObserver = l;
    }, {
        "../../config/constants": 32,
        "../../utility/timestamps": 98,
        "../onewaymediadisruption": 65
    } ],
    62: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.QPSumObserver = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../../config/constants"), h = d(g), i = a("../../utility/timestamps"), j = d(i), k = function() {
            function a(b) {
                e(this, a), this.lastQpSum = null, this.qpAvg = null, this.noticed = 0;
            }
            return f(a, [ {
                key: "test",
                value: function(a) {
                    var b = a.getTrack();
                    if (!b || !b.data || !b.data.qpSum) return !1;
                    if (!this.lastQpSum) return this.lastQpSum = b.data.qpSum, !1;
                    var c = b.data.qpSum - this.lastQpSum;
                    if (this.lastQpSum = b.data.qpSum, null === this.qpAvg) this.qpAvg = c; else {
                        this.qpAvg = .2 * c + .8 * this.qpAvg;
                    }
                    var d = Math.max(2 * this.qpAvg, 1);
                    if (c < this.qpAvg + d) return !1;
                    var e = j.getCurrent();
                    return this.noticed < e - 1e4;
                }
            } ]), a;
        }(), l = function() {
            function a(b) {
                e(this, a), this.notifyCallback = b, this.testers = new Map();
            }
            return f(a, [ {
                key: "accept",
                value: function(a) {
                    for (var b = 0; b < a.length; ++b) {
                        var c = a[b];
                        if (c.getMediaType() === h.mediaType.video) {
                            var d = c.getSSRC();
                            this.testers.has(d) || this.testers.set(d, new k(c));
                            if (this.testers.get(d).test(c)) {
                                var e = {
                                    reason: h.qualityDisruptionTypes.qpchange
                                };
                                this.notifyCallback(e);
                            }
                        }
                    }
                }
            }, {
                key: "toString",
                value: function() {
                    return "QPSumObserver";
                }
            } ]), a;
        }();
        c.QPSumObserver = l;
    }, {
        "../../config/constants": 32,
        "../../utility/timestamps": 98
    } ],
    63: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.SendingTrigger = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../../utility/timestamps"), h = d(g), i = a("../validator"), j = d(i), k = 1e3, l = 3e4, m = function() {
            function a(b, c, d) {
                e(this, a), this.last = null, this.actual = 0, this.name = b, this.alpha = c, this.supplier = d;
            }
            return f(a, [ {
                key: "update",
                value: function(a) {
                    if (null === this.last) return void (this.last = a);
                    var b = Math.abs(a - this.last);
                    this.actual = b * this.alpha + this.actual * (1 - this.alpha), this.last = a;
                }
            }, {
                key: "doTest",
                value: function(a) {
                    var b = this.last;
                    return this.update(a), null !== b && b + this.supplier(this.actual) < a;
                }
            } ]), a;
        }(), n = function() {
            function a() {
                e(this, a);
                var b = this;
                this.marginFactor = 1, this.rttTester = new m("RTT Tester", .2, function(a) {
                    return Math.max(50, a) * b.marginFactor;
                }), this.throughputTester = new m("Throughput Tester", .1, function(a) {
                    return Math.max(100, a) * b.marginFactor;
                }), this.FLTester = new m("FL Tester", .1, function(a) {
                    return Math.max(.2, a) * b.marginFactor;
                }), this.lastDecreased = h.getCurrent();
            }
            return f(a, [ {
                key: "test",
                value: function(a) {
                    var b = a.peek();
                    if (!b) return !1;
                    var c = a.getTrack(), d = c.data, e = b.getRTT(), f = j.checkForNan(parseInt(d.csioIntBRKbps, 10)), g = b.getFractionLost();
                    if (this.rttTester.doTest(e) || this.throughputTester.doTest(f) || this.FLTester.doTest(g)) return this.marginFactor = Math.min(2 * this.marginFactor, 15), 
                    !0;
                    var i = h.getCurrent();
                    return 3e3 < i - this.lastChanged && (this.marginFactor = Math.max(this.marginFactor - .5, 1), 
                    this.lastDecreased = i), !1;
                }
            } ]), a;
        }(), o = function() {
            function a(b) {
                e(this, a), this.notifyCallback = b, this.minInterval = k, this.maxInterval = l, 
                this.notified = 0, this.testers = new Map();
            }
            return f(a, [ {
                key: "setup",
                value: function(a, b) {
                    this.minInterval = a, this.maxInterval = b;
                }
            }, {
                key: "accept",
                value: function(a) {
                    var b = h.getCurrent(), c = b - this.notified;
                    if (this.minInterval === this.maxInterval) return void (this.minInterval <= c && (this.notifyCallback(), 
                    this.notified = b));
                    if (!(c < this.minInterval)) {
                        if (c < this.maxInterval) {
                            if (!1 === this.doSend(a)) return;
                        }
                        this.notifyCallback(), this.notified = b;
                    }
                }
            }, {
                key: "setIntervals",
                value: function(a, b) {
                    this.minInterval = a, this.maxInterval = b;
                }
            }, {
                key: "toString",
                value: function() {
                    return "SendingTrigger";
                }
            }, {
                key: "doSend",
                value: function(a) {
                    for (var b = 0; b < a.length; ++b) {
                        var c = a[b], d = c.getSSRC();
                        this.testers.has(d) || this.testers.set(d, new n());
                        if (this.testers.get(d).test(c)) return !0;
                    }
                    return !1;
                }
            } ]), a;
        }();
        c.SendingTrigger = o;
    }, {
        "../../utility/timestamps": 98,
        "../validator": 82
    } ],
    64: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.ThroughputObserver = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../../config/constants"), h = d(g), i = a("../../utility/timestamps"), j = d(i), k = function() {
            function a(b) {
                e(this, a), this.notifierCallback = b, this.observations = new Map();
            }
            return f(a, [ {
                key: "accept",
                value: function(a) {
                    var b = a.filter(function(a) {
                        return a.getMediaType() === h.mediaType.video && a.getStreamType() === h.streamType.outbound;
                    });
                    if (!(b.length < 1)) {
                        var c = this;
                        b.forEach(function(a) {
                            c.observe(a);
                        });
                    }
                }
            }, {
                key: "toString",
                value: function() {
                    return "ThroughputObserver";
                }
            }, {
                key: "getObservations",
                value: function(a) {
                    if (this.observations.has(a)) return this.observations.get(a);
                    var b = {
                        ssrc: 0,
                        started: 0,
                        max: 0,
                        maxTs: 0,
                        stable: 0,
                        stableTs: 0,
                        ready: !1,
                        maxVerified: !1,
                        stableVerified: !1
                    };
                    return this.observations.set(a, b), this.observations.get(a);
                }
            }, {
                key: "observe",
                value: function(a) {
                    var b = a.getSSRC(), c = this.getObservations(b), d = j.getCurrent();
                    if (!0 !== c.ready) {
                        if (0 === c.started) return c.ssrc = b, void (c.started = d);
                        var e = a.getTrack(), f = e.data, g = f.csioIntBRKbps, h = Math.min(50, .05 * g);
                        if (c.max < g ? (c.max = g, c.maxTs = d) : 1e4 < d - c.maxTs && (c.maxVerified = !0), 
                        !(d - c.started < 15e3) && (g - h < f.csioAvgBRKbps && f.csioAvgBRKbps < g + h && (c.stableTs = d, 
                        c.stable = g, c.stableVerified = !0), c.stableVerified && c.maxVerified)) {
                            var i = {
                                ssrc: String(c.ssrc),
                                maxsendingKBitrate: c.max,
                                timeToMaxSendingKBitrate: c.maxTs - c.started,
                                stablesendingKBitrate: c.stable,
                                timeToStableSendingKBitrate: c.stableTs - c.started
                            };
                            this.notifierCallback(i), c.ready = !0;
                        }
                    }
                }
            } ]), a;
        }();
        c.ThroughputObserver = k;
    }, {
        "../../config/constants": 32,
        "../../utility/timestamps": 98
    } ],
    65: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a(b) {
                var c = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : "0";
                d(this, a), this.mediaType = b, this.ssrc = c;
            }
            return e(a, [ {
                key: "getContent",
                value: function() {
                    var a = this;
                    return {
                        mediaType: a.mediaType,
                        ssrc: a.ssrc
                    };
                }
            } ]), a;
        }();
        c.OneWayMediaDisruption = f;
    }, {} ],
    66: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a(b, c, e, f, g, h) {
                d(this, a), this.candidatePair = b, this.codec = c, this.pcHash = e, this.trackStats = f, 
                this.transportStats = g, this.measurements = h;
            }
            return e(a, [ {
                key: "getCandidatePair",
                value: function() {
                    return this.candidatePair;
                }
            }, {
                key: "getCodec",
                value: function() {
                    return this.codec;
                }
            }, {
                key: "getPcHash",
                value: function() {
                    return this.pcHash;
                }
            }, {
                key: "getTrackStats",
                value: function() {
                    return this.trackStats;
                }
            }, {
                key: "getTransportStats",
                value: function() {
                    return this.transportStats;
                }
            }, {
                key: "getMeasurements",
                value: function() {
                    return this.measurements;
                }
            } ]), a;
        }();
        c.PcStats = f;
    }, {} ],
    67: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a(b, c, e) {
                d(this, a), this.width = b, this.height = c, this.frameRate = e;
            }
            return e(a, [ {
                key: "getWidth",
                value: function() {
                    return this.width;
                }
            }, {
                key: "getHeight",
                value: function() {
                    return this.height;
                }
            }, {
                key: "getFrameRate",
                value: function() {
                    return this.frameRate;
                }
            }, {
                key: "toString",
                value: function() {
                    return this.width && this.height && this.frameRate ? this.width.toString() + "X" + this.height.toString() + "X" + this.frameRate.toString() : null;
                }
            } ]), a;
        }();
        c.Resolution = f;
    }, {} ],
    68: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function f(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function g(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.StatsAdapter = c.StatsAdapterIO = void 0;
        var h = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), i = a("../config/constants"), j = d(i), k = a("../collections/component"), l = a("../utility/registry"), m = a("../utility/hash"), n = d(m), o = c.StatsAdapterIO = {
            RawStatsIn: "RawStatsIn",
            RawStatsOut: "RawStatsOut",
            UnprocessedOut: "UnprocessedOut"
        }, p = function(a) {
            function b(a, c) {
                e(this, b);
                var d = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "StatsAdapter"));
                return d.bindPort(o.RawStatsIn, d.receiveRawData, d), d.declarePort(o.RawStatsOut), 
                d.declarePort(o.UnprocessedOut), d.codeBase = a, d.browser = c, d;
            }
            return g(b, a), h(b, [ {
                key: "receiveRawData",
                value: function(a, b) {
                    if (a) {
                        var c = this.extractRawStats(a);
                        if (c) {
                            window && window.csioReactNative && (c = this.removeValues(c)), this.isConnected(o.UnprocessedOut) && this.transmit(o.UnprocessedOut, c);
                            var d = this.processRawStats(c, b);
                            if (d && d.transportStats) for (var e = 0; e < d.transportStats.length; e++) d.transportStats[e].hash = this.getTransportHash(d.transportStats[e]);
                            d && d.transportStats && this.checkTransportStatsUpdates(d.transportStats, b), d && d.trackStats && (d = this.backFillTrackStats(d)), 
                            d && d.transportStats && d.candidatePair && (d = this.backFillCandidatePairStats(d)), 
                            d.pcHash = b, this.transmit(o.RawStatsOut, d);
                        }
                    }
                }
            }, {
                key: "removeValues",
                value: function(a) {
                    for (var b = 0; b < a.length; ++b) {
                        var c = a[b];
                        if (c && c.values) {
                            for (var d = 0; d < c.values.length; ++d) Object.assign(c, c.values[d]);
                            delete c.values;
                        }
                    }
                    return a;
                }
            }, {
                key: "getIceCandidates",
                value: function(a) {
                    if (!a) return null;
                    var b = this.extractRawStats(a);
                    return this.processRawStatsForIceInfo(b);
                }
            }, {
                key: "extractRawStats",
                value: function(a) {
                    var b = [];
                    if (a && a.result) b = a.result(); else if (a && a.forEach) a.forEach(function(a) {
                        b.push(a);
                    }); else for (var c in a) a.hasOwnProperty(c) && b.push(a[c]);
                    return b;
                }
            }, {
                key: "normalizeIceCandidates",
                value: function(a) {
                    for (var b = 0; b < a.length; b += 1) {
                        var c = a[b];
                        c.transport = c.protocol ? c.protocol : "udp", c.ip = c.ip ? c.ip : c.ipAddress, 
                        c.port = c.portNumber ? Number(c.portNumber) : c.port, "ssltcp" === c.transport && (c.transport = "tcp");
                    }
                    return a;
                }
            }, {
                key: "normalizeCanidatePairs",
                value: function(a) {
                    for (var b = 0; b < a.length; b += 1) {
                        var c = a[b];
                        "in-progress" === c.state && (c.state = "inprogress"), c.state || (c.state = "succeeded"), 
                        c.nominated || (c.nominated = "true" === c.googActiveConnection), c.priority || (c.priority = 123);
                    }
                    return a;
                }
            }, {
                key: "processRawStatsForIceInfo",
                value: function(a) {
                    var b = [], c = [], d = [], e = void 0;
                    if (!a) return null;
                    for (var f = 0; f < a.length; ++f) {
                        var g = this.getParsedStats(a[f]), h = this.statsClassifier(g);
                        if (h.candidatePair) d.push(h.candidatePair); else if (h.transportStats) {
                            if ("transport" === h.transportStats.type) {
                                e = h.transportStats.selectedCandidatePairId;
                                continue;
                            }
                            d.push(h.transportStats);
                        } else h.localCandidate ? b.push(h.localCandidate) : h.remoteCandidate && c.push(h.remoteCandidate);
                    }
                    if (e) for (var i = 0; i < d.length; ++i) d[i].id === e && (d[i].googActiveConnection = "true");
                    return {
                        localIceCandidates: this.normalizeIceCandidates(b),
                        remoteIceCandidates: this.normalizeIceCandidates(c),
                        iceCandidatePairs: this.normalizeCanidatePairs(d)
                    };
                }
            }, {
                key: "processRawStats",
                value: function(a, b) {
                    var c = {}, d = {}, e = {};
                    c.tracks = [], c.candidatePair = [], c.transportStats = [], c.trackStats = [], c.codec = [];
                    for (var f = 0; f < a.length; f++) {
                        var g = this.getParsedStats(a[f]), h = this.statsClassifier(g);
                        h.tracks ? c.tracks.push(h.tracks) : h.candidatePair ? c.candidatePair.push(h.candidatePair) : h.transportStats ? this.codeBase !== j.codeBaseType.firefox ? (parseInt(h.transportStats.bytesReceived, 10) > 0 || parseInt(h.transportStats.bytesSent, 10) > 0) && (c.transportStats.push(h.transportStats), 
                        "true" !== h.transportStats.googActiveConnection && !0 !== h.transportStats.googActiveConnection || (c.activeConnectionIndex = h.transportStats.length)) : "true" !== h.transportStats.selected && !0 !== h.transportStats.selected || (c.transportStats.push(h.transportStats), 
                        c.activeConnectionIndex = h.transportStats.length) : h.bwe ? c.bwe = h.bwe : h.trackStats ? c.trackStats.push(h.trackStats) : h.codec ? c.codec.push(h.codec) : h.localCandidate ? d[h.localCandidate.id] = h.localCandidate : h.remoteCandidate && (e[h.remoteCandidate.id] = h.remoteCandidate);
                    }
                    if (c.tracks) {
                        var i = l.Registry.getConferenceManager().getConferenceForPcHash(b), k = void 0;
                        i && (k = i.getPeerConnectionManager().getPcHandlerByHash(b)), c.tracks.forEach(function(a) {
                            var b = k.getSSRCInfo(a.data.ssrc);
                            void 0 !== b && b.localStartTime || k && (k.updateSDP(c.tracks), b = k.getSSRCInfo(a.data.ssrc)), 
                            b && (a.cname = b.cname, a.msid = b.msid, a.associatedVideoTag = b.associatedVideoTag, 
                            a.usageLabel = b.usageLabel);
                        });
                    }
                    return c.transportStats && this.codeBase === j.codeBaseType.firefox && (c.transportStats = this.getAddressInfoFromCandidates(c.transportStats, d, e)), 
                    c;
                }
            }, {
                key: "getParsedStats",
                value: function(a) {
                    var b = {};
                    if (a.timestamp instanceof Date && (b.timestamp = a.timestamp.getTime().toString()), 
                    a.type && (b.type = a.type), a.names) {
                        for (var c = a.names(), d = 0; d < c.length; ++d) b[c[d]] = a.stat(c[d]);
                        a.id && (b.id = a.id);
                    } else Object.assign(b, a);
                    if (b.values) {
                        for (var e = 0; e < b.values.length; ++e) Object.assign(b, b.values[e]);
                        delete b.values;
                    }
                    return b;
                }
            }, {
                key: "statsClassifier",
                value: function(a) {
                    var b = {}, c = function() {
                        for (var b = arguments.length, c = Array(b), d = 0; d < b; d++) c[d] = arguments[d];
                        return -1 !== c.indexOf(a.type);
                    }, d = c("inbound-rtp", "inboundrtp"), e = "true" === a.isRemote || !0 === a.isRemote;
                    return d || c("outbound-rtp", "outboundrtp") ? (b.tracks = {}, b.tracks.data = a, 
                    b.tracks.ssrc = a.ssrc, b.tracks.streamType = d ? "inbound" : "outbound", b.tracks.reportType = "local", 
                    void 0 !== a.isRemote && (b.tracks.reportType = e ? "remote" : "local")) : c("candidatepair") && a.selected ? b.transportStats = a : c("localcandidate", "local-candidate") ? b.localCandidate = a : c("remotecandidate", "remote-candidate") ? b.remoteCandidate = a : c("transport", "googCandidatePair") ? b.transportStats = a : c("VideoBwe") ? b.bwe = a : c("track") ? b.trackStats = a : c("candidate-pair") ? b.candidatePair = a : c("codec") ? b.codec = a : c("ssrc") && (b.tracks = {}, 
                    b.tracks.data = a, b.tracks.ssrc = a.ssrc, b.tracks.reportType = "local", b.tracks.streamType = a.bytesSent ? "outbound" : "inbound"), 
                    b;
                }
            }, {
                key: "getAddressInfoFromCandidates",
                value: function(a, b, c) {
                    for (var d = void 0, e = void 0, f = 0; f < a.length; f++) d = b[a[f].localCandidateId], 
                    e = c[a[f].remoteCandidateId], d && e && (a[f].localAddr = d.ipAddress + ":" + d.portNumber, 
                    a[f].remoteAddr = e.ipAddress + ":" + e.portNumber, a[f].localAddrType = d.candidateType, 
                    a[f].remoteAddrType = e.candidateType, a[f].transportType = d.transport);
                    return a;
                }
            }, {
                key: "getTransportHash",
                value: function(a) {
                    var b = void 0;
                    return a && (this.codeBase === j.codeBaseType.chrome ? a.googLocalAddress ? (b = a.googLocalAddress, 
                    b.concat(":", a.googRemoteAddress)) : a.selectedCandidatePairId && (b = a.selectedCandidatePairId) : this.codeBase === j.codeBaseType.firefox && (b = a.localAddr, 
                    b.concat(":", a.remoteAddr))), n.generateHash(b);
                }
            }, {
                key: "backFillTrackStats",
                value: function(a) {
                    for (var b = a.tracks.length, c = void 0, d = void 0, e = void 0, f = 0; f < b; f++) c = a.tracks[f], 
                    c.data.trackId && (d = this.getStatsForId(a.trackStats, c.data.trackId)) && (a.tracks[f].data = this.mergeObjects(a.tracks[f].data, d)), 
                    c.data.codecId && (e = this.getStatsForId(a.codec, c.data.codecId)) && (a.tracks[f].data = this.mergeObjects(a.tracks[f].data, e));
                    return a;
                }
            }, {
                key: "backFillCandidatePairStats",
                value: function(a) {
                    for (var b = a.transportStats.length, c = void 0, d = void 0, e = 0; e < b; e++) d = a.transportStats[e], 
                    d.selectedCandidatePairId && (c = this.getStatsForId(a.candidatePair, d.selectedCandidatePairId)) && (a.transportStats[e] = this.mergeObjects(a.transportStats[e], c));
                    return a;
                }
            }, {
                key: "mergeObjects",
                value: function(a, b) {
                    for (var c in b) b.hasOwnProperty(c) && "id" !== c && "type" !== c && (a[c] = b[c]);
                    return a;
                }
            }, {
                key: "getStatsForId",
                value: function(a, b) {
                    if (a) {
                        var c = a.filter(function(a) {
                            return a.id === b;
                        });
                        if (c.length > 0) return c[0];
                    }
                }
            }, {
                key: "formatRelayType",
                value: function(a) {
                    var b = "None";
                    switch (a) {
                      case 0:
                        b = "TURN/TLS";
                        break;

                      case 1:
                        b = "TURN/TCP";
                        break;

                      case 2:
                        b = "TURN/UDP";
                    }
                    return b;
                }
            }, {
                key: "getRelayType",
                value: function(a, b) {
                    var c = this, d = void 0, e = function(b) {
                        if (b.typePreference) {
                            var e = b.typePreference >> 24;
                            return "rtp" === b.protocol && b.address === a && (e >= 0 && e <= 2 && (d = c.formatTypePreference(e)), 
                            !0);
                        }
                        return !1;
                    };
                    return b.getIceCandidates().some(e), d;
                }
            }, {
                key: "getTransportInfo",
                value: function(a, b) {
                    for (var c = {}, d = !1, e = 0; e < a.length; e++) {
                        var f = a[e];
                        if (navigator.mozGetUserMedia && "candidatepair" === f.type && ("true" === f.selected || !0 === f.selected)) {
                            c.foundActive = !0, c.localAddr = f.localAddr, c.remoteAddr = f.remoteAddr, c.localAddrType = f.localAddrType, 
                            c.remoteAddrType = f.remoteAddrType, c.transportType = f.transportType, c.localCandidateId = f.localCandidateId, 
                            c.remoteCandidateId = f.remoteCandidateId;
                            break;
                        }
                        if ("googCandidatePair" === f.type && ("true" === f.googActiveConnection || !0 === f.googActiveConnection)) {
                            c.foundActive = !0, c.localAddr = f.googLocalAddress, c.remoteAddr = f.googRemoteAddress, 
                            c.localAddrType = f.googLocalCandidateType, c.remoteAddrType = f.googRemoteCandidateType, 
                            c.transportType = f.googTransportType;
                            break;
                        }
                        if ("transport" === f.type) {
                            d = !0, f.selectedCandidatePairId && (c.selectedCandidatePairId = f.selectedCandidatePairId);
                            break;
                        }
                    }
                    return d && c.localAddr && (c.ipv6 = 0 === c.localAddr.indexOf("["), c.relayType = getRelayType(c.localAddr, b)), 
                    c;
                }
            }, {
                key: "sendFabricTransportSwitch",
                value: function(a, b) {
                    a.sendFabricTransportSwitch(b);
                }
            }, {
                key: "checkTransportStatsUpdates",
                value: function(a, b) {
                    var c = l.Registry.getConferenceManager().getConferenceForPcHash(b);
                    if (c) {
                        var d = c.getPeerConnectionManager().getPcHandlerByHash(b);
                        if (d) {
                            var e = this.getTransportInfo(a, d), f = d.getTransportInfo();
                            f && (f.localAddr === e.localAddr && f.remoteAddr === e.remoteAddr && f.transportType === e.transportType && f.selectedCandidatePairId === e.selectedCandidatePairId && f.localCandidateId === e.localCandidateId && f.remoteCandidateId === e.remoteCandidateId || (d.setTransportInfo(e), 
                            this.sendFabricTransportSwitch(d, e.relayType)));
                        }
                    }
                }
            } ]), b;
        }(k.Component);
        c.StatsAdapter = p;
    }, {
        "../collections/component": 25,
        "../config/constants": 32,
        "../utility/hash": 91,
        "../utility/registry": 94
    } ],
    69: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function e(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function f(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.StatsAssembler = c.StatsAssemblerIO = void 0;
        var g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = a("../collections/component"), i = c.StatsAssemblerIO = {
            StatsTupleIn: "StatsTupleIn",
            CallstatsOut: "CallstatsOut"
        }, j = function(a) {
            function b() {
                d(this, b);
                var a = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "StatsAssembler"));
                return a.pcHashes = [], a.bindPort(i.StatsTupleIn, a.receiveStats, a), a.declarePort(i.CallstatsOut), 
                a;
            }
            return f(b, a), g(b, [ {
                key: "receiveStats",
                value: function(a) {
                    for (var b = this, c = 0; c < a.tracks.length; c++) {
                        (function(c) {
                            var d = a.tracks[c];
                            if (b.pcHashes.find(function(a) {
                                return a === d.pcHash;
                            })) return "continue";
                            b.pcHashes.push(d.pcHash);
                        })(c);
                    }
                    for (var d = a.getTransportStats(), c = 0; c < this.pcHashes.length; c++) {
                        var e = this.pcHashes[c], f = {};
                        f.codec = a.getCodec(), f.trackStats = a.getTrackStats(), f.tracks = [];
                        for (var g = 0; g < a.tracks.length; g++) {
                            var h = a.tracks[g];
                            h.pcHash === e && f.tracks.push(h);
                        }
                        var j = d.get(e);
                        1 == j.length ? f.Transport = j[0] : f.Transport = j, this.transmit(i.CallstatsOut, e, f);
                    }
                }
            } ]), b;
        }(h.Component);
        c.StatsAssembler = j;
    }, {
        "../collections/component": 25
    } ],
    70: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.StatsCallbackBuilder = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("../utility/registry"), g = function() {
            function a() {
                d(this, a), this.callback = null;
            }
            return e(a, [ {
                key: "setCallback",
                value: function(a) {
                    this.callback = a;
                }
            }, {
                key: "buildStats",
                value: function(a, b) {
                    this.callback && this.buildFromUnifiedFormat(a, b);
                }
            }, {
                key: "getConnectionState",
                value: function() {
                    return !0 === navigator.onLine ? "online" : "offline";
                }
            }, {
                key: "buildConferenceUrl",
                value: function(a) {
                    var b = a.getConferenceId(), c = f.Registry.getConferenceManager().get(b);
                    return c ? c.getUrl() : null;
                }
            }, {
                key: "buildFromUnifiedFormat",
                value: function(a, b) {
                    var c = {};
                    c.connectionState = this.getConnectionState(), c.conferenceURL = this.buildConferenceUrl(b), 
                    c.fabricState = b.getPcState(), c.streams = {};
                    for (var d = 0; d < a.length; d++) {
                        var e = a[d];
                        if ("inbound-rtp" === e.type || "outbound-rtp" === e.type) {
                            var f = {
                                ssrc: e.ssrc,
                                statsType: e.type,
                                fractionLoss: e.csioIntFL,
                                bitrate: e.csioIntBRKbps,
                                quality: e.csioMark,
                                mediaType: e.csioMediaType,
                                jitter: e.jitter,
                                audioOutputLevel: e.audioOutputLevel,
                                audioIntputLevel: e.audioIntputLevel,
                                audioLevel: e.audioLevel,
                                averageRTT: e.csioAvgRtt,
                                averageJitter: e.csioAvgJitter,
                                packetLossPercentage: e.csioPktLossPercentage,
                                rtt: e.roundTripTime,
                                remoteUserID: b.getRemoteId()
                            }, g = b.getSSRCInfo(e.ssrc + "");
                            g && (f.cname = g.cname, f.msid = g.msid, f.usageLabel = g.usageLabel, f.associatedVideoTag = g.associatedVideoTag), 
                            e.hasOwnProperty("googRtt") && (f.rtt = e.googRtt), e.hasOwnProperty("mozRtt") && (f.rtt = e.mozRtt), 
                            e.hasOwnProperty("googJitterReceived") && (f.jitter = e.googJitterReceived), c.streams[e.ssrc] = f;
                        }
                    }
                    this.callback(c);
                }
            } ]), a;
        }();
        c.StatsCallbackBuilder = g;
    }, {
        "../utility/registry": 94
    } ],
    71: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function f(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function g(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.StatsMonitor = c.StatsMonitorIO = void 0;
        var h = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), i = a("../collections/component"), j = a("./tracksmonitor"), k = a("./transportsmonitor"), l = a("./statstuple"), m = a("../utility/registry"), n = a("./monitorhooks/sendingtrigger"), o = a("./monitorhooks/onewaymediaobserver"), p = a("./monitorhooks/throughputobserver"), q = a("./monitorhooks/cpulimitationobserver"), r = a("./monitorhooks/qpsumobserver"), s = a("../config/constants"), t = d(s), u = a("../utility/csiologger"), v = d(u), w = c.StatsMonitorIO = {
            PcStatsTupleIn: "PcStatsTupleIn",
            StatsTupleOut: "StatsTupleOut"
        }, x = function(a) {
            function b(a) {
                e(this, b);
                var c = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "StatsMonitor"));
                return c.bindPort(w.PcStatsTupleIn, c.receive, c), c.declarePort(w.StatsTupleOut), 
                c.lastPcStats = null, c.lastPcHash = null, c.tracksmonitor = new j.TracksMonitor(), 
                c.transportsmonitor = new k.TransportsMonitor(a), c.candidatepairs = new Map(), 
                c.monitorhooks = [], c.sendingTrigger = new n.SendingTrigger(c.sendStatsTuple.bind(c)), 
                c.oneWayMediaObserver = new o.OneWayMediaObserver(c.sendDisruptions.bind(c)), c.throughputObserver = new p.ThroughputObserver(c.sendThroughputObservations.bind(c)), 
                c.cpuLimitationObserver = new q.CPULimitationObserver(c.sendCPULimitationObservations.bind(c)), 
                c.qpSumObserver = new r.QPSumObserver(c.sendQPSumDistortions.bind(c)), c.setupHooks(), 
                c;
            }
            return g(b, a), h(b, [ {
                key: "setupHooks",
                value: function() {
                    this.monitorhooks.push(this.sendingTrigger.accept.bind(this.sendingTrigger)), this.monitorhooks.push(this.oneWayMediaObserver.accept.bind(this.oneWayMediaObserver)), 
                    this.monitorhooks.push(this.throughputObserver.accept.bind(this.throughputObserver)), 
                    this.monitorhooks.push(this.cpuLimitationObserver.accept.bind(this.cpuLimitationObserver)), 
                    this.monitorhooks.push(this.qpSumObserver.accept.bind(this.qpSumObserver));
                }
            }, {
                key: "setIntervals",
                value: function(a, b) {
                    this.sendingTrigger.setup(a, b);
                }
            }, {
                key: "receive",
                value: function(a) {
                    var b = a.getPcHash(), c = a.getMeasurements();
                    this.candidatepairs.set(b, a.getCandidatePair()), this.transportsmonitor.set(b, a.getTransportStats());
                    for (var d = 0; d < c.length; d++) {
                        var e = c[d], f = this.tracksmonitor.getMonitor(e);
                        f ? f.add(e) : v.warn("No monitor for ssrc " + e.getSSRC());
                    }
                    this.lastPcStats = a, this.lastPcHash = b;
                    for (var g = this.tracksmonitor.getMonitors(), h = this.monitorhooks, i = 0; i < h.length; i++) {
                        (0, h[i])(g);
                    }
                }
            }, {
                key: "getCandidatePairs",
                value: function() {
                    var a = [];
                    return this.candidatepairs.forEach(function(b, c) {
                        var d = [ c, b ];
                        a.push(d);
                    }), a;
                }
            }, {
                key: "sendStatsTuple",
                value: function() {
                    var a = new l.StatsTuple(this.getCandidatePairs(), this.lastPcStats.getCodec(), this.lastPcStats.getTrackStats(), this.transportsmonitor.getIntervalStats(), this.tracksmonitor.extractTracks());
                    this.transmit(w.StatsTupleOut, a);
                }
            }, {
                key: "sendDisruptions",
                value: function(a) {
                    var b = this;
                    a.forEach(function(a) {
                        b.sendEventMsg(t.internalFabricEvent.oneWayMedia, a.getContent());
                    });
                }
            }, {
                key: "sendCPULimitationObservations",
                value: function(a) {}
            }, {
                key: "sendQPSumDistortions",
                value: function(a) {}
            }, {
                key: "sendThroughputObservations",
                value: function(a) {
                    this.sendEventMsg(t.internalFabricEvent.sendingThroughputObservations, a);
                }
            }, {
                key: "sendEventMsg",
                value: function(a, b) {
                    if (this.lastPcHash) {
                        var c = m.Registry.getConferenceManager().getConferenceForPcHash(this.lastPcHash);
                        if (c) {
                            var d = c.getPeerConnectionManager().getPcHandlerByHash(this.lastPcHash), e = d.getPeerConnection(), f = d.getConferenceId();
                            m.Registry.getEventMessageBuilder().make(a, f, e, b);
                        }
                    }
                }
            } ]), b;
        }(i.Component);
        c.StatsMonitor = x;
    }, {
        "../collections/component": 25,
        "../config/constants": 32,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "./monitorhooks/cpulimitationobserver": 60,
        "./monitorhooks/onewaymediaobserver": 61,
        "./monitorhooks/qpsumobserver": 62,
        "./monitorhooks/sendingtrigger": 63,
        "./monitorhooks/throughputobserver": 64,
        "./statstuple": 74,
        "./tracksmonitor": 80,
        "./transportsmonitor": 81
    } ],
    72: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function f(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function g(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.StatsParser = c.StatsParserIO = void 0;
        var h = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), i = a("../collections/component"), j = a("./measurement"), k = a("./pcstats"), l = a("../utility/rttregistry"), m = a("./validator"), n = d(m), o = a("../config/constants"), p = d(o), q = a("../utility/csiologger"), r = d(q), s = c.StatsParserIO = {
            RawStatsIn: "RawStatsIn",
            PcStatsTupleOut: "PcStatsTupleOut"
        }, t = function(a) {
            function b() {
                e(this, b);
                var a = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "StatsParser"));
                return a.bindPort(s.RawStatsIn, a.receive, a), a.declarePort(s.PcStatsTupleOut), 
                a;
            }
            return g(b, a), h(b, [ {
                key: "receive",
                value: function(a) {
                    if (null === a) return void r.warn("Stats object can not be null");
                    for (var b = a.tracks, c = [], d = 0; d < b.length; ++d) {
                        var e = b[d];
                        if (e && e.data) {
                            var f = j.Measurement.make(a.pcHash, this.getSSRC(e), this.getStreamType(e), this.getMediaType(e), this.getFrameRateReceived(e), this.getFrameHeight(e), this.getFrameWidth(e), this.getDroppedFramesNum(e), this.getRTT(e), this.getJitter(e), this.getLostPackets(e), this.getReceivedPackets(e), this.getSentPackets(e), this.getDiscardedPackets(e), this.getSentBytes(e), this.getReceivedBytes(e), e);
                            c.push(f);
                        } else r.log("No track or track.data.");
                    }
                    var g = new k.PcStats(a.candidatePair, a.codec, a.pcHash, a.trackStats, a.transportStats, c);
                    this.transmit(s.PcStatsTupleOut, g);
                }
            }, {
                key: "getSSRC",
                value: function(a) {
                    return a.ssrc;
                }
            }, {
                key: "getStreamType",
                value: function(a) {
                    return a.streamType === p.streamType.inbound ? p.streamType.inbound : a.streamType === p.streamType.outbound ? p.streamType.outbound : void 0;
                }
            }, {
                key: "getSentBytes",
                value: function(a) {
                    if (void 0 === a.data.bytesSent) return -1;
                    var b = n.checkForNan(parseInt(a.data.bytesSent, 10));
                    return null !== b ? b : -1;
                }
            }, {
                key: "getReceivedBytes",
                value: function(a) {
                    if (void 0 === a.data.bytesReceived) return -1;
                    var b = n.checkForNan(parseInt(a.data.bytesReceived, 10));
                    return null !== b ? b : -1;
                }
            }, {
                key: "getReceivedPackets",
                value: function(a) {
                    if (void 0 === a.data.packetsReceived) return -1;
                    var b = n.checkForNegativeValue(parseInt(a.data.packetsReceived, 10));
                    return null !== b ? b : -1;
                }
            }, {
                key: "getSentPackets",
                value: function(a) {
                    if (void 0 === a.data.packetsSent) return -1;
                    var b = n.checkForNegativeValue(parseInt(a.data.packetsSent, 10));
                    return null !== b ? b : -1;
                }
            }, {
                key: "getDiscardedPackets",
                value: function(a) {
                    if (void 0 === a.data.discardedPackets) return -1;
                    var b = n.checkForNan(parseInt(a.data.discardedPackets, 10));
                    return null !== b ? b : -1;
                }
            }, {
                key: "getLostPackets",
                value: function(a) {
                    if (void 0 === a.data.packetsLost) return -1;
                    var b = n.checkForNegativeValue(parseInt(a.data.packetsLost, 10));
                    return null !== b ? b : -1;
                }
            }, {
                key: "getDroppedFramesNum",
                value: function(a) {
                    if (void 0 === a.data.droppedFrames) return -1;
                    var b = n.checkForNegativeValue(parseInt(a.data.droppedFrames, 10));
                    return null !== b ? b : -1;
                }
            }, {
                key: "getFrameRateReceived",
                value: function(a) {
                    var b = null;
                    return void 0 !== a.data.googFrameRateOutput ? b = parseInt(a.data.googFrameRateOutput, 10) : void 0 !== a.data.googFrameRateDecoded ? b = parseInt(a.data.googFrameRateDecoded, 10) : void 0 !== a.data.googFrameRateReceived ? b = parseInt(a.data.googFrameRateReceived, 10) : void 0 !== a.data.googFrameRateSent ? b = parseInt(a.data.googFrameRateSent, 10) : void 0 !== a.data.framerateMean && (b = parseInt(a.data.framerateMean, 10)), 
                    void 0 !== b && (b = n.checkForNegativeValue(b)), b;
                }
            }, {
                key: "getFrameHeight",
                value: function(a) {
                    var b = void 0;
                    return void 0 !== a.data.googFrameHeightReceived ? b = a.data.googFrameHeightReceived : void 0 !== a.data.googFrameHeightSent ? b = a.data.googFrameHeightSent : void 0 !== a.data.frameHeight && (b = a.data.frameHeight), 
                    b;
                }
            }, {
                key: "getJitter",
                value: function(a) {
                    return void 0 !== a.data.googJitterReceived ? n.checkForNan(parseInt(a.data.googJitterReceived, 10)) : void 0 !== a.data.jitter ? n.checkForNan(parseInt(a.data.jitter, 10)) : void 0;
                }
            }, {
                key: "getFrameWidth",
                value: function(a) {
                    return void 0 !== a.data.googFrameWidthReceived ? a.data.googFrameWidthReceived : void 0 !== a.data.googFrameWidthSent ? a.data.googFrameWidthSent : void 0 !== a.data.frameWidth ? a.data.frameWidth : void 0;
                }
            }, {
                key: "getRTT",
                value: function(a) {
                    var b = function(a) {
                        return isNaN(a) || a < 0 ? null : a;
                    };
                    if (void 0 !== a.data.googRtt) return b(parseInt(a.data.googRtt, 10));
                    if (void 0 !== a.data.mozRtt) return b(parseInt(a.data.mozRtt, 10));
                    if (a.data.roundTripTime) return b(parseInt(a.data.roundTripTime, 10));
                    var c = this.getSSRC(a), d = (0, l.getRTTRegistry)().getRTT(c);
                    return d && (a.data.roundTripTime = d), d;
                }
            }, {
                key: "getMediaType",
                value: function(a) {
                    var b = p.mediaType.unknown;
                    return a.data && void 0 !== a.data.mediaType ? a.data.mediaType : (void 0 !== a.data.googFrameRateReceived || void 0 !== a.data.googFrameRateSent ? b = p.mediaType.video : void 0 !== a.data.audioInputLevel || void 0 !== a.data.audioOutputLevel ? b = p.mediaType.audio : a.data.mediaType ? b = a.data.mediaType : void 0 !== a.data.framerateMean && (b = p.mediaType.video), 
                    b);
                }
            } ]), b;
        }(i.Component);
        c.StatsParser = t;
    }, {
        "../collections/component": 25,
        "../config/constants": 32,
        "../utility/csiologger": 87,
        "../utility/rttregistry": 95,
        "./measurement": 59,
        "./pcstats": 66,
        "./validator": 82
    } ],
    73: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function f(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function g(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.StatsTransmitter = c.StatsTransmitterIO = void 0;
        var h = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), i = a("../collections/component"), j = a("../utility/registry"), k = a("../config/constants"), l = d(k), m = a("../utility/csiologger"), n = d(m), o = c.StatsTransmitterIO = {
            CallstatsIn: "CallstatsIn",
            UnprocessedIn: "UnprocessedIn"
        }, p = function(a) {
            function b() {
                e(this, b);
                var a = f(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, "StatsTransmitter"));
                return a.pcHashes = [], a.battery = j.Registry.getBattery(), a.lastUnprocessed = null, 
                a.bindPort(o.CallstatsIn, a.receiveCallstats, a), a.bindPort(o.UnprocessedIn, a.receiveUnprocessed, a), 
                a;
            }
            return g(b, a), h(b, [ {
                key: "receiveUnprocessed",
                value: function(a) {
                    this.lastUnprocessed = a;
                }
            }, {
                key: "receiveCallstats",
                value: function(a, b) {
                    var c = null;
                    if (!(c = this.getUnifiedFormat(b))) return void n.warn("Content can not be sent");
                    this.send(a, c);
                }
            }, {
                key: "send",
                value: function(a, b) {
                    var c = j.Registry.getConferenceManager().getConferenceForPcHash(a);
                    if (c) {
                        var d = c.getPeerConnectionManager().getPcHandlerByHash(a);
                        if (d) {
                            j.Registry.getEventMessageBuilder().make(l.callstatsChannels.processedStats, d.getConferenceId(), d.getPeerConnection(), b), 
                            this.sendToStatsCallback(b.stats, d);
                        }
                    }
                }
            }, {
                key: "sendToStatsCallback",
                value: function(a, b) {
                    var c = j.Registry.getStatsCallbackBuilder();
                    c && c.buildStats(a, b);
                }
            }, {
                key: "getUnifiedFormat",
                value: function(a) {
                    for (var b = this.lastUnprocessed, c = [], d = 0; d < b.length; d++) {
                        var e = b[d], f = {};
                        e.id && (f.id = e.id), e.timestamp && (f.timestamp = e.timestamp), e.type && (f.type = e.type), 
                        Object.assign(f, e);
                        var g = function(b) {
                            for (var c = 0; c < a.tracks.length; c++) {
                                var d = a.tracks[c];
                                if (d.data.id === b.id && d.data.type === b.type) return d.data;
                            }
                            return b.id === a.Transport.id && b.type === a.Transport.type ? a.Transport : null;
                        }(e);
                        if (g) {
                            for (var h in g) if (g.hasOwnProperty(h)) {
                                if ("id" === h || "type" === h || "timestamp" === h) continue;
                                f[h] = g[h];
                            }
                            c.push(f);
                        } else c.push(f);
                    }
                    var i = {
                        stats: c
                    };
                    return i.wifiStats = j.Registry.getWifiStatsExecutor().getWifiStats(), i.batteryStatus = {}, 
                    i.batteryStatus.batteryLevel = this.battery.getLevel(), i.batteryStatus.isBatteryCharging = this.battery.getCharging(), 
                    i;
                }
            } ]), b;
        }(i.Component);
        c.StatsTransmitter = p;
    }, {
        "../collections/component": 25,
        "../config/constants": 32,
        "../utility/csiologger": 87,
        "../utility/registry": 94
    } ],
    74: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a(b, c, e, f, g) {
                d(this, a), this.candidatePairs = b, this.codec = c, this.trackStats = e, this.transportStats = f, 
                this.tracks = g;
            }
            return e(a, [ {
                key: "getCandidatePairs",
                value: function() {
                    return this.candidatePairs;
                }
            }, {
                key: "getCodec",
                value: function() {
                    return this.codec;
                }
            }, {
                key: "getTrackStats",
                value: function() {
                    return this.trackStats;
                }
            }, {
                key: "getTransportStats",
                value: function() {
                    return this.transportStats;
                }
            }, {
                key: "getTracks",
                value: function() {
                    return this.tracks;
                }
            } ]), a;
        }();
        c.StatsTuple = f;
    }, {} ],
    75: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function e(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function f(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.SWAvg = void 0;
        var g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = a("./swplugin"), i = function(a) {
            function b(a, c) {
                var f = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null;
                d(this, b);
                var g = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, a, c, f));
                return g.sum = 0, g.counter = 0, g;
            }
            return f(b, a), g(b, [ {
                key: "add",
                value: function(a) {
                    this.filter(a) && (this.sum += this.extract(a), ++this.counter, this.calculate());
                }
            }, {
                key: "remove",
                value: function(a) {
                    this.filter(a) && (this.sum -= this.extract(a), --this.counter, this.calculate());
                }
            }, {
                key: "calculate",
                value: function() {
                    var a = 0;
                    if (this.counter < 1) return void this.notify(a);
                    a = this.sum / this.counter, this.notify(a);
                }
            } ]), b;
        }(h.SWPlugin);
        c.SWAvg = i;
    }, {
        "./swplugin": 78
    } ],
    76: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function e(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function f(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.SWBTreePercentile = void 0;
        var g = function() {
            function a(a, b) {
                var c = [], d = !0, e = !1, f = void 0;
                try {
                    for (var g, h = a[Symbol.iterator](); !(d = (g = h.next()).done) && (c.push(g.value), 
                    !b || c.length !== b); d = !0) ;
                } catch (a) {
                    e = !0, f = a;
                } finally {
                    try {
                        !d && h.return && h.return();
                    } finally {
                        if (e) throw f;
                    }
                }
                return c;
            }
            return function(b, c) {
                if (Array.isArray(b)) return b;
                if (Symbol.iterator in Object(b)) return a(b, c);
                throw new TypeError("Invalid attempt to destructure non-iterable instance");
            };
        }(), h = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), i = a("./swplugin"), j = a("../../collections/binarytree"), k = function(a) {
            function b(a, c, f, g) {
                var h = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : null, i = arguments.length > 5 && void 0 !== arguments[5] ? arguments[5] : null, k = arguments.length > 6 && void 0 !== arguments[6] ? arguments[6] : null;
                d(this, b);
                var l = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, f, g, i));
                if (99 < a || a < 1) throw new RangeError("Percentile parameter must be between 1 and 99");
                return l.comparator = c, l.percentile = a, l.meanCalcer = k, l.estimator = h, l.ratio = a / (100 - a), 
                l.maxtree = new j.BinaryTree(c), l.mintree = new j.BinaryTree(c), l.ratio < 1 ? l.required = 1 / l.ratio + 1 : 1 < l.ratio ? l.required = l.ratio + 1 : l.required = 2, 
                l.result = null, l;
            }
            return f(b, a), h(b, [ {
                key: "add",
                value: function(a) {
                    if (this.filter(a)) {
                        if (this.maxtree.getNodeCounter() < 1) return this.maxtree.insert(a), void this.calculate();
                        this.comparator(a, this.maxtree.getTopValue()) <= 0 ? this.maxtree.insert(a) : this.mintree.insert(a), 
                        this.balancing(), this.calculate();
                    }
                }
            }, {
                key: "remove",
                value: function(a) {
                    if (this.filter(a)) {
                        var b = this.mintree.getNodeCounter();
                        this.maxtree.getNodeCounter() < 1 ? this.mintree.delete(a) : b < 1 ? this.maxtree.delete(a) : this.comparator(a, this.maxtree.getTopValue()) <= 0 ? this.maxtree.delete(a) : this.mintree.delete(a), 
                        this.calculate();
                    }
                }
            }, {
                key: "getThresholds",
                value: function() {
                    var a = this.mintree.getSize(), b = this.maxtree.getSize(), c = a + 1, d = b + 1;
                    return 1 < this.ratio ? (c = Math.ceil(a * this.ratio), d = Math.floor(b / this.ratio) + 1) : this.ratio < 1 && (c = Math.floor(a * this.ratio) + 1, 
                    d = Math.ceil(b / this.ratio)), [ c, d ];
                }
            }, {
                key: "balancing",
                value: function() {
                    var a = this.mintree, b = this.maxtree, c = a.getSize(), d = b.getSize();
                    if (!(d + c < this.required)) {
                        if (c < 1) return void a.insertNodeAtBottom(b.popTopNode());
                        for (d < 1 && b.insertNodeAtTop(a.popBottomNode()); ;) {
                            var e = 1 < a.getNodeCounter(), f = 1 < b.getNodeCounter(), h = a.getBottomNode().getLength(), i = b.getTopNode().getLength();
                            if (a.getNodeCounter() < 1 || b.getNodeCounter() < 1) break;
                            var j = this.getThresholds(), k = g(j, 2), l = k[0], m = k[1];
                            if (f &= c + i <= m, e &= d + h <= l, c = a.getSize(), d = b.getSize(), l < d && f) a.insertNodeAtBottom(b.popTopNode()); else {
                                if (!(m < c && e)) break;
                                b.insertNodeAtTop(a.popBottomNode());
                            }
                        }
                    }
                }
            }, {
                key: "getMean",
                value: function(a, b) {
                    return this.meanCalcer ? this.meanCalcer(a, b) : a;
                }
            }, {
                key: "estimate",
                value: function(a, b) {
                    return this.estimator ? this.estimator(a, b) : null;
                }
            }, {
                key: "calculate",
                value: function() {
                    var a = null, b = this.mintree, c = this.maxtree, d = b.getSize(), e = c.getSize(), f = e + d;
                    if (!(f < 1)) {
                        if (f < this.required || d < 1 || e < 1) {
                            if (0 == f) return;
                            var g = void 0, h = void 0;
                            d < 1 ? (g = this.maxtree.getBottomValue(), h = this.maxtree.getTopValue()) : e < 1 ? (g = this.mintree.getBottomValue(), 
                            h = this.mintree.getTopValue()) : (h = this.mintree.getTopValue(), g = this.maxtree.getBottomValue());
                            var i = this.estimate(g, h);
                            return void this.notify(i);
                        }
                        var j = c.getTopNode(), k = b.getBottomNode();
                        if (j || k) {
                            if (!j) {
                                var l = this.extract(k);
                                return void this.notify(l);
                            }
                            if (!k) {
                                var m = this.extract(j);
                                return void this.notify(m);
                            }
                            var n = f * (this.percentile / 100);
                            if (!Number.isInteger(n)) {
                                var o = e / d;
                                a = this.ratio < o ? j.peek() : o < this.ratio ? k.peek() : this.ratio < 1 ? k.peek() : j.peek();
                            } else {
                                var p = Math.floor(n);
                                a = Math.ceil(n + 1) <= e ? j.peek() : p <= e ? this.getMean(j.peek(), k.peek()) : k.peek();
                            }
                            var q = this.extract(a);
                            this.notify(q);
                        }
                    }
                }
            } ]), b;
        }(i.SWPlugin);
        c.SWBTreePercentile = k;
    }, {
        "../../collections/binarytree": 22,
        "./swplugin": 78
    } ],
    77: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function e(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function f(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.SWFunctor = void 0;
        var g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = a("./swplugin"), i = function(a) {
            function b(a, c) {
                var f = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null;
                d(this, b);
                var g = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, null, null, f));
                return g.addFunc = a, g.remFunc = c, g;
            }
            return f(b, a), g(b, [ {
                key: "add",
                value: function(a) {
                    this.filter(a) && this.addFunc && this.addFunc(a);
                }
            }, {
                key: "remove",
                value: function(a) {
                    this.filter(a) && this.remFunc && this.remFunc(a);
                }
            }, {
                key: "toString",
                value: function() {
                    return "SWFuncPlugin";
                }
            } ]), b;
        }(h.SWPlugin);
        c.SWFunctor = i;
    }, {
        "./swplugin": 78
    } ],
    78: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.SWPlugin = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("../../utility/csiologger"), g = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(f), h = function() {
            function a(b, c) {
                var e = arguments.length > 2 && void 0 !== arguments[2] ? arguments[2] : null;
                d(this, a), this.extractorFnc = b, this.notifierFnc = c, this.filterFunc = e;
            }
            return e(a, [ {
                key: "notify",
                value: function(a) {
                    if (!this.notifierFnc) return void g.warn("Failed notification for " + this.toString());
                    this.notifierFnc(a);
                }
            }, {
                key: "extract",
                value: function(a) {
                    return this.extractorFnc ? this.extractorFnc(a) : (g.warn(this.toString() + " tried to extract without extractorFnc"), 
                    null);
                }
            }, {
                key: "filter",
                value: function(a) {
                    return !this.filterFunc || this.filterFunc(a);
                }
            }, {
                key: "add",
                value: function(a) {
                    g.log("Abstract method is called width value: " + a);
                }
            }, {
                key: "remove",
                value: function(a) {
                    g.log("Abstract method is called with value: " + a);
                }
            }, {
                key: "toString",
                value: function() {
                    return "SWPlugin";
                }
            } ]), a;
        }();
        c.SWPlugin = h;
    }, {
        "../../utility/csiologger": 87
    } ],
    79: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!a) throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
            return !b || "object" != typeof b && "function" != typeof b ? a : b;
        }
        function f(a, b) {
            if ("function" != typeof b && null !== b) throw new TypeError("Super expression must either be null or a function, not " + typeof b);
            a.prototype = Object.create(b && b.prototype, {
                constructor: {
                    value: a,
                    enumerable: !1,
                    writable: !0,
                    configurable: !0
                }
            }), b && (Object.setPrototypeOf ? Object.setPrototypeOf(a, b) : a.__proto__ = b);
        }
        function g(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function h(a, b) {
            return b.green <= a ? t.avQualityRatings.excellent : b.red < a ? t.avQualityRatings.fair : t.avQualityRatings.bad;
        }
        function i(a, b) {
            return b.red < a ? t.avQualityRatings.bad : b.green <= a ? t.avQualityRatings.fair : t.avQualityRatings.excellent;
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.TrackMonitor = void 0;
        var j = function a(b, c, d) {
            null === b && (b = Function.prototype);
            var e = Object.getOwnPropertyDescriptor(b, c);
            if (void 0 === e) {
                var f = Object.getPrototypeOf(b);
                return null === f ? void 0 : a(f, c, d);
            }
            if ("value" in e) return e.value;
            var g = e.get;
            if (void 0 !== g) return g.call(d);
        }, k = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), l = a("../utility/registry"), m = a("../collections/slidingwindow"), n = a("../statspipeline/swplugins/swavg"), o = a("../statspipeline/swplugins/swbtreepercentile"), p = a("../statspipeline/swplugins/swfunctor"), q = a("../utility/timestamps"), r = d(q), s = a("../config/constants"), t = d(s), u = a("../utility/csiologger"), v = d(u), w = function() {
            function a() {
                g(this, a), this.evaluators = [];
            }
            return k(a, [ {
                key: "addEvaluator",
                value: function(a) {
                    var b = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 1, c = {
                        processFnc: a,
                        weight: b
                    };
                    this.evaluators.push(c);
                }
            }, {
                key: "getQuality",
                value: function(a) {
                    for (var b = 0, c = [], d = 0, e = 0; e < this.evaluators.length; e++) {
                        var f = this.evaluators[e], g = 0, h = f.processFnc ? f.processFnc(a) : 0;
                        if (h) {
                            if (h === t.avQualityRatings.bad) g = t.qualityRating.bad; else if (h === t.avQualityRatings.fair) g = t.qualityRating.fair; else if (h === t.avQualityRatings.excellent) g = t.qualityRating.excellent; else if (h === t.avQualityRatings.unknown) continue;
                            b += f.weight, c.push({
                                result: g,
                                weight: f.weight
                            });
                        }
                    }
                    for (var i = 0; i < c.length; i++) {
                        var j = c[i];
                        d += j.result * (j.weight / b);
                    }
                    return d = Math.floor(d), d === t.qualityRating.excellent ? t.avQualityRatings.excellent : d === t.qualityRating.good ? t.avQualityRatings.fair : d === t.qualityRating.fair ? t.avQualityRatings.fair : d === t.qualityRating.poor ? t.avQualityRatings.fair : d === t.qualityRating.bad ? t.avQualityRatings.bad : void 0;
                }
            } ]), a;
        }(), x = function(a) {
            function b(a, c, d, f) {
                g(this, b);
                var h = e(this, (b.__proto__ || Object.getPrototypeOf(b)).call(this, a, c));
                return h.thresholds = [], h.enableThresholds = !1, h.requestTime = 0, h.started = 0, 
                h.created = r.getCurrent(), h.mediaType = f, h.streamType = d, h.qualityHelper = new w(), 
                h.metrics = h.makeTrack(), h.lastTrack = {}, h.prevFrameRateMean = null, h.ssrc = null, 
                h.scsHelper = {
                    total: 0,
                    above: 0,
                    ccDriven: 0,
                    sumMaxBitrateDiff: 0,
                    sumThroughputDiff: 0,
                    prevCsioAvgBRKbps: 0
                }, h;
            }
            return f(b, a), k(b, null, [ {
                key: "make",
                value: function(a, c, d, e) {
                    var f = new b(a, c, d, e), g = f.metrics;
                    return f.attach(new n.SWAvg(function(a) {
                        return a.getJitter();
                    }, function(a) {
                        g.csioAvgJitter = a;
                    }, function(a) {
                        var b = a.getJitter();
                        return null !== b && void 0 !== b;
                    })), f.attach(new n.SWAvg(function(a) {
                        return a.getRTT();
                    }, function(a) {
                        g.csioAvgRtt = a;
                    }, function(a) {
                        var b = a.getRTT();
                        return null !== b && void 0 !== b;
                    })), f.attach(new o.SWBTreePercentile(95, function(a, b) {
                        var c = a.getJitter(), d = b.getJitter();
                        return c == d ? 0 : c < d ? -1 : 1;
                    }, function(a) {
                        return a.getJitter();
                    }, function(a) {
                        g.csioPercentileJitter = a;
                    }, function(a, b) {
                        return b ? b.getJitter() : a ? a.getJitter() : void 0;
                    }, function(a) {
                        var b = a.getJitter();
                        return null !== b && void 0 !== b;
                    }, function(a, b) {
                        return a;
                    })), f.attach(new o.SWBTreePercentile(95, function(a, b) {
                        var c = a.getRTT(), d = b.getRTT();
                        return c == d ? 0 : c < d ? -1 : 1;
                    }, function(a) {
                        return a.getRTT();
                    }, function(a) {
                        g.csioSig2Latency = a, g.csioeM = a + 40;
                    }, function(a, b) {
                        return b ? b.getRTT() : a ? a.getRTT() : void 0;
                    }, function(a) {
                        var b = a.getRTT();
                        return null !== b && void 0 !== b;
                    }, function(a, b) {
                        return a;
                    })), d === t.streamType.inbound ? b.setupInboundMonitor(f) : d === t.streamType.outbound ? b.setupOutboundMonitor(f) : v.warn("Unrecognized streamType (" + d + ") at TrackMonitor"), 
                    e === t.mediaType.audio ? b.setupAudioMonitor(f) : e === t.mediaType.video ? b.setupVideoMonitor(f) : v.warn("Unrecognized mediaType (" + e + ") at TrackMonitor"), 
                    d === t.streamType.inbound && e === t.mediaType.audio ? b.setupInbAudioQualityEvaluator(f) : d === t.streamType.inbound && e === t.mediaType.video ? b.setupInbVideoQualityEvaluator(f) : d === t.streamType.outbound && e === t.mediaType.audio ? b.setupOutbAudioQualityEvaluator(f) : d === t.streamType.outbound && e === t.mediaType.video && (b.setupOutbVideoQualityEvaluator(f), 
                    b.setupSCSValidator(f)), f.addPostProcess(function(a) {
                        g.csioMark = f.getQuality(a);
                    }), f;
                }
            }, {
                key: "setupInbAudioQualityEvaluator",
                value: function(a) {
                    var b = a.metrics;
                    a.addQualityEvaluator(function(a) {
                        return void 0 === b.csioIntBRKbps || null === b.csioIntBRKbps || b.csioIntBRKbps < 0 ? t.avQualityRatings.unknown : h(b.csioIntBRKbps, t.throughputThreshold.audio);
                    }), a.addQualityEvaluator(function(a) {
                        return void 0 === b.csioIntFL || null === b.csioIntFL || b.csioIntFL < 0 ? t.avQualityRatings.unknown : i(b.csioIntFL, t.fractionalLossThreshold.audio);
                    }), a.addQualityEvaluator(function(a) {
                        return void 0 === b.csioeM || null === b.csioeM ? t.avQualityRatings.unknown : i(b.csioeM, t.eModelThreshold.audio);
                    });
                }
            }, {
                key: "setupOutbAudioQualityEvaluator",
                value: function(a) {
                    var b = a.metrics;
                    a.addQualityEvaluator(function(a) {
                        return void 0 === b.csioIntBRKbps || null === b.csioIntBRKbps || b.csioIntBRKbps < 0 ? t.avQualityRatings.unknown : h(b.csioIntBRKbps, t.throughputThreshold.audio);
                    }), a.addQualityEvaluator(function(a) {
                        return void 0 === b.csioeM || null === b.csioeM ? t.avQualityRatings.unknown : i(b.csioeM, t.eModelThreshold.audio);
                    });
                }
            }, {
                key: "setupInbVideoQualityEvaluator",
                value: function(a) {
                    var b = a.metrics;
                    a.addQualityEvaluator(function(a) {
                        return void 0 === b.csioIntBRKbps || null === b.csioIntBRKbps || b.csioIntBRKbps < 0 ? t.avQualityRatings.unknown : h(b.csioIntBRKbps, t.throughputThreshold.video);
                    }), a.addQualityEvaluator(function(c) {
                        return void 0 === b.csioFrameRateMean || null === b.csioFrameRateMean ? t.avQualityRatings.unknown : b.csioFrameRateMean && a.prevFrameRateMean ? h(b.csioFrameRateMean / a.prevFrameRateMean, t.currOverPrevFrameRateThreshold.video) : t.avQualityRatings.bad;
                    }), a.addQualityEvaluator(function(a) {
                        return void 0 === b.csioSig2Latency || null === b.csioSig2Latency ? t.avQualityRatings.unknown : i(b.csioSig2Latency, t.rttThreshold.video);
                    });
                }
            }, {
                key: "setupOutbVideoQualityEvaluator",
                value: function(a) {
                    var b = a.metrics;
                    a.addQualityEvaluator(function(a) {
                        return void 0 == b.csioIntBRKbps || null == b.csioIntBRKbps ? t.avQualityRatings.unknown : h(b.csioIntBRKbps, t.throughputThreshold.video);
                    }), a.addQualityEvaluator(function(c) {
                        return void 0 === b.csioFrameRateMean || null === b.csioFrameRateMean ? t.avQualityRatings.unknown : b.csioFrameRateMean && a.prevFrameRateMean ? h(b.csioFrameRateMean / a.prevFrameRateMean, t.currOverPrevFrameRateThreshold.video) : t.avQualityRatings.bad;
                    }), a.addQualityEvaluator(function(a) {
                        return void 0 === b.csioSig2Latency || null === b.csioSig2Latency ? t.avQualityRatings.unknown : i(b.csioSig2Latency, t.rttThreshold.video);
                    });
                }
            }, {
                key: "setupInboundMonitor",
                value: function(a) {
                    var b = a.metrics;
                    a.addPreProcess(function(c) {
                        var d = c.getLostPackets(), e = c.getReceivedPackets(), f = a.getRequestedMeasurement(), g = 0, h = 0;
                        f ? (g = d - f.getLostPackets(), h = e - f.getReceivedPackets()) : (g = d, h = e);
                        var i = 0;
                        (0 < g || 0 < h) && (i = g / (h + g)), b.csioIntPktLoss = g, b.csioIntFL = i, c.setFractionLost(i);
                    }), a.attach(new p.SWFunctor(function(c) {
                        var d = r.getCurrent(), e = c.getResolution(), f = a.getRequestedMeasurement(), g = a.getRequestTime(), h = c.getLostPackets(), i = 8 * c.getReceivedBytes(), j = c.getReceivedPackets(), k = d - a.getStartTime(), m = 0, n = 0, o = 0, p = 0, q = 1e3, s = Math.max(d - a.getStartTime(), q);
                        f ? (p = j - f.getReceivedPackets(), m = i - 8 * f.getReceivedBytes(), n = h - f.getLostPackets(), 
                        o = Math.max(d - g, q)) : (q = (l.Registry.getCredentials().getAdaptiveInterval(), 
                        l.Registry.getCredentials().getStatsSubmissionInterval()), s = Math.max(d - a.getStartTime(), q), 
                        p = j, m = i, n = h, o = Math.max(s, q)), b.csioIntPktRcv = p, b.csioIntPR = p / (o / 1e3), 
                        b.csioAvgBRKbps = i / s, b.csioIntBRKbps = m / o, b.csioAvgPacketSize = c.getReceivedBytes() / j, 
                        b.csioIntMs = k, b.csioTimeElapseMs = o, b.csiores = e, b.csioPktLostPercentage = n / m * 100;
                    }, null, null)), a.attach(new o.SWBTreePercentile(95, function(a, b) {
                        var c = a.getFractionLost(), d = b.getFractionLost();
                        return c == d ? 0 : c < d ? -1 : 1;
                    }, function(a) {
                        return a.getFractionLost();
                    }, function(a) {
                        b.csioPercentileFl = a;
                    }, function(a, b) {
                        return b ? b.getFractionLost() : a ? a.getFractionLost() : void 0;
                    }, function(a) {
                        var b = a.getFractionLost();
                        return null !== b && void 0 !== b;
                    }, function(a, b) {
                        return a;
                    }));
                }
            }, {
                key: "setupOutboundMonitor",
                value: function(a) {
                    var b = a.metrics;
                    a.addPreProcess(function(c) {
                        var d = c.getLostPackets(), e = c.getSentPackets(), f = a.getRequestedMeasurement(), g = 0, h = 0;
                        f ? (g = d - f.getLostPackets(), h = e - f.getSentPackets()) : (g = d, h = e);
                        var i = 0;
                        (0 < g || 0 < h) && (i = g / (h + g)), b.csioIntPktLoss = g, b.csioIntFL = i, c.setFractionLost(i);
                    }), a.attach(new p.SWFunctor(function(c) {
                        var d = r.getCurrent(), e = c.getResolution(), f = a.getRequestedMeasurement(), g = a.getRequestTime(), h = c.getLostPackets(), i = 8 * c.getSentBytes(), j = c.getSentPackets(), k = d - a.getStartTime(), m = 0, n = 0, o = 0, p = 0, q = 1e3, s = Math.max(d - a.getStartTime(), q);
                        f ? (p = j - f.getSentPackets(), m = i - 8 * f.getSentBytes(), n = h - f.getLostPackets(), 
                        o = Math.max(d - g, q)) : (q = (l.Registry.getCredentials().getAdaptiveInterval(), 
                        l.Registry.getCredentials().getStatsSubmissionInterval()), s = Math.max(d - a.getStartTime(), q), 
                        p = j, m = i, n = h, o = Math.max(s, q)), b.csioIntPktRcv = p, b.csioAvgBRKbps = i / s, 
                        b.csioIntBRKbps = m / o, b.csioIntPR = p / (o / 1e3), b.csioAvgPacketSize = c.getSentBytes() / j, 
                        b.csioIntMs = k, b.csioTimeElapseMs = o, b.csiores = e, b.csioPktLostPercentage = n / m * 100;
                    }, null, null)), a.attach(new o.SWBTreePercentile(95, function(a, b) {
                        var c = a.getFractionLost(), d = b.getFractionLost();
                        return c == d ? 0 : c < d ? -1 : 1;
                    }, function(a) {
                        return a.getFractionLost();
                    }, function(a) {
                        b.csioPercentileFl = a;
                    }, function(a, b) {
                        return b ? b.getFractionLost() : a ? a.getFractionLost() : void 0;
                    }, function(a) {
                        var b = a.getFractionLost();
                        return null !== b && void 0 !== b;
                    }, function(a, b) {
                        return a;
                    }));
                }
            }, {
                key: "setupAudioMonitor",
                value: function(a) {
                    var b = a.metrics;
                    a.attach(new p.SWFunctor(function(a) {
                        b.csioMediaType = t.mediaType.audio;
                    }, null, null));
                }
            }, {
                key: "setupVideoMonitor",
                value: function(a) {
                    var b = a.metrics;
                    a.attach(new n.SWAvg(function(a) {
                        return a.getFrameRateReceived();
                    }, function(c) {
                        a.prevFrameRateMean = b.csioFrameRateMean, b.csioFrameRateMean = c;
                    }, function(a) {
                        var b = a.getFrameRateReceived();
                        return null !== b && void 0 !== b;
                    })), a.attach(new n.SWAvg(function(a) {
                        return a.getFrameHeight();
                    }, function(a) {
                        b.csioFrameHeightMean = a;
                    }, function(a) {
                        var b = a.getFrameHeight();
                        return null !== b && void 0 !== b;
                    })), a.attach(new n.SWAvg(function(a) {
                        return a.getFrameWidth();
                    }, function(a) {
                        b.csioFrameWidthMean = a;
                    }, function(a) {
                        var b = a.getFrameWidth();
                        return null !== b && void 0 !== b;
                    })), a.attach(new o.SWBTreePercentile(95, function(a, b) {
                        var c = a.getFrameRateReceived(), d = b.getFrameRateReceived();
                        return c == d ? 0 : c < d ? -1 : 1;
                    }, function(a) {
                        return a.getFrameRateReceived();
                    }, function(a) {
                        b.csioFrameRate95Percentile = a;
                    }, function(a, b) {
                        return b ? b.getFrameRateReceived() : a ? a.getFrameRateReceived() : void 0;
                    }, function(a) {
                        var b = a.getFrameRateReceived();
                        return null !== b && void 0 !== b;
                    }, function(a, b) {
                        return a;
                    })), a.attach(new o.SWBTreePercentile(50, function(a, b) {
                        var c = a.getFrameRateReceived(), d = b.getFrameRateReceived();
                        return c == d ? 0 : c < d ? -1 : 1;
                    }, function(a) {
                        return a.getFrameRateReceived();
                    }, function(a) {
                        b.csioFrameRate50Percentile = a;
                    }, function(a, b) {
                        return b ? b.getFrameRateReceived() : a ? a.getFrameRateReceived() : void 0;
                    }, function(a) {
                        var b = a.getFrameRateReceived();
                        return null !== b && void 0 !== b;
                    }, function(a, b) {
                        return a;
                    })), a.attach(new o.SWBTreePercentile(95, function(a, b) {
                        var c = a.getFrameHeight(), d = b.getFrameHeight();
                        return c == d ? 0 : c < d ? -1 : 1;
                    }, function(a) {
                        return a.getFrameHeight();
                    }, function(a) {
                        b.csioFrameHeight95Percentile = a;
                    }, function(a, b) {
                        return b ? b.getFrameHeight() : a ? a.getFrameHeight() : void 0;
                    }, function(a) {
                        var b = a.getFrameHeight();
                        return null !== b && void 0 !== b;
                    }, function(a, b) {
                        return a;
                    })), a.attach(new o.SWBTreePercentile(50, function(a, b) {
                        var c = a.getFrameHeight(), d = b.getFrameHeight();
                        return c == d ? 0 : c < d ? -1 : 1;
                    }, function(a) {
                        return a.getFrameHeight();
                    }, function(a) {
                        b.csioFrameHeight50Percentile = a;
                    }, function(a, b) {
                        return b ? b.getFrameHeight() : a ? a.getFrameHeight() : void 0;
                    }, function(a) {
                        var b = a.getFrameHeight();
                        return null !== b && void 0 !== b;
                    }, function(a, b) {
                        return a;
                    })), a.attach(new o.SWBTreePercentile(95, function(a, b) {
                        var c = a.getFrameWidth(), d = b.getFrameWidth();
                        return c == d ? 0 : c < d ? -1 : 1;
                    }, function(a) {
                        return a.getFrameWidth();
                    }, function(a) {
                        b.csioFrameWidth95Percentile = a;
                    }, function(a, b) {
                        return b ? b.getFrameWidth() : a ? a.getFrameWidth() : void 0;
                    }, function(a) {
                        var b = a.getFrameWidth();
                        return null !== b && void 0 !== b;
                    }, function(a, b) {
                        return a;
                    })), a.attach(new o.SWBTreePercentile(50, function(a, b) {
                        var c = a.getFrameWidth(), d = b.getFrameWidth();
                        return c == d ? 0 : c < d ? -1 : 1;
                    }, function(a) {
                        return a.getFrameWidth();
                    }, function(a) {
                        b.csioFrameWidth50Percentile = a;
                    }, function(a, b) {
                        return b ? b.getFrameWidth() : a ? a.getFrameWidth() : void 0;
                    }, function(a) {
                        var b = a.getFrameWidth();
                        return null !== b && void 0 !== b;
                    }, function(a, b) {
                        return a;
                    })), a.attach(new p.SWFunctor(function(a) {
                        b.csioMediaType = t.mediaType.video;
                    }, null, null));
                }
            }, {
                key: "setupSCSValidator",
                value: function(a) {
                    var b = a.metrics;
                    a.attach(new p.SWFunctor(function(c) {
                        var d = l.Registry.getConfigServiceWrapper().getSenderConfig();
                        if (!d || !d.rtc_rtp_parameters || !d.rtc_rtp_parameters.encodings) return b.csioSCSValidationSampleCount = null, 
                        b.csioAvgMaxBitrateDiff = null, b.csioAvgDeltaThroughput = null, b.csioMaxBitrateAboveRatio = null, 
                        void (b.csioCCDrivenRatio = null);
                        var e = 0;
                        d.rtc_rtp_parameters.encodings.forEach(function(a) {
                            a && (e = Math.max(e, a.maxBitrate));
                        });
                        var f = 0, g = l.Registry.getConfigServiceWrapper().getDefaultSenderConfig();
                        if (g && g.encodings) {
                            g.encodings.forEach(function(a) {
                                f = Math.max(f, a.maxBitrate);
                            });
                            var h = 0, i = 0, j = null, k = null, m = a.getSCSHelper();
                            0 < f && .9 * f < 1e3 * b.csioAvgBRKbps ? (h = e - f, k = !1) : (h = e - 1e3 * b.csioAvgBRKbps, 
                            k = !0), j = 0 < h, i = b.csioAvgBRKbps - b.prevCsioAvgBRKbps, m.prevCsioAvgBRKbps = b.csioAvgBRKbps, 
                            b.csioSCSValidationSampleCount = ++m.total, m.sumMaxBitrateDiff += h, b.csioAvgMaxBitrateDiff = m.sumMaxBitrateDiff / m.total, 
                            m.sumThroughputDiff += i, b.csioAvgDeltaThroughput = m.sumThroughputDiff / m.total, 
                            j && (m.above += 1), b.csioMaxBitrateAboveRatio = m.above / m.total, k && (m.ccDriven += 1), 
                            b.csioCCDrivenRatio = m.ccDriven / m.total;
                        }
                    }, null, null));
                }
            } ]), k(b, [ {
                key: "makeTrack",
                value: function() {
                    var a = {};
                    return a.csioMediaType = void 0, a.csioMark = void 0, a.csioIntBRKbps = void 0, 
                    a.csioAvgBRKbps = void 0, a.csioIntFL = void 0, a.csioIntMs = void 0, a.csioIntPR = void 0, 
                    a.csioPercentileFl = void 0, a.csioAvgJitter = void 0, a.csioAvgRtt = void 0, a.csioPercentileJitter = void 0, 
                    a.csioSig2Latency = void 0, a.csioTimeElapseMs = void 0, a.csioeM = void 0, a.csiores = void 0, 
                    a.csioFrameWidth95Percentile = void 0, a.csioFrameWidth50Percentile = void 0, a.csioFrameHeight95Percentile = void 0, 
                    a.csioFrameHeight50Percentile = void 0, a.csioFrameRate95Percentile = void 0, a.csioFrameRate50Percentile = void 0, 
                    a.csioFrameWidthMean = void 0, a.csioFrameHeightMean = void 0, a.csioFrameRateMean = void 0, 
                    a.csioIntPktRcv = void 0, a.csioSCSValidationSampleCount = null, a.csioAvgMaxBitrateDiff = null, 
                    a.csioAvgDeltaThroughput = null, a.csioMaxBitrateAboveRatio = null, a.csioCCDrivenRatio = null, 
                    a;
                }
            }, {
                key: "getSSRC",
                value: function() {
                    return this.ssrc;
                }
            }, {
                key: "add",
                value: function(a) {
                    this.ssrc = a.getSSRC(), this.lastTrack = a.extractTrack(), this.lastTrack.pcHash = a.getPcHash(), 
                    0 === this.started && (this.started = r.getCurrent()), j(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "add", this).call(this, a);
                }
            }, {
                key: "hasTraffic",
                value: function() {
                    return 0 < this.metrics.csioIntBRKbps;
                }
            }, {
                key: "getTrack",
                value: function() {
                    var a = this.lastTrack;
                    return Object.assign(a.data, this.metrics), a;
                }
            }, {
                key: "extractTrack",
                value: function() {
                    var a = this.lastTrack;
                    return Object.assign(a.data, this.metrics), this.requestTime = r.getCurrent(), this.requestedMeasurement = this.peek(), 
                    a;
                }
            }, {
                key: "getMediaType",
                value: function() {
                    return this.mediaType;
                }
            }, {
                key: "getStreamType",
                value: function() {
                    return this.streamType;
                }
            }, {
                key: "getStartTime",
                value: function() {
                    return this.started;
                }
            }, {
                key: "getCreationTime",
                value: function() {
                    return this.created;
                }
            }, {
                key: "getRequestTime",
                value: function() {
                    return Math.max(this.started, this.requestTime);
                }
            }, {
                key: "getRequestedMeasurement",
                value: function() {
                    return this.requestedMeasurement;
                }
            }, {
                key: "getSCSHelper",
                value: function() {
                    return this.scsHelper;
                }
            }, {
                key: "addQualityEvaluator",
                value: function(a) {
                    var b = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : 1;
                    this.qualityHelper.addEvaluator(a, b);
                }
            }, {
                key: "getQuality",
                value: function(a) {
                    return this.qualityHelper.getQuality(a);
                }
            }, {
                key: "addPreProcess",
                value: function(a) {
                    j(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "addPreProcess", this).call(this, a);
                }
            }, {
                key: "addPostProcess",
                value: function(a) {
                    j(b.prototype.__proto__ || Object.getPrototypeOf(b.prototype), "addPostProcess", this).call(this, a);
                }
            } ]), b;
        }(m.SlidingWindow);
        c.TrackMonitor = x;
    }, {
        "../collections/slidingwindow": 27,
        "../config/constants": 32,
        "../statspipeline/swplugins/swavg": 75,
        "../statspipeline/swplugins/swbtreepercentile": 76,
        "../statspipeline/swplugins/swfunctor": 77,
        "../utility/csiologger": 87,
        "../utility/registry": 94,
        "../utility/timestamps": 98
    } ],
    80: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.TracksMonitor = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./trackmonitor"), g = a("../config/constants"), h = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(g), i = function() {
            function a() {
                d(this, a), this.inbMonitors = new Map(), this.outbMonitors = new Map();
            }
            return e(a, [ {
                key: "getMonitor",
                value: function(a) {
                    var b = a.getStreamType(), c = a.getMediaType(), d = a.getSSRC(), e = null;
                    return b === h.streamType.inbound ? c === h.mediaType.audio ? e = this.getInbAudioMonitor(d) : c === h.mediaType.video && (e = this.getInbVideoMonitor(d)) : b === h.streamType.outbound && (c === h.mediaType.audio ? e = this.getOutbAudioMonitor(d) : c === h.mediaType.video && (e = this.getOutbVideoMonitor(d))), 
                    e;
                }
            }, {
                key: "extractTracks",
                value: function() {
                    var a = [];
                    return this.outbMonitors.forEach(function(b, c) {
                        a.push(b.extractTrack());
                    }), this.inbMonitors.forEach(function(b, c) {
                        a.push(b.extractTrack());
                    }), a;
                }
            }, {
                key: "getTracks",
                value: function() {
                    var a = [];
                    return this.outbMonitors.forEach(function(b, c) {
                        a.push(b.getTrack());
                    }), this.inbMonitors.forEach(function(b, c) {
                        a.push(b.getTrack());
                    }), a;
                }
            }, {
                key: "getMonitors",
                value: function() {
                    var a = [];
                    return this.outbMonitors.forEach(function(b, c) {
                        a.push(b);
                    }), this.inbMonitors.forEach(function(b, c) {
                        a.push(b);
                    }), a;
                }
            }, {
                key: "getInbAudioMonitor",
                value: function(a) {
                    var b = this.inbMonitors.get(a);
                    return b || (b = f.TrackMonitor.make(1e3, 3e4, h.streamType.inbound, h.mediaType.audio), 
                    this.inbMonitors.set(a, b)), b;
                }
            }, {
                key: "getInbVideoMonitor",
                value: function(a) {
                    var b = this.inbMonitors.get(a);
                    return b || (b = f.TrackMonitor.make(1e3, 3e4, h.streamType.inbound, h.mediaType.video), 
                    this.inbMonitors.set(a, b)), b;
                }
            }, {
                key: "getOutbAudioMonitor",
                value: function(a) {
                    var b = this.outbMonitors.get(a);
                    return b || (b = f.TrackMonitor.make(1e3, 3e4, h.streamType.outbound, h.mediaType.audio), 
                    this.outbMonitors.set(a, b)), b;
                }
            }, {
                key: "getOutbVideoMonitor",
                value: function(a) {
                    var b = this.outbMonitors.get(a);
                    return b || (b = f.TrackMonitor.make(1e3, 3e4, h.streamType.outbound, h.mediaType.video), 
                    this.outbMonitors.set(a, b)), b;
                }
            } ]), a;
        }();
        c.TracksMonitor = i;
    }, {
        "../config/constants": 32,
        "./trackmonitor": 79
    } ],
    81: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.TransportsMonitor = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../config/constants"), h = d(g), i = a("../utility/timestamps"), j = d(i), k = a("../utility/rttregistry"), l = function() {
            function a(b) {
                e(this, a), this.previous = b, this.actual = b, this.outdated = j.getCurrent();
            }
            return f(a, [ {
                key: "setActual",
                value: function(a) {
                    this.actual = a;
                }
            }, {
                key: "outdate",
                value: function() {
                    this.previous = this.actual, this.outdated = j.getCurrent();
                }
            }, {
                key: "getActual",
                value: function() {
                    return this.actual;
                }
            }, {
                key: "getPrevious",
                value: function() {
                    return this.previous;
                }
            }, {
                key: "getElapsedTime",
                value: function() {
                    return j.getCurrent() - this.outdated;
                }
            } ]), a;
        }(), m = function() {
            function a(b) {
                e(this, a), this.stats = new Map(), this.codeBase = b;
            }
            return f(a, [ {
                key: "set",
                value: function(a, b) {
                    var c = this.stats.get(a);
                    if (!c) return void this.stats.set(a, new l(b));
                    c.setActual(b);
                }
            }, {
                key: "getIntervalStats",
                value: function() {
                    var a = this, b = new Map();
                    return this.stats.forEach(function(c, d) {
                        b.set(d, a.getIntervalStat(c)), c.outdate();
                    }), b;
                }
            }, {
                key: "getIntervalStat",
                value: function(a) {
                    var b = null;
                    switch (this.codeBase) {
                      case h.codeBaseType.chrome:
                        b = this.getIntervalStatForChrome(a);
                        break;

                      default:
                        b = a.getActual();
                    }
                    return b;
                }
            }, {
                key: "getIntervalStatForChrome",
                value: function(a) {
                    var b = a.getActual(), c = a.getPrevious(), d = a.getElapsedTime();
                    if (!c) return actual;
                    for (var e = 0; e < b.length; ++e) {
                        var f = b[e], g = c[e];
                        if (!g || !f) return b;
                        var i = parseInt(g.bytesReceived, 10), j = parseInt(g.bytesSent, 10);
                        f.csioReceivedBwKbps = 8 * (parseInt(f.bytesReceived, 10) - i) / d, f.csioSentBwKbps = 8 * (parseInt(f.bytesSent, 10) - j) / d, 
                        f.csioIntBytesReceived = parseInt(f.bytesReceived, 10) - i, f.csioIntBytesSent = parseInt(f.bytesSent, 10) - j, 
                        void 0 !== g.packetsSent && void 0 !== f.packetsSent && (f.csioSentPacketRate = (parseInt(f.packetsSent, 10) - parseInt(g.packetsSent, 10)) / (d / 1e3), 
                        f.csioIntPacketsSent = parseInt(f.packetsSent, 10) - parseInt(g.packetsSent, 10)), 
                        void 0 !== g.packetsReceived && void 0 !== f.packetsReceived && (f.csioReceivedPacketRate = (parseInt(f.packetsReceived, 10) - parseInt(g.packetsReceived, 10)) / (d / 1e3), 
                        f.csioIntPacketsReceived = parseInt(f.packetsReceived, 10) - parseInt(g.packetsReceived, 10)), 
                        this.codeBase == h.codeBaseType.chrome && (f.currentRoundTripTime = (0, k.getRTTRegistry)().getTransportRTT());
                    }
                    return b;
                }
            } ]), a;
        }();
        c.TransportsMonitor = m;
    }, {
        "../config/constants": 32,
        "../utility/rttregistry": 95,
        "../utility/timestamps": 98
    } ],
    82: [ function(a, b, c) {
        "use strict";
        function d(a) {
            return isNaN(a) ? null : a;
        }
        function e(a) {
            return null !== d(a) && 0 < a ? a : null;
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.checkForNan = d, c.checkForNegativeValue = e;
    }, {} ],
    83: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a() {
                d(this, a), this.getWifiStatsMethod = null, this.wifiStats = null, this.interval = 1e4;
            }
            return e(a, [ {
                key: "setGetWifiStatsMethod",
                value: function(a) {
                    this.getWifiStatsMethod = a, this.wifiStatsHandler();
                }
            }, {
                key: "getWifiStats",
                value: function() {
                    return this.wifiStats;
                }
            }, {
                key: "wifiStatsHandler",
                value: function() {
                    var a = this;
                    a.getWifiStatsMethod && a.getWifiStatsMethod().then(function(b) {
                        a.wifiStats = JSON.parse(b), setTimeout(function() {
                            a.wifiStatsHandler();
                        }, a.interval);
                    }).catch(function() {
                        setTimeout(function() {
                            a.wifiStatsHandler();
                        }, a.interval);
                    });
                }
            } ]), a;
        }();
        c.WifiStatsExecutor = f;
    }, {} ],
    84: [ function(a, b, c) {
        "use strict";
        function d(a) {
            return window.btoa(a);
        }
        function e(a) {
            return window.atob(a);
        }
        function f(a) {
            return d(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g, function(a, b) {
                return String.fromCharCode("0x" + b);
            }));
        }
        function g(a) {
            return d(a).replace(/\+/g, "-").replace(/\//g, "_").replace(/\=+$/, "");
        }
        function h(a) {
            return f(a).replace(/\+/g, "-").replace(/\//g, "_").replace(/\=+$/, "");
        }
        function i(a) {
            for (var b = e(a.replace(/[ \r\n]+$/, "")), c = [], d = 0; d < b.length; ++d) {
                var f = b.charCodeAt(d).toString(16);
                1 === f.length && (f = "0" + f), c.push(f);
            }
            return c.join("");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.encode = d, c.decode = e, c.urlencode = g, c.urlencodeUnicode = h, c.strtohex = i;
    }, {} ],
    85: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.Callbacks = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../config/constants"), h = d(g), i = a("./registry"), j = a("./csiologger"), k = d(j), l = function() {
            function a() {
                e(this, a), this.callbacks = {};
            }
            return f(a, [ {
                key: "set",
                value: function(a, b) {
                    if ("function" == typeof b) return h.callbackFunctions.hasOwnProperty(a) ? (this.callbacks[a] = b, 
                    void (a === h.callbackFunctions.stats && i.Registry.getStatsCallbackBuilder().setCallback(b))) : void k.error("Couldn't set callback: " + a);
                }
            }, {
                key: "get",
                value: function(a) {
                    return this.callbacks.hasOwnProperty(a) ? this.callbacks[a] : null;
                }
            } ]), a;
        }();
        c.Callbacks = l;
    }, {
        "../config/constants": 32,
        "./csiologger": 87,
        "./registry": 94
    } ],
    86: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.Credentials = void 0;
        var f = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {
            return typeof a;
        } : function(a) {
            return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;
        }, g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = a("../config/constants"), i = d(h), j = a("./csiologger"), k = d(j), l = function() {
            function a() {
                e(this, a), this.appId = null, this.userId = null, this.userIdObject = null, this.deviceId = null, 
                this.statsSubmissionInterval = 15e3, this.collectSDP = !1, this.transportType = i.transportType.rest, 
                this.adaptiveInterval = !1;
            }
            return g(a, [ {
                key: "getAppId",
                value: function() {
                    return this.appId;
                }
            }, {
                key: "setAppId",
                value: function(a) {
                    this.appId = "string" == typeof a ? parseInt(a, 10) : a;
                }
            }, {
                key: "getUserId",
                value: function() {
                    return this.userId;
                }
            }, {
                key: "setUserId",
                value: function(a) {
                    "object" === (void 0 === a ? "undefined" : f(a)) ? (this.userId = a.aliasName, this.setUserIdObject(a)) : this.userId = a;
                }
            }, {
                key: "getUserIdObject",
                value: function() {
                    return this.userIdObject;
                }
            }, {
                key: "setUserIdObject",
                value: function(a) {
                    this.userIdObject = a;
                }
            }, {
                key: "getStatsSubmissionInterval",
                value: function() {
                    return this.statsSubmissionInterval;
                }
            }, {
                key: "setStatsSubmissionInterval",
                value: function(a) {
                    k.log("setStatsSubmissionInterval is ", a), this.statsSubmissionInterval = a;
                }
            }, {
                key: "getCollectSDP",
                value: function() {
                    return this.collectSDP;
                }
            }, {
                key: "setCollectSDP",
                value: function(a) {
                    this.collectSDP = a;
                }
            }, {
                key: "getTransportType",
                value: function() {
                    return this.transportType;
                }
            }, {
                key: "setTransportType",
                value: function(a) {
                    this.transportType = a;
                }
            }, {
                key: "getAdaptiveInterval",
                value: function() {
                    return this.adaptiveInterval;
                }
            }, {
                key: "setAdaptiveInterval",
                value: function(a) {
                    this.adaptiveInterval = a;
                }
            } ]), a;
        }();
        c.Credentials = l;
    }, {
        "../config/constants": 32,
        "./csiologger": 87
    } ],
    87: [ function(a, b, c) {
        "use strict";
        function d() {
            if ("true" === i.csioDebug) {
                var a;
                (a = console).info.apply(a, arguments);
            }
        }
        function e() {
            if ("true" === i.csioDebug) {
                var a;
                (a = console).log.apply(a, arguments);
            }
        }
        function f() {
            if ("true" === i.csioDebug) {
                var a;
                (a = console).warn.apply(a, arguments);
            }
        }
        function g() {
            var a;
            (a = console).warn.apply(a, arguments);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.info = d, c.log = e, c.warn = f, c.error = g;
        var h = a("../config/settings"), i = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(h);
    }, {
        "../config/settings": 33
    } ],
    88: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.Endpoint = void 0;
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = a("../browserapi/localstorage"), h = d(g), i = a("../browserapi/detectbrowser"), j = d(i), k = a("../utility/timestamps"), l = d(k), m = a("../utility/hash"), n = d(m), o = function() {
            function a() {
                e(this, a), this.id = null, this.appversion = null, this.magicKey = Math.floor(4294967296 * Math.random()), 
                this.browserName = null, this.browserVersion = null, this.osName = null, this.osVersion = null, 
                this.codeBase = null, this.userAgent = null, this.retrieveId();
            }
            return f(a, [ {
                key: "setup",
                value: function() {
                    var a = j.detect();
                    this.browserName = a.browserName, this.browserVersion = a.browserVersion, this.osName = a.os, 
                    this.osVersion = a.osVersion, this.codeBase = a.codeBase, this.userAgent = a.userAgent;
                }
            }, {
                key: "retrieveId",
                value: function() {
                    var a = this, b = h.get("endpointID");
                    if (null === b) {
                        var c = l.getCurrent(), d = Math.random() * c;
                        n.generateSHA256(d.toString(), function(b) {
                            a.id = b, h.store("endpointID", b);
                        });
                    } else this.id = b;
                }
            }, {
                key: "getId",
                value: function() {
                    return this.id;
                }
            }, {
                key: "getAppVersion",
                value: function() {
                    return this.appversion;
                }
            }, {
                key: "setAppVersion",
                value: function(a) {
                    this.appversion = a;
                }
            }, {
                key: "getMagicKey",
                value: function() {
                    return this.magicKey;
                }
            }, {
                key: "getBrowserName",
                value: function() {
                    return this.browserName;
                }
            }, {
                key: "getBrowserVersion",
                value: function() {
                    return this.browserVersion;
                }
            }, {
                key: "getOsName",
                value: function() {
                    return this.osName;
                }
            }, {
                key: "getOsVersion",
                value: function() {
                    return this.osVersion;
                }
            }, {
                key: "getCodeBase",
                value: function() {
                    return this.codeBase;
                }
            }, {
                key: "getUserAgent",
                value: function() {
                    return this.userAgent;
                }
            }, {
                key: "serialize",
                value: function() {
                    return {
                        type: "browser",
                        buildName: this.browserName,
                        buildVersion: this.browserVersion,
                        appVersion: this.appversion,
                        os: this.osName,
                        osVersion: this.osVersion,
                        userAgent: this.userAgent
                    };
                }
            } ]), a;
        }();
        c.Endpoint = o;
    }, {
        "../browserapi/detectbrowser": 17,
        "../browserapi/localstorage": 19,
        "../utility/hash": 91,
        "../utility/timestamps": 98
    } ],
    89: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.EventMessage = void 0;
        var f = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {
            return typeof a;
        } : function(a) {
            return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;
        }, g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = a("../config/constants"), i = d(h), j = a("../config/settings"), k = d(j), l = a("./registry"), m = a("./csiologger"), n = d(m), o = function() {
            function a(b, c, d, f) {
                e(this, a), this.eventType = b, this.customEntries = d, this.pcHandler = f, this.auth = l.Registry.getAuthenticator(), 
                this.clocksync = l.Registry.getClockSync(), this.timestamp = this.clocksync.getSynchronizedTimestamp(), 
                this.conferenceId = c, this.clockUnSynced = !this.clocksync.isCompleted();
            }
            return g(a, [ {
                key: "updateConferenceId",
                value: function(a) {
                    n.log("updating conferenceId to ", this.eventType, this.conferenceId, a), this.conferenceId = a;
                }
            }, {
                key: "toJson",
                value: function() {
                    if (!this.canBeSent()) return null;
                    var a = this.getCommonHeader();
                    return Object.assign(a, this.customEntries), this.eventType === i.internalFabricEvent.userJoined && delete a.connectionID, 
                    a;
                }
            }, {
                key: "getCallback",
                value: function() {
                    return this.pcHandler ? this.pcHandler.getCallback() : null;
                }
            }, {
                key: "canBeSent",
                value: function() {
                    var a = void 0, b = i.tmpConferenceId;
                    if (this.conferenceId === b) return !1;
                    if (this.pcHandler && !this.pcHandler.getRemoteId()) return !1;
                    if (this.eventType !== i.precalltestEvents.results) {
                        var c = l.Registry.getConferenceManager().get(this.conferenceId);
                        if (!c) return !1;
                        a = c.getUcId();
                    }
                    return !!this.auth.getToken() && (this.auth.isTokenValid() ? !!(this.isPriority() || this.clocksync.isCompleted() && a) && !(this.eventType === i.internalFabricEvent.userAlive && !a) : (this.auth.reAuthenticate(), 
                    !1));
                }
            }, {
                key: "isCachable",
                value: function() {
                    return -1 === [ i.internalFabricEvent.userAlive ].indexOf(this.eventType);
                }
            }, {
                key: "isPriority",
                value: function() {
                    var a = !1;
                    return this.eventType !== i.internalFabricEvent.userJoined && this.eventType !== i.precalltestEvents.results && this.eventType !== i.internalFabricEvent.userAlive || (a = !0), 
                    a;
                }
            }, {
                key: "getConferenceId",
                value: function() {
                    return this.conferenceId;
                }
            }, {
                key: "getCommonHeader",
                value: function() {
                    var a = {
                        version: k.version,
                        callstatsVersion: k.version,
                        channel: this.decideChannel(),
                        timestamp: this.timestamp,
                        action: this.eventType,
                        eventType: this.eventType,
                        localID: encodeURIComponent(l.Registry.getCredentials().getUserId()),
                        timeShift: 0,
                        appID: l.Registry.getCredentials().getAppId(),
                        deviceID: l.Registry.getEndpoint().getId(),
                        token: this.auth.getToken(),
                        confID: encodeURIComponent(this.conferenceId)
                    };
                    this.clockUnSynced && (a.timestamp += this.clocksync.getOffset());
                    var b = l.Registry.getConferenceManager().get(this.conferenceId);
                    return a.ucID = b ? b.getUcId() : null, this.eventType !== i.callstatsChannels.userFeedback && this.eventType !== i.precalltestEvents.results && (this.pcHandler ? (a.remoteID = encodeURIComponent(this.pcHandler.getRemoteId()), 
                    a.connectionID = this.pcHandler.getPcHash()) : (a.remoteID = encodeURIComponent(l.Registry.getCredentials().getUserId()), 
                    a.connectionID = encodeURIComponent(l.Registry.getCredentials().getUserId()))), 
                    a;
                }
            }, {
                key: "decideChannel",
                value: function() {
                    if (this.eventType == i.callstatsChannels.sdpSubmission) return i.callstatsChannels.sdpSubmission;
                    if (this.eventType == i.callstatsChannels.userFeedback) return i.callstatsChannels.userFeedback;
                    if (this.eventType == i.callstatsChannels.processedStats) return i.callstatsChannels.processedStats;
                    for (var a in i.precalltestEvents) if (this.eventType == i.precalltestEvents[a]) return i.callstatsChannels.preCallTest;
                    return i.callstatsChannels.callstatsEvent;
                }
            } ], [ {
                key: "checkCustomEntries",
                value: function(a, b) {
                    if (!p[a]) return n.error("eventType not recognized:", a), !1;
                    var c = p[a];
                    for (var d in c) if (!b.hasOwnProperty(d) || f(b[d]) !== c[d]) return n.error("customEntries for", a, "should have", d, "of type", c[d]), 
                    !1;
                    return !0;
                }
            } ]), a;
        }(), p = {};
        p[i.internalFabricEvent.userJoined] = {
            endpointInfo: "object"
        }, p[i.internalFabricEvent.userLeft] = {}, p[i.internalFabricEvent.userAlive] = {}, 
        p[i.internalFabricEvent.userDetails] = {
            userName: "string"
        }, p[i.internalFabricEvent.connectedDeviceList] = {
            mediaDeviceList: "object"
        }, p[i.fabricEvent.activeDeviceList] = {
            mediaDeviceList: "object"
        }, p[i.fabricEvent.audioMute] = {}, p[i.fabricEvent.audioUnmute] = {}, p[i.fabricEvent.videoPause] = {}, 
        p[i.fabricEvent.videoResume] = {}, p[i.fabricEvent.screenShareStart] = {}, p[i.fabricEvent.screenShareStop] = {}, 
        p[i.internalFabricEvent.mediaPlaybackStart] = {
            ssrc: "string"
        }, p[i.internalFabricEvent.mediaPlaybackSuspended] = {
            ssrc: "string"
        }, p[i.internalFabricEvent.mediaPlaybackStalled] = {
            ssrc: "string"
        }, p[i.internalFabricEvent.oneWayMedia] = {
            mediaType: "string",
            ssrc: "string"
        }, p[i.internalFabricEvent.fabricSetup] = {
            localIceCandidates: "object",
            remoteIceCandidates: "object",
            iceCandidatePairs: "object"
        }, p[i.fabricEvent.fabricSetupFailed] = {
            failureDelay: "number",
            reason: "string",
            function: "string",
            endpoint: "object"
        }, p[i.internalFabricEvent.fabricStateChange] = {
            changedState: "string",
            prevState: "string",
            newState: "string"
        }, p[i.internalFabricEvent.fabricDropped] = {
            prevIceConnectionState: "string",
            currIceConnectionState: "string",
            currIceCandidatePair: "object",
            failureDelay: "number"
        }, p[i.internalFabricEvent.iceConnectionDisruptionStart] = {
            prevIceConnectionState: "string",
            currIceConnectionState: "string",
            prevIceConnectionStateTs: "number",
            currIceCandidatePair: "object"
        }, p[i.internalFabricEvent.iceConnectionDisruptionEnd] = {
            prevIceConnectionState: "string",
            currIceConnectionState: "string",
            disruptionDelay: "number"
        }, p[i.internalFabricEvent.iceDisruptionStart] = {
            prevIceConnectionState: "string",
            currIceConnectionState: "string",
            prevIceConnectionStateTs: "number",
            currIceCandidatePair: "object"
        }, p[i.internalFabricEvent.iceDisruptionEnd] = {
            prevIceConnectionState: "string",
            currIceConnectionState: "string",
            prevIceCandidatePair: "object"
        }, p[i.internalFabricEvent.iceFailed] = {
            localIceCandidates: "object",
            prevIceConnectionState: "string",
            currIceConnectionState: "string",
            currIceCandidatePair: "object",
            failureDelay: "number"
        }, p[i.internalFabricEvent.iceAborted] = {
            prevIceConnectionState: "string",
            currIceConnectionState: "string"
        }, p[i.internalFabricEvent.iceRestarted] = {
            prevIceConnectionState: "string",
            currIceConnectionState: "string",
            prevIceCandidatePair: "object"
        }, p[i.internalFabricEvent.fabricTransportSwitch] = {
            prevIceCandidatePair: "object",
            currIceCandidatePair: "object"
        }, p[i.internalFabricEvent.iceTerminated] = {
            prevIceConnectionState: "string",
            currIceConnectionState: "string"
        }, p[i.fabricEvent.fabricTerminated] = {}, p[i.fabricEvent.fabricHold] = {}, p[i.fabricEvent.fabricResume] = {}, 
        p[i.callstatsChannels.sdpSubmission] = {
            localSDP: "string",
            remoteSDP: "string"
        }, p[i.internalFabricEvent.ssrcMap] = {
            ssrcData: "object"
        }, p[i.callstatsChannels.userFeedback] = {
            feedback: "object"
        }, p[i.internalFabricEvent.sendingThroughputObservations] = {
            ssrc: "string",
            maxsendingKBitrate: "number",
            timeToMaxSendingKBitrate: "number",
            stablesendingKBitrate: "number",
            timeToStableSendingKBitrate: "number"
        }, p[i.fabricEvent.dominantSpeaker] = {}, p[i.fabricEvent.applicationErrorLog] = {
            message: "string",
            messageType: "string"
        }, p[i.callstatsChannels.processedStats] = {
            stats: "object"
        }, p[i.callstatsChannels.senderConfiguration] = {
            rtc_rtp_parameters: "object"
        }, p[i.internalFabricEvent.limitationObservations] = {
            reason: "string"
        }, p[i.qualityDisruptionTypes.qpchange] = {
            reason: "string"
        }, p[i.precalltestEvents.results] = {
            results: "object"
        }, p[i.precalltestEvents.associate] = {
            ids: "object"
        }, c.EventMessage = o;
    }, {
        "../config/constants": 32,
        "../config/settings": 33,
        "./csiologger": 87,
        "./registry": 94
    } ],
    90: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.EventMessageBuilder = void 0;
        var f = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {
            return typeof a;
        } : function(a) {
            return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;
        }, g = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), h = a("./eventmessage"), i = a("../config/constants"), j = d(i), k = a("./registry"), l = a("./csiologger"), m = d(l), n = function() {
            function a() {
                e(this, a), this.transmissionmanager = k.Registry.getTransmissionManager();
            }
            return g(a, [ {
                key: "make",
                value: function(a, b, c) {
                    var d = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : {};
                    if ("string" != typeof a || null === d || "object" !== (void 0 === d ? "undefined" : f(d))) return m.error("failed typeof checks:", a, void 0 === a ? "undefined" : f(a), void 0 === d ? "undefined" : f(d), d), 
                    k.Registry.getGenericEventHandler().sendEvent(j.logEvents.error, {
                        msg: "failed typeof checks:" + a + ":" + (void 0 === d ? "undefined" : f(d))
                    }), !1;
                    if (null === b && a !== j.precalltestEvents.results) return m.error("failed conferenceId checks:", a, b), 
                    k.Registry.getGenericEventHandler().sendEvent(j.logEvents.error, {
                        msg: "failed conferenceId checks:" + a
                    }), !1;
                    if (!c && a !== j.callstatsChannels.userFeedback && a !== j.fabricEvent.applicationErrorLog && a !== j.fabricEvent.fabricSetupFailed && a !== j.precalltestEvents.results) return m.error("peerconnection cannot be null", a), 
                    k.Registry.getGenericEventHandler().sendEvent(j.logEvents.error, {
                        msg: "peerconnection cannot be null" + a
                    }), !1;
                    if (!h.EventMessage.checkCustomEntries(a, d)) return m.error("failed checks:", a, d), 
                    k.Registry.getGenericEventHandler().sendEvent(j.logEvents.error, {
                        msg: "failed customEntries checks:" + a
                    }), !1;
                    var e = void 0;
                    if (b) {
                        var g = k.Registry.getConferenceManager().get(b);
                        g && c && (e = g.getPeerConnectionManager().getPcHandler(c));
                    }
                    var i = new h.EventMessage(a, b, d, e);
                    return this.transmissionmanager.send(i), !0;
                }
            } ]), a;
        }();
        c.EventMessageBuilder = n;
    }, {
        "../config/constants": 32,
        "./csiologger": 87,
        "./eventmessage": 89,
        "./registry": 94
    } ],
    91: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            var c = {
                name: "SHA-256"
            };
            if (window.crypto) {
                var d = window.crypto.subtle || window.crypto.webkitSubtle;
                if (!d) return void e(a, b);
                d.digest(c, f(a)).then(function(a) {
                    b(g(a));
                }).catch(function() {
                    e(a, b);
                });
            } else if (window.msCrypto) {
                if (!window.msCrypto.subtle) return void e(a, b);
                var h = window.msCrypto.subtle.digest(c, f(a));
                h.oncomplete = function(a) {
                    a.target && b(g(a.target.result));
                }, h.onerror = function() {
                    e(a, b);
                };
            } else e(a, b);
        }
        function e(a) {
            var b = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : null, c = 0;
            if (!a) return c;
            for (var d = 0, e = a.length; d < e; d++) {
                c = (c << 5) - c + a.charCodeAt(d), c |= 0;
            }
            return b && b(c + ""), c + "";
        }
        function f(a) {
            for (var b = [], c = 0; c < a.length; ++c) {
                var d = a.charCodeAt(c);
                d < 128 ? b[b.length] = d : d > 127 && d < 2048 ? (b[b.length] = d >> 6 | 192, b[b.length] = 63 & d | 128) : (b[b.length] = d >> 12 | 224, 
                b[b.length] = d >> 6 & 63 | 128, b[b.length] = 63 & d | 128);
            }
            return new Uint8Array(b).buffer;
        }
        function g(a) {
            for (var b = new DataView(a), c = "", d = void 0, e = 0; e < b.byteLength; e++) d = b.getUint8(e).toString(16), 
            d.length < 2 && (d = "0" + d), c += d;
            return c;
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.generateSHA256 = d, c.generateHash = e;
    }, {} ],
    92: [ function(a, b, c) {
        "use strict";
        function d(a) {
            return !!/^[\],:{}\s]*$/.test(a.replace(/\\["\\\/bfnrtu]/g, "@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g, "]").replace(/(?:^|:|,)(?:\s*\[)+/g, ""));
        }
        function e(a) {
            var b = null;
            return null === a ? b : (d(a) && (b = JSON.parse(a)), b);
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.isValid = d, c.parse = e;
    }, {} ],
    93: [ function(a, b, c) {
        "use strict";
        function d(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }
        function e() {
            window && window.addEventListener && window.addEventListener("error", function(a) {
                var b = f.Registry.getGenericEventHandler();
                if (a && a.filename && a.filename.indexOf("callstats") > -1) {
                    for (var c = !1, d = {
                        fileName: a.filename,
                        line: a.lineno,
                        col: a.colno,
                        jsVersion: h.version,
                        eventType: "error",
                        message: a.message,
                        pageURL: window.location.href
                    }, e = f.Registry.getConferenceManager().getConferenceIds(), g = 0; g < e.length; g++) d.conferenceID = e[g], 
                    b.sendEvent(j.logEvents.error, d), c = !0;
                    c || b.sendEvent(j.logEvents.error, d);
                }
            });
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.setErrorEventListener = e;
        var f = a("./registry"), g = a("../config/settings"), h = d(g), i = a("../config/constants"), j = d(i);
    }, {
        "../config/constants": 32,
        "../config/settings": 33,
        "./registry": 94
    } ],
    94: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.Registry = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("../services/clocksync"), g = a("../services/configservice/configservicewrapper"), h = a("../services/authenticator"), i = a("../services/backendlog"), j = a("../services/transmissionmanager"), k = a("./eventmessagebuilder"), l = a("../conference/conferencemanager"), m = a("../utility/credentials"), n = a("../statspipeline/statsadapter"), o = a("../statspipeline/statsparser"), p = a("../statspipeline/statsmonitor"), q = a("../statspipeline/statstransmitter"), r = a("../statspipeline/statsassembler"), s = a("../utility/endpoint"), t = a("../browserapi/battery"), u = a("precalltest"), v = a("../statspipeline/wifistatsexecutor"), w = a("./callbacks"), x = a("../statspipeline/statscallbackbuilder"), y = a("../services/connectionmanager"), z = null, A = null, B = null, C = null, D = null, E = null, F = null, G = null, H = null, I = null, J = null, K = null, L = null, M = null, N = null, O = null, P = null, Q = null, R = null, S = null, T = function() {
            function a() {
                d(this, a);
            }
            return e(a, null, [ {
                key: "getConferenceManager",
                value: function() {
                    return O || (O = new l.ConferenceManager()), O;
                }
            }, {
                key: "getStatsCallbackBuilder",
                value: function() {
                    return R || (R = new x.StatsCallbackBuilder()), R;
                }
            }, {
                key: "getClockSync",
                value: function() {
                    return A || (A = new f.ClockSync()), A;
                }
            }, {
                key: "getWifiStatsExecutor",
                value: function() {
                    return P || (P = new v.WifiStatsExecutor()), P;
                }
            }, {
                key: "getAuthenticator",
                value: function() {
                    return B || (B = new h.Authenticator()), B;
                }
            }, {
                key: "getConfigServiceWrapper",
                value: function() {
                    return C || (C = new g.ConfigServiceWrapper()), C;
                }
            }, {
                key: "getGenericEventHandler",
                value: function() {
                    return D || (D = new i.GenericEventHandler(), D.enable()), D;
                }
            }, {
                key: "getConnectionManager",
                value: function() {
                    return S || (S = new y.ConnectionManager()), S;
                }
            }, {
                key: "getTransmissionManager",
                value: function() {
                    return E || (E = new j.TransmissionManager()), E;
                }
            }, {
                key: "getEventMessageBuilder",
                value: function() {
                    return F || (F = new k.EventMessageBuilder()), F;
                }
            }, {
                key: "getCredentials",
                value: function() {
                    return G || (G = new m.Credentials()), G;
                }
            }, {
                key: "getEndpoint",
                value: function() {
                    return H || (H = new s.Endpoint()), H;
                }
            }, {
                key: "getStatsAdapter",
                value: function() {
                    if (!I) {
                        var b = a.getEndpoint().getCodeBase(), c = a.getEndpoint().getBrowserName();
                        I = new n.StatsAdapter(b, c);
                    }
                    return I;
                }
            }, {
                key: "getPreCallTest",
                value: function() {
                    return z || (z = new u.PreCallTest()), z;
                }
            }, {
                key: "getStatsParser",
                value: function() {
                    return J || (J = new o.StatsParser()), J;
                }
            }, {
                key: "getStatsMonitor",
                value: function() {
                    if (!K) {
                        var b = a.getEndpoint().getCodeBase();
                        K = new p.StatsMonitor(b);
                    }
                    return K;
                }
            }, {
                key: "getStatsTransmitter",
                value: function() {
                    return L || (L = new q.StatsTransmitter()), L;
                }
            }, {
                key: "getStatsAssembler",
                value: function() {
                    return M || (M = new r.StatsAssembler()), M;
                }
            }, {
                key: "getBattery",
                value: function() {
                    return N || (N = new t.Battery()), N;
                }
            }, {
                key: "getCallbacks",
                value: function() {
                    return Q || (Q = new w.Callbacks()), Q;
                }
            } ]), a;
        }();
        c.Registry = T;
    }, {
        "../browserapi/battery": 16,
        "../conference/conferencemanager": 30,
        "../services/authenticator": 43,
        "../services/backendlog": 44,
        "../services/clocksync": 45,
        "../services/configservice/configservicewrapper": 49,
        "../services/connectionmanager": 50,
        "../services/transmissionmanager": 55,
        "../statspipeline/statsadapter": 68,
        "../statspipeline/statsassembler": 69,
        "../statspipeline/statscallbackbuilder": 70,
        "../statspipeline/statsmonitor": 71,
        "../statspipeline/statsparser": 72,
        "../statspipeline/statstransmitter": 73,
        "../statspipeline/wifistatsexecutor": 83,
        "../utility/credentials": 86,
        "../utility/endpoint": 88,
        "./callbacks": 85,
        "./eventmessagebuilder": 90,
        precalltest: 2
    } ],
    95: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        function e() {
            return null === i && (i = new j()), i;
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }();
        c.getRTTRegistry = e;
        var g = a("../statspipeline/validator"), h = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(g), i = null, j = function() {
            function a() {
                d(this, a), this.rtts = new Map(), this.transportRTT = null;
            }
            return f(a, [ {
                key: "update",
                value: function(a) {
                    var b = this;
                    a.getStats(function(a) {
                        for (var c = [], d = a.result(), e = 0; e < d.length; ++e) {
                            var f = d[e];
                            if ("googCandidatePair" !== f.type) {
                                if ("ssrc" === f.type) {
                                    var g = f.stat("googRtt"), i = f.stat("ssrc");
                                    g && b.rtts.set(h.checkForNan(parseInt(i, 10)), h.checkForNan(parseInt(g, 10)));
                                }
                            } else {
                                var j = f.stat("googRtt");
                                c.push(j);
                            }
                        }
                        b.transportRTT = Math.max.apply(Math, c);
                    });
                }
            }, {
                key: "getTransportRTT",
                value: function() {
                    return this.transportRTT;
                }
            }, {
                key: "getRTT",
                value: function(a) {
                    var b = h.checkForNan(parseInt(a, 10));
                    return this.rtts.has(b) ? this.rtts.get(b) : null;
                }
            } ]), a;
        }();
    }, {
        "../statspipeline/validator": 82
    } ],
    96: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = function() {
            function a(b, c, e) {
                d(this, a), this.max = b, this.midpoint = c, this.stepness = e, this.actualStep = 0, 
                this.reset();
            }
            return e(a, [ {
                key: "reset",
                value: function() {
                    this.actualStep = 0;
                }
            }, {
                key: "setMidpoint",
                value: function(a) {
                    this.midpoint = a;
                }
            }, {
                key: "setMax",
                value: function(a) {
                    this.max = a;
                }
            }, {
                key: "setStepness",
                value: function(a) {
                    this.stepness = a;
                }
            }, {
                key: "increaseActualStep",
                value: function(a) {
                    this.actualStep += a;
                }
            }, {
                key: "getActual",
                value: function() {
                    var a = arguments.length > 0 && void 0 !== arguments[0] ? arguments[0] : 1;
                    return this.actualStep += a, this.max / (1 + Math.exp(-1 * this.stepness * (this.actualStep - this.midpoint)));
                }
            } ]), a;
        }();
        c.Sigmoid = f;
    }, {} ],
    97: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.TimeoutProcess = void 0;
        var e = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), f = a("./csiologger"), g = function(a) {
            if (a && a.__esModule) return a;
            var b = {};
            if (null != a) for (var c in a) Object.prototype.hasOwnProperty.call(a, c) && (b[c] = a[c]);
            return b.default = a, b;
        }(f), h = function() {
            function a(b) {
                d(this, a), this.interval = b, this.timerId = null, this.callback = function() {
                    g.warn("no callback function set", this);
                };
            }
            return e(a, [ {
                key: "setCallback",
                value: function(a) {
                    this.callback = a;
                }
            }, {
                key: "start",
                value: function() {
                    var a = this;
                    this.timerId = setInterval(function() {
                        a.callback();
                    }, this.interval);
                }
            }, {
                key: "stop",
                value: function() {
                    clearInterval(this.timerId), this.timerId = null;
                }
            }, {
                key: "isStarted",
                value: function() {
                    return null !== this.timerId;
                }
            } ]), a;
        }();
        c.TimeoutProcess = h;
    }, {
        "./csiologger": 87
    } ],
    98: [ function(a, b, c) {
        "use strict";
        function d() {
            return window && window.performance && window.performance.now && window.performance.timing && window.performance.timing.navigationStart ? window.performance.now() + window.performance.timing.navigationStart : Date.now();
        }
        function e() {
            return window && window.performance && window.performance.now ? window.performance.now() : null;
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.getCurrent = d, c.getSinceOrigin = e;
    }, {} ],
    99: [ function(a, b, c) {
        "use strict";
        function d(a, b) {
            if (!(a instanceof b)) throw new TypeError("Cannot call a class as a function");
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        });
        var e = "function" == typeof Symbol && "symbol" == typeof Symbol.iterator ? function(a) {
            return typeof a;
        } : function(a) {
            return a && "function" == typeof Symbol && a.constructor === Symbol && a !== Symbol.prototype ? "symbol" : typeof a;
        }, f = function() {
            function a(a, b) {
                for (var c = 0; c < b.length; c++) {
                    var d = b[c];
                    d.enumerable = d.enumerable || !1, d.configurable = !0, "value" in d && (d.writable = !0), 
                    Object.defineProperty(a, d.key, d);
                }
            }
            return function(b, c, d) {
                return c && a(b.prototype, c), d && a(b, d), b;
            };
        }(), g = function() {
            function a(b) {
                d(this, a), this.base = b;
                for (var c = arguments.length, e = Array(c > 1 ? c - 1 : 0), f = 1; f < c; f++) e[f - 1] = arguments[f];
                this.appendixes = e;
            }
            return f(a, null, [ {
                key: "concat",
                value: function(a, b) {
                    if (!b) return a;
                    if (!a) return b;
                    var c = "/" === a.substr(a.length - 1), d = "/" === b.substring(0, 1);
                    return c || d ? c && d ? a + b.substring(1) : a + b : a + "/" + b;
                }
            } ]), f(a, [ {
                key: "append",
                value: function(a) {
                    this.appendixes.push(a);
                }
            }, {
                key: "toString",
                value: function() {
                    var b = this.getString(this.base), c = this;
                    return this.appendixes.forEach(function(d) {
                        if (null !== d && void 0 !== d) {
                            var e = c.getString(d);
                            b = a.concat(b, e);
                        }
                    }), b;
                }
            }, {
                key: "getString",
                value: function(a) {
                    switch (void 0 === a ? "undefined" : e(a)) {
                      case "function":
                        return this.getString(a());

                      case "number":
                        return a + "";

                      case "string":
                      default:
                        return a;
                    }
                }
            } ]), a;
        }();
        c.Url = g;
    }, {} ],
    100: [ function(a, b, c) {
        "use strict";
        function d(a) {
            var b = [];
            if (!a) return b;
            for (var c = 0; c < a.length; c++) {
                var d = {};
                d.mediaDeviceID = a[c].deviceId, d.groupID = a[c].groupId, d.kind = a[c].kind, d.label = a[c].label, 
                b.push(d);
            }
            return b;
        }
        function e() {
            Number.isInteger || (Number.isInteger = Number.isInteger || function(a) {
                return "number" == typeof a && isFinite(a) && Math.floor(a) === a;
            });
        }
        function f() {
            "function" != typeof Object.assign && Object.defineProperty(Object, "assign", {
                value: function(a, b) {
                    if (null == a) throw new TypeError("Cannot convert undefined or null to object");
                    for (var c = Object(a), d = 1; d < arguments.length; d++) {
                        var e = arguments[d];
                        if (null != e) for (var f in e) Object.prototype.hasOwnProperty.call(e, f) && (c[f] = e[f]);
                    }
                    return c;
                },
                writable: !0,
                configurable: !0
            });
        }
        Object.defineProperty(c, "__esModule", {
            value: !0
        }), c.normalizeMediaDeviceList = d, c.isIntegerPollyfill = e, c.assignPollyfill = f;
    }, {} ]
}, {}, [ 21 ]);